{"version":3,"file":"2.Ba3Hf8tR.js","sources":["../../../../../../../../../node_modules/.pnpm/svelte@5.43.2/node_modules/svelte/src/internal/client/dom/blocks/each.js","../../../../../../../../../node_modules/.pnpm/svelte@5.43.2/node_modules/svelte/src/internal/shared/attributes.js","../../../../../../../../../node_modules/.pnpm/svelte@5.43.2/node_modules/svelte/src/internal/client/dom/elements/class.js","../../../../../../../../../node_modules/.pnpm/svelte@5.43.2/node_modules/svelte/src/internal/client/dom/elements/style.js","../../../../../../../../../node_modules/.pnpm/svelte@5.43.2/node_modules/svelte/src/internal/client/dom/elements/bindings/select.js","../../../../../../../../../node_modules/.pnpm/svelte@5.43.2/node_modules/svelte/src/internal/client/dom/elements/attributes.js","../../../../../../../../../node_modules/.pnpm/svelte@5.43.2/node_modules/svelte/src/internal/client/dom/elements/bindings/input.js","../../../../../../src/lib/audio/context.js","../../../../../../src/lib/audio/synthesis/piano-voice.js","../../../../../../src/lib/audio/effects/saturation.js","../../../../../../src/lib/audio/effects/compression.js","../../../../../../src/lib/audio/effects/reverb.js","../../../../../../src/lib/stores/audio-state.svelte.js","../../../../../../src/lib/components/piano/PianoKeyboard.svelte","../../../../../../../../../shared/ui-components/controls/VintageKnob.svelte","../../../../../../src/lib/components/controls/AGEControl.svelte","../../../../../../src/lib/components/controls/RoomMicsControl.svelte","../../../../../../src/lib/components/controls/TubeSaturationControl.svelte","../../../../../../../../../shared/ui-components/visualizers/SpectrumAnalyzer.svelte","../../../../../../../../../shared/ui-components/visualizers/EnvelopeGraph.svelte","../../../../../../../../../shared/ui-components/visualizers/VUMeter.svelte","../../../../../../src/lib/components/controls/ControlPanel.svelte","../../../../../../../../../shared/audio-core/music-theory/scales.js","../../../../../../../../../shared/audio-core/music-theory/chords.js","../../../../../../../../../shared/audio-core/music-theory/midi.js","../../../../../../../../../shared/audio-core/music-theory/progressions.js","../../../../../../src/lib/components/chord-generator/ChordSelector.svelte","../../../../../../src/lib/components/chord-generator/ChordDisplay.svelte","../../../../../../src/lib/components/chord-generator/ProgressionBuilder.svelte","../../../../../../src/lib/components/chord-generator/ChordGenerator.svelte","../../../../../../src/lib/components/Layout.svelte","../../../../../../src/routes/+page.svelte"],"sourcesContent":["/** @import { EachItem, EachState, Effect, MaybeSource, Source, TemplateNode, TransitionManager, Value } from '#client' */\n/** @import { Batch } from '../../reactivity/batch.js'; */\nimport {\n\tEACH_INDEX_REACTIVE,\n\tEACH_IS_ANIMATED,\n\tEACH_IS_CONTROLLED,\n\tEACH_ITEM_IMMUTABLE,\n\tEACH_ITEM_REACTIVE,\n\tHYDRATION_END,\n\tHYDRATION_START_ELSE\n} from '../../../../constants.js';\nimport {\n\thydrate_next,\n\thydrate_node,\n\thydrating,\n\tread_hydration_instruction,\n\tskip_nodes,\n\tset_hydrate_node,\n\tset_hydrating\n} from '../hydration.js';\nimport {\n\tclear_text_content,\n\tcreate_text,\n\tget_first_child,\n\tget_next_sibling,\n\tshould_defer_append\n} from '../operations.js';\nimport {\n\tblock,\n\tbranch,\n\tdestroy_effect,\n\trun_out_transitions,\n\tpause_children,\n\tpause_effect,\n\tresume_effect\n} from '../../reactivity/effects.js';\nimport { source, mutable_source, internal_set } from '../../reactivity/sources.js';\nimport { array_from, is_array } from '../../../shared/utils.js';\nimport { COMMENT_NODE, INERT } from '#client/constants';\nimport { queue_micro_task } from '../task.js';\nimport { active_effect, get } from '../../runtime.js';\nimport { DEV } from 'esm-env';\nimport { derived_safe_equal } from '../../reactivity/deriveds.js';\nimport { current_batch } from '../../reactivity/batch.js';\n\n/**\n * The row of a keyed each block that is currently updating. We track this\n * so that `animate:` directives have something to attach themselves to\n * @type {EachItem | null}\n */\nexport let current_each_item = null;\n\n/** @param {EachItem | null} item */\nexport function set_current_each_item(item) {\n\tcurrent_each_item = item;\n}\n\n/**\n * @param {any} _\n * @param {number} i\n */\nexport function index(_, i) {\n\treturn i;\n}\n\n/**\n * Pause multiple effects simultaneously, and coordinate their\n * subsequent destruction. Used in each blocks\n * @param {EachState} state\n * @param {EachItem[]} items\n * @param {null | Node} controlled_anchor\n */\nfunction pause_effects(state, items, controlled_anchor) {\n\tvar items_map = state.items;\n\n\t/** @type {TransitionManager[]} */\n\tvar transitions = [];\n\tvar length = items.length;\n\n\tfor (var i = 0; i < length; i++) {\n\t\tpause_children(items[i].e, transitions, true);\n\t}\n\n\tvar is_controlled = length > 0 && transitions.length === 0 && controlled_anchor !== null;\n\t// If we have a controlled anchor, it means that the each block is inside a single\n\t// DOM element, so we can apply a fast-path for clearing the contents of the element.\n\tif (is_controlled) {\n\t\tvar parent_node = /** @type {Element} */ (\n\t\t\t/** @type {Element} */ (controlled_anchor).parentNode\n\t\t);\n\t\tclear_text_content(parent_node);\n\t\tparent_node.append(/** @type {Element} */ (controlled_anchor));\n\t\titems_map.clear();\n\t\tlink(state, items[0].prev, items[length - 1].next);\n\t}\n\n\trun_out_transitions(transitions, () => {\n\t\tfor (var i = 0; i < length; i++) {\n\t\t\tvar item = items[i];\n\t\t\tif (!is_controlled) {\n\t\t\t\titems_map.delete(item.k);\n\t\t\t\tlink(state, item.prev, item.next);\n\t\t\t}\n\t\t\tdestroy_effect(item.e, !is_controlled);\n\t\t}\n\t});\n}\n\n/**\n * @template V\n * @param {Element | Comment} node The next sibling node, or the parent node if this is a 'controlled' block\n * @param {number} flags\n * @param {() => V[]} get_collection\n * @param {(value: V, index: number) => any} get_key\n * @param {(anchor: Node, item: MaybeSource<V>, index: MaybeSource<number>) => void} render_fn\n * @param {null | ((anchor: Node) => void)} fallback_fn\n * @returns {void}\n */\nexport function each(node, flags, get_collection, get_key, render_fn, fallback_fn = null) {\n\tvar anchor = node;\n\n\t/** @type {EachState} */\n\tvar state = { flags, items: new Map(), first: null };\n\n\tvar is_controlled = (flags & EACH_IS_CONTROLLED) !== 0;\n\n\tif (is_controlled) {\n\t\tvar parent_node = /** @type {Element} */ (node);\n\n\t\tanchor = hydrating\n\t\t\t? set_hydrate_node(/** @type {Comment | Text} */ (get_first_child(parent_node)))\n\t\t\t: parent_node.appendChild(create_text());\n\t}\n\n\tif (hydrating) {\n\t\thydrate_next();\n\t}\n\n\t/** @type {Effect | null} */\n\tvar fallback = null;\n\n\tvar was_empty = false;\n\n\t/** @type {Map<any, EachItem>} */\n\tvar offscreen_items = new Map();\n\n\t// TODO: ideally we could use derived for runes mode but because of the ability\n\t// to use a store which can be mutated, we can't do that here as mutating a store\n\t// will still result in the collection array being the same from the store\n\tvar each_array = derived_safe_equal(() => {\n\t\tvar collection = get_collection();\n\n\t\treturn is_array(collection) ? collection : collection == null ? [] : array_from(collection);\n\t});\n\n\t/** @type {V[]} */\n\tvar array;\n\n\t/** @type {Effect} */\n\tvar each_effect;\n\n\tfunction commit() {\n\t\treconcile(\n\t\t\teach_effect,\n\t\t\tarray,\n\t\t\tstate,\n\t\t\toffscreen_items,\n\t\t\tanchor,\n\t\t\trender_fn,\n\t\t\tflags,\n\t\t\tget_key,\n\t\t\tget_collection\n\t\t);\n\n\t\tif (fallback_fn !== null) {\n\t\t\tif (array.length === 0) {\n\t\t\t\tif (fallback) {\n\t\t\t\t\tresume_effect(fallback);\n\t\t\t\t} else {\n\t\t\t\t\tfallback = branch(() => fallback_fn(anchor));\n\t\t\t\t}\n\t\t\t} else if (fallback !== null) {\n\t\t\t\tpause_effect(fallback, () => {\n\t\t\t\t\tfallback = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tblock(() => {\n\t\t// store a reference to the effect so that we can update the start/end nodes in reconciliation\n\t\teach_effect ??= /** @type {Effect} */ (active_effect);\n\n\t\tarray = /** @type {V[]} */ (get(each_array));\n\t\tvar length = array.length;\n\n\t\tif (was_empty && length === 0) {\n\t\t\t// ignore updates if the array is empty,\n\t\t\t// and it already was empty on previous run\n\t\t\treturn;\n\t\t}\n\t\twas_empty = length === 0;\n\n\t\t/** `true` if there was a hydration mismatch. Needs to be a `let` or else it isn't treeshaken out */\n\t\tlet mismatch = false;\n\n\t\tif (hydrating) {\n\t\t\tvar is_else = read_hydration_instruction(anchor) === HYDRATION_START_ELSE;\n\n\t\t\tif (is_else !== (length === 0)) {\n\t\t\t\t// hydration mismatch â€” remove the server-rendered DOM and start over\n\t\t\t\tanchor = skip_nodes();\n\n\t\t\t\tset_hydrate_node(anchor);\n\t\t\t\tset_hydrating(false);\n\t\t\t\tmismatch = true;\n\t\t\t}\n\t\t}\n\n\t\t// this is separate to the previous block because `hydrating` might change\n\t\tif (hydrating) {\n\t\t\t/** @type {EachItem | null} */\n\t\t\tvar prev = null;\n\n\t\t\t/** @type {EachItem} */\n\t\t\tvar item;\n\n\t\t\tfor (var i = 0; i < length; i++) {\n\t\t\t\tif (\n\t\t\t\t\thydrate_node.nodeType === COMMENT_NODE &&\n\t\t\t\t\t/** @type {Comment} */ (hydrate_node).data === HYDRATION_END\n\t\t\t\t) {\n\t\t\t\t\t// The server rendered fewer items than expected,\n\t\t\t\t\t// so break out and continue appending non-hydrated items\n\t\t\t\t\tanchor = /** @type {Comment} */ (hydrate_node);\n\t\t\t\t\tmismatch = true;\n\t\t\t\t\tset_hydrating(false);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvar value = array[i];\n\t\t\t\tvar key = get_key(value, i);\n\t\t\t\titem = create_item(\n\t\t\t\t\thydrate_node,\n\t\t\t\t\tstate,\n\t\t\t\t\tprev,\n\t\t\t\t\tnull,\n\t\t\t\t\tvalue,\n\t\t\t\t\tkey,\n\t\t\t\t\ti,\n\t\t\t\t\trender_fn,\n\t\t\t\t\tflags,\n\t\t\t\t\tget_collection\n\t\t\t\t);\n\t\t\t\tstate.items.set(key, item);\n\n\t\t\t\tprev = item;\n\t\t\t}\n\n\t\t\t// remove excess nodes\n\t\t\tif (length > 0) {\n\t\t\t\tset_hydrate_node(skip_nodes());\n\t\t\t}\n\t\t}\n\n\t\tif (hydrating) {\n\t\t\tif (length === 0 && fallback_fn) {\n\t\t\t\tfallback = branch(() => fallback_fn(anchor));\n\t\t\t}\n\t\t} else {\n\t\t\tif (should_defer_append()) {\n\t\t\t\tvar keys = new Set();\n\t\t\t\tvar batch = /** @type {Batch} */ (current_batch);\n\n\t\t\t\tfor (i = 0; i < length; i += 1) {\n\t\t\t\t\tvalue = array[i];\n\t\t\t\t\tkey = get_key(value, i);\n\n\t\t\t\t\tvar existing = state.items.get(key) ?? offscreen_items.get(key);\n\n\t\t\t\t\tif (existing) {\n\t\t\t\t\t\t// update before reconciliation, to trigger any async updates\n\t\t\t\t\t\tif ((flags & (EACH_ITEM_REACTIVE | EACH_INDEX_REACTIVE)) !== 0) {\n\t\t\t\t\t\t\tupdate_item(existing, value, i, flags);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem = create_item(\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\trender_fn,\n\t\t\t\t\t\t\tflags,\n\t\t\t\t\t\t\tget_collection,\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\toffscreen_items.set(key, item);\n\t\t\t\t\t}\n\n\t\t\t\t\tkeys.add(key);\n\t\t\t\t}\n\n\t\t\t\tfor (const [key, item] of state.items) {\n\t\t\t\t\tif (!keys.has(key)) {\n\t\t\t\t\t\tbatch.skipped_effects.add(item.e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbatch.oncommit(commit);\n\t\t\t} else {\n\t\t\t\tcommit();\n\t\t\t}\n\t\t}\n\n\t\tif (mismatch) {\n\t\t\t// continue in hydration mode\n\t\t\tset_hydrating(true);\n\t\t}\n\n\t\t// When we mount the each block for the first time, the collection won't be\n\t\t// connected to this effect as the effect hasn't finished running yet and its deps\n\t\t// won't be assigned. However, it's possible that when reconciling the each block\n\t\t// that a mutation occurred and it's made the collection MAYBE_DIRTY, so reading the\n\t\t// collection again can provide consistency to the reactive graph again as the deriveds\n\t\t// will now be `CLEAN`.\n\t\tget(each_array);\n\t});\n\n\tif (hydrating) {\n\t\tanchor = hydrate_node;\n\t}\n}\n\n/**\n * Add, remove, or reorder items output by an each block as its input changes\n * @template V\n * @param {Effect} each_effect\n * @param {Array<V>} array\n * @param {EachState} state\n * @param {Map<any, EachItem>} offscreen_items\n * @param {Element | Comment | Text} anchor\n * @param {(anchor: Node, item: MaybeSource<V>, index: number | Source<number>, collection: () => V[]) => void} render_fn\n * @param {number} flags\n * @param {(value: V, index: number) => any} get_key\n * @param {() => V[]} get_collection\n * @returns {void}\n */\nfunction reconcile(\n\teach_effect,\n\tarray,\n\tstate,\n\toffscreen_items,\n\tanchor,\n\trender_fn,\n\tflags,\n\tget_key,\n\tget_collection\n) {\n\tvar is_animated = (flags & EACH_IS_ANIMATED) !== 0;\n\tvar should_update = (flags & (EACH_ITEM_REACTIVE | EACH_INDEX_REACTIVE)) !== 0;\n\n\tvar length = array.length;\n\tvar items = state.items;\n\tvar first = state.first;\n\tvar current = first;\n\n\t/** @type {undefined | Set<EachItem>} */\n\tvar seen;\n\n\t/** @type {EachItem | null} */\n\tvar prev = null;\n\n\t/** @type {undefined | Set<EachItem>} */\n\tvar to_animate;\n\n\t/** @type {EachItem[]} */\n\tvar matched = [];\n\n\t/** @type {EachItem[]} */\n\tvar stashed = [];\n\n\t/** @type {V} */\n\tvar value;\n\n\t/** @type {any} */\n\tvar key;\n\n\t/** @type {EachItem | undefined} */\n\tvar item;\n\n\t/** @type {number} */\n\tvar i;\n\n\tif (is_animated) {\n\t\tfor (i = 0; i < length; i += 1) {\n\t\t\tvalue = array[i];\n\t\t\tkey = get_key(value, i);\n\t\t\titem = items.get(key);\n\n\t\t\tif (item !== undefined) {\n\t\t\t\titem.a?.measure();\n\t\t\t\t(to_animate ??= new Set()).add(item);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (i = 0; i < length; i += 1) {\n\t\tvalue = array[i];\n\t\tkey = get_key(value, i);\n\n\t\titem = items.get(key);\n\n\t\tif (item === undefined) {\n\t\t\tvar pending = offscreen_items.get(key);\n\n\t\t\tif (pending !== undefined) {\n\t\t\t\toffscreen_items.delete(key);\n\t\t\t\titems.set(key, pending);\n\n\t\t\t\tvar next = prev ? prev.next : current;\n\n\t\t\t\tlink(state, prev, pending);\n\t\t\t\tlink(state, pending, next);\n\n\t\t\t\tmove(pending, next, anchor);\n\t\t\t\tprev = pending;\n\t\t\t} else {\n\t\t\t\tvar child_anchor = current ? /** @type {TemplateNode} */ (current.e.nodes_start) : anchor;\n\n\t\t\t\tprev = create_item(\n\t\t\t\t\tchild_anchor,\n\t\t\t\t\tstate,\n\t\t\t\t\tprev,\n\t\t\t\t\tprev === null ? state.first : prev.next,\n\t\t\t\t\tvalue,\n\t\t\t\t\tkey,\n\t\t\t\t\ti,\n\t\t\t\t\trender_fn,\n\t\t\t\t\tflags,\n\t\t\t\t\tget_collection\n\t\t\t\t);\n\t\t\t}\n\n\t\t\titems.set(key, prev);\n\n\t\t\tmatched = [];\n\t\t\tstashed = [];\n\n\t\t\tcurrent = prev.next;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (should_update) {\n\t\t\tupdate_item(item, value, i, flags);\n\t\t}\n\n\t\tif ((item.e.f & INERT) !== 0) {\n\t\t\tresume_effect(item.e);\n\t\t\tif (is_animated) {\n\t\t\t\titem.a?.unfix();\n\t\t\t\t(to_animate ??= new Set()).delete(item);\n\t\t\t}\n\t\t}\n\n\t\tif (item !== current) {\n\t\t\tif (seen !== undefined && seen.has(item)) {\n\t\t\t\tif (matched.length < stashed.length) {\n\t\t\t\t\t// more efficient to move later items to the front\n\t\t\t\t\tvar start = stashed[0];\n\t\t\t\t\tvar j;\n\n\t\t\t\t\tprev = start.prev;\n\n\t\t\t\t\tvar a = matched[0];\n\t\t\t\t\tvar b = matched[matched.length - 1];\n\n\t\t\t\t\tfor (j = 0; j < matched.length; j += 1) {\n\t\t\t\t\t\tmove(matched[j], start, anchor);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (j = 0; j < stashed.length; j += 1) {\n\t\t\t\t\t\tseen.delete(stashed[j]);\n\t\t\t\t\t}\n\n\t\t\t\t\tlink(state, a.prev, b.next);\n\t\t\t\t\tlink(state, prev, a);\n\t\t\t\t\tlink(state, b, start);\n\n\t\t\t\t\tcurrent = start;\n\t\t\t\t\tprev = b;\n\t\t\t\t\ti -= 1;\n\n\t\t\t\t\tmatched = [];\n\t\t\t\t\tstashed = [];\n\t\t\t\t} else {\n\t\t\t\t\t// more efficient to move earlier items to the back\n\t\t\t\t\tseen.delete(item);\n\t\t\t\t\tmove(item, current, anchor);\n\n\t\t\t\t\tlink(state, item.prev, item.next);\n\t\t\t\t\tlink(state, item, prev === null ? state.first : prev.next);\n\t\t\t\t\tlink(state, prev, item);\n\n\t\t\t\t\tprev = item;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmatched = [];\n\t\t\tstashed = [];\n\n\t\t\twhile (current !== null && current.k !== key) {\n\t\t\t\t// If the each block isn't inert and an item has an effect that is already inert,\n\t\t\t\t// skip over adding it to our seen Set as the item is already being handled\n\t\t\t\tif ((current.e.f & INERT) === 0) {\n\t\t\t\t\t(seen ??= new Set()).add(current);\n\t\t\t\t}\n\t\t\t\tstashed.push(current);\n\t\t\t\tcurrent = current.next;\n\t\t\t}\n\n\t\t\tif (current === null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\titem = current;\n\t\t}\n\n\t\tmatched.push(item);\n\t\tprev = item;\n\t\tcurrent = item.next;\n\t}\n\n\tif (current !== null || seen !== undefined) {\n\t\tvar to_destroy = seen === undefined ? [] : array_from(seen);\n\n\t\twhile (current !== null) {\n\t\t\t// If the each block isn't inert, then inert effects are currently outroing and will be removed once the transition is finished\n\t\t\tif ((current.e.f & INERT) === 0) {\n\t\t\t\tto_destroy.push(current);\n\t\t\t}\n\t\t\tcurrent = current.next;\n\t\t}\n\n\t\tvar destroy_length = to_destroy.length;\n\n\t\tif (destroy_length > 0) {\n\t\t\tvar controlled_anchor = (flags & EACH_IS_CONTROLLED) !== 0 && length === 0 ? anchor : null;\n\n\t\t\tif (is_animated) {\n\t\t\t\tfor (i = 0; i < destroy_length; i += 1) {\n\t\t\t\t\tto_destroy[i].a?.measure();\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < destroy_length; i += 1) {\n\t\t\t\t\tto_destroy[i].a?.fix();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpause_effects(state, to_destroy, controlled_anchor);\n\t\t}\n\t}\n\n\tif (is_animated) {\n\t\tqueue_micro_task(() => {\n\t\t\tif (to_animate === undefined) return;\n\t\t\tfor (item of to_animate) {\n\t\t\t\titem.a?.apply();\n\t\t\t}\n\t\t});\n\t}\n\n\teach_effect.first = state.first && state.first.e;\n\teach_effect.last = prev && prev.e;\n\n\tfor (var unused of offscreen_items.values()) {\n\t\tdestroy_effect(unused.e);\n\t}\n\n\toffscreen_items.clear();\n}\n\n/**\n * @param {EachItem} item\n * @param {any} value\n * @param {number} index\n * @param {number} type\n * @returns {void}\n */\nfunction update_item(item, value, index, type) {\n\tif ((type & EACH_ITEM_REACTIVE) !== 0) {\n\t\tinternal_set(item.v, value);\n\t}\n\n\tif ((type & EACH_INDEX_REACTIVE) !== 0) {\n\t\tinternal_set(/** @type {Value<number>} */ (item.i), index);\n\t} else {\n\t\titem.i = index;\n\t}\n}\n\n/**\n * @template V\n * @param {Node | null} anchor\n * @param {EachState} state\n * @param {EachItem | null} prev\n * @param {EachItem | null} next\n * @param {V} value\n * @param {unknown} key\n * @param {number} index\n * @param {(anchor: Node, item: V | Source<V>, index: number | Value<number>, collection: () => V[]) => void} render_fn\n * @param {number} flags\n * @param {() => V[]} get_collection\n * @param {boolean} [deferred]\n * @returns {EachItem}\n */\nfunction create_item(\n\tanchor,\n\tstate,\n\tprev,\n\tnext,\n\tvalue,\n\tkey,\n\tindex,\n\trender_fn,\n\tflags,\n\tget_collection,\n\tdeferred\n) {\n\tvar previous_each_item = current_each_item;\n\tvar reactive = (flags & EACH_ITEM_REACTIVE) !== 0;\n\tvar mutable = (flags & EACH_ITEM_IMMUTABLE) === 0;\n\n\tvar v = reactive ? (mutable ? mutable_source(value, false, false) : source(value)) : value;\n\tvar i = (flags & EACH_INDEX_REACTIVE) === 0 ? index : source(index);\n\n\tif (DEV && reactive) {\n\t\t// For tracing purposes, we need to link the source signal we create with the\n\t\t// collection + index so that tracing works as intended\n\t\t/** @type {Value} */ (v).trace = () => {\n\t\t\tvar collection_index = typeof i === 'number' ? index : i.v;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\t\t\tget_collection()[collection_index];\n\t\t};\n\t}\n\n\t/** @type {EachItem} */\n\tvar item = {\n\t\ti,\n\t\tv,\n\t\tk: key,\n\t\ta: null,\n\t\t// @ts-expect-error\n\t\te: null,\n\t\tprev,\n\t\tnext\n\t};\n\n\tcurrent_each_item = item;\n\n\ttry {\n\t\tif (anchor === null) {\n\t\t\tvar fragment = document.createDocumentFragment();\n\t\t\tfragment.append((anchor = create_text()));\n\t\t}\n\n\t\titem.e = branch(() => render_fn(/** @type {Node} */ (anchor), v, i, get_collection), hydrating);\n\n\t\titem.e.prev = prev && prev.e;\n\t\titem.e.next = next && next.e;\n\n\t\tif (prev === null) {\n\t\t\tif (!deferred) {\n\t\t\t\tstate.first = item;\n\t\t\t}\n\t\t} else {\n\t\t\tprev.next = item;\n\t\t\tprev.e.next = item.e;\n\t\t}\n\n\t\tif (next !== null) {\n\t\t\tnext.prev = item;\n\t\t\tnext.e.prev = item.e;\n\t\t}\n\n\t\treturn item;\n\t} finally {\n\t\tcurrent_each_item = previous_each_item;\n\t}\n}\n\n/**\n * @param {EachItem} item\n * @param {EachItem | null} next\n * @param {Text | Element | Comment} anchor\n */\nfunction move(item, next, anchor) {\n\tvar end = item.next ? /** @type {TemplateNode} */ (item.next.e.nodes_start) : anchor;\n\n\tvar dest = next ? /** @type {TemplateNode} */ (next.e.nodes_start) : anchor;\n\tvar node = /** @type {TemplateNode} */ (item.e.nodes_start);\n\n\twhile (node !== null && node !== end) {\n\t\tvar next_node = /** @type {TemplateNode} */ (get_next_sibling(node));\n\t\tdest.before(node);\n\t\tnode = next_node;\n\t}\n}\n\n/**\n * @param {EachState} state\n * @param {EachItem | null} prev\n * @param {EachItem | null} next\n */\nfunction link(state, prev, next) {\n\tif (prev === null) {\n\t\tstate.first = next;\n\t} else {\n\t\tprev.next = next;\n\t\tprev.e.next = next && next.e;\n\t}\n\n\tif (next !== null) {\n\t\tnext.prev = prev;\n\t\tnext.e.prev = prev && prev.e;\n\t}\n}\n","import { escape_html } from '../../escaping.js';\nimport { clsx as _clsx } from 'clsx';\n\n/**\n * `<div translate={false}>` should be rendered as `<div translate=\"no\">` and _not_\n * `<div translate=\"false\">`, which is equivalent to `<div translate=\"yes\">`. There\n * may be other odd cases that need to be added to this list in future\n * @type {Record<string, Map<any, string>>}\n */\nconst replacements = {\n\ttranslate: new Map([\n\t\t[true, 'yes'],\n\t\t[false, 'no']\n\t])\n};\n\n/**\n * @template V\n * @param {string} name\n * @param {V} value\n * @param {boolean} [is_boolean]\n * @returns {string}\n */\nexport function attr(name, value, is_boolean = false) {\n\t// attribute hidden for values other than \"until-found\" behaves like a boolean attribute\n\tif (name === 'hidden' && value !== 'until-found') {\n\t\tis_boolean = true;\n\t}\n\tif (value == null || (!value && is_boolean)) return '';\n\tconst normalized = (name in replacements && replacements[name].get(value)) || value;\n\tconst assignment = is_boolean ? '' : `=\"${escape_html(normalized, true)}\"`;\n\treturn ` ${name}${assignment}`;\n}\n\n/**\n * Small wrapper around clsx to preserve Svelte's (weird) handling of falsy values.\n * TODO Svelte 6 revisit this, and likely turn all falsy values into the empty string (what clsx also does)\n * @param  {any} value\n */\nexport function clsx(value) {\n\tif (typeof value === 'object') {\n\t\treturn _clsx(value);\n\t} else {\n\t\treturn value ?? '';\n\t}\n}\n\nconst whitespace = [...' \\t\\n\\r\\f\\u00a0\\u000b\\ufeff'];\n\n/**\n * @param {any} value\n * @param {string | null} [hash]\n * @param {Record<string, boolean>} [directives]\n * @returns {string | null}\n */\nexport function to_class(value, hash, directives) {\n\tvar classname = value == null ? '' : '' + value;\n\n\tif (hash) {\n\t\tclassname = classname ? classname + ' ' + hash : hash;\n\t}\n\n\tif (directives) {\n\t\tfor (var key in directives) {\n\t\t\tif (directives[key]) {\n\t\t\t\tclassname = classname ? classname + ' ' + key : key;\n\t\t\t} else if (classname.length) {\n\t\t\t\tvar len = key.length;\n\t\t\t\tvar a = 0;\n\n\t\t\t\twhile ((a = classname.indexOf(key, a)) >= 0) {\n\t\t\t\t\tvar b = a + len;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t(a === 0 || whitespace.includes(classname[a - 1])) &&\n\t\t\t\t\t\t(b === classname.length || whitespace.includes(classname[b]))\n\t\t\t\t\t) {\n\t\t\t\t\t\tclassname = (a === 0 ? '' : classname.substring(0, a)) + classname.substring(b + 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ta = b;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn classname === '' ? null : classname;\n}\n\n/**\n *\n * @param {Record<string,any>} styles\n * @param {boolean} important\n */\nfunction append_styles(styles, important = false) {\n\tvar separator = important ? ' !important;' : ';';\n\tvar css = '';\n\n\tfor (var key in styles) {\n\t\tvar value = styles[key];\n\t\tif (value != null && value !== '') {\n\t\t\tcss += ' ' + key + ': ' + value + separator;\n\t\t}\n\t}\n\n\treturn css;\n}\n\n/**\n * @param {string} name\n * @returns {string}\n */\nfunction to_css_name(name) {\n\tif (name[0] !== '-' || name[1] !== '-') {\n\t\treturn name.toLowerCase();\n\t}\n\treturn name;\n}\n\n/**\n * @param {any} value\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [styles]\n * @returns {string | null}\n */\nexport function to_style(value, styles) {\n\tif (styles) {\n\t\tvar new_style = '';\n\n\t\t/** @type {Record<string,any> | undefined} */\n\t\tvar normal_styles;\n\n\t\t/** @type {Record<string,any> | undefined} */\n\t\tvar important_styles;\n\n\t\tif (Array.isArray(styles)) {\n\t\t\tnormal_styles = styles[0];\n\t\t\timportant_styles = styles[1];\n\t\t} else {\n\t\t\tnormal_styles = styles;\n\t\t}\n\n\t\tif (value) {\n\t\t\tvalue = String(value)\n\t\t\t\t.replaceAll(/\\s*\\/\\*.*?\\*\\/\\s*/g, '')\n\t\t\t\t.trim();\n\n\t\t\t/** @type {boolean | '\"' | \"'\"} */\n\t\t\tvar in_str = false;\n\t\t\tvar in_apo = 0;\n\t\t\tvar in_comment = false;\n\n\t\t\tvar reserved_names = [];\n\n\t\t\tif (normal_styles) {\n\t\t\t\treserved_names.push(...Object.keys(normal_styles).map(to_css_name));\n\t\t\t}\n\t\t\tif (important_styles) {\n\t\t\t\treserved_names.push(...Object.keys(important_styles).map(to_css_name));\n\t\t\t}\n\n\t\t\tvar start_index = 0;\n\t\t\tvar name_index = -1;\n\n\t\t\tconst len = value.length;\n\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\tvar c = value[i];\n\n\t\t\t\tif (in_comment) {\n\t\t\t\t\tif (c === '/' && value[i - 1] === '*') {\n\t\t\t\t\t\tin_comment = false;\n\t\t\t\t\t}\n\t\t\t\t} else if (in_str) {\n\t\t\t\t\tif (in_str === c) {\n\t\t\t\t\t\tin_str = false;\n\t\t\t\t\t}\n\t\t\t\t} else if (c === '/' && value[i + 1] === '*') {\n\t\t\t\t\tin_comment = true;\n\t\t\t\t} else if (c === '\"' || c === \"'\") {\n\t\t\t\t\tin_str = c;\n\t\t\t\t} else if (c === '(') {\n\t\t\t\t\tin_apo++;\n\t\t\t\t} else if (c === ')') {\n\t\t\t\t\tin_apo--;\n\t\t\t\t}\n\n\t\t\t\tif (!in_comment && in_str === false && in_apo === 0) {\n\t\t\t\t\tif (c === ':' && name_index === -1) {\n\t\t\t\t\t\tname_index = i;\n\t\t\t\t\t} else if (c === ';' || i === len - 1) {\n\t\t\t\t\t\tif (name_index !== -1) {\n\t\t\t\t\t\t\tvar name = to_css_name(value.substring(start_index, name_index).trim());\n\n\t\t\t\t\t\t\tif (!reserved_names.includes(name)) {\n\t\t\t\t\t\t\t\tif (c !== ';') {\n\t\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar property = value.substring(start_index, i).trim();\n\t\t\t\t\t\t\t\tnew_style += ' ' + property + ';';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstart_index = i + 1;\n\t\t\t\t\t\tname_index = -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (normal_styles) {\n\t\t\tnew_style += append_styles(normal_styles);\n\t\t}\n\n\t\tif (important_styles) {\n\t\t\tnew_style += append_styles(important_styles, true);\n\t\t}\n\n\t\tnew_style = new_style.trim();\n\t\treturn new_style === '' ? null : new_style;\n\t}\n\n\treturn value == null ? null : String(value);\n}\n","import { to_class } from '../../../shared/attributes.js';\nimport { hydrating } from '../hydration.js';\n\n/**\n * @param {Element} dom\n * @param {boolean | number} is_html\n * @param {string | null} value\n * @param {string} [hash]\n * @param {Record<string, any>} [prev_classes]\n * @param {Record<string, any>} [next_classes]\n * @returns {Record<string, boolean> | undefined}\n */\nexport function set_class(dom, is_html, value, hash, prev_classes, next_classes) {\n\t// @ts-expect-error need to add __className to patched prototype\n\tvar prev = dom.__className;\n\n\tif (\n\t\thydrating ||\n\t\tprev !== value ||\n\t\tprev === undefined // for edge case of `class={undefined}`\n\t) {\n\t\tvar next_class_name = to_class(value, hash, next_classes);\n\n\t\tif (!hydrating || next_class_name !== dom.getAttribute('class')) {\n\t\t\t// Removing the attribute when the value is only an empty string causes\n\t\t\t// performance issues vs simply making the className an empty string. So\n\t\t\t// we should only remove the class if the value is nullish\n\t\t\t// and there no hash/directives :\n\t\t\tif (next_class_name == null) {\n\t\t\t\tdom.removeAttribute('class');\n\t\t\t} else if (is_html) {\n\t\t\t\tdom.className = next_class_name;\n\t\t\t} else {\n\t\t\t\tdom.setAttribute('class', next_class_name);\n\t\t\t}\n\t\t}\n\n\t\t// @ts-expect-error need to add __className to patched prototype\n\t\tdom.__className = value;\n\t} else if (next_classes && prev_classes !== next_classes) {\n\t\tfor (var key in next_classes) {\n\t\t\tvar is_present = !!next_classes[key];\n\n\t\t\tif (prev_classes == null || is_present !== !!prev_classes[key]) {\n\t\t\t\tdom.classList.toggle(key, is_present);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn next_classes;\n}\n","import { to_style } from '../../../shared/attributes.js';\nimport { hydrating } from '../hydration.js';\n\n/**\n * @param {Element & ElementCSSInlineStyle} dom\n * @param {Record<string, any>} prev\n * @param {Record<string, any>} next\n * @param {string} [priority]\n */\nfunction update_styles(dom, prev = {}, next, priority) {\n\tfor (var key in next) {\n\t\tvar value = next[key];\n\n\t\tif (prev[key] !== value) {\n\t\t\tif (next[key] == null) {\n\t\t\t\tdom.style.removeProperty(key);\n\t\t\t} else {\n\t\t\t\tdom.style.setProperty(key, value, priority);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} dom\n * @param {string | null} value\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [prev_styles]\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [next_styles]\n */\nexport function set_style(dom, value, prev_styles, next_styles) {\n\t// @ts-expect-error\n\tvar prev = dom.__style;\n\n\tif (hydrating || prev !== value) {\n\t\tvar next_style_attr = to_style(value, next_styles);\n\n\t\tif (!hydrating || next_style_attr !== dom.getAttribute('style')) {\n\t\t\tif (next_style_attr == null) {\n\t\t\t\tdom.removeAttribute('style');\n\t\t\t} else {\n\t\t\t\tdom.style.cssText = next_style_attr;\n\t\t\t}\n\t\t}\n\n\t\t// @ts-expect-error\n\t\tdom.__style = value;\n\t} else if (next_styles) {\n\t\tif (Array.isArray(next_styles)) {\n\t\t\tupdate_styles(dom, prev_styles?.[0], next_styles[0]);\n\t\t\tupdate_styles(dom, prev_styles?.[1], next_styles[1], 'important');\n\t\t} else {\n\t\t\tupdate_styles(dom, prev_styles, next_styles);\n\t\t}\n\t}\n\n\treturn next_styles;\n}\n","import { effect, teardown } from '../../../reactivity/effects.js';\nimport { listen_to_event_and_reset_event } from './shared.js';\nimport { is } from '../../../proxy.js';\nimport { is_array } from '../../../../shared/utils.js';\nimport * as w from '../../../warnings.js';\nimport { Batch, current_batch, previous_batch } from '../../../reactivity/batch.js';\n\n/**\n * Selects the correct option(s) (depending on whether this is a multiple select)\n * @template V\n * @param {HTMLSelectElement} select\n * @param {V} value\n * @param {boolean} mounting\n */\nexport function select_option(select, value, mounting = false) {\n\tif (select.multiple) {\n\t\t// If value is null or undefined, keep the selection as is\n\t\tif (value == undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If not an array, warn and keep the selection as is\n\t\tif (!is_array(value)) {\n\t\t\treturn w.select_multiple_invalid_value();\n\t\t}\n\n\t\t// Otherwise, update the selection\n\t\tfor (var option of select.options) {\n\t\t\toption.selected = value.includes(get_option_value(option));\n\t\t}\n\n\t\treturn;\n\t}\n\n\tfor (option of select.options) {\n\t\tvar option_value = get_option_value(option);\n\t\tif (is(option_value, value)) {\n\t\t\toption.selected = true;\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (!mounting || value !== undefined) {\n\t\tselect.selectedIndex = -1; // no option should be selected\n\t}\n}\n\n/**\n * Selects the correct option(s) if `value` is given,\n * and then sets up a mutation observer to sync the\n * current selection to the dom when it changes. Such\n * changes could for example occur when options are\n * inside an `#each` block.\n * @param {HTMLSelectElement} select\n */\nexport function init_select(select) {\n\tvar observer = new MutationObserver(() => {\n\t\t// @ts-ignore\n\t\tselect_option(select, select.__value);\n\t\t// Deliberately don't update the potential binding value,\n\t\t// the model should be preserved unless explicitly changed\n\t});\n\n\tobserver.observe(select, {\n\t\t// Listen to option element changes\n\t\tchildList: true,\n\t\tsubtree: true, // because of <optgroup>\n\t\t// Listen to option element value attribute changes\n\t\t// (doesn't get notified of select value changes,\n\t\t// because that property is not reflected as an attribute)\n\t\tattributes: true,\n\t\tattributeFilter: ['value']\n\t});\n\n\tteardown(() => {\n\t\tobserver.disconnect();\n\t});\n}\n\n/**\n * @param {HTMLSelectElement} select\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_select_value(select, get, set = get) {\n\tvar batches = new WeakSet();\n\tvar mounting = true;\n\n\tlisten_to_event_and_reset_event(select, 'change', (is_reset) => {\n\t\tvar query = is_reset ? '[selected]' : ':checked';\n\t\t/** @type {unknown} */\n\t\tvar value;\n\n\t\tif (select.multiple) {\n\t\t\tvalue = [].map.call(select.querySelectorAll(query), get_option_value);\n\t\t} else {\n\t\t\t/** @type {HTMLOptionElement | null} */\n\t\t\tvar selected_option =\n\t\t\t\tselect.querySelector(query) ??\n\t\t\t\t// will fall back to first non-disabled option if no option is selected\n\t\t\t\tselect.querySelector('option:not([disabled])');\n\t\t\tvalue = selected_option && get_option_value(selected_option);\n\t\t}\n\n\t\tset(value);\n\n\t\tif (current_batch !== null) {\n\t\t\tbatches.add(current_batch);\n\t\t}\n\t});\n\n\t// Needs to be an effect, not a render_effect, so that in case of each loops the logic runs after the each block has updated\n\teffect(() => {\n\t\tvar value = get();\n\n\t\tif (select === document.activeElement) {\n\t\t\t// we need both, because in non-async mode, render effects run before previous_batch is set\n\t\t\tvar batch = /** @type {Batch} */ (previous_batch ?? current_batch);\n\n\t\t\t// Don't update the <select> if it is focused. We can get here if, for example,\n\t\t\t// an update is deferred because of async work depending on the select:\n\t\t\t//\n\t\t\t// <select bind:value={selected}>...</select>\n\t\t\t// <p>{await find(selected)}</p>\n\t\t\tif (batches.has(batch)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tselect_option(select, value, mounting);\n\n\t\t// Mounting and value undefined -> take selection from dom\n\t\tif (mounting && value === undefined) {\n\t\t\t/** @type {HTMLOptionElement | null} */\n\t\t\tvar selected_option = select.querySelector(':checked');\n\t\t\tif (selected_option !== null) {\n\t\t\t\tvalue = get_option_value(selected_option);\n\t\t\t\tset(value);\n\t\t\t}\n\t\t}\n\n\t\t// @ts-ignore\n\t\tselect.__value = value;\n\t\tmounting = false;\n\t});\n\n\tinit_select(select);\n}\n\n/** @param {HTMLOptionElement} option */\nfunction get_option_value(option) {\n\t// __value only exists if the <option> has a value attribute\n\tif ('__value' in option) {\n\t\treturn option.__value;\n\t} else {\n\t\treturn option.value;\n\t}\n}\n","/** @import { Effect } from '#client' */\nimport { DEV } from 'esm-env';\nimport { hydrating, set_hydrating } from '../hydration.js';\nimport { get_descriptors, get_prototype_of } from '../../../shared/utils.js';\nimport { create_event, delegate } from './events.js';\nimport { add_form_reset_listener, autofocus } from './misc.js';\nimport * as w from '../../warnings.js';\nimport { LOADING_ATTR_SYMBOL } from '#client/constants';\nimport { queue_micro_task } from '../task.js';\nimport { is_capture_event, can_delegate_event, normalize_attribute } from '../../../../utils.js';\nimport {\n\tactive_effect,\n\tactive_reaction,\n\tget,\n\tset_active_effect,\n\tset_active_reaction\n} from '../../runtime.js';\nimport { attach } from './attachments.js';\nimport { clsx } from '../../../shared/attributes.js';\nimport { set_class } from './class.js';\nimport { set_style } from './style.js';\nimport { ATTACHMENT_KEY, NAMESPACE_HTML, UNINITIALIZED } from '../../../../constants.js';\nimport { block, branch, destroy_effect, effect } from '../../reactivity/effects.js';\nimport { init_select, select_option } from './bindings/select.js';\nimport { flatten } from '../../reactivity/async.js';\n\nexport const CLASS = Symbol('class');\nexport const STYLE = Symbol('style');\n\nconst IS_CUSTOM_ELEMENT = Symbol('is custom element');\nconst IS_HTML = Symbol('is html');\n\n/**\n * The value/checked attribute in the template actually corresponds to the defaultValue property, so we need\n * to remove it upon hydration to avoid a bug when someone resets the form value.\n * @param {HTMLInputElement} input\n * @returns {void}\n */\nexport function remove_input_defaults(input) {\n\tif (!hydrating) return;\n\n\tvar already_removed = false;\n\n\t// We try and remove the default attributes later, rather than sync during hydration.\n\t// Doing it sync during hydration has a negative impact on performance, but deferring the\n\t// work in an idle task alleviates this greatly. If a form reset event comes in before\n\t// the idle callback, then we ensure the input defaults are cleared just before.\n\tvar remove_defaults = () => {\n\t\tif (already_removed) return;\n\t\talready_removed = true;\n\n\t\t// Remove the attributes but preserve the values\n\t\tif (input.hasAttribute('value')) {\n\t\t\tvar value = input.value;\n\t\t\tset_attribute(input, 'value', null);\n\t\t\tinput.value = value;\n\t\t}\n\n\t\tif (input.hasAttribute('checked')) {\n\t\t\tvar checked = input.checked;\n\t\t\tset_attribute(input, 'checked', null);\n\t\t\tinput.checked = checked;\n\t\t}\n\t};\n\n\t// @ts-expect-error\n\tinput.__on_r = remove_defaults;\n\tqueue_micro_task(remove_defaults);\n\tadd_form_reset_listener();\n}\n\n/**\n * @param {Element} element\n * @param {any} value\n */\nexport function set_value(element, value) {\n\tvar attributes = get_attributes(element);\n\n\tif (\n\t\tattributes.value ===\n\t\t\t(attributes.value =\n\t\t\t\t// treat null and undefined the same for the initial value\n\t\t\t\tvalue ?? undefined) ||\n\t\t// @ts-expect-error\n\t\t// `progress` elements always need their value set when it's `0`\n\t\t(element.value === value && (value !== 0 || element.nodeName !== 'PROGRESS'))\n\t) {\n\t\treturn;\n\t}\n\n\t// @ts-expect-error\n\telement.value = value ?? '';\n}\n\n/**\n * @param {Element} element\n * @param {boolean} checked\n */\nexport function set_checked(element, checked) {\n\tvar attributes = get_attributes(element);\n\n\tif (\n\t\tattributes.checked ===\n\t\t(attributes.checked =\n\t\t\t// treat null and undefined the same for the initial value\n\t\t\tchecked ?? undefined)\n\t) {\n\t\treturn;\n\t}\n\n\t// @ts-expect-error\n\telement.checked = checked;\n}\n\n/**\n * Sets the `selected` attribute on an `option` element.\n * Not set through the property because that doesn't reflect to the DOM,\n * which means it wouldn't be taken into account when a form is reset.\n * @param {HTMLOptionElement} element\n * @param {boolean} selected\n */\nexport function set_selected(element, selected) {\n\tif (selected) {\n\t\t// The selected option could've changed via user selection, and\n\t\t// setting the value without this check would set it back.\n\t\tif (!element.hasAttribute('selected')) {\n\t\t\telement.setAttribute('selected', '');\n\t\t}\n\t} else {\n\t\telement.removeAttribute('selected');\n\t}\n}\n\n/**\n * Applies the default checked property without influencing the current checked property.\n * @param {HTMLInputElement} element\n * @param {boolean} checked\n */\nexport function set_default_checked(element, checked) {\n\tconst existing_value = element.checked;\n\telement.defaultChecked = checked;\n\telement.checked = existing_value;\n}\n\n/**\n * Applies the default value property without influencing the current value property.\n * @param {HTMLInputElement | HTMLTextAreaElement} element\n * @param {string} value\n */\nexport function set_default_value(element, value) {\n\tconst existing_value = element.value;\n\telement.defaultValue = value;\n\telement.value = existing_value;\n}\n\n/**\n * @param {Element} element\n * @param {string} attribute\n * @param {string | null} value\n * @param {boolean} [skip_warning]\n */\nexport function set_attribute(element, attribute, value, skip_warning) {\n\tvar attributes = get_attributes(element);\n\n\tif (hydrating) {\n\t\tattributes[attribute] = element.getAttribute(attribute);\n\n\t\tif (\n\t\t\tattribute === 'src' ||\n\t\t\tattribute === 'srcset' ||\n\t\t\t(attribute === 'href' && element.nodeName === 'LINK')\n\t\t) {\n\t\t\tif (!skip_warning) {\n\t\t\t\tcheck_src_in_dev_hydration(element, attribute, value ?? '');\n\t\t\t}\n\n\t\t\t// If we reset these attributes, they would result in another network request, which we want to avoid.\n\t\t\t// We assume they are the same between client and server as checking if they are equal is expensive\n\t\t\t// (we can't just compare the strings as they can be different between client and server but result in the\n\t\t\t// same url, so we would need to create hidden anchor elements to compare them)\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (attributes[attribute] === (attributes[attribute] = value)) return;\n\n\tif (attribute === 'loading') {\n\t\t// @ts-expect-error\n\t\telement[LOADING_ATTR_SYMBOL] = value;\n\t}\n\n\tif (value == null) {\n\t\telement.removeAttribute(attribute);\n\t} else if (typeof value !== 'string' && get_setters(element).includes(attribute)) {\n\t\t// @ts-ignore\n\t\telement[attribute] = value;\n\t} else {\n\t\telement.setAttribute(attribute, value);\n\t}\n}\n\n/**\n * @param {Element} dom\n * @param {string} attribute\n * @param {string} value\n */\nexport function set_xlink_attribute(dom, attribute, value) {\n\tdom.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\n/**\n * @param {HTMLElement} node\n * @param {string} prop\n * @param {any} value\n */\nexport function set_custom_element_data(node, prop, value) {\n\t// We need to ensure that setting custom element props, which can\n\t// invoke lifecycle methods on other custom elements, does not also\n\t// associate those lifecycle methods with the current active reaction\n\t// or effect\n\tvar previous_reaction = active_reaction;\n\tvar previous_effect = active_effect;\n\n\t// If we're hydrating but the custom element is from Svelte, and it already scaffolded,\n\t// then it might run block logic in hydration mode, which we have to prevent.\n\tlet was_hydrating = hydrating;\n\tif (hydrating) {\n\t\tset_hydrating(false);\n\t}\n\n\tset_active_reaction(null);\n\tset_active_effect(null);\n\n\ttry {\n\t\tif (\n\t\t\t// `style` should use `set_attribute` rather than the setter\n\t\t\tprop !== 'style' &&\n\t\t\t// Don't compute setters for custom elements while they aren't registered yet,\n\t\t\t// because during their upgrade/instantiation they might add more setters.\n\t\t\t// Instead, fall back to a simple \"an object, then set as property\" heuristic.\n\t\t\t(setters_cache.has(node.getAttribute('is') || node.nodeName) ||\n\t\t\t// customElements may not be available in browser extension contexts\n\t\t\t!customElements ||\n\t\t\tcustomElements.get(node.getAttribute('is') || node.tagName.toLowerCase())\n\t\t\t\t? get_setters(node).includes(prop)\n\t\t\t\t: value && typeof value === 'object')\n\t\t) {\n\t\t\t// @ts-expect-error\n\t\t\tnode[prop] = value;\n\t\t} else {\n\t\t\t// We did getters etc checks already, stringify before passing to set_attribute\n\t\t\t// to ensure it doesn't invoke the same logic again, and potentially populating\n\t\t\t// the setters cache too early.\n\t\t\tset_attribute(node, prop, value == null ? value : String(value));\n\t\t}\n\t} finally {\n\t\tset_active_reaction(previous_reaction);\n\t\tset_active_effect(previous_effect);\n\t\tif (was_hydrating) {\n\t\t\tset_hydrating(true);\n\t\t}\n\t}\n}\n\n/**\n * Spreads attributes onto a DOM element, taking into account the currently set attributes\n * @param {Element & ElementCSSInlineStyle} element\n * @param {Record<string | symbol, any> | undefined} prev\n * @param {Record<string | symbol, any>} next New attributes - this function mutates this object\n * @param {string} [css_hash]\n * @param {boolean} [should_remove_defaults]\n * @param {boolean} [skip_warning]\n * @returns {Record<string, any>}\n */\nfunction set_attributes(\n\telement,\n\tprev,\n\tnext,\n\tcss_hash,\n\tshould_remove_defaults = false,\n\tskip_warning = false\n) {\n\tif (hydrating && should_remove_defaults && element.tagName === 'INPUT') {\n\t\tvar input = /** @type {HTMLInputElement} */ (element);\n\t\tvar attribute = input.type === 'checkbox' ? 'defaultChecked' : 'defaultValue';\n\n\t\tif (!(attribute in next)) {\n\t\t\tremove_input_defaults(input);\n\t\t}\n\t}\n\n\tvar attributes = get_attributes(element);\n\n\tvar is_custom_element = attributes[IS_CUSTOM_ELEMENT];\n\tvar preserve_attribute_case = !attributes[IS_HTML];\n\n\t// If we're hydrating but the custom element is from Svelte, and it already scaffolded,\n\t// then it might run block logic in hydration mode, which we have to prevent.\n\tlet is_hydrating_custom_element = hydrating && is_custom_element;\n\tif (is_hydrating_custom_element) {\n\t\tset_hydrating(false);\n\t}\n\n\tvar current = prev || {};\n\tvar is_option_element = element.tagName === 'OPTION';\n\n\tfor (var key in prev) {\n\t\tif (!(key in next)) {\n\t\t\tnext[key] = null;\n\t\t}\n\t}\n\n\tif (next.class) {\n\t\tnext.class = clsx(next.class);\n\t} else if (css_hash || next[CLASS]) {\n\t\tnext.class = null; /* force call to set_class() */\n\t}\n\n\tif (next[STYLE]) {\n\t\tnext.style ??= null; /* force call to set_style() */\n\t}\n\n\tvar setters = get_setters(element);\n\n\t// since key is captured we use const\n\tfor (const key in next) {\n\t\t// let instead of var because referenced in a closure\n\t\tlet value = next[key];\n\n\t\t// Up here because we want to do this for the initial value, too, even if it's undefined,\n\t\t// and this wouldn't be reached in case of undefined because of the equality check below\n\t\tif (is_option_element && key === 'value' && value == null) {\n\t\t\t// The <option> element is a special case because removing the value attribute means\n\t\t\t// the value is set to the text content of the option element, and setting the value\n\t\t\t// to null or undefined means the value is set to the string \"null\" or \"undefined\".\n\t\t\t// To align with how we handle this case in non-spread-scenarios, this logic is needed.\n\t\t\t// There's a super-edge-case bug here that is left in in favor of smaller code size:\n\t\t\t// Because of the \"set missing props to null\" logic above, we can't differentiate\n\t\t\t// between a missing value and an explicitly set value of null or undefined. That means\n\t\t\t// that once set, the value attribute of an <option> element can't be removed. This is\n\t\t\t// a very rare edge case, and removing the attribute altogether isn't possible either\n\t\t\t// for the <option value={undefined}> case, so we're not losing any functionality here.\n\t\t\t// @ts-ignore\n\t\t\telement.value = element.__value = '';\n\t\t\tcurrent[key] = value;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (key === 'class') {\n\t\t\tvar is_html = element.namespaceURI === 'http://www.w3.org/1999/xhtml';\n\t\t\tset_class(element, is_html, value, css_hash, prev?.[CLASS], next[CLASS]);\n\t\t\tcurrent[key] = value;\n\t\t\tcurrent[CLASS] = next[CLASS];\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (key === 'style') {\n\t\t\tset_style(element, value, prev?.[STYLE], next[STYLE]);\n\t\t\tcurrent[key] = value;\n\t\t\tcurrent[STYLE] = next[STYLE];\n\t\t\tcontinue;\n\t\t}\n\n\t\tvar prev_value = current[key];\n\n\t\t// Skip if value is unchanged, unless it's `undefined` and the element still has the attribute\n\t\tif (value === prev_value && !(value === undefined && element.hasAttribute(key))) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tcurrent[key] = value;\n\n\t\tvar prefix = key[0] + key[1]; // this is faster than key.slice(0, 2)\n\t\tif (prefix === '$$') continue;\n\n\t\tif (prefix === 'on') {\n\t\t\t/** @type {{ capture?: true }} */\n\t\t\tconst opts = {};\n\t\t\tconst event_handle_key = '$$' + key;\n\t\t\tlet event_name = key.slice(2);\n\t\t\tvar delegated = can_delegate_event(event_name);\n\n\t\t\tif (is_capture_event(event_name)) {\n\t\t\t\tevent_name = event_name.slice(0, -7);\n\t\t\t\topts.capture = true;\n\t\t\t}\n\n\t\t\tif (!delegated && prev_value) {\n\t\t\t\t// Listening to same event but different handler -> our handle function below takes care of this\n\t\t\t\t// If we were to remove and add listeners in this case, it could happen that the event is \"swallowed\"\n\t\t\t\t// (the browser seems to not know yet that a new one exists now) and doesn't reach the handler\n\t\t\t\t// https://github.com/sveltejs/svelte/issues/11903\n\t\t\t\tif (value != null) continue;\n\n\t\t\t\telement.removeEventListener(event_name, current[event_handle_key], opts);\n\t\t\t\tcurrent[event_handle_key] = null;\n\t\t\t}\n\n\t\t\tif (value != null) {\n\t\t\t\tif (!delegated) {\n\t\t\t\t\t/**\n\t\t\t\t\t * @this {any}\n\t\t\t\t\t * @param {Event} evt\n\t\t\t\t\t */\n\t\t\t\t\tfunction handle(evt) {\n\t\t\t\t\t\tcurrent[key].call(this, evt);\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrent[event_handle_key] = create_event(event_name, element, handle, opts);\n\t\t\t\t} else {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\telement[`__${event_name}`] = value;\n\t\t\t\t\tdelegate([event_name]);\n\t\t\t\t}\n\t\t\t} else if (delegated) {\n\t\t\t\t// @ts-ignore\n\t\t\t\telement[`__${event_name}`] = undefined;\n\t\t\t}\n\t\t} else if (key === 'style') {\n\t\t\t// avoid using the setter\n\t\t\tset_attribute(element, key, value);\n\t\t} else if (key === 'autofocus') {\n\t\t\tautofocus(/** @type {HTMLElement} */ (element), Boolean(value));\n\t\t} else if (!is_custom_element && (key === '__value' || (key === 'value' && value != null))) {\n\t\t\t// @ts-ignore We're not running this for custom elements because __value is actually\n\t\t\t// how Lit stores the current value on the element, and messing with that would break things.\n\t\t\telement.value = element.__value = value;\n\t\t} else if (key === 'selected' && is_option_element) {\n\t\t\tset_selected(/** @type {HTMLOptionElement} */ (element), value);\n\t\t} else {\n\t\t\tvar name = key;\n\t\t\tif (!preserve_attribute_case) {\n\t\t\t\tname = normalize_attribute(name);\n\t\t\t}\n\n\t\t\tvar is_default = name === 'defaultValue' || name === 'defaultChecked';\n\n\t\t\tif (value == null && !is_custom_element && !is_default) {\n\t\t\t\tattributes[key] = null;\n\n\t\t\t\tif (name === 'value' || name === 'checked') {\n\t\t\t\t\t// removing value/checked also removes defaultValue/defaultChecked â€” preserve\n\t\t\t\t\tlet input = /** @type {HTMLInputElement} */ (element);\n\t\t\t\t\tconst use_default = prev === undefined;\n\t\t\t\t\tif (name === 'value') {\n\t\t\t\t\t\tlet previous = input.defaultValue;\n\t\t\t\t\t\tinput.removeAttribute(name);\n\t\t\t\t\t\tinput.defaultValue = previous;\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tinput.value = input.__value = use_default ? previous : null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet previous = input.defaultChecked;\n\t\t\t\t\t\tinput.removeAttribute(name);\n\t\t\t\t\t\tinput.defaultChecked = previous;\n\t\t\t\t\t\tinput.checked = use_default ? previous : false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\telement.removeAttribute(key);\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tis_default ||\n\t\t\t\t(setters.includes(name) && (is_custom_element || typeof value !== 'string'))\n\t\t\t) {\n\t\t\t\t// @ts-ignore\n\t\t\t\telement[name] = value;\n\t\t\t\t// remove it from attributes's cache\n\t\t\t\tif (name in attributes) attributes[name] = UNINITIALIZED;\n\t\t\t} else if (typeof value !== 'function') {\n\t\t\t\tset_attribute(element, name, value, skip_warning);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (is_hydrating_custom_element) {\n\t\tset_hydrating(true);\n\t}\n\n\treturn current;\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} element\n * @param {(...expressions: any) => Record<string | symbol, any>} fn\n * @param {Array<() => any>} sync\n * @param {Array<() => Promise<any>>} async\n * @param {Array<Promise<void>>} blockers\n * @param {string} [css_hash]\n * @param {boolean} [should_remove_defaults]\n * @param {boolean} [skip_warning]\n */\nexport function attribute_effect(\n\telement,\n\tfn,\n\tsync = [],\n\tasync = [],\n\tblockers = [],\n\tcss_hash,\n\tshould_remove_defaults = false,\n\tskip_warning = false\n) {\n\tflatten(blockers, sync, async, (values) => {\n\t\t/** @type {Record<string | symbol, any> | undefined} */\n\t\tvar prev = undefined;\n\n\t\t/** @type {Record<symbol, Effect>} */\n\t\tvar effects = {};\n\n\t\tvar is_select = element.nodeName === 'SELECT';\n\t\tvar inited = false;\n\n\t\tblock(() => {\n\t\t\tvar next = fn(...values.map(get));\n\t\t\t/** @type {Record<string | symbol, any>} */\n\t\t\tvar current = set_attributes(\n\t\t\t\telement,\n\t\t\t\tprev,\n\t\t\t\tnext,\n\t\t\t\tcss_hash,\n\t\t\t\tshould_remove_defaults,\n\t\t\t\tskip_warning\n\t\t\t);\n\n\t\t\tif (inited && is_select && 'value' in next) {\n\t\t\t\tselect_option(/** @type {HTMLSelectElement} */ (element), next.value);\n\t\t\t}\n\n\t\t\tfor (let symbol of Object.getOwnPropertySymbols(effects)) {\n\t\t\t\tif (!next[symbol]) destroy_effect(effects[symbol]);\n\t\t\t}\n\n\t\t\tfor (let symbol of Object.getOwnPropertySymbols(next)) {\n\t\t\t\tvar n = next[symbol];\n\n\t\t\t\tif (symbol.description === ATTACHMENT_KEY && (!prev || n !== prev[symbol])) {\n\t\t\t\t\tif (effects[symbol]) destroy_effect(effects[symbol]);\n\t\t\t\t\teffects[symbol] = branch(() => attach(element, () => n));\n\t\t\t\t}\n\n\t\t\t\tcurrent[symbol] = n;\n\t\t\t}\n\n\t\t\tprev = current;\n\t\t});\n\n\t\tif (is_select) {\n\t\t\tvar select = /** @type {HTMLSelectElement} */ (element);\n\n\t\t\teffect(() => {\n\t\t\t\tselect_option(select, /** @type {Record<string | symbol, any>} */ (prev).value, true);\n\t\t\t\tinit_select(select);\n\t\t\t});\n\t\t}\n\n\t\tinited = true;\n\t});\n}\n\n/**\n *\n * @param {Element} element\n */\nfunction get_attributes(element) {\n\treturn /** @type {Record<string | symbol, unknown>} **/ (\n\t\t// @ts-expect-error\n\t\telement.__attributes ??= {\n\t\t\t[IS_CUSTOM_ELEMENT]: element.nodeName.includes('-'),\n\t\t\t[IS_HTML]: element.namespaceURI === NAMESPACE_HTML\n\t\t}\n\t);\n}\n\n/** @type {Map<string, string[]>} */\nvar setters_cache = new Map();\n\n/** @param {Element} element */\nfunction get_setters(element) {\n\tvar cache_key = element.getAttribute('is') || element.nodeName;\n\tvar setters = setters_cache.get(cache_key);\n\tif (setters) return setters;\n\tsetters_cache.set(cache_key, (setters = []));\n\n\tvar descriptors;\n\tvar proto = element; // In the case of custom elements there might be setters on the instance\n\tvar element_proto = Element.prototype;\n\n\t// Stop at Element, from there on there's only unnecessary setters we're not interested in\n\t// Do not use contructor.name here as that's unreliable in some browser environments\n\twhile (element_proto !== proto) {\n\t\tdescriptors = get_descriptors(proto);\n\n\t\tfor (var key in descriptors) {\n\t\t\tif (descriptors[key].set) {\n\t\t\t\tsetters.push(key);\n\t\t\t}\n\t\t}\n\n\t\tproto = get_prototype_of(proto);\n\t}\n\n\treturn setters;\n}\n\n/**\n * @param {any} element\n * @param {string} attribute\n * @param {string} value\n */\nfunction check_src_in_dev_hydration(element, attribute, value) {\n\tif (!DEV) return;\n\tif (attribute === 'srcset' && srcset_url_equal(element, value)) return;\n\tif (src_url_equal(element.getAttribute(attribute) ?? '', value)) return;\n\n\tw.hydration_attribute_changed(\n\t\tattribute,\n\t\telement.outerHTML.replace(element.innerHTML, element.innerHTML && '...'),\n\t\tString(value)\n\t);\n}\n\n/**\n * @param {string} element_src\n * @param {string} url\n * @returns {boolean}\n */\nfunction src_url_equal(element_src, url) {\n\tif (element_src === url) return true;\n\treturn new URL(element_src, document.baseURI).href === new URL(url, document.baseURI).href;\n}\n\n/** @param {string} srcset */\nfunction split_srcset(srcset) {\n\treturn srcset.split(',').map((src) => src.trim().split(' ').filter(Boolean));\n}\n\n/**\n * @param {HTMLSourceElement | HTMLImageElement} element\n * @param {string} srcset\n * @returns {boolean}\n */\nfunction srcset_url_equal(element, srcset) {\n\tvar element_urls = split_srcset(element.srcset);\n\tvar urls = split_srcset(srcset);\n\n\treturn (\n\t\turls.length === element_urls.length &&\n\t\turls.every(\n\t\t\t([url, width], i) =>\n\t\t\t\twidth === element_urls[i][1] &&\n\t\t\t\t// We need to test both ways because Vite will create an a full URL with\n\t\t\t\t// `new URL(asset, import.meta.url).href` for the client when `base: './'`, and the\n\t\t\t\t// relative URLs inside srcset are not automatically resolved to absolute URLs by\n\t\t\t\t// browsers (in contrast to img.src). This means both SSR and DOM code could\n\t\t\t\t// contain relative or absolute URLs.\n\t\t\t\t(src_url_equal(element_urls[i][0], url) || src_url_equal(url, element_urls[i][0]))\n\t\t)\n\t);\n}\n","/** @import { Batch } from '../../../reactivity/batch.js' */\nimport { DEV } from 'esm-env';\nimport { render_effect, teardown } from '../../../reactivity/effects.js';\nimport { listen_to_event_and_reset_event } from './shared.js';\nimport * as e from '../../../errors.js';\nimport { is } from '../../../proxy.js';\nimport { queue_micro_task } from '../../task.js';\nimport { hydrating } from '../../hydration.js';\nimport { tick, untrack } from '../../../runtime.js';\nimport { is_runes } from '../../../context.js';\nimport { current_batch, previous_batch } from '../../../reactivity/batch.js';\n\n/**\n * @param {HTMLInputElement} input\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_value(input, get, set = get) {\n\tvar batches = new WeakSet();\n\n\tlisten_to_event_and_reset_event(input, 'input', async (is_reset) => {\n\t\tif (DEV && input.type === 'checkbox') {\n\t\t\t// TODO should this happen in prod too?\n\t\t\te.bind_invalid_checkbox_value();\n\t\t}\n\n\t\t/** @type {any} */\n\t\tvar value = is_reset ? input.defaultValue : input.value;\n\t\tvalue = is_numberlike_input(input) ? to_number(value) : value;\n\t\tset(value);\n\n\t\tif (current_batch !== null) {\n\t\t\tbatches.add(current_batch);\n\t\t}\n\n\t\t// Because `{#each ...}` blocks work by updating sources inside the flush,\n\t\t// we need to wait a tick before checking to see if we should forcibly\n\t\t// update the input and reset the selection state\n\t\tawait tick();\n\n\t\t// Respect any validation in accessors\n\t\tif (value !== (value = get())) {\n\t\t\tvar start = input.selectionStart;\n\t\t\tvar end = input.selectionEnd;\n\t\t\tvar length = input.value.length;\n\n\t\t\t// the value is coerced on assignment\n\t\t\tinput.value = value ?? '';\n\n\t\t\t// Restore selection\n\t\t\tif (end !== null) {\n\t\t\t\tvar new_length = input.value.length;\n\t\t\t\t// If cursor was at end and new input is longer, move cursor to new end\n\t\t\t\tif (start === end && end === length && new_length > length) {\n\t\t\t\t\tinput.selectionStart = new_length;\n\t\t\t\t\tinput.selectionEnd = new_length;\n\t\t\t\t} else {\n\t\t\t\t\tinput.selectionStart = start;\n\t\t\t\t\tinput.selectionEnd = Math.min(end, new_length);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tif (\n\t\t// If we are hydrating and the value has since changed,\n\t\t// then use the updated value from the input instead.\n\t\t(hydrating && input.defaultValue !== input.value) ||\n\t\t// If defaultValue is set, then value == defaultValue\n\t\t// TODO Svelte 6: remove input.value check and set to empty string?\n\t\t(untrack(get) == null && input.value)\n\t) {\n\t\tset(is_numberlike_input(input) ? to_number(input.value) : input.value);\n\n\t\tif (current_batch !== null) {\n\t\t\tbatches.add(current_batch);\n\t\t}\n\t}\n\n\trender_effect(() => {\n\t\tif (DEV && input.type === 'checkbox') {\n\t\t\t// TODO should this happen in prod too?\n\t\t\te.bind_invalid_checkbox_value();\n\t\t}\n\n\t\tvar value = get();\n\n\t\tif (input === document.activeElement) {\n\t\t\t// we need both, because in non-async mode, render effects run before previous_batch is set\n\t\t\tvar batch = /** @type {Batch} */ (previous_batch ?? current_batch);\n\n\t\t\t// Never rewrite the contents of a focused input. We can get here if, for example,\n\t\t\t// an update is deferred because of async work depending on the input:\n\t\t\t//\n\t\t\t// <input bind:value={query}>\n\t\t\t// <p>{await find(query)}</p>\n\t\t\tif (batches.has(batch)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (is_numberlike_input(input) && value === to_number(input.value)) {\n\t\t\t// handles 0 vs 00 case (see https://github.com/sveltejs/svelte/issues/9959)\n\t\t\treturn;\n\t\t}\n\n\t\tif (input.type === 'date' && !value && !input.value) {\n\t\t\t// Handles the case where a temporarily invalid date is set (while typing, for example with a leading 0 for the day)\n\t\t\t// and prevents this state from clearing the other parts of the date input (see https://github.com/sveltejs/svelte/issues/7897)\n\t\t\treturn;\n\t\t}\n\n\t\t// don't set the value of the input if it's the same to allow\n\t\t// minlength to work properly\n\t\tif (value !== input.value) {\n\t\t\t// @ts-expect-error the value is coerced on assignment\n\t\t\tinput.value = value ?? '';\n\t\t}\n\t});\n}\n\n/** @type {Set<HTMLInputElement[]>} */\nconst pending = new Set();\n\n/**\n * @param {HTMLInputElement[]} inputs\n * @param {null | [number]} group_index\n * @param {HTMLInputElement} input\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_group(inputs, group_index, input, get, set = get) {\n\tvar is_checkbox = input.getAttribute('type') === 'checkbox';\n\tvar binding_group = inputs;\n\n\t// needs to be let or related code isn't treeshaken out if it's always false\n\tlet hydration_mismatch = false;\n\n\tif (group_index !== null) {\n\t\tfor (var index of group_index) {\n\t\t\t// @ts-expect-error\n\t\t\tbinding_group = binding_group[index] ??= [];\n\t\t}\n\t}\n\n\tbinding_group.push(input);\n\n\tlisten_to_event_and_reset_event(\n\t\tinput,\n\t\t'change',\n\t\t() => {\n\t\t\t// @ts-ignore\n\t\t\tvar value = input.__value;\n\n\t\t\tif (is_checkbox) {\n\t\t\t\tvalue = get_binding_group_value(binding_group, value, input.checked);\n\t\t\t}\n\n\t\t\tset(value);\n\t\t},\n\t\t// TODO better default value handling\n\t\t() => set(is_checkbox ? [] : null)\n\t);\n\n\trender_effect(() => {\n\t\tvar value = get();\n\n\t\t// If we are hydrating and the value has since changed, then use the update value\n\t\t// from the input instead.\n\t\tif (hydrating && input.defaultChecked !== input.checked) {\n\t\t\thydration_mismatch = true;\n\t\t\treturn;\n\t\t}\n\n\t\tif (is_checkbox) {\n\t\t\tvalue = value || [];\n\t\t\t// @ts-ignore\n\t\t\tinput.checked = value.includes(input.__value);\n\t\t} else {\n\t\t\t// @ts-ignore\n\t\t\tinput.checked = is(input.__value, value);\n\t\t}\n\t});\n\n\tteardown(() => {\n\t\tvar index = binding_group.indexOf(input);\n\n\t\tif (index !== -1) {\n\t\t\tbinding_group.splice(index, 1);\n\t\t}\n\t});\n\n\tif (!pending.has(binding_group)) {\n\t\tpending.add(binding_group);\n\n\t\tqueue_micro_task(() => {\n\t\t\t// necessary to maintain binding group order in all insertion scenarios\n\t\t\tbinding_group.sort((a, b) => (a.compareDocumentPosition(b) === 4 ? -1 : 1));\n\t\t\tpending.delete(binding_group);\n\t\t});\n\t}\n\n\tqueue_micro_task(() => {\n\t\tif (hydration_mismatch) {\n\t\t\tvar value;\n\n\t\t\tif (is_checkbox) {\n\t\t\t\tvalue = get_binding_group_value(binding_group, value, input.checked);\n\t\t\t} else {\n\t\t\t\tvar hydration_input = binding_group.find((input) => input.checked);\n\t\t\t\t// @ts-ignore\n\t\t\t\tvalue = hydration_input?.__value;\n\t\t\t}\n\n\t\t\tset(value);\n\t\t}\n\t});\n}\n\n/**\n * @param {HTMLInputElement} input\n * @param {() => unknown} get\n * @param {(value: unknown) => void} set\n * @returns {void}\n */\nexport function bind_checked(input, get, set = get) {\n\tlisten_to_event_and_reset_event(input, 'change', (is_reset) => {\n\t\tvar value = is_reset ? input.defaultChecked : input.checked;\n\t\tset(value);\n\t});\n\n\tif (\n\t\t// If we are hydrating and the value has since changed,\n\t\t// then use the update value from the input instead.\n\t\t(hydrating && input.defaultChecked !== input.checked) ||\n\t\t// If defaultChecked is set, then checked == defaultChecked\n\t\tuntrack(get) == null\n\t) {\n\t\tset(input.checked);\n\t}\n\n\trender_effect(() => {\n\t\tvar value = get();\n\t\tinput.checked = Boolean(value);\n\t});\n}\n\n/**\n * @template V\n * @param {Array<HTMLInputElement>} group\n * @param {V} __value\n * @param {boolean} checked\n * @returns {V[]}\n */\nfunction get_binding_group_value(group, __value, checked) {\n\t/** @type {Set<V>} */\n\tvar value = new Set();\n\n\tfor (var i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) {\n\t\t\t// @ts-ignore\n\t\t\tvalue.add(group[i].__value);\n\t\t}\n\t}\n\n\tif (!checked) {\n\t\tvalue.delete(__value);\n\t}\n\n\treturn Array.from(value);\n}\n\n/**\n * @param {HTMLInputElement} input\n */\nfunction is_numberlike_input(input) {\n\tvar type = input.type;\n\treturn type === 'number' || type === 'range';\n}\n\n/**\n * @param {string} value\n */\nfunction to_number(value) {\n\treturn value === '' ? null : +value;\n}\n\n/**\n * @param {HTMLInputElement} input\n * @param {() => FileList | null} get\n * @param {(value: FileList | null) => void} set\n */\nexport function bind_files(input, get, set = get) {\n\tlisten_to_event_and_reset_event(input, 'change', () => {\n\t\tset(input.files);\n\t});\n\n\tif (\n\t\t// If we are hydrating and the value has since changed,\n\t\t// then use the updated value from the input instead.\n\t\thydrating &&\n\t\tinput.files\n\t) {\n\t\tset(input.files);\n\t}\n\n\trender_effect(() => {\n\t\tinput.files = get();\n\t});\n}\n","/**\n * Audio Context Manager\n *\n * Provides a singleton AudioContext instance with browser compatibility\n * handling and unlock functionality for iOS/Safari.\n *\n * @module audio/context\n */\n\nlet audioContext = null;\n\n/**\n * Get the global AudioContext instance\n * @returns {AudioContext} The audio context\n */\nexport function getAudioContext() {\n  if (!audioContext) {\n    const AudioContextClass =\n      (typeof window !== 'undefined' && (window.AudioContext || window.webkitAudioContext)) ||\n      globalThis.AudioContext ||\n      globalThis.webkitAudioContext;\n\n    if (!AudioContextClass) {\n      throw new Error('AudioContext is not available in this environment');\n    }\n\n    audioContext = new AudioContextClass();\n  }\n  return audioContext;\n}\n\n/**\n * Unlock AudioContext on iOS (required for user interaction)\n * @returns {Promise<void>}\n */\nexport async function unlockAudioContext() {\n  const ctx = getAudioContext();\n\n  if (ctx.state === 'suspended') {\n    const buffer = ctx.createBuffer(1, 1, 8000);\n    const source = ctx.createBufferSource();\n    source.buffer = buffer;\n    source.connect(ctx.destination);\n    source.start(0);\n\n    try {\n      await ctx.resume();\n      console.log('âœ“ AudioContext unlocked');\n    } catch (error) {\n      console.error('Failed to unlock AudioContext:', error);\n    }\n  }\n}\n\n/**\n * Suspend AudioContext\n */\nexport function suspendAudioContext() {\n  if (audioContext && audioContext.state === 'running') {\n    audioContext.suspend();\n  }\n}\n","/**\n * Piano Voice Generator\n *\n * Creates a single polyphonic voice with three detuned oscillators\n * and ADSR envelope. Designed for warm, chorus-like timbre.\n *\n * Features:\n * - Multiple detuned oscillators for rich, warm tone\n * - Configurable ADSR envelope\n * - Velocity-sensitive amplitude\n * - Smooth parameter automation (no clicks/pops)\n * - Dynamic detuning control for adaptive chorus effect\n *\n * @module audio/synthesis/piano-voice\n */\n\nimport { getAudioContext } from '../context.js';\n\nconst DEFAULT_DETUNE_CENTS = [0, 15, -20];\nconst DEFAULT_ATTACK = 0.05;\nconst DEFAULT_DECAY = 0.2;\nconst DEFAULT_SUSTAIN = 0.6;\nconst DEFAULT_RELEASE = 1.0;\nconst FREQUENCY_RAMP_TIME = 0.05; // Smooth frequency changes over 50ms\nconst VELOCITY_RAMP_TIME = 0.01; // Quick velocity response\nconst MIN_FREQUENCY = 20;\nconst MAX_FREQUENCY = 20000;\n\n/**\n * Creates a piano voice with detuned oscillators and envelope\n *\n * Architecture:\n * Oscillators (3x detuned) â†’ Envelope (ADSR) â†’ Velocity Gain â†’ Output\n *\n * @param {Object} options - Configuration options\n * @param {number} [options.frequency=440] - Frequency in Hz (20-20000)\n * @param {number} [options.velocity=100] - Velocity (0-127, MIDI range)\n * @param {number} [options.attackTime=0.05] - Attack time in seconds\n * @param {number} [options.decayTime=0.2] - Decay time in seconds\n * @param {number} [options.sustainLevel=0.6] - Sustain level (0-1)\n * @param {number} [options.releaseTime=1.0] - Release time in seconds\n * @param {number[]} [options.detuneCents] - Custom detuning in cents [osc1, osc2, osc3]\n * @param {number} [options.velocityScale=0.3] - Scale factor for velocity (0-1)\n * @returns {Object} Piano voice instance with methods for control\n * @throws {Error} If frequency is out of valid range\n */\nexport function createPianoVoice(options = {}) {\n  const ctx = getAudioContext();\n  const {\n    frequency = 440,\n    velocity = 100,\n    attackTime = DEFAULT_ATTACK,\n    decayTime = DEFAULT_DECAY,\n    sustainLevel = DEFAULT_SUSTAIN,\n    releaseTime = DEFAULT_RELEASE,\n    detuneCents = DEFAULT_DETUNE_CENTS,\n    velocityScale = 0.3\n  } = options;\n\n  // Validate inputs\n  if (frequency < MIN_FREQUENCY || frequency > MAX_FREQUENCY) {\n    throw new Error(\n      `Frequency out of range: ${frequency} Hz. Valid range: ${MIN_FREQUENCY}-${MAX_FREQUENCY} Hz`\n    );\n  }\n\n  if (velocity < 0 || velocity > 127) {\n    throw new Error(`Velocity out of range: ${velocity}. Valid range: 0-127`);\n  }\n\n  if (attackTime < 0 || decayTime < 0 || releaseTime < 0) {\n    throw new Error('Attack, decay, and release times must be non-negative');\n  }\n\n  if (sustainLevel < 0 || sustainLevel > 1) {\n    throw new Error('Sustain level must be between 0 and 1');\n  }\n\n  // Create oscillators with detuning\n  const oscillators = detuneCents.map((cents) => {\n    const osc = ctx.createOscillator();\n    osc.type = 'sine';\n    osc.frequency.value = frequency;\n    osc.detune.value = cents;\n    return osc;\n  });\n\n  // Create envelope\n  const envelope = ctx.createGain();\n  envelope.gain.value = 0;\n\n  // Create velocity controller\n  const velocityGain = ctx.createGain();\n  const normalizedVelocity = velocity / 127;\n  velocityGain.gain.value = normalizedVelocity * velocityScale;\n\n  // Internal state\n  let isPlaying = false;\n  let currentFrequency = frequency;\n  let currentVelocity = velocity;\n  let currentDetuning = [...detuneCents];\n\n  // Connect oscillators to envelope\n  oscillators.forEach((osc) => osc.connect(envelope));\n  envelope.connect(velocityGain);\n\n  /**\n   * Validates and updates envelope times\n   * @private\n   */\n  function validateEnvelopeTimes(attack, decay, sustain, release) {\n    if (attack < 0 || decay < 0 || release < 0) {\n      throw new Error('Envelope times must be non-negative');\n    }\n    if (sustain < 0 || sustain > 1) {\n      throw new Error('Sustain level must be between 0 and 1');\n    }\n  }\n\n  // Public interface\n  return {\n    // Audio nodes (for advanced connections)\n    oscillators,\n    envelope,\n    velocityGain,\n\n    // State getters\n    getIsPlaying() {\n      return isPlaying;\n    },\n\n    getFrequency() {\n      return currentFrequency;\n    },\n\n    getVelocity() {\n      return currentVelocity;\n    },\n\n    getDetuning() {\n      return [...currentDetuning];\n    },\n\n    /**\n     * Start the voice and trigger ADSR envelope\n     * Automatically schedules attack, decay, and sustain phases.\n     *\n     * @returns {Object} this (for chaining)\n     */\n    noteOn() {\n      if (isPlaying) {\n        // If already playing, restart envelope\n        this.noteOff();\n      }\n\n      const now = ctx.currentTime;\n      isPlaying = true;\n\n      // Start all oscillators\n      oscillators.forEach((osc) => osc.start(now));\n\n      // Schedule ADSR envelope\n      // Attack: 0 â†’ 1\n      envelope.gain.setValueAtTime(0, now);\n      envelope.gain.linearRampToValueAtTime(1, now + attackTime);\n\n      // Decay: 1 â†’ sustain level\n      envelope.gain.linearRampToValueAtTime(\n        sustainLevel,\n        now + attackTime + decayTime\n      );\n\n      return this;\n    },\n\n    /**\n     * Release the voice (trigger release phase)\n     * Smoothly ramps gain to 0 and stops oscillators.\n     *\n     * @returns {Object} this (for chaining)\n     */\n    noteOff() {\n      const now = ctx.currentTime;\n      isPlaying = false;\n\n      // Capture current gain value to avoid clicks\n      envelope.gain.setValueAtTime(envelope.gain.value, now);\n\n      // Release: current value â†’ 0\n      envelope.gain.linearRampToValueAtTime(0, now + releaseTime);\n\n      // Stop oscillators after release completes\n      oscillators.forEach((osc) => osc.stop(now + releaseTime));\n\n      return this;\n    },\n\n    /**\n     * Connect voice to destination node\n     *\n     * @param {AudioNode} destination - Target node (e.g., audioContext.destination)\n     * @returns {Object} this (for chaining)\n     */\n    connect(destination) {\n      velocityGain.connect(destination);\n      return this;\n    },\n\n    /**\n     * Disconnect voice from all destinations\n     *\n     * @returns {Object} this (for chaining)\n     */\n    disconnect() {\n      velocityGain.disconnect();\n      return this;\n    },\n\n    /**\n     * Set frequency with smooth ramping\n     * Prevents clicks/pops by ramping over 50ms.\n     *\n     * @param {number} freq - Frequency in Hz (20-20000)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If frequency is out of valid range\n     */\n    setFrequency(freq) {\n      if (freq < MIN_FREQUENCY || freq > MAX_FREQUENCY) {\n        throw new Error(\n          `Frequency out of range: ${freq} Hz. Valid range: ${MIN_FREQUENCY}-${MAX_FREQUENCY} Hz`\n        );\n      }\n\n      currentFrequency = freq;\n      const now = ctx.currentTime;\n\n      // Smooth frequency change over FREQUENCY_RAMP_TIME\n      oscillators.forEach((osc) => {\n        osc.frequency.linearRampToValueAtTime(freq, now + FREQUENCY_RAMP_TIME);\n      });\n\n      return this;\n    },\n\n    /**\n     * Set velocity (amplitude control)\n     * Velocity affects final output level based on velocityScale.\n     *\n     * @param {number} vel - Velocity (0-127, MIDI range)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If velocity is out of valid range\n     */\n    setVelocity(vel) {\n      if (vel < 0 || vel > 127) {\n        throw new Error(`Velocity out of range: ${vel}. Valid range: 0-127`);\n      }\n\n      currentVelocity = vel;\n      const now = ctx.currentTime;\n      const normalizedVel = vel / 127;\n\n      // Quick velocity response (10ms ramp)\n      velocityGain.gain.linearRampToValueAtTime(\n        normalizedVel * velocityScale,\n        now + VELOCITY_RAMP_TIME\n      );\n\n      return this;\n    },\n\n    /**\n     * Dynamically adjust detuning of oscillators\n     * Allows for adaptive chorus/detune effects post-initialization.\n     *\n     * @param {number[]} newDetuneCents - New detuning values in cents [osc1, osc2, osc3]\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If detuning array length doesn't match oscillator count\n     */\n    setDetuning(newDetuneCents) {\n      if (newDetuneCents.length !== oscillators.length) {\n        throw new Error(\n          `Detuning array length (${newDetuneCents.length}) must match oscillator count (${oscillators.length})`\n        );\n      }\n\n      currentDetuning = [...newDetuneCents];\n      const now = ctx.currentTime;\n\n      // Apply detuning with smooth ramping\n      oscillators.forEach((osc, index) => {\n        osc.detune.linearRampToValueAtTime(\n          newDetuneCents[index],\n          now + FREQUENCY_RAMP_TIME\n        );\n      });\n\n      return this;\n    },\n\n    /**\n     * Update ADSR envelope times\n     * Can be called while voice is playing to create dynamic envelope changes.\n     *\n     * @param {Object} envelopeParams - New envelope parameters\n     * @param {number} envelopeParams.attackTime - Attack time in seconds\n     * @param {number} envelopeParams.decayTime - Decay time in seconds\n     * @param {number} envelopeParams.sustainLevel - Sustain level (0-1)\n     * @param {number} envelopeParams.releaseTime - Release time in seconds\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If parameters are invalid\n     */\n    setEnvelope(envelopeParams) {\n      const {\n        attackTime: newAttack,\n        decayTime: newDecay,\n        sustainLevel: newSustain,\n        releaseTime: newRelease\n      } = envelopeParams;\n\n      validateEnvelopeTimes(newAttack, newDecay, newSustain, newRelease);\n\n      // Note: Updating envelope times won't retroactively affect\n      // currently playing notes. This is by design - envelope times\n      // only affect notes started AFTER this call.\n      // TODO: Implement dynamic envelope reshaping if needed\n\n      return this;\n    },\n\n    /**\n     * Get current state snapshot\n     *\n     * @returns {Object} Current voice state\n     */\n    getState() {\n      return {\n        isPlaying,\n        frequency: currentFrequency,\n        velocity: currentVelocity,\n        detuning: [...currentDetuning],\n        envelopePhase: isPlaying ? 'sustain' : 'idle' // Simplified for now\n      };\n    }\n  };\n}\n","/**\n * Saturation Effect (Tape Warmth)\n *\n * Adds gentle harmonic saturation for a warm, vintage tape-like tone.\n * Uses soft clipping to simulate tape saturation without harsh distortion.\n *\n * Features:\n * - Soft clipping saturation\n * - Tone control (adjustable harmonic character)\n * - Input/output gain control\n * - Smooth parameter automation\n *\n * @module audio/effects/saturation\n */\n\nimport { getAudioContext } from '../context.js';\n\nconst DEFAULT_AMOUNT = 0.3; // 0-1, how much saturation\nconst DEFAULT_TONE = 0.5; // 0-1, brightness of saturation\nconst MIN_FREQUENCY = 100; // Hz\nconst MAX_FREQUENCY = 10000; // Hz\n\n/**\n * Creates a soft-clipping saturation effect for warm tone\n *\n * @param {Object} options - Configuration options\n * @param {number} [options.amount=0.3] - Saturation amount (0-1)\n * @param {number} [options.tone=0.5] - Tone color (0-1, dark to bright)\n * @param {number} [options.dryWet=1] - Dry/wet balance (0=dry, 1=wet)\n * @returns {Object} Saturation effect instance\n * @throws {Error} If parameters are out of valid range\n */\nexport function createSaturation(options = {}) {\n  const ctx = getAudioContext();\n  const {\n    amount = DEFAULT_AMOUNT,\n    tone = DEFAULT_TONE,\n    dryWet = 1\n  } = options;\n\n  // Validate inputs\n  if (amount < 0 || amount > 1) {\n    throw new Error(`Saturation amount out of range: ${amount}. Valid range: 0-1`);\n  }\n\n  if (tone < 0 || tone > 1) {\n    throw new Error(`Saturation tone out of range: ${tone}. Valid range: 0-1`);\n  }\n\n  if (dryWet < 0 || dryWet > 1) {\n    throw new Error(`Dry/wet balance out of range: ${dryWet}. Valid range: 0-1`);\n  }\n\n  // Input gain control\n  const inputGain = ctx.createGain();\n  inputGain.gain.value = 1 + amount * 2; // Increase gain based on saturation amount\n\n  // Dry signal path\n  const dryGain = ctx.createGain();\n  dryGain.gain.value = 1 - dryWet;\n\n  // Wet signal path with saturation\n  const wetGain = ctx.createGain();\n  wetGain.gain.value = dryWet;\n\n  // Tone shaping (high-pass filter to control brightness)\n  const toneFilter = ctx.createBiquadFilter();\n  toneFilter.type = 'highshelf';\n  toneFilter.frequency.value = MIN_FREQUENCY + tone * (MAX_FREQUENCY - MIN_FREQUENCY);\n  toneFilter.gain.value = -10 + tone * 20; // -10dB to +10dB\n\n  // Output gain\n  const outputGain = ctx.createGain();\n  outputGain.gain.value = 1 / (1 + amount * 2); // Compensate for input gain\n\n  // Internal state\n  let currentAmount = amount;\n  let currentTone = tone;\n  let currentDryWet = dryWet;\n\n  /**\n   * Soft clipping saturation curve\n   * Uses tanh-like curve for smooth saturation\n   *\n   * @private\n   * @param {Float32Array} buffer - Audio buffer to process\n   * @param {number} intensity - Saturation intensity (0-1)\n   */\n  function applySoftClipping(buffer, intensity) {\n    const factor = 1 + intensity * 50; // Scale factor for saturation curve\n\n    for (let i = 0; i < buffer.length; i++) {\n      const sample = buffer[i];\n      // Soft clipping curve: tanh-like behavior\n      buffer[i] = (sample * factor) / (1 + Math.abs(sample * factor));\n    }\n  }\n\n  // Create a local offline context for saturation processing (if needed)\n  // For now, saturation is applied in real-time via ScriptProcessorNode\n  const processor = ctx.createScriptProcessor(4096, 1, 1);\n\n  processor.onaudioprocess = (event) => {\n    const input = event.inputBuffer.getChannelData(0);\n    const output = event.outputBuffer.getChannelData(0);\n\n    // Apply soft clipping saturation\n    applySoftClipping(input, currentAmount);\n\n    // Copy processed audio to output\n    for (let i = 0; i < input.length; i++) {\n      output[i] = input[i];\n    }\n  };\n\n  // Connect audio graph\n  // Input â†’ Input Gain â†’ (Dry Path & Tone-shaped Path) â†’ Output Gain â†’ Output\n  inputGain.connect(dryGain);\n  inputGain.connect(processor);\n  inputGain.connect(toneFilter);\n\n  dryGain.connect(outputGain);\n  processor.connect(toneFilter);\n  toneFilter.connect(wetGain);\n  wetGain.connect(outputGain);\n\n  // Public interface\n  return {\n    // Audio nodes for routing\n    get input() {\n      return inputGain;\n    },\n\n    get output() {\n      return outputGain;\n    },\n\n    // State getters\n    getAmount() {\n      return currentAmount;\n    },\n\n    getTone() {\n      return currentTone;\n    },\n\n    getDryWet() {\n      return currentDryWet;\n    },\n\n    /**\n     * Set saturation amount\n     *\n     * @param {number} newAmount - Saturation amount (0-1)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If amount is out of valid range\n     */\n    setAmount(newAmount) {\n      if (newAmount < 0 || newAmount > 1) {\n        throw new Error(`Saturation amount out of range: ${newAmount}. Valid range: 0-1`);\n      }\n\n      currentAmount = newAmount;\n      const now = ctx.currentTime;\n\n      // Smooth gain changes\n      const newGainValue = 1 + newAmount * 2;\n      inputGain.gain.linearRampToValueAtTime(newGainValue, now + 0.05);\n      outputGain.gain.linearRampToValueAtTime(1 / newGainValue, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set tone (brightness of saturation)\n     *\n     * @param {number} newTone - Tone control (0=dark, 1=bright)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If tone is out of valid range\n     */\n    setTone(newTone) {\n      if (newTone < 0 || newTone > 1) {\n        throw new Error(`Saturation tone out of range: ${newTone}. Valid range: 0-1`);\n      }\n\n      currentTone = newTone;\n      const now = ctx.currentTime;\n\n      // Smooth tone filter changes\n      const newFrequency = MIN_FREQUENCY + newTone * (MAX_FREQUENCY - MIN_FREQUENCY);\n      const newGain = -10 + newTone * 20;\n\n      toneFilter.frequency.linearRampToValueAtTime(newFrequency, now + 0.05);\n      toneFilter.gain.linearRampToValueAtTime(newGain, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set dry/wet balance\n     *\n     * @param {number} newDryWet - Balance (0=dry only, 1=wet only)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If balance is out of valid range\n     */\n    setDryWet(newDryWet) {\n      if (newDryWet < 0 || newDryWet > 1) {\n        throw new Error(`Dry/wet balance out of range: ${newDryWet}. Valid range: 0-1`);\n      }\n\n      currentDryWet = newDryWet;\n      const now = ctx.currentTime;\n\n      dryGain.gain.linearRampToValueAtTime(1 - newDryWet, now + 0.05);\n      wetGain.gain.linearRampToValueAtTime(newDryWet, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Connect saturation to input source\n     *\n     * @param {AudioNode} source - Source to connect from\n     * @returns {Object} this (for chaining)\n     */\n    connect(source) {\n      source.connect(this.input);\n      return this;\n    },\n\n    /**\n     * Disconnect saturation effect\n     *\n     * @returns {Object} this (for chaining)\n     */\n    disconnect() {\n      inputGain.disconnect();\n      dryGain.disconnect();\n      wetGain.disconnect();\n      processor.disconnect();\n      toneFilter.disconnect();\n      outputGain.disconnect();\n      return this;\n    },\n\n    /**\n     * Get current effect state\n     *\n     * @returns {Object} Effect state\n     */\n    getState() {\n      return {\n        amount: currentAmount,\n        tone: currentTone,\n        dryWet: currentDryWet\n      };\n    }\n  };\n}\n","/**\n * Dynamic Range Compressor\n *\n * Reduces dynamic range to keep audio levels consistent.\n * Essential for controlling piano dynamics and achieving cohesive mix.\n *\n * Features:\n * - Threshold, ratio, attack, release controls\n * - Makeup gain to compensate for reduction\n * - Look-ahead mode for smoother compression\n * - Dry/wet mixing\n *\n * @module audio/effects/compression\n */\n\nimport { getAudioContext } from '../context.js';\n\nconst DEFAULT_THRESHOLD = -24; // dB\nconst DEFAULT_RATIO = 4; // 4:1 compression\nconst DEFAULT_ATTACK = 0.003; // seconds (3ms for piano)\nconst DEFAULT_RELEASE = 0.25; // seconds\nconst DEFAULT_KNEE = 30; // dB (soft knee)\n\n/**\n * Creates a dynamic range compressor effect\n *\n * @param {Object} options - Configuration options\n * @param {number} [options.threshold=-24] - Threshold in dB\n * @param {number} [options.ratio=4] - Compression ratio (1:ratio)\n * @param {number} [options.attack=0.003] - Attack time in seconds\n * @param {number} [options.release=0.25] - Release time in seconds\n * @param {number} [options.knee=30] - Knee in dB (soft knee range)\n * @param {number} [options.dryWet=1] - Dry/wet balance (0-1)\n * @returns {Object} Compressor instance\n * @throws {Error} If parameters are out of valid range\n */\nexport function createCompressor(options = {}) {\n  const ctx = getAudioContext();\n  const {\n    threshold = DEFAULT_THRESHOLD,\n    ratio = DEFAULT_RATIO,\n    attack = DEFAULT_ATTACK,\n    release = DEFAULT_RELEASE,\n    knee = DEFAULT_KNEE,\n    dryWet = 1\n  } = options;\n\n  // Validate inputs\n  if (threshold < -100 || threshold > 0) {\n    throw new Error(`Compressor threshold out of range: ${threshold} dB. Valid range: -100 to 0 dB`);\n  }\n\n  if (ratio < 1 || ratio > 20) {\n    throw new Error(`Compression ratio out of range: ${ratio}. Valid range: 1-20`);\n  }\n\n  if (attack < 0 || attack > 1) {\n    throw new Error(`Attack time out of range: ${attack}s. Valid range: 0-1s`);\n  }\n\n  if (release < 0 || release > 2) {\n    throw new Error(`Release time out of range: ${release}s. Valid range: 0-2s`);\n  }\n\n  if (dryWet < 0 || dryWet > 1) {\n    throw new Error(`Dry/wet balance out of range: ${dryWet}. Valid range: 0-1`);\n  }\n\n  // Create dynamic compressor node\n  const compressor = ctx.createDynamicsCompressor();\n  compressor.threshold.value = threshold;\n  compressor.ratio.value = ratio;\n  compressor.attack.value = attack;\n  compressor.release.value = release;\n  compressor.knee.value = knee;\n\n  // Dry/wet mixing\n  const dryGain = ctx.createGain();\n  dryGain.gain.value = 1 - dryWet;\n\n  const wetGain = ctx.createGain();\n  wetGain.gain.value = dryWet;\n\n  // Makeup gain to compensate for reduction\n  const makeupGain = ctx.createGain();\n  makeupGain.gain.value = 1; // Will be calculated based on threshold and ratio\n\n  // Master gain\n  const inputGain = ctx.createGain();\n  inputGain.gain.value = 1;\n\n  const outputGain = ctx.createGain();\n  outputGain.gain.value = 1;\n\n  // Internal state\n  let currentThreshold = threshold;\n  let currentRatio = ratio;\n  let currentAttack = attack;\n  let currentRelease = release;\n  let currentDryWet = dryWet;\n\n  /**\n   * Calculate makeup gain to compensate for compression reduction\n   * @private\n   */\n  function calculateMakeupGain() {\n    // Simplified makeup gain calculation\n    // For a given reduction, apply opposite gain\n    const maxReduction = currentThreshold * (1 - 1 / currentRatio);\n    return Math.abs(maxReduction) / 20; // Convert dB to linear\n  }\n\n  // Connect audio graph\n  inputGain.connect(dryGain);\n  inputGain.connect(compressor);\n\n  compressor.connect(makeupGain);\n  makeupGain.connect(wetGain);\n\n  dryGain.connect(outputGain);\n  wetGain.connect(outputGain);\n\n  // Public interface\n  return {\n    // Audio nodes for routing\n    get input() {\n      return inputGain;\n    },\n\n    get output() {\n      return outputGain;\n    },\n\n    // Compressor node (for advanced inspection)\n    get compressorNode() {\n      return compressor;\n    },\n\n    // State getters\n    getThreshold() {\n      return currentThreshold;\n    },\n\n    getRatio() {\n      return currentRatio;\n    },\n\n    getAttack() {\n      return currentAttack;\n    },\n\n    getRelease() {\n      return currentRelease;\n    },\n\n    getDryWet() {\n      return currentDryWet;\n    },\n\n    getReduction() {\n      // Returns current reduction in dB (read from compressor)\n      return compressor.reduction;\n    },\n\n    /**\n     * Set compression threshold\n     *\n     * @param {number} newThreshold - Threshold in dB (-100 to 0)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If threshold is out of valid range\n     */\n    setThreshold(newThreshold) {\n      if (newThreshold < -100 || newThreshold > 0) {\n        throw new Error(`Compressor threshold out of range: ${newThreshold} dB. Valid range: -100 to 0 dB`);\n      }\n\n      currentThreshold = newThreshold;\n      const now = ctx.currentTime;\n\n      compressor.threshold.linearRampToValueAtTime(newThreshold, now + 0.05);\n      makeupGain.gain.linearRampToValueAtTime(calculateMakeupGain(), now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set compression ratio\n     *\n     * @param {number} newRatio - Ratio (1:newRatio)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If ratio is out of valid range\n     */\n    setRatio(newRatio) {\n      if (newRatio < 1 || newRatio > 20) {\n        throw new Error(`Compression ratio out of range: ${newRatio}. Valid range: 1-20`);\n      }\n\n      currentRatio = newRatio;\n      const now = ctx.currentTime;\n\n      compressor.ratio.linearRampToValueAtTime(newRatio, now + 0.05);\n      makeupGain.gain.linearRampToValueAtTime(calculateMakeupGain(), now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set attack time\n     *\n     * @param {number} newAttack - Attack time in seconds (0-1)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If attack is out of valid range\n     */\n    setAttack(newAttack) {\n      if (newAttack < 0 || newAttack > 1) {\n        throw new Error(`Attack time out of range: ${newAttack}s. Valid range: 0-1s`);\n      }\n\n      currentAttack = newAttack;\n      const now = ctx.currentTime;\n\n      compressor.attack.linearRampToValueAtTime(newAttack, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set release time\n     *\n     * @param {number} newRelease - Release time in seconds (0-2)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If release is out of valid range\n     */\n    setRelease(newRelease) {\n      if (newRelease < 0 || newRelease > 2) {\n        throw new Error(`Release time out of range: ${newRelease}s. Valid range: 0-2s`);\n      }\n\n      currentRelease = newRelease;\n      const now = ctx.currentTime;\n\n      compressor.release.linearRampToValueAtTime(newRelease, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set dry/wet balance\n     *\n     * @param {number} newDryWet - Balance (0=dry, 1=wet)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If balance is out of valid range\n     */\n    setDryWet(newDryWet) {\n      if (newDryWet < 0 || newDryWet > 1) {\n        throw new Error(`Dry/wet balance out of range: ${newDryWet}. Valid range: 0-1`);\n      }\n\n      currentDryWet = newDryWet;\n      const now = ctx.currentTime;\n\n      dryGain.gain.linearRampToValueAtTime(1 - newDryWet, now + 0.05);\n      wetGain.gain.linearRampToValueAtTime(newDryWet, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Connect compressor to input\n     *\n     * @param {AudioNode} source - Source to connect from\n     * @returns {Object} this (for chaining)\n     */\n    connect(source) {\n      source.connect(this.input);\n      return this;\n    },\n\n    /**\n     * Disconnect compressor\n     *\n     * @returns {Object} this (for chaining)\n     */\n    disconnect() {\n      inputGain.disconnect();\n      dryGain.disconnect();\n      wetGain.disconnect();\n      compressor.disconnect();\n      makeupGain.disconnect();\n      outputGain.disconnect();\n      return this;\n    },\n\n    /**\n     * Get current effect state\n     *\n     * @returns {Object} Effect state\n     */\n    getState() {\n      return {\n        threshold: currentThreshold,\n        ratio: currentRatio,\n        attack: currentAttack,\n        release: currentRelease,\n        dryWet: currentDryWet,\n        currentReduction: this.getReduction()\n      };\n    }\n  };\n}\n","/**\n * Reverb Effect (Space & Ambience)\n *\n * Creates a simple reverb effect to add space and vintage character.\n * Uses a combination of delays to simulate room reflections.\n *\n * Features:\n * - Room size control\n * - Decay time control\n * - Pre-delay for realism\n * - Dry/wet mixing\n * - Simple convolver-based approach\n *\n * @module audio/effects/reverb\n */\n\nimport { getAudioContext } from '../context.js';\n\nconst DEFAULT_DECAY_TIME = 2.0; // seconds\nconst DEFAULT_ROOM_SIZE = 0.5; // 0-1\nconst DEFAULT_PRE_DELAY = 0.02; // 20ms\nconst DEFAULT_DRY_WET = 0.3; // Subtle reverb\n\n/**\n * Creates a reverb effect for space and ambience\n *\n * @param {Object} options - Configuration options\n * @param {number} [options.decayTime=2.0] - Reverb decay time in seconds\n * @param {number} [options.roomSize=0.5] - Room size (0-1, small to large)\n * @param {number} [options.preDelay=0.02] - Pre-delay before reverb in seconds\n * @param {number} [options.dryWet=0.3] - Dry/wet balance (0-1)\n * @returns {Object} Reverb instance\n * @throws {Error} If parameters are out of valid range\n */\nexport function createReverb(options = {}) {\n  const ctx = getAudioContext();\n  const {\n    decayTime = DEFAULT_DECAY_TIME,\n    roomSize = DEFAULT_ROOM_SIZE,\n    preDelay = DEFAULT_PRE_DELAY,\n    dryWet = DEFAULT_DRY_WET\n  } = options;\n\n  // Validate inputs\n  if (decayTime < 0.1 || decayTime > 10) {\n    throw new Error(`Decay time out of range: ${decayTime}s. Valid range: 0.1-10s`);\n  }\n\n  if (roomSize < 0 || roomSize > 1) {\n    throw new Error(`Room size out of range: ${roomSize}. Valid range: 0-1`);\n  }\n\n  if (preDelay < 0 || preDelay > 1) {\n    throw new Error(`Pre-delay out of range: ${preDelay}s. Valid range: 0-1s`);\n  }\n\n  if (dryWet < 0 || dryWet > 1) {\n    throw new Error(`Dry/wet balance out of range: ${dryWet}. Valid range: 0-1`);\n  }\n\n  // Input stage\n  const inputGain = ctx.createGain();\n  inputGain.gain.value = 1;\n\n  // Dry signal path\n  const dryGain = ctx.createGain();\n  dryGain.gain.value = 1 - dryWet;\n\n  // Wet signal path (reverb)\n  const wetGain = ctx.createGain();\n  wetGain.gain.value = dryWet;\n\n  // Pre-delay\n  const preDelayNode = ctx.createDelay(5); // Max 5 second delay\n  preDelayNode.delayTime.value = preDelay;\n\n  // Create multi-tap delay for reverb simulation\n  // Using multiple delays at different times to simulate room reflections\n  const delays = [];\n  const delayTimes = [0.037, 0.041, 0.043, 0.047]; // Prime numbers for natural sound\n  const delayGains = [];\n\n  delayTimes.forEach((time) => {\n    const delay = ctx.createDelay(time + 0.1);\n    delay.delayTime.value = time * roomSize; // Scale by room size\n    delays.push(delay);\n\n    const gain = ctx.createGain();\n    // Feedback to create decay\n    gain.gain.value = Math.pow(0.5, time / decayTime);\n    delayGains.push(gain);\n  });\n\n  // Feedback paths for extended reverb\n  const feedbackGain = ctx.createGain();\n  feedbackGain.gain.value = roomSize * 0.5;\n\n  // Tone control for reverb (low-pass filter to darken reflections)\n  const toneFilter = ctx.createBiquadFilter();\n  toneFilter.type = 'lowpass';\n  toneFilter.frequency.value = 5000; // Darken the reverb tail\n  toneFilter.Q.value = 0.7;\n\n  // Output stage\n  const outputGain = ctx.createGain();\n  outputGain.gain.value = 1;\n\n  // Internal state\n  let currentDecayTime = decayTime;\n  let currentRoomSize = roomSize;\n  let currentPreDelay = preDelay;\n  let currentDryWet = dryWet;\n\n  // Audio graph connections\n  inputGain.connect(dryGain);\n  inputGain.connect(preDelayNode);\n\n  // Delay chain with feedback\n  preDelayNode.connect(delays[0]);\n  for (let i = 0; i < delays.length; i++) {\n    delays[i].connect(delayGains[i]);\n    delayGains[i].connect(toneFilter);\n\n    // Create feedback loop (except for last delay)\n    if (i < delays.length - 1) {\n      delayGains[i].connect(delays[i + 1]);\n    }\n  }\n\n  // Final reverb path\n  toneFilter.connect(feedbackGain);\n  feedbackGain.connect(preDelayNode); // Feedback into reverb\n  toneFilter.connect(wetGain);\n\n  // Mix dry and wet\n  dryGain.connect(outputGain);\n  wetGain.connect(outputGain);\n\n  // Public interface\n  return {\n    // Audio nodes for routing\n    get input() {\n      return inputGain;\n    },\n\n    get output() {\n      return outputGain;\n    },\n\n    // State getters\n    getDecayTime() {\n      return currentDecayTime;\n    },\n\n    getRoomSize() {\n      return currentRoomSize;\n    },\n\n    getPreDelay() {\n      return currentPreDelay;\n    },\n\n    getDryWet() {\n      return currentDryWet;\n    },\n\n    /**\n     * Set reverb decay time\n     *\n     * @param {number} newDecayTime - Decay time in seconds (0.1-10)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If decay time is out of valid range\n     */\n    setDecayTime(newDecayTime) {\n      if (newDecayTime < 0.1 || newDecayTime > 10) {\n        throw new Error(`Decay time out of range: ${newDecayTime}s. Valid range: 0.1-10s`);\n      }\n\n      currentDecayTime = newDecayTime;\n      const now = ctx.currentTime;\n\n      // Update feedback gains based on new decay time\n      delayGains.forEach((gain, index) => {\n        const newGainValue = Math.pow(0.5, delayTimes[index] / newDecayTime);\n        gain.gain.linearRampToValueAtTime(newGainValue, now + 0.1);\n      });\n\n      return this;\n    },\n\n    /**\n     * Set room size\n     *\n     * @param {number} newRoomSize - Room size (0-1, small to large)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If room size is out of valid range\n     */\n    setRoomSize(newRoomSize) {\n      if (newRoomSize < 0 || newRoomSize > 1) {\n        throw new Error(`Room size out of range: ${newRoomSize}. Valid range: 0-1`);\n      }\n\n      currentRoomSize = newRoomSize;\n      const now = ctx.currentTime;\n\n      // Update delay times based on room size\n      delays.forEach((delay, index) => {\n        const newDelayTime = delayTimes[index] * newRoomSize;\n        delay.delayTime.linearRampToValueAtTime(newDelayTime, now + 0.05);\n      });\n\n      // Update feedback\n      feedbackGain.gain.linearRampToValueAtTime(newRoomSize * 0.5, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set pre-delay\n     *\n     * @param {number} newPreDelay - Pre-delay in seconds (0-1)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If pre-delay is out of valid range\n     */\n    setPreDelay(newPreDelay) {\n      if (newPreDelay < 0 || newPreDelay > 1) {\n        throw new Error(`Pre-delay out of range: ${newPreDelay}s. Valid range: 0-1s`);\n      }\n\n      currentPreDelay = newPreDelay;\n      const now = ctx.currentTime;\n\n      preDelayNode.delayTime.linearRampToValueAtTime(newPreDelay, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set dry/wet balance\n     *\n     * @param {number} newDryWet - Balance (0=dry, 1=wet)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If balance is out of valid range\n     */\n    setDryWet(newDryWet) {\n      if (newDryWet < 0 || newDryWet > 1) {\n        throw new Error(`Dry/wet balance out of range: ${newDryWet}. Valid range: 0-1`);\n      }\n\n      currentDryWet = newDryWet;\n      const now = ctx.currentTime;\n\n      dryGain.gain.linearRampToValueAtTime(1 - newDryWet, now + 0.05);\n      wetGain.gain.linearRampToValueAtTime(newDryWet, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set reverb tone (brightness of reverb tail)\n     *\n     * @param {number} frequency - Filter frequency in Hz\n     * @returns {Object} this (for chaining)\n     */\n    setTone(frequency) {\n      if (frequency < 100 || frequency > 20000) {\n        throw new Error(`Tone frequency out of range: ${frequency} Hz`);\n      }\n\n      const now = ctx.currentTime;\n      toneFilter.frequency.linearRampToValueAtTime(frequency, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Connect reverb to input\n     *\n     * @param {AudioNode} source - Source to connect from\n     * @returns {Object} this (for chaining)\n     */\n    connect(source) {\n      source.connect(this.input);\n      return this;\n    },\n\n    /**\n     * Disconnect reverb\n     *\n     * @returns {Object} this (for chaining)\n     */\n    disconnect() {\n      inputGain.disconnect();\n      dryGain.disconnect();\n      wetGain.disconnect();\n      preDelayNode.disconnect();\n      delays.forEach((delay) => delay.disconnect());\n      delayGains.forEach((gain) => gain.disconnect());\n      feedbackGain.disconnect();\n      toneFilter.disconnect();\n      outputGain.disconnect();\n      return this;\n    },\n\n    /**\n     * Get current effect state\n     *\n     * @returns {Object} Effect state\n     */\n    getState() {\n      return {\n        decayTime: currentDecayTime,\n        roomSize: currentRoomSize,\n        preDelay: currentPreDelay,\n        dryWet: currentDryWet\n      };\n    }\n  };\n}\n","/**\n * Audio State Management\n *\n * Manages audio state for the LoFi Piano.\n * Uses plain JavaScript objects with callback-based updates.\n * Component scripts use Svelte 5 $state to wrap these values.\n *\n * Features:\n * - Integration with audio DSP modules\n * - MIDI note to frequency conversion\n * - Preset management\n * - Parameter change callbacks\n *\n * Note: This is a plain JS module. Use $state in Svelte components\n * to make values reactive, or create a .svelte component wrapper.\n *\n * @module stores/audio-state\n */\nimport { createPianoVoice } from '../audio/synthesis/piano-voice.js';\nimport { createSaturation } from '../audio/effects/saturation.js';\nimport { createCompressor } from '../audio/effects/compression.js';\nimport { createReverb } from '../audio/effects/reverb.js';\nimport { getAudioContext } from '../audio/context.js';\n\n/**\n * Create the global audio state object with integrated DSP\n *\n * @returns {Object} Audio state with reactive properties and audio nodes\n */\nexport function createAudioState() {\n  // Audio context and nodes\n  let audioContext = null;\n  let pianoVoices = new Map(); // Active voices keyed by MIDI note\n  let saturationEffect = null;\n  let compressionEffect = null;\n  let reverbEffect = null;\n  let masterGain = null;\n\n  // Piano state - plain JS object (wrap in $state in components)\n  const pianoState = {\n    isPlaying: false,\n    activeNotes: new Set(),\n    masterVolume: 0.5,\n    presetIndex: 0,\n    isInitialized: false\n  };\n\n  // Synthesis parameters (for new voices)\n  const synthesis = {\n    frequency: 440,\n    detune: [0, 15, -20],\n    velocity: 100,\n    attackTime: 0.05,\n    decayTime: 0.2,\n    sustainLevel: 0.6,\n    releaseTime: 1.0\n  };\n\n  // Effect parameters\n  const effects = {\n    saturation: {\n      amount: 0.3,\n      tone: 0.5,\n      dryWet: 1\n    },\n    compression: {\n      threshold: -24,\n      ratio: 4,\n      attack: 0.003,\n      release: 0.25,\n      dryWet: 1\n    },\n    reverb: {\n      decayTime: 2.0,\n      roomSize: 0.5,\n      preDelay: 0.02,\n      dryWet: 0.3\n    }\n  };\n\n  /**\n   * Initialize audio system\n   * Creates all audio nodes and connections\n   *\n   * @private\n   */\n  function initializeAudio() {\n    try {\n      audioContext = getAudioContext();\n      masterGain = audioContext.createGain();\n      masterGain.gain.value = pianoState.masterVolume;\n\n      // Create effect chain\n      saturationEffect = createSaturation({\n        amount: effects.saturation.amount,\n        tone: effects.saturation.tone,\n        dryWet: effects.saturation.dryWet\n      });\n\n      compressionEffect = createCompressor({\n        threshold: effects.compression.threshold,\n        ratio: effects.compression.ratio,\n        attack: effects.compression.attack,\n        release: effects.compression.release,\n        dryWet: effects.compression.dryWet\n      });\n\n      reverbEffect = createReverb({\n        decayTime: effects.reverb.decayTime,\n        roomSize: effects.reverb.roomSize,\n        preDelay: effects.reverb.preDelay,\n        dryWet: effects.reverb.dryWet\n      });\n\n      // Connect effect chain\n      saturationEffect.input.connect(compressionEffect.input);\n      compressionEffect.output.connect(reverbEffect.input);\n      reverbEffect.output.connect(masterGain);\n      masterGain.connect(audioContext.destination);\n\n      pianoState.isInitialized = true;\n    } catch (error) {\n      console.error('Failed to initialize audio:', error);\n      pianoState.isInitialized = false;\n    }\n  }\n\n  /**\n   * Ensure audio system is ready\n   * @private\n   */\n  function ensureAudioInitialized() {\n    if (!pianoState.isInitialized) {\n      initializeAudio();\n    }\n  }\n\n  /**\n   * Sync parameter changes to audio nodes\n   * These are called from component $effects when values change\n   */\n  function syncSaturation() {\n    if (!pianoState.isInitialized || !saturationEffect) return;\n    saturationEffect.setAmount(effects.saturation.amount);\n    saturationEffect.setTone(effects.saturation.tone);\n  }\n\n  function syncCompression() {\n    if (!pianoState.isInitialized || !compressionEffect) return;\n    compressionEffect.setThreshold(effects.compression.threshold);\n    compressionEffect.setRatio(effects.compression.ratio);\n    compressionEffect.setAttack(effects.compression.attack);\n    compressionEffect.setRelease(effects.compression.release);\n  }\n\n  function syncReverb() {\n    if (!pianoState.isInitialized || !reverbEffect) return;\n    reverbEffect.setDecay(effects.reverb.decayTime);\n    reverbEffect.setRoomSize(effects.reverb.roomSize);\n  }\n\n  function syncMasterVolume() {\n    if (!pianoState.isInitialized || !masterGain) return;\n    masterGain.gain.setValueAtTime(pianoState.masterVolume, getAudioContext().currentTime);\n  }\n\n  // Component $effects will call sync methods when values change\n\n  return {\n    // State objects\n    pianoState,\n    synthesis,\n    effects,\n\n    // Sync methods for $effects in components\n    syncSaturation,\n    syncCompression,\n    syncReverb,\n    syncMasterVolume,\n\n    /**\n     * Initialize audio system\n     * Must be called before playing notes\n     *\n     * @returns {Promise<void>}\n     */\n    async init() {\n      ensureAudioInitialized();\n    },\n\n    /**\n     * Play a piano note\n     *\n     * @param {number} note - MIDI note (0-127)\n     * @param {number} [velocity=100] - Velocity (0-127)\n     * @param {number} [duration] - Optional duration in ms\n     */\n    playNote(note, velocity = 100, duration = null) {\n      ensureAudioInitialized();\n\n      // Clamp note to valid MIDI range\n      const validNote = Math.max(0, Math.min(127, note));\n      const freq = noteToFrequency(validNote);\n\n      // Create new voice\n      const voice = createPianoVoice({\n        frequency: freq,\n        velocity: velocity,\n        attackTime: synthesis.attackTime,\n        decayTime: synthesis.decayTime,\n        sustainLevel: synthesis.sustainLevel,\n        releaseTime: synthesis.releaseTime,\n        detuneCents: synthesis.detune,\n        velocityScale: 0.3\n      });\n\n      // Connect voice to effect chain\n      voice.connect(saturationEffect.input);\n\n      // Start the note\n      voice.noteOn();\n\n      // Store voice reference\n      pianoVoices.set(validNote, voice);\n      pianoState.activeNotes.add(validNote);\n      pianoState.isPlaying = pianoState.activeNotes.size > 0;\n\n      // Optional: Stop note after duration\n      if (duration) {\n        setTimeout(() => {\n          this.stopNote(validNote);\n        }, duration);\n      }\n    },\n\n    /**\n     * Stop a piano note\n     *\n     * @param {number} note - MIDI note to stop (0-127)\n     */\n    stopNote(note) {\n      const validNote = Math.max(0, Math.min(127, note));\n      const voice = pianoVoices.get(validNote);\n\n      if (voice) {\n        voice.noteOff();\n\n        // Remove voice after release time\n        setTimeout(() => {\n          voice.disconnect();\n          pianoVoices.delete(validNote);\n        }, synthesis.releaseTime * 1000);\n      }\n\n      pianoState.activeNotes.delete(validNote);\n      pianoState.isPlaying = pianoState.activeNotes.size > 0;\n    },\n\n    /**\n     * Stop all active notes\n     */\n    stopAll() {\n      Array.from(pianoState.activeNotes).forEach((note) => {\n        this.stopNote(note);\n      });\n    },\n\n    /**\n     * Set a parameter value by path\n     *\n     * @param {string} path - Parameter path (e.g., \"effects.saturation.amount\")\n     * @param {number} value - New value\n     */\n    setParameter(path, value) {\n      const keys = path.split('.');\n      let obj = this;\n\n      // Navigate to parent object\n      for (let i = 0; i < keys.length - 1; i++) {\n        if (keys[i] in obj) {\n          obj = obj[keys[i]];\n        } else {\n          console.warn(`Parameter path not found: ${path}`);\n          return;\n        }\n      }\n\n      // Set the value\n      const lastKey = keys[keys.length - 1];\n      if (lastKey in obj) {\n        obj[lastKey] = value;\n      } else {\n        console.warn(`Parameter not found: ${path}`);\n      }\n    },\n\n    /**\n     * Get audio node for advanced routing\n     *\n     * @param {string} nodeName - Node name (saturation, compression, reverb, masterGain)\n     * @returns {AudioNode|null} Audio node or null\n     */\n    getAudioNode(nodeName) {\n      const nodes = {\n        saturation: saturationEffect?.output,\n        compression: compressionEffect?.output,\n        reverb: reverbEffect?.output,\n        masterGain: masterGain,\n        saturationInput: saturationEffect?.input,\n        compressionInput: compressionEffect?.input,\n        reverbInput: reverbEffect?.input\n      };\n\n      return nodes[nodeName] || null;\n    },\n\n    /**\n     * Get state snapshot of all effects and synthesis\n     *\n     * @returns {Object} Current state\n     */\n    getState() {\n      return {\n        pianoState: { ...pianoState },\n        synthesis: { ...synthesis },\n        effects: JSON.parse(JSON.stringify(effects)),\n        audioInitialized: pianoState.isInitialized\n      };\n    }\n  };\n}\n\n/**\n * Convert MIDI note to frequency\n * @param {number} note - MIDI note (0-127)\n * @returns {number} Frequency in Hz\n */\nexport function noteToFrequency(note) {\n  // A4 (MIDI note 69) = 440 Hz\n  return 440 * Math.pow(2, (note - 69) / 12);\n}\n\n/**\n * Convert frequency to MIDI note\n * @param {number} frequency - Frequency in Hz\n * @returns {number} MIDI note (0-127)\n */\nexport function frequencyToNote(frequency) {\n  return Math.round(69 + 12 * Math.log2(frequency / 440));\n}\n\n/**\n * Singleton instance\n */\nexport const audioState = createAudioState();\n","<script>\n  /**\n   * PianoKeyboard.svelte\n   *\n   * CONCEPT: A full 88-key piano keyboard UI with vintage aesthetic\n   *\n   * DESIGN PHILOSOPHY:\n   * - Minimalist, numbers-free design focusing on the act of playing\n   * - Vintage piano aesthetics (warm tones, wood-like surfaces)\n   * - Full mouse and touch support for flexibility\n   * - Keyboard support (QWERTY) for computer players\n   * - Visual feedback emphasizes motion and tactile response\n   *\n   * SVELTE 5 PATTERNS USED:\n   * - $props() for component properties\n   * - $state() for reactive local state (activeKeys, isMouseDown)\n   * - onMount() lifecycle hook for global event listeners\n   * - Cleanup function for proper listener removal on unmount\n   *\n   * INTERACTION PATTERNS:\n   * - Click/drag across keys to play multiple notes\n   * - Touch support for mobile/tablet playing\n   * - QWERTY keyboard mapping (Z-M, comma/period keys)\n   * - Visual feedback: depression effect, color change\n   * - Keyboard help text guides users\n   *\n   * ACCESSIBILITY:\n   * - ARIA labels for each key\n   * - Keyboard navigation support\n   * - Screen reader friendly\n   * - Focus indicators for accessibility\n   *\n   * USAGE:\n   * <PianoKeyboard\n   *   audioState={pianoState}\n   *   startNote={12}\n   *   keyCount={88}\n   *   showNoteNames={true}\n   *   showOctaveNumbers={true}\n   * />\n   */\n\n  import { onMount } from 'svelte';\n\n  // ===== PROPS DESTRUCTURING (Svelte 5 $props rune) =====\n  // audioState: Reference to the audio engine for playing/stopping notes\n  // startNote: MIDI note to start keyboard from (default A0 = 12)\n  // keyCount: Number of keys to display (default 88 = full piano)\n  // showNoteNames: Display C, C#, D, etc. on white keys\n  // showOctaveNumbers: Display octave numbers next to note names\n  let {\n    audioState = undefined,\n    startNote = 12,\n    keyCount = 88,\n    showNoteNames = true,\n    showOctaveNumbers = true\n  } = $props();\n\n  // ===== LOCAL REACTIVE STATE (Svelte 5 $state rune) =====\n  // keyboardElement: Reference to the keyboard container DOM node\n  // isMouseDown: Track mouse button state for drag across keys\n  // activeKeys: Map of currently playing notes (note -> DOM element)\n  let keyboardElement = $state();\n  let isMouseDown = $state(false);\n  let activeKeys = $state(new Map()); // Map of MIDI note -> element\n\n  // ===== KEYBOARD MAPPING & CONSTANTS =====\n  // Static keyboard mapping - created once at module initialization\n  let keyboardMapping = createKeyboardMapping();\n\n  // Musical note names for display (C to B, repeats each octave)\n  // MIDI uses: C=0, C#=1, D=2, ..., B=11 within each octave\n  const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n\n  // ===== HELPER FUNCTIONS =====\n\n  /**\n   * Create keyboard key to MIDI note mapping for QWERTY playing\n   *\n   * DESIGN: Two-octave chromatic layout matching standard piano playing\n   * - Bottom row (ZXCVBNM): White keys C3-B3\n   * - Top row (SDFGHJL): Black keys C#3-A#4\n   * - Comma period keys: C4-D4 (middle C range for easy playing)\n   *\n   * WHY: QWERTY mapping allows computer keyboard players to play naturally\n   * without memorizing note positions, similar to actual piano keys\n   *\n   * @private\n   * @returns {Object} Mapping of keyboard keys to MIDI notes\n   */\n  function createKeyboardMapping() {\n    return {\n      // Bottom row - white keys C3 to B3\n      'z': 48, // C3\n      'x': 50, // D3\n      'c': 52, // E3\n      'v': 53, // F3\n      'b': 55, // G3\n      'n': 57, // A3\n      'm': 59, // B3\n      // Top row - black keys C#3 to A#4\n      's': 49, // C#3\n      'd': 51, // D#3\n      'g': 54, // F#3\n      'h': 56, // G#3\n      'j': 58, // A#3\n      'l': 61, // C#4\n      // Extended range\n      ',': 60, // C4 (middle C)\n      '.': 62, // D4\n      ';': 63, // D#4\n      '/': 64  // E4\n    };\n  }\n\n  /**\n   * Get note name and octave for MIDI note number\n   *\n   * MATH: MIDI note = (octave + 1) * 12 + noteInOctave\n   * Example: MIDI 60 = (4 + 1) * 12 + 0 = C4 (middle C)\n   *\n   * WHY: Convert raw MIDI numbers to human-readable note names\n   * Display to users in format: \"C4\", \"F#3\", \"A1\", etc.\n   *\n   * @private\n   * @param {number} midiNote - MIDI note number (0-127)\n   * @returns {Object} { name: string, octave: number }\n   */\n  function getNoteInfo(midiNote) {\n    const octave = Math.floor(midiNote / 12) - 1;\n    const noteName = noteNames[midiNote % 12];\n    return { name: noteName, octave };\n  }\n\n  /**\n   * Determine if MIDI note is a black key on the piano\n   *\n   * DESIGN: Black keys are sharps/flats (C#, D#, F#, G#, A#)\n   * Pattern within each octave: indices 1, 3, 6, 8, 10\n   * Note: E/B don't have black keys (natural semitones)\n   *\n   * WHY: Visual layout requires different styles/positioning for black vs white keys\n   *\n   * @private\n   * @param {number} midiNote - MIDI note number\n   * @returns {boolean} True if black key\n   */\n  function isBlackKey(midiNote) {\n    const noteInOctave = midiNote % 12;\n    return [1, 3, 6, 8, 10].includes(noteInOctave);\n  }\n\n  // ===== MOUSE/TOUCH INTERACTION HANDLERS =====\n\n  /**\n   * Handle mouse/touch down on key - play note\n   *\n   * WHY: Initiates note playback with standard velocity (100)\n   * Also tracks state for drag-across-keys behavior\n   *\n   * @private\n   */\n  function handleKeyDown(e) {\n    if (!audioState) return;\n\n    const midiNote = parseInt(e.currentTarget.dataset.note);\n    const velocity = 100; // Standard velocity for all keys\n\n    // Tell audio engine to play this note\n    audioState.playNote(midiNote, velocity);\n    // Track in active keys for cleanup on release\n    activeKeys.set(midiNote, e.currentTarget);\n    // Add CSS class for visual feedback (depression effect)\n    e.currentTarget.classList.add('active');\n    // Set flag so entering other keys while dragging will also play them\n    isMouseDown = true;\n  }\n\n  /**\n   * Handle mouse/touch up on key - stop note\n   *\n   * WHY: Ends note playback, provides immediate feedback\n   *\n   * @private\n   */\n  function handleKeyUp(e) {\n    if (!audioState) return;\n\n    const midiNote = parseInt(e.currentTarget.dataset.note);\n\n    // Tell audio engine to release this note\n    audioState.stopNote(midiNote);\n    // Clean up tracking\n    activeKeys.delete(midiNote);\n    // Remove visual feedback\n    e.currentTarget.classList.remove('active');\n  }\n\n  /**\n   * Handle mouse entering a key while button is held down\n   *\n   * WHY: Enables drag-across-keys behavior (legato style playing)\n   * User can click one key and drag to another while holding button\n   * This plays each key as the mouse moves over it (like a glissando)\n   *\n   * DESIGN CHOICE: Only triggers if not already active\n   * This prevents playing the same note twice if mouse flickers\n   *\n   * @private\n   */\n  function handleMouseEnter(e) {\n    if (!isMouseDown || !audioState) return;\n\n    const midiNote = parseInt(e.currentTarget.dataset.note);\n    const velocity = 100;\n\n    // Only trigger if not already active - prevents duplicate playback\n    if (!activeKeys.has(midiNote)) {\n      audioState.playNote(midiNote, velocity);\n      activeKeys.set(midiNote, e.currentTarget);\n      e.currentTarget.classList.add('active');\n    }\n  }\n\n  /**\n   * Handle mouse leaving a key while button is held down\n   *\n   * WHY: Completes the drag-across behavior by stopping notes\n   * as the mouse moves away from keys\n   *\n   * @private\n   */\n  function handleMouseLeave(e) {\n    if (!isMouseDown || !audioState) return;\n\n    const midiNote = parseInt(e.currentTarget.dataset.note);\n\n    if (activeKeys.has(midiNote)) {\n      audioState.stopNote(midiNote);\n      activeKeys.delete(midiNote);\n      e.currentTarget.classList.remove('active');\n    }\n  }\n\n  // ===== KEYBOARD INTERACTION HANDLERS (QWERTY PLAYING) =====\n\n  /**\n   * Handle keyboard key press - play note via QWERTY mapping\n   *\n   * WHY: Enables playing piano with physical keyboard (Z-M keys)\n   * Prevents key repeat events from triggering multiple times\n   *\n   * @private\n   */\n  function handleWindowKeyDown(e) {\n    if (!audioState) return;\n\n    const key = e.key.toLowerCase();\n    const midiNote = keyboardMapping[key];\n\n    // Check: mapping exists AND not a repeat (key held down)\n    if (midiNote && !e.repeat) {\n      const velocity = 100;\n      audioState.playNote(midiNote, velocity);\n      activeKeys.set(midiNote, document.querySelector(`[data-note=\"${midiNote}\"]`));\n\n      // Add visual feedback to match visual key press\n      const element = document.querySelector(`[data-note=\"${midiNote}\"]`);\n      if (element) {\n        element.classList.add('active');\n      }\n    }\n  }\n\n  /**\n   * Handle keyboard key release - stop note from QWERTY playing\n   *\n   * WHY: Releases note playback when physical key is released\n   *\n   * @private\n   */\n  function handleWindowKeyUp(e) {\n    if (!audioState) return;\n\n    const key = e.key.toLowerCase();\n    const midiNote = keyboardMapping[key];\n\n    if (midiNote) {\n      audioState.stopNote(midiNote);\n      activeKeys.delete(midiNote);\n\n      // Remove visual feedback\n      const element = document.querySelector(`[data-note=\"${midiNote}\"]`);\n      if (element) {\n        element.classList.remove('active');\n      }\n    }\n  }\n\n  // ===== LIFECYCLE & CLEANUP =====\n\n  /**\n   * Cleanup function - called on component unmount\n   *\n   * WHY: Prevent memory leaks and ghost events after component is removed\n   * Must remove ALL event listeners we added and stop any playing notes\n   *\n   * @private\n   */\n  function cleanup() {\n    // Stop all audio playback and clear tracking\n    if (audioState) {\n      audioState.stopAll();\n      activeKeys.clear();\n    }\n\n    // Remove global keyboard listeners\n    // CRITICAL: Must do this or keyboard events fire on dead component\n    document.removeEventListener('keydown', handleWindowKeyDown);\n    document.removeEventListener('keyup', handleWindowKeyUp);\n  }\n\n  // Svelte lifecycle hook: runs when component mounts to DOM\n  // Returns cleanup function which Svelte calls on unmount\n  onMount(() => {\n    // Add global keyboard listeners for QWERTY playing\n    document.addEventListener('keydown', handleWindowKeyDown);\n    document.addEventListener('keyup', handleWindowKeyUp);\n\n    // Svelte calls this when component is destroyed\n    return cleanup;\n  });\n\n  // ===== DATA GENERATION =====\n\n  /**\n   * Generate array of MIDI notes for rendering keyboard\n   *\n   * WHY: Create list of consecutive MIDI notes starting at startNote\n   * For 88-key piano: MIDI 12 (A0) to MIDI 99 (C8)\n   *\n   * MATH: Each iteration adds 1 to startNote\n   * keyCount determines how many keys to display\n   *\n   * @private\n   * @returns {number[]} Array of MIDI notes\n   */\n  function generateNotes() {\n    const notes = [];\n    for (let i = 0; i < keyCount; i++) {\n      notes.push(startNote + i);\n    }\n    return notes;\n  }\n\n  // Generate the notes array once during initialization\n  // {#each} will iterate over this to render all keys\n  const notes = generateNotes();\n</script>\n\n<div class=\"keyboard-container\" bind:this={keyboardElement}>\n  <div class=\"keyboard\">\n    {#each notes as midiNote, idx (midiNote)}\n      {@const isBlack = isBlackKey(midiNote)}\n      {@const noteInfo = getNoteInfo(midiNote)}\n      {@const noteLabel = `${noteInfo.name}${showOctaveNumbers ? noteInfo.octave : ''}`}\n\n      <button\n        class:key\n        class:white-key={!isBlack}\n        class:black-key={isBlack}\n        data-note={midiNote}\n        onmousedown={handleKeyDown}\n        onmouseup={handleKeyUp}\n        onmouseleave={handleMouseLeave}\n        onmouseenter={handleMouseEnter}\n        ontouchstart={handleKeyDown}\n        ontouchend={handleKeyUp}\n        title={`${noteLabel} (MIDI ${midiNote})`}\n        aria-label=\"Piano key {noteLabel}\"\n      >\n        {#if showNoteNames && !isBlack}\n          <span class=\"note-label\">{noteInfo.name}</span>\n          {#if showOctaveNumbers}\n            <span class=\"octave-label\">{noteInfo.octave}</span>\n          {/if}\n        {/if}\n      </button>\n    {/each}\n  </div>\n\n  <div class=\"keyboard-help\">\n    <p class=\"help-text\">ðŸŽ¹ Click keys or press QWERTY keys (Z-M, comma/period) to play</p>\n  </div>\n</div>\n\n<style>\n  /* ============================================================\n     DESIGN TOKENS & CONTAINER\n     ============================================================\n     Vintage piano aesthetic with warm earth tones\n     Emulates the look and feel of a classic upright piano\n  */\n\n  .keyboard-container {\n    /* Piano key colors - using global design tokens */\n    --piano-white-light: var(--key-white); /* From global tokens.css */\n    --piano-white-mid: var(--bg-secondary);\n    --piano-white-dark: var(--color-surface);\n    --piano-black-light: var(--key-black);\n    --piano-black-dark: var(--color-deep-brown);\n\n    /* Accent colors for feedback - using global tokens */\n    --active-shadow: rgba(212, 165, 116, 0.3); /* var(--accent) with alpha */\n    --hover-shadow: rgba(0, 0, 0, 0.15);\n\n    /* Wood background for contrast */\n    --vintage-wood-dark: var(--color-warm-brown);\n    --vintage-wood-accent: #6d4c41;\n\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-4);\n    padding: var(--space-6);\n    background: linear-gradient(135deg, var(--vintage-wood-accent) 0%, var(--vintage-wood-dark) 100%);\n    border-radius: var(--border-radius-xl);\n    border: 2px solid var(--vintage-wood-dark);\n    box-shadow: var(--shadow-xl), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n  }\n\n  .keyboard {\n    /* Main keyboard bed - like the body of a piano */\n    display: flex;\n    gap: 0;\n    justify-content: center;\n    align-items: flex-end;\n    position: relative;\n    background: linear-gradient(to bottom, var(--vintage-wood-accent) 0%, var(--vintage-wood-dark) 100%);\n    padding: 1.5rem 1rem 1rem 1rem;\n    border-radius: 8px;\n    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.4), 0 4px 12px rgba(0, 0, 0, 0.3);\n    overflow-x: auto;\n    overflow-y: hidden;\n  }\n\n  /* ============================================================\n     WHITE KEYS - Vintage Ivory\n     ============================================================\n     Warm cream color with subtle 3D depth effect\n  */\n\n  .key.white-key {\n    width: 60px;\n    height: 280px;\n    /* Subtle gradient from light to darker ivory */\n    background: linear-gradient(to bottom, var(--piano-white-light) 0%, var(--piano-white-mid) 60%, var(--piano-white-dark) 100%);\n    /* Warm border color (not gray) */\n    border: 1px solid #a69e8f;\n    border-radius: 0 0 8px 8px;\n    /* Layout for note labels */\n    cursor: pointer;\n    user-select: none;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 4px;\n    position: relative;\n    /* Smooth depression effect when clicked */\n    transition: all 0.05s ease;\n    /* Depth shadow - looks like a real key */\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25), inset 0 -1px 2px rgba(0, 0, 0, 0.1);\n  }\n\n  .key.white-key:hover {\n    /* Slightly lighter on hover - like light hitting the key */\n    background: linear-gradient(to bottom, #fefbf7 0%, var(--piano-white-light) 60%, var(--piano-white-mid) 100%);\n    /* Enhanced shadow on hover */\n    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3), inset 0 -1px 2px rgba(0, 0, 0, 0.1);\n  }\n\n  .key.white-key.active {\n    /* Pressed effect - golden accent highlight */\n    background: linear-gradient(to bottom, var(--key-white-active) 0%, var(--accent) 60%, var(--accent-hover) 100%);\n    /* Inset shadow for depression, warm gold glow for feedback */\n    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3), inset 0 -1px 2px rgba(0, 0, 0, 0.1), 0 2px 8px var(--active-shadow);\n    /* Physical depression effect */\n    transform: translateY(2px);\n  }\n\n  /* ============================================================\n     BLACK KEYS - Vintage Ebony\n     ============================================================\n     Deep black with subtle sheen effect\n  */\n\n  .key.black-key {\n    width: 36px;\n    height: 180px;\n    /* Dark gradient with subtle shine at top */\n    background: linear-gradient(to bottom, var(--piano-black-light) 0%, var(--piano-black-dark) 100%);\n    border: 1px solid #0a0a0a;\n    border-radius: 0 0 6px 6px;\n    cursor: pointer;\n    user-select: none;\n    position: absolute;\n    margin-left: -18px;\n    margin-right: -18px;\n    z-index: 10;\n    transition: all 0.05s ease;\n    /* Deep shadow for 3D effect */\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6), inset 0 -1px 2px rgba(0, 0, 0, 0.5);\n  }\n\n  .key.black-key:hover {\n    /* Slightly lighter on hover */\n    background: linear-gradient(to bottom, #3a3a3a 0%, #1f1f1f 100%);\n    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.7), inset 0 -1px 2px rgba(0, 0, 0, 0.5);\n  }\n\n  .key.black-key.active {\n    /* Pressed effect with warm gold accent glow */\n    background: linear-gradient(to bottom, var(--key-black-active) 0%, var(--accent-hover) 70%, var(--accent) 100%);\n    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.5), inset 0 -1px 2px rgba(0, 0, 0, 0.5), 0 2px 8px var(--active-shadow);\n    transform: translateY(2px);\n  }\n\n  /* ============================================================\n     NOTE LABELS - Minimalist Design\n     ============================================================\n     Small, subtle labels that don't dominate the keyboard\n  */\n\n  .note-label {\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: #5d5d5d; /* Not black - warm gray */\n    margin-top: auto;\n    letter-spacing: 0.5px;\n  }\n\n  .octave-label {\n    font-size: 0.75rem;\n    color: #888; /* Lighter gray for secondary info */\n    font-weight: 500;\n    letter-spacing: 0.3px;\n  }\n\n  /* ============================================================\n     HELP TEXT - User Guidance\n     ============================================================\n     Non-obtrusive help text for new users\n  */\n\n  .keyboard-help {\n    text-align: center;\n    padding: 0.5rem 0;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n  }\n\n  .help-text {\n    font-size: 0.875rem;\n    color: #b8a89a; /* Warm beige text */\n    margin: 0;\n    font-style: italic;\n    letter-spacing: 0.3px;\n  }\n\n  /* ============================================================\n     RESPONSIVE DESIGN\n     ============================================================\n  */\n\n  @media (max-width: 1024px) {\n    .key.white-key {\n      width: 45px;\n      height: 200px;\n    }\n\n    .key.black-key {\n      width: 27px;\n      height: 130px;\n      margin-left: -13.5px;\n      margin-right: -13.5px;\n    }\n\n    .note-label {\n      font-size: 0.75rem;\n    }\n\n    .octave-label {\n      font-size: 0.65rem;\n    }\n  }\n\n  @media (max-width: 640px) {\n    .keyboard-container {\n      padding: 1rem;\n      gap: 0.75rem;\n    }\n\n    .keyboard {\n      padding: 1rem 0.75rem 0.75rem 0.75rem;\n    }\n\n    .key.white-key {\n      width: 35px;\n      height: 150px;\n      padding: 4px 2px;\n    }\n\n    .key.black-key {\n      width: 20px;\n      height: 100px;\n      margin-left: -10px;\n      margin-right: -10px;\n    }\n\n    .note-label {\n      font-size: 0.65rem;\n    }\n\n    .octave-label {\n      display: none;\n    }\n\n    .keyboard-help {\n      display: none;\n    }\n  }\n\n  /* ============================================================\n     ACCESSIBILITY\n     ============================================================\n     Keyboard focus indicators for accessibility\n  */\n\n  .key:focus {\n    outline: 2px solid var(--accent); /* Warm gold outline from design tokens */\n    outline-offset: 2px;\n  }\n\n  .key:focus:not(:focus-visible) {\n    outline: none;\n  }\n\n  /* ============================================================\n     PRINT STYLES\n     ============================================================\n  */\n\n  @media print {\n    .keyboard-container {\n      display: none;\n    }\n  }\n</style>\n","<script>\n  /**\n   * VintageKnob.svelte\n   *\n   * CONCEPT: Accessible rotary control component using Svelte 5 Runes\n   *\n   * DESIGN PHILOSOPHY:\n   * - Numbers-free interface: Users experience the knob visually, not numerically\n   * - Vintage aesthetic: Inspired by analog synthesizers and old audio equipment\n   * - Perceptual feedback: Arc indicator shows intensity without exact values\n   * - Full accessibility: ARIA labels, keyboard navigation, screen reader support\n   *\n   * SVELTE 5 PATTERNS USED:\n   * - $props() for destructuring component properties with defaults\n   * - $bindable() for two-way data binding on the 'value' prop\n   * - $state() for local reactive state (isDragging, ref elements)\n   * - $derived() for computed reactive values (rotation, intensity)\n   *\n   * INTERACTION PATTERNS:\n   * - Mouse/Touch: Click and drag to rotate (270Â° arc, not full circle)\n   * - Keyboard: Arrow keys (Up/Right = increase, Down/Left = decrease)\n   * - Relative positioning: Angle calculated from knob center\n   * - Responsive step: Quantized to 'step' prop for consistent values\n   *\n   * FEATURES:\n   * - Smooth rotation with mouse drag or touch\n   * - Keyboard support (Arrow keys for fine control)\n   * - Optional visual intensity arc\n   * - No numeric value display (perceptual design)\n   * - Accessibility-friendly (ARIA labels, keyboard navigation)\n   *\n   * IMPLEMENTATION NOTES:\n   * - Uses SVG for visual feedback (arc indicator)\n   * - Event listeners cleaned up in $effect cleanup\n   * - Knob rotates 270Â° (3/4 circle): -45Â° to 225Â° for visual balance\n   *\n   * USAGE:\n   * <VintageKnob\n   *   bind:value={frequency}\n   *   min={20}\n   *   max={20000}\n   *   step={10}\n   *   label=\"Frequency\"\n   *   showIntensity={true}\n   *   disabled={false}\n   * />\n   */\n\n  // ===== PROPS DESTRUCTURING (Svelte 5 $props rune) =====\n  // $props() creates a reactive proxy of component properties\n  // $bindable() marks 'value' as two-way bindable from parent: bind:value={myVar}\n  let {\n    value = $bindable(0.5),    // Current value (0-1 after normalization, but min-max in original scale)\n    min = 0,                    // Minimum boundary value\n    max = 100,                  // Maximum boundary value\n    step = 1,                   // Quantization step (e.g., 1 Hz, 0.1 dB)\n    label = 'Control',          // Display label below knob\n    showIntensity = true,       // Show arc indicator\n    disabled = false,           // Disable interaction\n    ariaLabel = label,          // Accessibility label for screen readers\n    ariaDescribedBy = null      // Optional reference to description element\n  } = $props();\n\n  // ===== LOCAL REACTIVE STATE (Svelte 5 $state rune) =====\n  // $state() creates local reactive variables that trigger reactivity when changed\n  let isDragging = $state(false);      // Tracks whether user is actively dragging\n  let knobElement = $state(null);      // Reference to DOM button element\n  let containerElement = $state(null); // Reference to DOM container div\n\n  // ===== COMPUTED REACTIVE VALUES (Svelte 5 $derived rune) =====\n  // $derived() creates reactive values that auto-update when dependencies change\n  // These are read-only and re-computed on every dependency change\n  let normalizedValue = $derived((value - min) / (max - min));  // 0-1 scale\n  let rotation = $derived(normalizedValue * 270);               // Convert 0-1 to 0-270 degrees\n  let intensity = $derived(normalizedValue);                    // Same as normalized for arc opacity\n  let arcRotation = $derived(rotation);                         // Alias for clarity in template\n\n  // ===== HELPER FUNCTIONS =====\n\n  /**\n   * Convert angle in degrees to normalized 0-1 value\n   * MATH: Clamps angle to valid 270Â° range and divides by 270\n   * REASON: Knob rotates 270Â° (3/4 circle), not full 360Â°\n   *\n   * @param {number} angle - Rotation angle in degrees (0-360)\n   * @returns {number} Normalized value (0-1)\n   */\n  function angleToNormalized(angle) {\n    const clampedAngle = Math.max(0, Math.min(270, angle));\n    return clampedAngle / 270;\n  }\n\n  /**\n   * Convert mouse/touch position to rotation angle\n   * MATH: Uses atan2 to calculate angle from center, adjusts for coordinate system\n   * REASON: Knob needs -45Â° (bottom-left) to 225Â° (bottom-right) mapping\n   *\n   * @param {number} clientX - Mouse X coordinate (screen space)\n   * @param {number} clientY - Mouse Y coordinate (screen space)\n   * @returns {number} Angle in degrees relative to knob center\n   */\n  function clientToAngle(clientX, clientY) {\n    if (!knobElement) return 0;\n\n    // Get knob center coordinates\n    const rect = knobElement.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n\n    // Calculate relative position\n    const dx = clientX - centerX;\n    const dy = clientY - centerY;\n\n    // atan2(y, x) gives angle in radians: 0Â° = right, 90Â° = down, -90Â° = up\n    let angle = Math.atan2(dy, dx) * (180 / Math.PI);\n\n    // Rotate coordinate system: shift by -45Â° so 0Â° is bottom-left\n    angle = angle - (-45);\n    if (angle < 0) angle += 360;\n\n    return angle;\n  }\n\n  /**\n   * UPDATE VALUE FROM INPUT\n   * Handles the common pattern: calculate angle â†’ normalize â†’ scale to min-max â†’ quantize\n   * @param {number} clientX - Mouse/touch X\n   * @param {number} clientY - Mouse/touch Y\n   */\n  function updateValueFromPosition(clientX, clientY) {\n    const angle = clientToAngle(clientX, clientY);\n    const normalized = angleToNormalized(angle);\n    // QUANTIZATION: Round to nearest 'step' to avoid floating-point drift\n    value = Math.round((min + normalized * (max - min)) / step) * step;\n  }\n\n  // ===== MOUSE INTERACTION HANDLERS =====\n\n  /**\n   * Handle mouse down: Start dragging, attach global listeners\n   * WHY GLOBAL LISTENERS: User may move mouse fast outside knob bounds\n   * So we listen on document, not just the knob element\n   */\n  function handleMouseDown(e) {\n    if (disabled) return;\n    isDragging = true;\n    updateValueFromPosition(e.clientX, e.clientY);\n    // Global listeners persist until user releases mouse\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n  }\n\n  /**\n   * Handle mouse move while dragging\n   * Updates value in real-time as user drags\n   */\n  function handleMouseMove(e) {\n    if (!isDragging) return;\n    e.preventDefault();\n    updateValueFromPosition(e.clientX, e.clientY);\n  }\n\n  /**\n   * Handle mouse up: Stop dragging, remove global listeners\n   */\n  function handleMouseUp() {\n    isDragging = false;\n    document.removeEventListener('mousemove', handleMouseMove);\n    document.removeEventListener('mouseup', handleMouseUp);\n  }\n\n  // ===== KEYBOARD INTERACTION HANDLER =====\n\n  /**\n   * Handle keyboard input for accessible control\n   * Up/Right = increase by step\n   * Down/Left = decrease by step\n   * e.preventDefault() stops browser from scrolling page\n   */\n  function handleKeyDown(e) {\n    if (disabled) return;\n    let increment = 0;\n\n    switch (e.key) {\n      case 'ArrowUp':\n      case 'ArrowRight':\n        increment = step;\n        e.preventDefault();\n        break;\n      case 'ArrowDown':\n      case 'ArrowLeft':\n        increment = -step;\n        e.preventDefault();\n        break;\n      default:\n        return;\n    }\n\n    // Clamp new value to min-max range\n    value = Math.max(min, Math.min(max, value + increment));\n  }\n\n  // ===== TOUCH INTERACTION HANDLERS =====\n\n  /**\n   * Handle touch start: Same as mouse, but for touch devices\n   * Check e.touches.length === 1 to ignore multi-touch\n   */\n  function handleTouchStart(e) {\n    if (disabled || e.touches.length !== 1) return;\n    isDragging = true;\n    const touch = e.touches[0];\n    updateValueFromPosition(touch.clientX, touch.clientY);\n    document.addEventListener('touchmove', handleTouchMove);\n    document.addEventListener('touchend', handleTouchEnd);\n  }\n\n  /**\n   * Handle touch move while dragging\n   */\n  function handleTouchMove(e) {\n    if (!isDragging || e.touches.length !== 1) return;\n    e.preventDefault();\n    const touch = e.touches[0];\n    updateValueFromPosition(touch.clientX, touch.clientY);\n  }\n\n  /**\n   * Handle touch end: Stop dragging, remove listeners\n   */\n  function handleTouchEnd() {\n    isDragging = false;\n    document.removeEventListener('touchmove', handleTouchMove);\n    document.removeEventListener('touchend', handleTouchEnd);\n  }\n\n  // ===== LIFECYCLE & CLEANUP (Svelte 5 $effect with cleanup) =====\n\n  /**\n   * CLEANUP PATTERN: $effect with return function for cleanup\n   * This runs when component unmounts and removes all global event listeners\n   * Prevents memory leaks if component is destroyed while dragging\n   * REASON: If user is dragging and component unmounts, listeners stay active\n   * This causes \"ghost\" events on the removed component\n   */\n  $effect(() => {\n    // Return cleanup function that runs on unmount\n    return () => {\n      // Remove all possible listeners (important: some may not be attached)\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n      document.removeEventListener('touchmove', handleTouchMove);\n      document.removeEventListener('touchend', handleTouchEnd);\n    };\n  });\n</script>\n\n<!--\n  TEMPLATE STRUCTURE:\n  1. Container div: Layout container with design tokens (CSS custom properties)\n  2. Label: Text below knob for affordance (\"Frequency\", \"Volume\", etc.)\n  3. Button: Interactive element (role=\"slider\" for accessibility)\n     - SVG arc: Visual feedback showing intensity (optional)\n     - Grip div: Rotatable indicator showing current position\n  4. Hidden text: Accessibility help for screen readers\n-->\n\n<div class=\"knob-container\" bind:this={containerElement}>\n  <!-- Display label (no numbers, just semantic text) -->\n  <div class=\"knob-label\">{label}</div>\n\n  <!--\n    ACCESSIBLE BUTTON PATTERN:\n    - role=\"slider\": Tells screen readers this is a slider control\n    - aria-valuemin/max/now: Numeric accessibility info for screen readers\n    - tabindex: 0 = focusable, -1 = not focusable (when disabled)\n    - onmousedown/ontouchstart/onkeydown: Svelte 5 event handlers (no on: directive)\n  -->\n  <button\n    bind:this={knobElement}\n    class=\"knob\"\n    class:dragging={isDragging}\n    class:disabled\n    role=\"slider\"\n    aria-label={ariaLabel}\n    aria-describedby={ariaDescribedBy}\n    aria-valuemin={min}\n    aria-valuemax={max}\n    aria-valuenow={value}\n    aria-valuetext={`${value.toFixed(2)}`}\n    onmousedown={handleMouseDown}\n    ontouchstart={handleTouchStart}\n    onkeydown={handleKeyDown}\n    tabindex={disabled ? -1 : 0}\n  >\n    <!--\n      VISUAL FEEDBACK: Optional arc indicator\n      - Uses stroke-dasharray trick: draws partial arc by limiting dash length\n      - Background arc: 220px dash on 220px total (full circle visible)\n      - Active arc: partial dash based on rotation (shows intensity)\n      - SVG path: M = move to, A = arc, coordinates relative to 100x100 viewBox\n    -->\n    {#if showIntensity}\n      <svg class=\"knob-arc\" viewBox=\"0 0 100 100\">\n        <!-- Background arc (shows full range in faded color) -->\n        <path\n          class=\"arc-background\"\n          d=\"M 50 8 A 42 42 0 0 1 78 78\"\n          stroke=\"var(--color-border)\"\n          stroke-width=\"2\"\n          fill=\"none\"\n          stroke-linecap=\"round\"\n        />\n\n        <!--\n          Active arc (visual progress indicator)\n          stroke-dasharray: \"Xpx 220px\" means: draw X pixels, gap 220-X pixels\n          This creates the visual effect of a partial arc based on rotation %\n          opacity: intensity (0-1) fades arc as value changes\n        -->\n        <path\n          class=\"arc-active\"\n          d=\"M 50 8 A 42 42 0 0 1 78 78\"\n          stroke=\"var(--color-accent)\"\n          stroke-width=\"3\"\n          fill=\"none\"\n          stroke-linecap=\"round\"\n          style=\"stroke-dasharray: {(rotation / 270) * 220}px 220px; opacity: {intensity};\"\n        />\n      </svg>\n    {/if}\n\n    <!--\n      ROTATABLE GRIP INDICATOR\n      - Outer div: Rotates via CSS transform\n      - Inner div: Yellow bar showing current position\n      - CSS animation provides smooth rotation transition\n    -->\n    <div class=\"knob-grip\" style=\"transform: rotate({rotation}deg);\">\n      <div class=\"knob-indicator\"></div>\n    </div>\n  </button>\n\n  <!--\n    ACCESSIBILITY: Hidden help text for screen readers\n    sr-only class: CSS hides visually but keeps for screen readers\n    Provides keyboard instructions for non-obvious interactions\n  -->\n  <div class=\"sr-only\" id=\"{label}-help\">\n    Use arrow keys to adjust. Left/Right for coarse, Up/Down for fine control.\n  </div>\n</div>\n\n<style>\n  /* ============================================================\n     DESIGN TOKENS & CONTAINER\n     ============================================================\n     Svelte 5 scoped styles: CSS custom properties are local to component\n     VINTAGE AESTHETIC: Warm earth tones (cream, taupe, gold)\n     These token names follow convention: --color-*, --shadow-*, --space-*\n  */\n  .knob-container {\n    /* --- DESIGN TOKENS: Color Palette (Vintage Audio Equipment) ---*/\n    --color-cream: #f5f1e8;           /* Background: warm off-white */\n    --color-taupe: #8b8680;           /* Secondary text: muted brown */\n    --color-sage: #9ca89a;            /* Borders: dusty green */\n    --color-warm-brown: #6b5b52;      /* Unused in this component */\n    --color-gold: #d4a574;            /* Accent: warm gold for highlights */\n    --color-deep-brown: #3d3230;      /* Primary text: very dark */\n\n    /* --- SEMANTIC COLOR MAPPINGS ---*/\n    --color-background: var(--color-cream);       /* Container background */\n    --color-surface: #ebe7dd;                      /* Knob face color */\n    --color-text-primary: var(--color-deep-brown); /* Main text */\n    --color-text-secondary: var(--color-taupe);    /* Secondary text (label) */\n    --color-border: var(--color-sage);             /* Knob border & arcs */\n    --color-accent: var(--color-gold);             /* Interactive states */\n\n    /* --- SHADOWS: Depth and affordance ---*/\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08); /* Subtle shadow */\n    --shadow-md: 0 2px 4px rgba(61, 50, 48, 0.12); /* Hover shadow */\n\n    /* --- UTILITIES ---*/\n    --border-radius-md: 4px;\n\n    /* --- LAYOUT ---*/\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n  }\n\n  /* Label text below knob: \"FREQUENCY\", \"VOLUME\", etc. */\n  .knob-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--color-text-secondary);\n    text-transform: uppercase;       /* Makes label LOOK more analog */\n    letter-spacing: 0.5px;           /* Slightly spaced for vintage feel */\n    text-align: center;\n    max-width: 120px;                /* Prevent long labels from breaking layout */\n    line-height: 1.2;\n  }\n\n  /* ============================================================\n     INTERACTIVE KNOB BUTTON\n     ============================================================\n     Core element: 80x80px circular button with visual feedback\n     Uses flexbox to center SVG arc and grip indicator\n  */\n  .knob {\n    /* --- BUTTON RESET ---\n       Remove default browser styling from <button> element\n    */\n    background: none;\n    border: none;\n    padding: 0;\n    margin: 0;\n    cursor: grab;          /* \"Grabbable\" cursor affordance */\n    position: relative;    /* Allows absolute positioning of arc & grip */\n\n    /* --- SHAPE & SIZE ---\n       Circular 80x80px knob, centered content\n    */\n    width: 80px;\n    height: 80px;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    /* --- VISUAL STYLING ---\n       Subtle border and shadow for depth\n    */\n    background: var(--color-surface);\n    border: 2px solid var(--color-border);\n    box-shadow: var(--shadow-sm);\n\n    /* --- ANIMATION ---\n       Smooth transitions for interactive feedback (50ms)\n    */\n    transition: all 0.2s ease-out;\n\n    /* --- ACCESSIBILITY ---\n       Remove default focus ring; we provide custom one\n    */\n    outline: none;\n  }\n\n  /* Hover state: Highlight when user hovers (not dragging) */\n  .knob:hover:not(.disabled) {\n    box-shadow: var(--shadow-md);      /* Elevated shadow on hover */\n    border-color: var(--color-accent); /* Highlight border in gold */\n  }\n\n  /* Keyboard focus: Custom focus indicator for accessibility */\n  .knob:focus-visible {\n    outline: 2px solid var(--color-accent);\n    outline-offset: 4px;\n  }\n\n  /* Dragging state: Pressed-in appearance */\n  .knob.dragging {\n    cursor: grabbing;\n    box-shadow: inset 0 2px 4px rgba(61, 50, 48, 0.15); /* Inset shadow = pressed */\n    border-color: var(--color-accent);\n  }\n\n  /* Disabled state: Opacity and cursor change */\n  .knob.disabled {\n    opacity: 0.5;                              /* Faded appearance */\n    cursor: not-allowed;                       /* Clear interaction unavailable */\n    background: rgba(235, 231, 221, 0.7);     /* Desaturated surface */\n  }\n\n  /* ============================================================\n     VISUAL FEEDBACK: SVG Arc Indicator\n     ============================================================\n     Shows intensity via animated arc (stroke-dasharray trick)\n     Layered on top of knob via absolute positioning\n  */\n  .knob-arc {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    pointer-events: none;  /* Don't interfere with mouse/touch on button */\n  }\n\n  /* Background arc: Shows full range (always visible, faded) */\n  .arc-background {\n    opacity: 0.3;\n  }\n\n  /* Active arc: Animates as value changes (stroke-dasharray updates) */\n  .arc-active {\n    /* Fast animation: 50ms matches button feedback speed */\n    transition: stroke-dasharray 0.05s linear, opacity 0.05s linear;\n  }\n\n  /* ============================================================\n     INTERACTIVE INDICATOR: Rotatable Grip\n     ============================================================\n     Yellow bar rotates with knob: { transform: rotate(Ndeg) }\n     Updated by $derived rotation value in script\n  */\n  .knob-grip {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    /* Smooth rotation (50ms matches arc animation) */\n    transition: transform 0.05s linear;\n  }\n\n  /* Yellow indicator bar (3px wide, 28px tall) */\n  .knob-indicator {\n    position: absolute;\n    width: 3px;\n    height: 28px;\n    background: var(--color-accent);        /* Gold color */\n    border-radius: 2px;                     /* Rounded ends */\n    top: 8px;                               /* Position at top of knob */\n    left: 50%;                              /* Center horizontally */\n    transform: translateX(-50%);            /* Precise centering */\n\n    /* Subtle glow: Creates depth & affordance */\n    box-shadow: 0 0 0 2px rgba(212, 165, 116, 0.2);\n  }\n\n  /* ============================================================\n     ACCESSIBILITY: Screen Reader Only Text\n     ============================================================\n     Hides text visually but keeps for screen reader users\n     Standard WAI-ARIA pattern for hidden descriptive text\n  */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n</style>\n","<script>\n  /**\n   * AGEControl.svelte\n   * Analog Gear Emulation - Postcard Piano's signature vintage character effect\n   *\n   * The AGE knob progressively adds analog warmth and character through:\n   * - Tape saturation (subtle harmonic distortion)\n   * - Frequency rolloff (slight high-frequency loss)\n   * - Subtle modulation (analog tape wow/flutter)\n   *\n   * This creates a numbers-free, perceptual interface for vintage warmth.\n   *\n   * Usage:\n   * <AGEControl bind:ageAmount={ageAmount} />\n   */\n\n  import VintageKnob from '@ui/controls/VintageKnob.svelte';\n\n  let { ageAmount = $bindable(0) } = $props();\n\n  // Derived parameters for audio processing\n  let ageIntensity = $derived(ageAmount / 100);\n  let saturationAmount = $derived(ageIntensity * 0.3); // 0-30% harmonic content\n  let rolloffAmount = $derived(ageIntensity * 1500); // 0-1500 Hz high-frequency rolloff\n  let modulationAmount = $derived(ageIntensity * 0.05); // 0-5% tape wobble\n\n  // Perceptual description (no numbers shown to user)\n  let ageCharacter = $derived.by(() => {\n    if (ageAmount === 0) return 'Digital (pristine)';\n    if (ageAmount < 25) return 'Subtle warmth';\n    if (ageAmount < 50) return 'Warm vintage';\n    if (ageAmount < 75) return 'Rich analog';\n    return 'Heavily aged';\n  });\n\n  // Effect on audio is applied when ageAmount changes\n  // The actual audio processing happens in the parent component or audio state manager\n  $effect(() => {\n    // This triggers when ageAmount changes\n    // Parent component or audio state should listen for this effect\n    // Example: audioState.updateAGE({ saturation, rolloff, modulation })\n  });\n</script>\n\n<div class=\"age-section\">\n  <div class=\"age-header\">\n    <h3 class=\"age-title\">AGE</h3>\n    <div class=\"age-description\">{ageCharacter}</div>\n  </div>\n\n  <div class=\"age-knob-container\">\n    <VintageKnob\n      bind:value={ageAmount}\n      min={0}\n      max={100}\n      step={1}\n      label=\"Vintage Character\"\n      showIntensity={true}\n      ariaLabel=\"AGE - Analog Gear Emulation\"\n      ariaDescribedBy=\"age-help\"\n    />\n  </div>\n\n  <!-- Accessibility help text -->\n  <div class=\"sr-only\" id=\"age-help\">\n    Adjust vintage character from pristine digital to heavily aged analog. Use arrow keys for fine control.\n  </div>\n</div>\n\n<style>\n  .age-section {\n    /* Design tokens */\n    --color-cream: #f5f1e8;\n    --color-taupe: #8b8680;\n    --color-sage: #9ca89a;\n    --color-warm-brown: #6b5b52;\n    --color-gold: #d4a574;\n    --color-deep-brown: #3d3230;\n\n    --color-background: var(--color-cream);\n    --color-surface: #ebe7dd;\n    --color-text-primary: var(--color-deep-brown);\n    --color-text-secondary: var(--color-taupe);\n    --color-border: var(--color-sage);\n    --color-accent: var(--color-gold);\n\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08);\n\n    --space-4: 16px;\n    --space-6: 24px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-background);\n  }\n\n  .age-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n    text-align: center;\n  }\n\n  .age-title {\n    font-size: 24px;\n    font-weight: 700;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 2px;\n    text-transform: uppercase;\n  }\n\n  .age-description {\n    font-size: 12px;\n    color: var(--color-text-secondary);\n    font-style: italic;\n    height: 18px; /* Fixed height to prevent layout shift */\n  }\n\n  .age-knob-container {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n  }\n\n  /* Screen reader only text */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n</style>\n","<script>\n  /**\n   * RoomMicsControl.svelte\n   * Intimate studio ambience controls - Postcard Piano's room character feature\n   *\n   * Controls the balance between close-miked dry signal and ambient room reverb\n   * without exposing numeric parameters. Users hear the effect, not numbers.\n   *\n   * Features:\n   * - Mix: Balance between dry and room ambience (0% = dry, 100% = ambient)\n   * - Decay: How long room reverb sustains (perceptual, not quantitative)\n   *\n   * Usage:\n   * <RoomMicsControl\n   *   bind:roomMix={roomMix}\n   *   bind:roomDecay={roomDecay}\n   * />\n   */\n\n  import VintageKnob from '@ui/controls/VintageKnob.svelte';\n\n  let { roomMix = $bindable(0.3), roomDecay = $bindable(2) } = $props();\n\n  // Derived perceptual descriptions (no numbers shown)\n  let mixCharacter = $derived.by(() => {\n    if (roomMix === 0) return 'Dry (no room)';\n    if (roomMix < 0.2) return 'Close (intimate)';\n    if (roomMix < 0.4) return 'Balanced';\n    if (roomMix < 0.7) return 'Ambient';\n    return 'Lush (full room)';\n  });\n\n  let decayCharacter = $derived.by(() => {\n    if (roomDecay < 1) return 'Short (tight)';\n    if (roomDecay < 2) return 'Medium (natural)';\n    if (roomDecay < 3.5) return 'Long (spacious)';\n    return 'Very long (cathedral)';\n  });\n\n  // Visual intensity for arc indicators\n  let mixIntensity = $derived(roomMix);\n  let decayIntensity = $derived(Math.min(roomDecay / 5, 1)); // Normalize to 0-1\n\n  // Effects are applied when values change\n  // Parent component or audio state should listen for these changes\n  $effect(() => {\n    // Update reverb mix when roomMix changes\n    // Example: audioState.updateRoomMix(roomMix)\n  });\n\n  $effect(() => {\n    // Update reverb decay when roomDecay changes\n    // Example: audioState.updateRoomDecay(roomDecay)\n  });\n</script>\n\n<div class=\"room-section\">\n  <div class=\"room-header\">\n    <h3 class=\"room-title\">Room Mics</h3>\n    <div class=\"room-subtitle\">Ambient Studio Character</div>\n  </div>\n\n  <div class=\"room-controls\">\n    <!-- Mix Control -->\n    <div class=\"control-group\">\n      <VintageKnob\n        bind:value={roomMix}\n        min={0}\n        max={1}\n        step={0.05}\n        label=\"Mix\"\n        showIntensity={true}\n        ariaLabel=\"Room Microphone Mix\"\n        ariaDescribedBy=\"mix-help\"\n      />\n      <div class=\"control-info\">{mixCharacter}</div>\n    </div>\n\n    <!-- Decay Control -->\n    <div class=\"control-group\">\n      <VintageKnob\n        bind:value={roomDecay}\n        min={0.5}\n        max={5}\n        step={0.1}\n        label=\"Decay\"\n        showIntensity={true}\n        ariaLabel=\"Room Reverb Decay Time\"\n        ariaDescribedBy=\"decay-help\"\n      />\n      <div class=\"control-info\">{decayCharacter}</div>\n    </div>\n  </div>\n\n  <!-- Accessibility help text -->\n  <div class=\"sr-only\" id=\"mix-help\">\n    Adjust the balance between dry close-miked signal and ambient room reverb. Left is dry, right is full room.\n  </div>\n  <div class=\"sr-only\" id=\"decay-help\">\n    Adjust how long the room reverb sustains. Left is short and tight, right is long and spacious.\n  </div>\n</div>\n\n<style>\n  .room-section {\n    /* Design tokens */\n    --color-cream: #f5f1e8;\n    --color-taupe: #8b8680;\n    --color-sage: #9ca89a;\n    --color-warm-brown: #6b5b52;\n    --color-gold: #d4a574;\n    --color-deep-brown: #3d3230;\n\n    --color-background: var(--color-cream);\n    --color-surface: #ebe7dd;\n    --color-text-primary: var(--color-deep-brown);\n    --color-text-secondary: var(--color-taupe);\n    --color-border: var(--color-sage);\n    --color-accent: var(--color-gold);\n\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08);\n\n    --space-2: 8px;\n    --space-4: 16px;\n    --space-6: 24px;\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-background);\n    border-top: 1px solid var(--color-border);\n  }\n\n  .room-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n    text-align: center;\n  }\n\n  .room-title {\n    font-size: 18px;\n    font-weight: 700;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 1px;\n    text-transform: uppercase;\n  }\n\n  .room-subtitle {\n    font-size: 11px;\n    color: var(--color-text-secondary);\n    font-style: italic;\n    letter-spacing: 0.5px;\n  }\n\n  .room-controls {\n    display: flex;\n    gap: var(--space-6);\n    justify-content: center;\n    flex-wrap: wrap;\n  }\n\n  .control-group {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-2);\n  }\n\n  .control-info {\n    font-size: 11px;\n    color: var(--color-text-secondary);\n    font-style: italic;\n    text-align: center;\n    height: 14px; /* Fixed height to prevent layout shift */\n    min-width: 100px;\n  }\n\n  /* Screen reader only text */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n</style>\n","<script>\n  /**\n   * TubeSaturationControl.svelte\n   * Warm coloration effect simulating analog tube amplifier distortion\n   *\n   * This effect adds progressive harmonic richness and warmth without digital harshness.\n   * It combines:\n   * - Subtle harmonic distortion (even and odd harmonics)\n   * - Gentle frequency shaping (slight low-end boost, high-end softening)\n   * - Output compensation (maintains volume as saturation increases)\n   *\n   * Numbers-free design: users feel the warmth, not the parameters.\n   *\n   * Usage:\n   * <TubeSaturationControl bind:saturation={saturation} />\n   */\n\n  import VintageKnob from '@ui/controls/VintageKnob.svelte';\n\n  let { saturation = $bindable(0) } = $props();\n\n  // Derived parameters for audio processing\n  let driveAmount = $derived(saturation / 100);\n  let outputCompensation = $derived(1 - (saturation / 100) * 0.2); // Slight output reduction\n  let harmonicContent = $derived(Math.min(saturation * 2, 100)); // Visual indicator\n\n  // Perceptual description (no numbers shown to user)\n  let saturationCharacter = $derived.by(() => {\n    if (saturation === 0) return 'Clean (pristine)';\n    if (saturation < 20) return 'Subtle warmth';\n    if (saturation < 40) return 'Warm glow';\n    if (saturation < 60) return 'Rich saturation';\n    if (saturation < 80) return 'Heavy warmth';\n    return 'Intense coloration';\n  });\n\n  // Effect on audio is applied when saturation changes\n  $effect(() => {\n    // This triggers when saturation changes\n    // Parent component or audio state should listen for this effect\n    // Example: audioState.updateTubeSaturation({ drive, output })\n  });\n</script>\n\n<div class=\"saturation-section\">\n  <div class=\"saturation-header\">\n    <h3 class=\"saturation-title\">Tube Saturation</h3>\n    <div class=\"saturation-description\">{saturationCharacter}</div>\n  </div>\n\n  <div class=\"saturation-knob-container\">\n    <VintageKnob\n      bind:value={saturation}\n      min={0}\n      max={100}\n      step={1}\n      label=\"Warmth\"\n      showIntensity={true}\n      ariaLabel=\"Tube Saturation - Warmth\"\n      ariaDescribedBy=\"saturation-help\"\n    />\n  </div>\n\n  <!-- Optional: Visual harmonic indicator (no numbers!) -->\n  {#if saturation > 0}\n    <div class=\"harmonic-indicator\">\n      <div class=\"harmonic-bar\" style=\"width: {harmonicContent}%;\"></div>\n    </div>\n  {/if}\n\n  <!-- Accessibility help text -->\n  <div class=\"sr-only\" id=\"saturation-help\">\n    Adjust tube saturation for warmth and harmonic richness. Increases from clean to heavily saturated.\n  </div>\n</div>\n\n<style>\n  .saturation-section {\n    /* Design tokens */\n    --color-cream: #f5f1e8;\n    --color-taupe: #8b8680;\n    --color-sage: #9ca89a;\n    --color-warm-brown: #6b5b52;\n    --color-gold: #d4a574;\n    --color-accent-dark: #b8935f;\n    --color-deep-brown: #3d3230;\n\n    --color-background: var(--color-cream);\n    --color-surface: #ebe7dd;\n    --color-text-primary: var(--color-deep-brown);\n    --color-text-secondary: var(--color-taupe);\n    --color-border: var(--color-sage);\n    --color-accent: var(--color-gold);\n\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08);\n\n    --space-4: 16px;\n    --space-6: 24px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-background);\n    border-top: 1px solid var(--color-border);\n  }\n\n  .saturation-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n    text-align: center;\n  }\n\n  .saturation-title {\n    font-size: 18px;\n    font-weight: 700;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 1px;\n    text-transform: uppercase;\n  }\n\n  .saturation-description {\n    font-size: 12px;\n    color: var(--color-text-secondary);\n    font-style: italic;\n    height: 18px; /* Fixed height to prevent layout shift */\n  }\n\n  .saturation-knob-container {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n  }\n\n  /* Visual harmonic indicator - shows intensity without numbers */\n  .harmonic-indicator {\n    width: 120px;\n    height: 4px;\n    background: var(--color-surface);\n    border-radius: 2px;\n    overflow: hidden;\n    border: 1px solid var(--color-border);\n    box-shadow: var(--shadow-sm);\n  }\n\n  .harmonic-bar {\n    height: 100%;\n    background: linear-gradient(90deg, var(--color-accent), var(--color-accent-dark));\n    width: 0%;\n    transition: width 0.1s ease-out;\n    border-radius: 2px;\n  }\n\n  /* Screen reader only text */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n</style>\n","<script>\n  /**\n   * SpectrumAnalyzer.svelte\n   * \n   * PURPOSE:\n   * Real-time frequency spectrum visualization using Web Audio API AnalyserNode.\n   * Shows the frequency content of audio in real-time with a vintage aesthetic.\n   * \n   * EDUCATIONAL VALUE:\n   * - Teaches frequency domain representation (FFT)\n   * - Shows how different notes occupy different frequency ranges\n   * - Demonstrates effect of saturation (harmonic generation)\n   * - Visualizes low-pass/high-pass filtering effects\n   * \n   * WEB AUDIO CONCEPTS:\n   * - AnalyserNode: Provides FFT analysis of audio signal\n   * - FFT Size: 2048 samples = good frequency resolution\n   * - Smoothing: 0.8 = smooth transitions, less jumpy\n   * - FrequencyBinCount: fftSize/2 = number of frequency buckets\n   * \n   * USAGE:\n   * <SpectrumAnalyzer audioContext={ctx} sourceNode={masterGain} />\n   */\n\n  import { onMount } from 'svelte';\n\n  // ===== COMPONENT PROPS =====\n  let {\n    audioContext = undefined,\n    sourceNode = undefined,\n    width = 600,\n    height = 150,\n    fftSize = 2048,\n    smoothing = 0.8\n  } = $props();\n\n  // ===== LOCAL STATE =====\n  let canvasRef = $state(null);\n  let analyser = $state(null);\n  let dataArray = $state(null);\n  let animationId = $state(null);\n  let isActive = $state(false);\n\n  // ===== LIFECYCLE & SETUP =====\n\n  /**\n   * Initialize analyzer when audio context and source are available\n   * Creates AnalyserNode and connects it to the audio graph\n   */\n  $effect(() => {\n    if (!audioContext || !sourceNode) {\n      cleanup();\n      return;\n    }\n\n    try {\n      // Create and configure analyzer node\n      analyser = audioContext.createAnalyser();\n      analyser.fftSize = fftSize;\n      analyser.smoothingTimeConstant = smoothing;\n\n      // Connect source â†’ analyzer (analyzer doesn't affect audio output)\n      sourceNode.connect(analyser);\n\n      // Allocate frequency data buffer\n      // frequencyBinCount = fftSize / 2\n      dataArray = new Uint8Array(analyser.frequencyBinCount);\n\n      isActive = true;\n\n      // Start animation loop\n      draw();\n\n      console.log(`âœ“ SpectrumAnalyzer initialized: ${analyser.frequencyBinCount} bins`);\n    } catch (err) {\n      console.error('SpectrumAnalyzer setup failed:', err);\n      cleanup();\n    }\n\n    // Cleanup on unmount or when dependencies change\n    return cleanup;\n  });\n\n  /**\n   * Animation loop: Read frequency data and draw bars\n   * Runs at ~60fps using requestAnimationFrame\n   */\n  function draw() {\n    if (!isActive) return;\n\n    animationId = requestAnimationFrame(draw);\n\n    if (!analyser || !dataArray || !canvasRef) return;\n\n    // Get current frequency data (0-255 values)\n    analyser.getByteFrequencyData(dataArray);\n\n    const canvas = canvasRef;\n    const ctx = canvas.getContext('2d');\n    const canvasWidth = canvas.width;\n    const canvasHeight = canvas.height;\n\n    // Clear canvas with cream background\n    ctx.fillStyle = 'var(--bg-primary)';\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    // Draw frequency bars\n    // Only show first 40% of bins (most relevant frequencies for music)\n    const binCount = Math.floor(dataArray.length * 0.4);\n    const barWidth = (canvasWidth / binCount) * 0.9; // 90% width = small gaps\n    const barGap = (canvasWidth / binCount) * 0.1;\n\n    for (let i = 0; i < binCount; i++) {\n      const amplitude = dataArray[i];\n      const normalizedAmplitude = amplitude / 255;\n      const barHeight = normalizedAmplitude * canvasHeight;\n\n      // X position for this bar\n      const x = i * (barWidth + barGap);\n\n      // Y position (draw from bottom up)\n      const y = canvasHeight - barHeight;\n\n      // Gold gradient - more opaque when louder\n      const alpha = Math.max(0.3, normalizedAmplitude); // minimum 30% opacity\n      ctx.fillStyle = `rgba(212, 165, 116, ${alpha})`; // var(--accent) with alpha\n\n      // Draw rounded rectangle\n      ctx.beginPath();\n      ctx.roundRect(x, y, barWidth, barHeight, 2);\n      ctx.fill();\n    }\n  }\n\n  /**\n   * Cleanup function\n   * Stops animation and disconnects audio nodes\n   */\n  function cleanup() {\n    isActive = false;\n\n    if (animationId) {\n      cancelAnimationFrame(animationId);\n      animationId = null;\n    }\n\n    if (analyser && sourceNode) {\n      try {\n        sourceNode.disconnect(analyser);\n      } catch (err) {\n        // Node might already be disconnected\n      }\n      analyser = null;\n    }\n\n    dataArray = null;\n  }\n\n  // Ensure cleanup on component unmount\n  onMount(() => {\n    return cleanup;\n  });\n</script>\n\n<!-- ===== TEMPLATE ===== -->\n<div class=\"spectrum-analyzer\" role=\"img\" aria-label=\"Audio frequency spectrum visualization\">\n  <!-- Canvas for drawing spectrum -->\n  <canvas\n    bind:this={canvasRef}\n    width={width}\n    height={height}\n    class=\"spectrum-canvas\"\n  ></canvas>\n\n  <!-- Frequency labels for educational value -->\n  <div class=\"frequency-labels\">\n    <span class=\"label\">20 Hz</span>\n    <span class=\"label\">1 kHz</span>\n    <span class=\"label\">20 kHz</span>\n  </div>\n\n  <!-- Educational info -->\n  <div class=\"spectrum-info\">\n    <span class=\"info-text\">\n      {#if isActive}\n        <span class=\"status-dot active\"></span>\n        Live Spectrum\n      {:else}\n        <span class=\"status-dot\"></span>\n        Waiting for audio...\n      {/if}\n    </span>\n  </div>\n</div>\n\n<!-- ===== STYLES - Using Design Tokens ===== -->\n<style>\n  .spectrum-analyzer {\n    display: flex;\n    flex-direction: column;\n    background: var(--bg-secondary);\n    border: var(--border-default);\n    border-radius: var(--border-radius-lg);\n    overflow: hidden;\n    box-shadow: var(--shadow-md);\n  }\n\n  .spectrum-canvas {\n    display: block;\n    width: 100%;\n    height: auto;\n    background: var(--bg-primary);\n  }\n\n  .frequency-labels {\n    display: flex;\n    justify-content: space-between;\n    padding: var(--space-2) var(--space-4);\n    background: var(--bg-elevated);\n    border-top: 1px solid var(--border-color);\n  }\n\n  .label {\n    font-size: var(--font-size-xs);\n    font-weight: var(--font-weight-semibold);\n    color: var(--text-secondary);\n    font-family: var(--font-family-mono);\n    letter-spacing: var(--letter-spacing-wide);\n  }\n\n  .spectrum-info {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: var(--space-2) var(--space-4);\n    background: var(--bg-secondary);\n    border-top: 1px solid var(--border-color);\n  }\n\n  .info-text {\n    display: flex;\n    align-items: center;\n    gap: var(--space-2);\n    font-size: var(--font-size-xs);\n    font-weight: var(--font-weight-medium);\n    color: var(--text-secondary);\n  }\n\n  .status-dot {\n    width: 8px;\n    height: 8px;\n    border-radius: var(--border-radius-full);\n    background: var(--color-taupe);\n  }\n\n  .status-dot.active {\n    background: var(--color-success);\n    box-shadow: 0 0 8px rgba(143, 168, 154, 0.5);\n    animation: pulse 2s ease-in-out infinite;\n  }\n\n  @keyframes pulse {\n    0%, 100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0.6;\n    }\n  }\n\n  /* Responsive */\n  @media (max-width: 768px) {\n    .spectrum-canvas {\n      height: 100px;\n    }\n\n    .label {\n      font-size: var(--font-size-xs);\n    }\n  }\n\n  /* Accessibility */\n  @media (prefers-reduced-motion: reduce) {\n    .status-dot.active {\n      animation: none;\n    }\n  }\n</style>\n","<script>\n  /**\n   * EnvelopeGraph.svelte\n   * \n   * PURPOSE:\n   * Visualizes ADSR (Attack, Decay, Sustain, Release) envelope shape using SVG.\n   * Updates in real-time as user adjusts envelope parameters.\n   * \n   * EDUCATIONAL VALUE:\n   * - Shows how ADSR shapes sound amplitude over time\n   * - Demonstrates relationship between envelope phases\n   * - Teaches attack = note onset, release = note end\n   * - Visualizes why fast attack = percussive, slow attack = soft\n   * \n   * AUDIO CONCEPTS:\n   * - Attack: Time to reach peak amplitude (0-peak)\n   * - Decay: Time to fall from peak to sustain level\n   * - Sustain: Held amplitude level during note\n   * - Release: Time to fade to silence after note off\n   * \n   * USAGE:\n   * <EnvelopeGraph attack={0.05} decay={0.2} sustain={0.7} release={1.0} />\n   */\n\n  // ===== COMPONENT PROPS =====\n  let {\n    attack = 0.05,\n    decay = 0.2,\n    sustain = 0.7,\n    release = 1.0,\n    width = 300,\n    height = 120\n  } = $props();\n\n  // ===== DERIVED STATE =====\n\n  /**\n   * Calculate SVG path for ADSR envelope\n   * Updates reactively when any parameter changes\n   */\n  let envelopePath = $derived.by(() => {\n    const padding = 10;\n    const graphWidth = width - 2 * padding;\n    const graphHeight = height - 2 * padding;\n\n    // Calculate time proportions\n    // Show sustain as fixed 200ms segment for visualization\n    const totalTime = attack + decay + 0.2 + release;\n    \n    // X coordinates for each phase\n    const attackX = (attack / totalTime) * graphWidth;\n    const decayX = attackX + (decay / totalTime) * graphWidth;\n    const sustainX = decayX + (0.2 / totalTime) * graphWidth;\n    const releaseX = graphWidth;\n\n    // Y coordinates (inverted because SVG Y increases downward)\n    const peakY = padding; // Top of graph\n    const sustainY = padding + (1 - sustain) * graphHeight;\n    const silenceY = padding + graphHeight; // Bottom of graph\n\n    // Build SVG path string\n    // M = moveto, L = lineto\n    return `\n      M ${padding} ${silenceY}\n      L ${padding + attackX} ${peakY}\n      L ${padding + decayX} ${sustainY}\n      L ${padding + sustainX} ${sustainY}\n      L ${padding + releaseX} ${silenceY}\n    `.trim();\n  });\n\n  /**\n   * Grid lines for visual reference\n   */\n  let gridLines = $derived.by(() => {\n    const padding = 10;\n    const graphHeight = height - 2 * padding;\n    \n    return [\n      { y: padding + graphHeight * 0.25, label: '75%' },\n      { y: padding + graphHeight * 0.5, label: '50%' },\n      { y: padding + graphHeight * 0.75, label: '25%' }\n    ];\n  });\n\n  /**\n   * Phase markers for educational labels\n   */\n  let phaseMarkers = $derived.by(() => {\n    const padding = 10;\n    const graphWidth = width - 2 * padding;\n    const graphHeight = height - 2 * padding;\n    const totalTime = attack + decay + 0.2 + release;\n\n    const attackX = (attack / totalTime) * graphWidth;\n    const decayX = attackX + (decay / totalTime) * graphWidth;\n    const sustainX = decayX + (0.2 / totalTime) * graphWidth;\n\n    return [\n      { \n        x: padding + attackX / 2, \n        y: height - 5, \n        label: 'A',\n        title: `Attack: ${(attack * 1000).toFixed(0)}ms`\n      },\n      { \n        x: padding + attackX + (decayX - attackX) / 2, \n        y: height - 5, \n        label: 'D',\n        title: `Decay: ${(decay * 1000).toFixed(0)}ms`\n      },\n      { \n        x: padding + decayX + (sustainX - decayX) / 2, \n        y: height - 5, \n        label: 'S',\n        title: `Sustain: ${(sustain * 100).toFixed(0)}%`\n      },\n      { \n        x: padding + sustainX + (graphWidth - sustainX) / 2, \n        y: height - 5, \n        label: 'R',\n        title: `Release: ${(release * 1000).toFixed(0)}ms`\n      }\n    ];\n  });\n</script>\n\n<!-- ===== TEMPLATE ===== -->\n<div class=\"envelope-graph\" role=\"img\" aria-label=\"ADSR Envelope visualization\">\n  <!-- SVG for envelope path -->\n  <svg\n    viewBox=\"0 0 {width} {height}\"\n    class=\"envelope-svg\"\n    aria-hidden=\"true\"\n  >\n    <!-- Background -->\n    <rect\n      x=\"0\"\n      y=\"0\"\n      width={width}\n      height={height}\n      fill=\"var(--bg-primary)\"\n    />\n\n    <!-- Grid lines -->\n    {#each gridLines as line}\n      <line\n        x1=\"10\"\n        y1={line.y}\n        x2={width - 10}\n        y2={line.y}\n        stroke=\"var(--border-color)\"\n        stroke-width=\"1\"\n        stroke-dasharray=\"2,2\"\n        opacity=\"0.3\"\n      />\n      <text\n        x=\"15\"\n        y={line.y - 2}\n        font-size=\"8\"\n        fill=\"var(--text-muted)\"\n        font-family=\"var(--font-family-mono)\"\n      >\n        {line.label}\n      </text>\n    {/each}\n\n    <!-- Envelope path -->\n    <path\n      d={envelopePath}\n      fill=\"none\"\n      stroke=\"var(--accent)\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n\n    <!-- Fill area under curve for emphasis -->\n    <path\n      d=\"{envelopePath} L {width - 10} {height - 10} L 10 {height - 10} Z\"\n      fill=\"var(--accent)\"\n      opacity=\"0.2\"\n    />\n\n    <!-- Phase markers (A, D, S, R labels) -->\n    {#each phaseMarkers as marker}\n      <text\n        x={marker.x}\n        y={marker.y}\n        text-anchor=\"middle\"\n        font-size=\"10\"\n        font-weight=\"600\"\n        fill=\"var(--text-primary)\"\n        font-family=\"var(--font-family-mono)\"\n      >\n        <title>{marker.title}</title>\n        {marker.label}\n      </text>\n    {/each}\n  </svg>\n\n  <!-- Educational info -->\n  <div class=\"envelope-info\">\n    <div class=\"info-row\">\n      <span class=\"info-label\">Attack:</span>\n      <span class=\"info-value\">{(attack * 1000).toFixed(0)}ms</span>\n    </div>\n    <div class=\"info-row\">\n      <span class=\"info-label\">Decay:</span>\n      <span class=\"info-value\">{(decay * 1000).toFixed(0)}ms</span>\n    </div>\n    <div class=\"info-row\">\n      <span class=\"info-label\">Sustain:</span>\n      <span class=\"info-value\">{(sustain * 100).toFixed(0)}%</span>\n    </div>\n    <div class=\"info-row\">\n      <span class=\"info-label\">Release:</span>\n      <span class=\"info-value\">{(release * 1000).toFixed(0)}ms</span>\n    </div>\n  </div>\n</div>\n\n<!-- ===== STYLES - Using Design Tokens ===== -->\n<style>\n  .envelope-graph {\n    display: flex;\n    flex-direction: column;\n    background: var(--bg-secondary);\n    border: var(--border-default);\n    border-radius: var(--border-radius-lg);\n    overflow: hidden;\n    box-shadow: var(--shadow-md);\n  }\n\n  .envelope-svg {\n    display: block;\n    width: 100%;\n    height: auto;\n  }\n\n  .envelope-info {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: var(--space-2);\n    padding: var(--space-3) var(--space-4);\n    background: var(--bg-elevated);\n    border-top: 1px solid var(--border-color);\n  }\n\n  .info-row {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-1);\n  }\n\n  .info-label {\n    font-size: var(--font-size-xs);\n    font-weight: var(--font-weight-semibold);\n    color: var(--text-secondary);\n    font-family: var(--font-family-mono);\n    letter-spacing: var(--letter-spacing-wide);\n    text-transform: uppercase;\n  }\n\n  .info-value {\n    font-size: var(--font-size-sm);\n    font-weight: var(--font-weight-bold);\n    color: var(--accent);\n    font-family: var(--font-family-mono);\n  }\n\n  /* Responsive */\n  @media (max-width: 768px) {\n    .envelope-info {\n      grid-template-columns: repeat(2, 1fr);\n      gap: var(--space-3);\n    }\n  }\n</style>\n","<script>\n  /**\n   * VUMeter.svelte\n   * \n   * PURPOSE:\n   * Volume Unit meter showing real-time audio level with peak hold.\n   * Monitors output amplitude to prevent clipping and show dynamic range.\n   * \n   * EDUCATIONAL VALUE:\n   * - Shows dynamic range of audio signal\n   * - Teaches about clipping (when signal exceeds 0 dBFS)\n   * - Demonstrates peak vs. RMS measurement\n   * - Visual feedback for compression/dynamics\n   * \n   * AUDIO CONCEPTS:\n   * - 0 dBFS = maximum digital level (clipping point)\n   * - -6 dB = healthy headroom target\n   * - Peak hold = highest level reached (slow decay)\n   * - RMS = Root Mean Square (average energy level)\n   * \n   * USAGE:\n   * <VUMeter audioContext={ctx} sourceNode={masterGain} />\n   */\n\n  import { onMount } from 'svelte';\n\n  // ===== COMPONENT PROPS =====\n  let {\n    audioContext = undefined,\n    sourceNode = undefined,\n    orientation = 'vertical', // 'vertical' | 'horizontal'\n    width = 40,\n    height = 200\n  } = $props();\n\n  // ===== LOCAL STATE =====\n  let canvasRef = $state(null);\n  let analyser = $state(null);\n  let dataArray = $state(null);\n  let animationId = $state(null);\n  let isActive = $state(false);\n\n  let currentLevel = $state(0); // 0-1 range\n  let peakLevel = $state(0); // 0-1 range\n  let peakHoldTime = $state(0); // Time since peak\n\n  // ===== LIFECYCLE & SETUP =====\n\n  /**\n   * Initialize analyzer when audio context and source are available\n   */\n  $effect(() => {\n    if (!audioContext || !sourceNode) {\n      cleanup();\n      return;\n    }\n\n    try {\n      // Create analyzer for level detection\n      analyser = audioContext.createAnalyser();\n      analyser.fftSize = 256; // Small FFT = fast response\n      analyser.smoothingTimeConstant = 0.8;\n\n      // Connect source â†’ analyzer\n      sourceNode.connect(analyser);\n\n      // Allocate buffer for time-domain data (waveform)\n      dataArray = new Uint8Array(analyser.frequencyBinCount);\n\n      isActive = true;\n\n      // Start animation loop\n      draw();\n\n      console.log(`âœ“ VUMeter initialized`);\n    } catch (err) {\n      console.error('VUMeter setup failed:', err);\n      cleanup();\n    }\n\n    return cleanup;\n  });\n\n  /**\n   * Animation loop: Measure audio level and update meter\n   * Runs at ~60fps\n   */\n  function draw() {\n    if (!isActive) return;\n\n    animationId = requestAnimationFrame(draw);\n\n    if (!analyser || !dataArray || !canvasRef) return;\n\n    // Get time-domain data (waveform samples)\n    analyser.getByteTimeDomainData(dataArray);\n\n    // Calculate RMS (Root Mean Square) level\n    let sumSquares = 0;\n    for (let i = 0; i < dataArray.length; i++) {\n      const normalized = (dataArray[i] - 128) / 128; // Convert 0-255 to -1 to 1\n      sumSquares += normalized * normalized;\n    }\n    const rms = Math.sqrt(sumSquares / dataArray.length);\n\n    // Update current level (with smoothing)\n    currentLevel = currentLevel * 0.8 + rms * 0.2;\n\n    // Update peak hold\n    if (currentLevel > peakLevel) {\n      peakLevel = currentLevel;\n      peakHoldTime = 0;\n    } else {\n      peakHoldTime += 1;\n      // Decay peak slowly after 60 frames (1 second at 60fps)\n      if (peakHoldTime > 60) {\n        peakLevel = Math.max(0, peakLevel - 0.001);\n      }\n    }\n\n    // Draw the meter\n    drawMeter();\n  }\n\n  /**\n   * Draw VU meter on canvas\n   */\n  function drawMeter() {\n    const canvas = canvasRef;\n    const ctx = canvas.getContext('2d');\n    const w = canvas.width;\n    const h = canvas.height;\n\n    // Clear canvas\n    ctx.fillStyle = 'var(--bg-primary)';\n    ctx.fillRect(0, 0, w, h);\n\n    if (orientation === 'vertical') {\n      drawVerticalMeter(ctx, w, h);\n    } else {\n      drawHorizontalMeter(ctx, w, h);\n    }\n  }\n\n  /**\n   * Draw vertical VU meter\n   */\n  function drawVerticalMeter(ctx, w, h) {\n    const barHeight = currentLevel * h;\n    const peakY = h - (peakLevel * h);\n\n    // Draw level bar (green â†’ yellow â†’ red gradient)\n    const gradient = ctx.createLinearGradient(0, h, 0, 0);\n    gradient.addColorStop(0, 'var(--vu-green)'); // Green (bottom)\n    gradient.addColorStop(0.7, 'var(--vu-yellow)'); // Yellow (middle)\n    gradient.addColorStop(1, 'var(--vu-red)'); // Red (top)\n\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, h - barHeight, w, barHeight);\n\n    // Draw peak hold marker\n    if (peakLevel > 0.05) {\n      ctx.fillStyle = 'var(--accent)';\n      ctx.fillRect(0, peakY - 2, w, 3);\n    }\n\n    // Draw scale markers (0, -6, -12, -24 dB)\n    ctx.strokeStyle = 'var(--border-color)';\n    ctx.lineWidth = 1;\n    \n    const markers = [\n      { db: 0, y: 0 },\n      { db: -6, y: h * 0.3 },\n      { db: -12, y: h * 0.5 },\n      { db: -24, y: h * 0.7 }\n    ];\n\n    markers.forEach(marker => {\n      ctx.beginPath();\n      ctx.moveTo(0, marker.y);\n      ctx.lineTo(w * 0.3, marker.y);\n      ctx.stroke();\n    });\n  }\n\n  /**\n   * Draw horizontal VU meter\n   */\n  function drawHorizontalMeter(ctx, w, h) {\n    const barWidth = currentLevel * w;\n    const peakX = peakLevel * w;\n\n    // Draw level bar\n    const gradient = ctx.createLinearGradient(0, 0, w, 0);\n    gradient.addColorStop(0, 'var(--vu-green)');\n    gradient.addColorStop(0.7, 'var(--vu-yellow)');\n    gradient.addColorStop(1, 'var(--vu-red)');\n\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, barWidth, h);\n\n    // Draw peak hold marker\n    if (peakLevel > 0.05) {\n      ctx.fillStyle = 'var(--accent)';\n      ctx.fillRect(peakX - 2, 0, 3, h);\n    }\n  }\n\n  /**\n   * Cleanup function\n   */\n  function cleanup() {\n    isActive = false;\n\n    if (animationId) {\n      cancelAnimationFrame(animationId);\n      animationId = null;\n    }\n\n    if (analyser && sourceNode) {\n      try {\n        sourceNode.disconnect(analyser);\n      } catch (err) {\n        // Already disconnected\n      }\n      analyser = null;\n    }\n\n    dataArray = null;\n    currentLevel = 0;\n    peakLevel = 0;\n  }\n\n  onMount(() => {\n    return cleanup;\n  });\n\n  // Computed level in dB for display\n  let currentDb = $derived(\n    currentLevel > 0.001 \n      ? Math.round(20 * Math.log10(currentLevel))\n      : -60\n  );\n\n  let peakDb = $derived(\n    peakLevel > 0.001\n      ? Math.round(20 * Math.log10(peakLevel))\n      : -60\n  );\n</script>\n\n<!-- ===== TEMPLATE ===== -->\n<div \n  class=\"vu-meter\" \n  class:vertical={orientation === 'vertical'}\n  class:horizontal={orientation === 'horizontal'}\n  role=\"img\" \n  aria-label=\"VU Meter - Audio level monitor\"\n>\n  <!-- Canvas for meter display -->\n  <canvas\n    bind:this={canvasRef}\n    width={width}\n    height={height}\n    class=\"vu-canvas\"\n  ></canvas>\n\n  <!-- Level readout -->\n  <div class=\"level-readout\">\n    <div class=\"readout-row\">\n      <span class=\"readout-label\">RMS:</span>\n      <span class=\"readout-value\" class:warn={currentDb > -6} class:danger={currentDb > -3}>\n        {currentDb} dB\n      </span>\n    </div>\n    <div class=\"readout-row\">\n      <span class=\"readout-label\">Peak:</span>\n      <span class=\"readout-value\" class:warn={peakDb > -6} class:danger={peakDb > -3}>\n        {peakDb} dB\n      </span>\n    </div>\n  </div>\n</div>\n\n<!-- ===== STYLES - Using Design Tokens ===== -->\n<style>\n  .vu-meter {\n    display: flex;\n    background: var(--bg-secondary);\n    border: var(--border-default);\n    border-radius: var(--border-radius-lg);\n    overflow: hidden;\n    box-shadow: var(--shadow-md);\n  }\n\n  .vu-meter.vertical {\n    flex-direction: column;\n    align-items: center;\n    padding: var(--space-3);\n    gap: var(--space-3);\n  }\n\n  .vu-meter.horizontal {\n    flex-direction: row;\n    align-items: center;\n    padding: var(--space-3);\n    gap: var(--space-3);\n  }\n\n  .vu-canvas {\n    display: block;\n    background: var(--bg-primary);\n    border: 1px solid var(--border-color);\n    border-radius: var(--border-radius-sm);\n  }\n\n  .level-readout {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-2);\n    min-width: 100px;\n  }\n\n  .readout-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: var(--space-2);\n  }\n\n  .readout-label {\n    font-size: var(--font-size-xs);\n    font-weight: var(--font-weight-semibold);\n    color: var(--text-secondary);\n    font-family: var(--font-family-mono);\n    letter-spacing: var(--letter-spacing-wide);\n  }\n\n  .readout-value {\n    font-size: var(--font-size-sm);\n    font-weight: var(--font-weight-bold);\n    color: var(--vu-green);\n    font-family: var(--font-family-mono);\n    transition: color var(--transition-fast);\n  }\n\n  .readout-value.warn {\n    color: var(--vu-yellow);\n  }\n\n  .readout-value.danger {\n    color: var(--vu-red);\n  }\n\n  /* Responsive */\n  @media (max-width: 768px) {\n    .vu-meter.vertical {\n      padding: var(--space-2);\n      gap: var(--space-2);\n    }\n\n    .level-readout {\n      min-width: 80px;\n    }\n  }\n</style>\n","<script>\n  /**\n   * ControlPanel.svelte\n   * Numbers-free, vintage-aesthetic control interface\n   *\n   * Redesigned for Postcard Piano aesthetic:\n   * - No numeric value displays (all visual/perceptual feedback)\n   * - Custom VintageKnob components instead of sliders\n   * - Signature features: AGE, Room Mics, Tube Saturation\n   * - Minimal layout with generous whitespace\n   * - Advanced controls hidden by default\n   *\n   * @component\n   */\n\n  import VintageKnob from '@ui/controls/VintageKnob.svelte';\n  import AGEControl from './AGEControl.svelte';\n  import RoomMicsControl from './RoomMicsControl.svelte';\n  import TubeSaturationControl from './TubeSaturationControl.svelte';\n  import SpectrumAnalyzer from '@ui/visualizers/SpectrumAnalyzer.svelte';\n  import EnvelopeGraph from '@ui/visualizers/EnvelopeGraph.svelte';\n  import VUMeter from '@ui/visualizers/VUMeter.svelte';\n\n  let { audioState = undefined } = $props();\n\n  // Primary control states (numbers-free)\n  let masterVolume = $state(audioState?.pianoState?.masterVolume ?? 0.5);\n  let ageAmount = $state(0);\n  let roomMix = $state(0.3);\n  let roomDecay = $state(2);\n  let saturation = $state(0);\n\n  // Advanced controls (hidden by default)\n  let showAdvanced = $state(false);\n\n  // Advanced control states\n  let attackTime = $state(audioState?.synthesis?.attackTime ?? 0.05);\n  let decayTime = $state(audioState?.synthesis?.decayTime ?? 0.2);\n  let sustainLevel = $state(audioState?.synthesis?.sustainLevel ?? 0.6);\n  let releaseTime = $state(audioState?.synthesis?.releaseTime ?? 1.0);\n  let compressionThreshold = $state(audioState?.effects?.compression?.threshold ?? -24);\n  let compressionRatio = $state(audioState?.effects?.compression?.ratio ?? 4);\n\n  // Update audio state when primary controls change\n  $effect(() => {\n    if (audioState) {\n      audioState.setParameter('pianoState.masterVolume', masterVolume);\n    }\n  });\n\n  $effect(() => {\n    if (audioState) {\n      audioState.setParameter('effects.saturation.amount', saturation / 100);\n    }\n  });\n\n  $effect(() => {\n    if (audioState) {\n      audioState.setParameter('effects.reverb.dryWet', roomMix);\n      audioState.setParameter('effects.reverb.decayTime', roomDecay);\n    }\n  });\n\n  // Advanced control effects\n  $effect(() => {\n    if (audioState && showAdvanced) {\n      audioState.setParameter('synthesis.attackTime', attackTime);\n      audioState.setParameter('synthesis.decayTime', decayTime);\n      audioState.setParameter('synthesis.sustainLevel', sustainLevel);\n      audioState.setParameter('synthesis.releaseTime', releaseTime);\n    }\n  });\n\n  $effect(() => {\n    if (audioState && showAdvanced) {\n      audioState.setParameter('effects.compression.threshold', compressionThreshold);\n      audioState.setParameter('effects.compression.ratio', compressionRatio);\n    }\n  });\n\n  function toggleAdvanced() {\n    showAdvanced = !showAdvanced;\n  }\n</script>\n\n<div class=\"control-panel\">\n  <!-- Master Volume Section -->\n  <section class=\"control-section\">\n    <div class=\"section-header\">\n      <h3 class=\"section-title\">Master Volume</h3>\n    </div>\n\n    <div class=\"knob-container\">\n      <VintageKnob\n        bind:value={masterVolume}\n        min={0}\n        max={1}\n        step={0.05}\n        label=\"Level\"\n        showIntensity={true}\n        ariaLabel=\"Master Volume\"\n      />\n    </div>\n  </section>\n\n  <!-- Visual Feedback: Spectrum & Levels -->\n  <section class=\"control-section visualizer-section\">\n    <div class=\"section-header\">\n      <h3 class=\"section-title\">Audio Visualization</h3>\n      <p class=\"section-description\">Real-time frequency spectrum and level monitoring</p>\n    </div>\n\n    <div class=\"visualizers-grid\">\n      <div class=\"visualizer-item spectrum-item\">\n        <SpectrumAnalyzer \n          audioContext={audioState?.audioContext}\n          sourceNode={audioState?.masterGain}\n          width={600}\n          height={150}\n        />\n      </div>\n\n      <div class=\"visualizer-item meter-item\">\n        <VUMeter\n          audioContext={audioState?.audioContext}\n          sourceNode={audioState?.masterGain}\n          orientation=\"vertical\"\n          width={40}\n          height={150}\n        />\n      </div>\n    </div>\n  </section>\n\n  <!-- AGE: Signature Vintage Character Feature -->\n  <AGEControl bind:ageAmount={ageAmount} />\n\n  <!-- Room Mics: Intimate Studio Ambience -->\n  <RoomMicsControl bind:roomMix={roomMix} bind:roomDecay={roomDecay} />\n\n  <!-- Tube Saturation: Warm Coloration -->\n  <TubeSaturationControl bind:saturation={saturation} />\n\n  <!-- Advanced Controls: Collapsible Section -->\n  <section class=\"control-section advanced-section\">\n    <button class=\"advanced-toggle\" onclick={toggleAdvanced}>\n      <span class=\"toggle-label\">\n        {showAdvanced ? 'â–¼' : 'â–¶'} Advanced Controls\n      </span>\n    </button>\n\n    {#if showAdvanced}\n      <div class=\"advanced-content\">\n        <!-- Envelope Section -->\n        <div class=\"subsection\">\n          <h4 class=\"subsection-title\">Envelope (ADSR)</h4>\n\n          <div class=\"knob-grid\">\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={attackTime}\n                min={0}\n                max={0.5}\n                step={0.01}\n                label=\"Attack\"\n                ariaLabel=\"Attack Time\"\n              />\n            </div>\n\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={decayTime}\n                min={0}\n                max={1}\n                step={0.01}\n                label=\"Decay\"\n                ariaLabel=\"Decay Time\"\n              />\n            </div>\n\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={sustainLevel}\n                min={0}\n                max={1}\n                step={0.05}\n                label=\"Sustain\"\n                ariaLabel=\"Sustain Level\"\n              />\n            </div>\n\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={releaseTime}\n                min={0}\n                max={3}\n                step={0.05}\n                label=\"Release\"\n                ariaLabel=\"Release Time\"\n              />\n            </div>\n          </div>\n\n          <!-- Envelope Visualization -->\n          <div class=\"visualizer-container\">\n            <EnvelopeGraph\n              attack={attackTime}\n              decay={decayTime}\n              sustain={sustainLevel}\n              release={releaseTime}\n              width={400}\n              height={120}\n            />\n          </div>\n        </div>\n\n        <!-- Compression Section -->\n        <div class=\"subsection\">\n          <h4 class=\"subsection-title\">Compression</h4>\n\n          <div class=\"knob-grid\">\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={compressionThreshold}\n                min={-60}\n                max={0}\n                step={1}\n                label=\"Threshold\"\n                ariaLabel=\"Compression Threshold\"\n              />\n            </div>\n\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={compressionRatio}\n                min={1}\n                max={20}\n                step={0.5}\n                label=\"Ratio\"\n                ariaLabel=\"Compression Ratio\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    {/if}\n  </section>\n</div>\n\n<style>\n  .control-panel {\n    /* Design tokens - local scope */\n    --color-cream: #f5f1e8;\n    --color-taupe: #8b8680;\n    --color-sage: #9ca89a;\n    --color-warm-brown: #6b5b52;\n    --color-gold: #d4a574;\n    --color-deep-brown: #3d3230;\n\n    --color-background: var(--color-cream);\n    --color-surface: #ebe7dd;\n    --color-text-primary: var(--color-deep-brown);\n    --color-text-secondary: var(--color-taupe);\n    --color-border: var(--color-sage);\n    --color-accent: var(--color-gold);\n\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08);\n    --shadow-md: 0 2px 4px rgba(61, 50, 48, 0.12);\n\n    --border-radius-md: 4px;\n\n    --space-2: 8px;\n    --space-3: 12px;\n    --space-4: 16px;\n    --space-6: 24px;\n    --space-8: 32px;\n    display: flex;\n    flex-direction: column;\n    gap: 0;\n    background: var(--color-background);\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: var(--shadow-md);\n  }\n\n  .control-section {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-background);\n\n    /* Separator between sections */\n    border-bottom: 1px solid var(--color-border);\n  }\n\n  .control-section:last-child {\n    border-bottom: none;\n  }\n\n  .section-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-2);\n    text-align: center;\n  }\n\n  .section-title {\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 0.5px;\n    text-transform: uppercase;\n  }\n\n  .section-description {\n    font-size: 12px;\n    font-weight: 400;\n    color: var(--color-text-secondary);\n    margin: 0;\n    font-style: italic;\n  }\n\n  /* Visualizer Section */\n  .visualizer-section {\n    background: var(--color-surface);\n  }\n\n  .visualizers-grid {\n    display: flex;\n    gap: var(--space-4);\n    align-items: flex-start;\n    justify-content: center;\n    flex-wrap: wrap;\n  }\n\n  .visualizer-item {\n    display: flex;\n  }\n\n  .spectrum-item {\n    flex: 1;\n    min-width: 300px;\n  }\n\n  .meter-item {\n    flex-shrink: 0;\n  }\n\n  .knob-container {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n  }\n\n  /* Advanced Controls Section */\n  .advanced-section {\n    gap: 0;\n    padding: 0;\n    border-top: 2px solid var(--color-border);\n  }\n\n  .advanced-toggle {\n    /* Reset button styling */\n    background: none;\n    border: none;\n    padding: var(--space-6);\n    margin: 0;\n    cursor: pointer;\n    width: 100%;\n    text-align: left;\n\n    /* Typography */\n    font-family: inherit;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--color-text-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n\n    /* Hover state */\n    transition: background 0.2s ease-out;\n    background: var(--color-surface);\n  }\n\n  .advanced-toggle:hover {\n    background: #e0dbd0;\n  }\n\n  .advanced-toggle:focus-visible {\n    outline: 2px solid var(--color-accent);\n    outline-offset: -2px;\n  }\n\n  .toggle-label {\n    display: flex;\n    align-items: center;\n    gap: var(--space-2);\n  }\n\n  .advanced-content {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-surface);\n    animation: slideDown 0.2s ease-out;\n  }\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-8px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  .subsection {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-4);\n  }\n\n  .subsection:not(:last-child) {\n    padding-bottom: var(--space-4);\n    border-bottom: 1px solid var(--color-border);\n  }\n\n  .subsection-title {\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--color-text-secondary);\n    margin: 0;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    text-align: center;\n  }\n\n  .knob-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n    gap: var(--space-4);\n    justify-items: center;\n  }\n\n  .knob-item {\n    display: flex;\n    justify-content: center;\n  }\n\n  /* Visualizer Container */\n  .visualizer-container {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n    margin-top: var(--space-2);\n  }\n</style>\n","/**\n * scales.js - Music Theory: Scale System\n *\n * CONCEPT:\n * Scales are ordered sequences of notes with specific interval patterns.\n * All Western music is built on scales. Understanding scales is fundamental\n * to understanding chords and progressions.\n *\n * MUSIC THEORY BASICS:\n * - Semitone (half-step): smallest interval in Western music = 1 MIDI number\n * - Whole tone (whole-step): = 2 semitones\n * - Octave: 12 semitones, same note name, different pitch\n * - Scale degree: position in scale (I, II, III, IV, V, VI, VII)\n * - Root note: starting note of the scale\n *\n * EXAMPLES:\n * - C Major scale: C D E F G A B C\n * - Intervals: W W H W W W H (Whole, Whole, Half, Whole, Whole, Whole, Half)\n * - MIDI pattern: [0, 2, 4, 5, 7, 9, 11] (semitones from root)\n *\n * HOW THIS MODULE WORKS:\n * 1. Scale definitions stored as interval patterns (semitones from root)\n * 2. Generate scale notes given a root MIDI note\n * 3. Map scale degrees to notes\n * 4. Provide scale information (name, intervals, etc.)\n *\n * @module music-theory/scales\n */\n\n// ============================================================\n// SCALE DEFINITIONS - Interval patterns (semitones from root)\n// ============================================================\n\n/**\n * Scale definitions as interval patterns\n *\n * Each scale is an array of semitone intervals from the root note.\n * The root (0) is always included, and the pattern repeats at octave (12).\n *\n * WHY THIS FORMAT:\n * - Works with any root note (transposition)\n * - MIDI compatible (can multiply by root MIDI number)\n * - Easy to understand visually\n * - Extensible (add new scales easily)\n */\nexport const SCALE_DEFINITIONS = {\n  // MAJOR SCALE - Happiest, most common scale\n  // Pattern: W W H W W W H\n  // Used in: pop, classical, folk, many genres\n  // Emotional: bright, happy, resolved\n  major: {\n    name: 'Major',\n    intervals: [0, 2, 4, 5, 7, 9, 11],\n    description: 'Bright, happy, resolved',\n    degrees: ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII']\n  },\n\n  // MINOR (Natural) - Darker than major\n  // Pattern: W H W W H W W\n  // Used in: blues, rock, metal, sad songs\n  // Emotional: melancholic, introspective, darker\n  minorNatural: {\n    name: 'Minor (Natural)',\n    intervals: [0, 2, 3, 5, 7, 8, 10],\n    description: 'Dark, introspective, melancholic',\n    degrees: ['I', 'II', 'IIIb', 'IV', 'V', 'VIb', 'VIIb']\n  },\n\n  // MINOR (Harmonic) - Minor with raised VII for dominant function\n  // Pattern: W H W W H W+H W (augmented 2nd between VI-VII)\n  // Used in: classical, flamenco\n  // Why: Makes V chord sound more resolved\n  minorHarmonic: {\n    name: 'Minor (Harmonic)',\n    intervals: [0, 2, 3, 5, 7, 8, 11],\n    description: 'Dark with classical harmonic strength',\n    degrees: ['I', 'II', 'IIIb', 'IV', 'V', 'VIb', 'VII']\n  },\n\n  // MINOR (Melodic) - Minor scale with raised VI and VII in ascending direction\n  // Pattern: W H W W W W H (ascending)\n  // Used in: classical melodies, jazz improvisations\n  // Why: Easier to play in ascending passages\n  minorMelodic: {\n    name: 'Minor (Melodic)',\n    intervals: [0, 2, 3, 5, 7, 9, 11],\n    description: 'Dark but with melodic ease',\n    degrees: ['I', 'II', 'IIIb', 'IV', 'V', 'VI', 'VII']\n  },\n\n  // MODES - Same notes as major scale, different starting points\n  // Dorian: Major scale starting from II\n  // Phrygian: Major scale starting from III\n  // Lydian: Major scale starting from IV\n  // Mixolydian: Major scale starting from V\n  // Aeolian: Major scale starting from VI (= natural minor)\n  // Locrian: Major scale starting from VII\n\n  // DORIAN - II mode of major scale\n  // Pattern: W H W W W H W\n  // Used in: jazz, funk, blues, modal jazz\n  // Emotional: jazzy, slightly dark but not sad\n  dorian: {\n    name: 'Dorian',\n    intervals: [0, 2, 3, 5, 7, 9, 10],\n    description: 'Jazzy, funky, slightly dark',\n    degrees: ['I', 'II', 'IIIb', 'IV', 'V', 'VI', 'VIIb']\n  },\n\n  // PHRYGIAN - III mode of major scale\n  // Pattern: H W W W H W W\n  // Used in: Spanish/flamenco, metal, exotic sounds\n  // Emotional: exotic, dark, ominous\n  phrygian: {\n    name: 'Phrygian',\n    intervals: [0, 1, 3, 5, 7, 8, 10],\n    description: 'Spanish, exotic, ominous',\n    degrees: ['I', 'IIb', 'IIIb', 'IV', 'V', 'VIb', 'VIIb']\n  },\n\n  // LYDIAN - IV mode of major scale\n  // Pattern: W W W H W W H\n  // Used in: video game music, film scores, quirky pop\n  // Emotional: bright, ethereal, whimsical\n  lydian: {\n    name: 'Lydian',\n    intervals: [0, 2, 4, 6, 7, 9, 11],\n    description: 'Bright, ethereal, whimsical',\n    degrees: ['I', 'II', 'III', '#IV', 'V', 'VI', 'VII']\n  },\n\n  // MIXOLYDIAN - V mode of major scale\n  // Pattern: W W H W W H W\n  // Used in: blues, rock, funk, country\n  // Emotional: bluesy, dominant feel, not quite major\n  mixolydian: {\n    name: 'Mixolydian',\n    intervals: [0, 2, 4, 5, 7, 9, 10],\n    description: 'Bluesy, dominant, rock-oriented',\n    degrees: ['I', 'II', 'III', 'IV', 'V', 'VI', 'VIIb']\n  },\n\n  // AEOLIAN - VI mode of major scale (same as natural minor)\n  // Pattern: W H W W H W W\n  // Used in: any music using natural minor\n  // Emotional: dark, introspective\n  aeolian: {\n    name: 'Aeolian',\n    intervals: [0, 2, 3, 5, 7, 8, 10],\n    description: 'Dark, introspective',\n    degrees: ['I', 'II', 'IIIb', 'IV', 'V', 'VIb', 'VIIb']\n  },\n\n  // LOCRIAN - VII mode of major scale\n  // Pattern: H W W H W W W\n  // Used in: heavy metal, experimental, rarely in other genres\n  // Emotional: dark, dissonant, unstable\n  locrian: {\n    name: 'Locrian',\n    intervals: [0, 1, 3, 5, 6, 8, 10],\n    description: 'Dark, dissonant, unstable',\n    degrees: ['I', 'IIb', 'IIIb', 'IV', 'Vb', 'VIb', 'VIIb']\n  },\n\n  // PENTATONIC SCALES - 5-note scales (penta = 5)\n  // Simpler than 7-note scales, very common in world music\n  // Hard to play wrong - great for beginners\n\n  // MAJOR PENTATONIC - Major scale without IV and VII\n  // Notes: 1 2 3 5 6\n  // Pattern: W W W+H W W+H (irregular)\n  // Used in: blues, rock, pop, Asian music\n  // Why: No \"wrong\" notes, very musical\n  majorPentatonic: {\n    name: 'Major Pentatonic',\n    intervals: [0, 2, 4, 7, 9],\n    description: 'Pentatonic, musical, versatile',\n    degrees: ['I', 'II', 'III', 'V', 'VI']\n  },\n\n  // MINOR PENTATONIC - Natural minor without II and VI\n  // Notes: 1 b3 4 5 b7\n  // Pattern: W+H W W W+H W (irregular)\n  // Used in: blues, rock, funk, worldmusic\n  // Why: Same as major pentatonic - no \"wrong\" notes\n  minorPentatonic: {\n    name: 'Minor Pentatonic',\n    intervals: [0, 3, 5, 7, 10],\n    description: 'Pentatonic blues, versatile',\n    degrees: ['I', 'IIIb', 'IV', 'V', 'VIIb']\n  },\n\n  // BLUES SCALE - Minor pentatonic + flat 5 (blue note)\n  // Pattern: W+H W W H W+H W\n  // Used in: blues, rock, funk\n  // Why: The flat 5 (Vb) creates that classic blues sound\n  blues: {\n    name: 'Blues',\n    intervals: [0, 3, 5, 6, 7, 10],\n    description: 'Blues, rock, with blue notes',\n    degrees: ['I', 'IIIb', 'IV', 'Vb', 'V', 'VIIb']\n  }\n};\n\n// ============================================================\n// NOTE NAMES AND ENHARMONICS\n// ============================================================\n\n/**\n * Note names: C, C#/Db, D, D#/Eb, E, F, F#/Gb, G, G#/Ab, A, A#/Bb, B\n * Sharp (#): raise by 1 semitone\n * Flat (b): lower by 1 semitone\n */\nconst NOTE_NAMES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\nconst NOTE_NAMES_FLAT = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n\n// ============================================================\n// SCALE GENERATION FUNCTIONS\n// ============================================================\n\n/**\n * Generate all notes in a scale given a root MIDI note\n *\n * MUSIC THEORY CONCEPT:\n * - Transposition: applying the same interval pattern to a different root\n * - This works because Western music is based on repeating interval patterns\n * - Example: C Major and F# Major have the same interval pattern,\n *   just starting from different notes\n *\n * ALGORITHM:\n * 1. Get scale definition (interval pattern)\n * 2. For each interval, add to root MIDI note\n * 3. Generate additional octaves to fill range\n * 4. Return array of scale notes in MIDI numbers\n *\n * @param {number} rootMidi - Root note in MIDI (0-127, usually 48-84)\n * @param {string} scaleType - Key from SCALE_DEFINITIONS (e.g., 'major', 'minorPentatonic')\n * @param {number} octaves - How many octaves to generate (default: 2)\n * @returns {Array<number>} Array of MIDI notes in the scale\n *\n * @example\n * const cMajor = generateScale(60, 'major', 2);\n * // Returns: [60, 62, 64, 65, 67, 69, 71, 72, 74, 76, 77, 79, 81, 83]\n * // Which is: C4, D4, E4, F4, G4, A4, B4, C5, D5, E5, F5, G5, A5, B5\n */\nexport function generateScale(rootMidi, scaleType = 'major', octaves = 2) {\n  // Validate inputs\n  if (!SCALE_DEFINITIONS[scaleType]) {\n    console.warn(`Unknown scale type: ${scaleType}, defaulting to major`);\n    scaleType = 'major';\n  }\n\n  const scaleDef = SCALE_DEFINITIONS[scaleType];\n  const notes = [];\n\n  // Generate notes across specified octaves\n  for (let oct = 0; oct < octaves; oct++) {\n    for (const interval of scaleDef.intervals) {\n      const midiNote = rootMidi + (oct * 12) + interval;\n      // Validate MIDI range (0-127)\n      if (midiNote >= 0 && midiNote <= 127) {\n        notes.push(midiNote);\n      }\n    }\n  }\n\n  return notes;\n}\n\n/**\n * Get scale information (name, intervals, scale degrees)\n *\n * @param {string} scaleType - Key from SCALE_DEFINITIONS\n * @returns {Object} Scale definition object\n *\n * @example\n * const majorInfo = getScaleInfo('major');\n * // Returns:\n * // {\n * //   name: 'Major',\n * //   intervals: [0, 2, 4, 5, 7, 9, 11],\n * //   description: 'Bright, happy, resolved',\n * //   degrees: ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII']\n * // }\n */\nexport function getScaleInfo(scaleType) {\n  return SCALE_DEFINITIONS[scaleType] || SCALE_DEFINITIONS.major;\n}\n\n/**\n * Get all available scale types\n *\n * @returns {Array<string>} Array of scale type keys\n *\n * @example\n * const scales = getAvailableScales();\n * // Returns: ['major', 'minorNatural', 'minorHarmonic', ...]\n */\nexport function getAvailableScales() {\n  return Object.keys(SCALE_DEFINITIONS);\n}\n\n/**\n * Get scale note name (e.g., C4, D#4, Bb3)\n *\n * MUSIC THEORY CONCEPT:\n * - Note name: letter + accidental (sharp/flat) + octave\n * - Middle C = C4 = MIDI 60\n * - Each octave starts on C and ends on B\n *\n * @param {number} midiNote - MIDI note number (0-127)\n * @param {boolean} useSharps - Use sharps (default) or flats\n * @returns {string} Note name (e.g., \"C4\", \"F#3\", \"Bb5\")\n *\n * @example\n * getNoteName(60);  // \"C4\"\n * getNoteName(61);  // \"C#4\"\n * getNoteName(61, false);  // \"Db4\"\n * getNoteName(69);  // \"A4\" (concert pitch)\n */\nexport function getNoteName(midiNote, useSharps = true) {\n  const octave = Math.floor(midiNote / 12) - 1;\n  const noteIndex = midiNote % 12;\n  const noteNames = useSharps ? NOTE_NAMES : NOTE_NAMES_FLAT;\n  return `${noteNames[noteIndex]}${octave}`;\n}\n\n/**\n * Get note names for a scale\n *\n * @param {number} rootMidi - Root note in MIDI\n * @param {string} scaleType - Scale type from SCALE_DEFINITIONS\n * @param {number} octaves - Number of octaves to generate\n * @param {boolean} useSharps - Use sharps or flats\n * @returns {Array<string>} Array of note names (e.g., [\"C4\", \"D4\", \"E4\", ...])\n *\n * @example\n * const cMajorNames = getScaleNoteNames(60, 'major', 1);\n * // Returns: [\"C4\", \"D4\", \"E4\", \"F4\", \"G4\", \"A4\", \"B4\"]\n */\nexport function getScaleNoteNames(rootMidi, scaleType, octaves = 2, useSharps = true) {\n  const midiNotes = generateScale(rootMidi, scaleType, octaves);\n  return midiNotes.map(note => getNoteName(note, useSharps));\n}\n\n/**\n * Get scale degree information\n *\n * MUSIC THEORY CONCEPT:\n * - Scale degree: position in the scale (1-7 in Western music)\n * - Roman numerals: I, II, III, IV, V, VI, VII\n * - Uppercase = major, lowercase = minor, Â° = diminished\n *\n * @param {number} degree - Scale degree (1-7, can be 8 for octave)\n * @param {string} scaleType - Scale type\n * @returns {Object} Degree information\n *\n * @example\n * const fifthDegree = getScaleDegree(5, 'major');\n * // Returns: { degree: 5, roman: 'V', name: 'Dominant', ... }\n */\nexport function getScaleDegree(degree, scaleType = 'major') {\n  const scaleDef = getScaleInfo(scaleType);\n  const degreeNames = ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'];\n  const degreeIndex = (degree - 1) % 7;\n\n  return {\n    degree,\n    roman: scaleDef.degrees[degreeIndex],\n    name: degreeNames[degreeIndex],\n    interval: scaleDef.intervals[degreeIndex]\n  };\n}\n\nexport default {\n  SCALE_DEFINITIONS,\n  generateScale,\n  getScaleInfo,\n  getAvailableScales,\n  getNoteName,\n  getScaleNoteNames,\n  getScaleDegree\n};\n","/**\n * chords.js - Music Theory: Chord System\n *\n * CONCEPT:\n * Chords are combinations of three or more notes played simultaneously.\n * Understanding chords is essential to music - almost all songs use chords.\n *\n * MUSIC THEORY BASICS:\n * - Triad: 3 notes (root, 3rd, 5th)\n * - Seventh chord: 4 notes (triad + 7th)\n * - Intervals: measured from root in semitones\n * - Inversion: moving the root note up an octave\n * - Voice leading: smooth movement between chords\n *\n * CHORD QUALITIES:\n * - Major (maj): happy, resolved, bright\n * - Minor (min): sad, dark, introspective\n * - Diminished (dim): unstable, needs resolution\n * - Augmented (aug): tense, unusual\n *\n * HARMONIC FUNCTION:\n * - Tonic (I): home, rest (C, c)\n * - Subdominant (IV): moving away from home (F, f)\n * - Dominant (V): tension, needs resolution (G, g)\n * - Pre-dominant (ii, iii, vi): lead to dominant\n *\n * @module music-theory/chords\n */\n\nimport { SCALE_DEFINITIONS, generateScale } from './scales.js';\n\n// ============================================================\n// CHORD DEFINITIONS\n// ============================================================\n\n/**\n * Chord templates - intervals from root note\n *\n * Triads (3 notes):\n * - Major: root + major 3rd + perfect 5th = [0, 4, 7]\n * - Minor: root + minor 3rd + perfect 5th = [0, 3, 7]\n * - Diminished: root + minor 3rd + diminished 5th = [0, 3, 6]\n * - Augmented: root + major 3rd + augmented 5th = [0, 4, 8]\n *\n * Seventh chords (4 notes):\n * - Maj7: major triad + major 7th = [0, 4, 7, 11]\n * - Dom7: major triad + minor 7th = [0, 4, 7, 10] (V7)\n * - Min7: minor triad + minor 7th = [0, 3, 7, 10]\n * - Min7b5: diminished + minor 7th = [0, 3, 6, 10] (half-diminished, ii7b5)\n *\n * WHY THESE INTERVALS:\n * - Intervals are measured in semitones\n * - Major 3rd = 4 semitones = bright, happy\n * - Minor 3rd = 3 semitones = dark, sad\n * - Perfect 5th = 7 semitones = stable, consonant\n * - Major 7th = 11 semitones = jazz, sophisticated\n * - Minor 7th = 10 semitones = blues, funk, dominant\n */\nexport const CHORD_TEMPLATES = {\n  // TRIADS - 3-note chords\n  major: {\n    intervals: [0, 4, 7],\n    name: 'Major',\n    symbol: '',\n    quality: 'major',\n    numNotes: 3,\n    description: 'Happy, bright, resolved'\n  },\n\n  minor: {\n    intervals: [0, 3, 7],\n    name: 'Minor',\n    symbol: 'm',\n    quality: 'minor',\n    numNotes: 3,\n    description: 'Sad, dark, introspective'\n  },\n\n  diminished: {\n    intervals: [0, 3, 6],\n    name: 'Diminished',\n    symbol: 'Â°',\n    quality: 'diminished',\n    numNotes: 3,\n    description: 'Unstable, needs resolution'\n  },\n\n  augmented: {\n    intervals: [0, 4, 8],\n    name: 'Augmented',\n    symbol: '+',\n    quality: 'augmented',\n    numNotes: 3,\n    description: 'Tense, unusual, exotic'\n  },\n\n  // SEVENTH CHORDS - 4-note chords\n  maj7: {\n    intervals: [0, 4, 7, 11],\n    name: 'Major 7th',\n    symbol: 'maj7',\n    quality: 'maj7',\n    numNotes: 4,\n    description: 'Jazz, sophisticated, bright'\n  },\n\n  dom7: {\n    intervals: [0, 4, 7, 10],\n    name: 'Dominant 7th',\n    symbol: '7',\n    quality: 'dom7',\n    numNotes: 4,\n    description: 'Blues, funk, dominant tension'\n  },\n\n  min7: {\n    intervals: [0, 3, 7, 10],\n    name: 'Minor 7th',\n    symbol: 'm7',\n    quality: 'min7',\n    numNotes: 4,\n    description: 'Jazz, funk, dark and smooth'\n  },\n\n  minMaj7: {\n    intervals: [0, 3, 7, 11],\n    name: 'Minor Major 7th',\n    symbol: 'm(maj7)',\n    quality: 'minMaj7',\n    numNotes: 4,\n    description: 'Jazz, mysterious, iii or vi chord'\n  },\n\n  halfDim7: {\n    intervals: [0, 3, 6, 10],\n    name: 'Half Diminished 7th',\n    symbol: 'Ã¸7',\n    quality: 'halfDim7',\n    numNotes: 4,\n    description: 'Jazz, pre-dominant tension'\n  }\n};\n\n// ============================================================\n// DIATONIC CHORDS - Chords built from scale degrees\n// ============================================================\n\n/**\n * Diatonic chords: chords built using only notes from a scale\n *\n * MUSIC THEORY CONCEPT:\n * - Each scale degree becomes a chord root\n * - The chord quality depends on the intervals in the scale\n * - For major scale: I(maj), ii(min), iii(min), IV(maj), V(maj), vi(min), viiÂ°\n * - For minor scale: i(min), iiÂ°, III(maj), iv(min), v(min), VI(maj), VII(maj)\n *\n * WHY DIATONIC CHORDS:\n * - All notes in the chord come from the scale = harmonically coherent\n * - Chords sound \"right\" together\n * - No accidental clashes or dissonance\n * - Foundation of melody/harmony rules\n *\n * This function generates all 7 diatonic chords for a given scale\n */\nexport const DIATONIC_CHORD_QUALITIES = {\n  // Major scale diatonic chords\n  major: [\n    { degree: 1, quality: 'major', symbol: 'I', name: 'I', function: 'tonic' },\n    { degree: 2, quality: 'minor', symbol: 'ii', name: 'ii', function: 'pre-dominant' },\n    { degree: 3, quality: 'minor', symbol: 'iii', name: 'iii', function: 'relative' },\n    { degree: 4, quality: 'major', symbol: 'IV', name: 'IV', function: 'subdominant' },\n    { degree: 5, quality: 'major', symbol: 'V', name: 'V', function: 'dominant' },\n    { degree: 6, quality: 'minor', symbol: 'vi', name: 'vi', function: 'relative' },\n    { degree: 7, quality: 'diminished', symbol: 'viiÂ°', name: 'viiÂ°', function: 'diminished' }\n  ],\n\n  // Natural minor scale diatonic chords\n  minorNatural: [\n    { degree: 1, quality: 'minor', symbol: 'i', name: 'i', function: 'tonic' },\n    { degree: 2, quality: 'diminished', symbol: 'iiÂ°', name: 'iiÂ°', function: 'diminished' },\n    { degree: 3, quality: 'major', symbol: 'III', name: 'III', function: 'relative' },\n    { degree: 4, quality: 'minor', symbol: 'iv', name: 'iv', function: 'subdominant' },\n    { degree: 5, quality: 'minor', symbol: 'v', name: 'v', function: 'dominant' },\n    { degree: 6, quality: 'major', symbol: 'VI', name: 'VI', function: 'subdominant' },\n    { degree: 7, quality: 'major', symbol: 'VII', name: 'VII', function: 'dominant-like' }\n  ],\n\n  // Harmonic minor scale diatonic chords\n  minorHarmonic: [\n    { degree: 1, quality: 'minor', symbol: 'i', name: 'i', function: 'tonic' },\n    { degree: 2, quality: 'diminished', symbol: 'iiÂ°', name: 'iiÂ°', function: 'diminished' },\n    { degree: 3, quality: 'augmented', symbol: 'III+', name: 'III+', function: 'relative' },\n    { degree: 4, quality: 'minor', symbol: 'iv', name: 'iv', function: 'subdominant' },\n    { degree: 5, quality: 'major', symbol: 'V', name: 'V', function: 'dominant' },\n    { degree: 6, quality: 'major', symbol: 'VI', name: 'VI', function: 'subdominant' },\n    { degree: 7, quality: 'diminished', symbol: 'viiÂ°', name: 'viiÂ°', function: 'diminished' }\n  ]\n};\n\n// ============================================================\n// CHORD GENERATION FUNCTIONS\n// ============================================================\n\n/**\n * Generate chord notes from root MIDI note and chord template\n *\n * ALGORITHM:\n * 1. Get chord template (intervals)\n * 2. Add each interval to root MIDI note\n * 3. Return array of MIDI notes in chord\n *\n * @param {number} rootMidi - Root note in MIDI (0-127)\n * @param {string} chordType - Chord type key (e.g., 'major', 'min7', 'dim')\n * @returns {Array<number>} Array of MIDI notes in the chord\n *\n * @example\n * generateChord(60, 'major');\n * // Returns: [60, 64, 67] (C, E, G = C Major)\n *\n * generateChord(60, 'min7');\n * // Returns: [60, 63, 67, 70] (C, Eb, G, Bb = C min7)\n */\nexport function generateChord(rootMidi, chordType = 'major') {\n  if (!CHORD_TEMPLATES[chordType]) {\n    console.warn(`Unknown chord type: ${chordType}, defaulting to major`);\n    chordType = 'major';\n  }\n\n  const template = CHORD_TEMPLATES[chordType];\n  return template.intervals.map(interval => rootMidi + interval);\n}\n\n/**\n * Generate all diatonic chords for a scale\n *\n * MUSIC THEORY CONCEPT:\n * For each scale degree, build a chord using only notes from the scale.\n *\n * EXAMPLE: C Major scale\n * - I chord: C E G (from C major scale) = C major\n * - ii chord: D F A (from C major scale) = D minor\n * - iii chord: E G B (from C major scale) = E minor\n * - IV chord: F A C (from C major scale) = F major\n * - V chord: G B D (from C major scale) = G major\n * - vi chord: A C E (from C major scale) = A minor\n * - viiÂ° chord: B D F (from C major scale) = B diminished\n *\n * ALGORITHM:\n * 1. Get scale notes\n * 2. For each scale degree (1-7):\n *    a. Use that degree as chord root\n *    b. Find 3rd (skip next note)\n *    c. Find 5th (skip another note)\n *    d. Use root MIDI + intervals to build chord\n * 3. Return array of chord objects\n *\n * @param {number} rootMidi - Root note in MIDI\n * @param {string} scaleType - Scale type (e.g., 'major', 'minorNatural')\n * @returns {Array<Object>} Array of chord objects with notes and info\n *\n * @example\n * const cMajorChords = generateDiatonicChords(60, 'major');\n * // Returns:\n * // [\n * //   { degree: 1, roman: 'I', root: 60, notes: [60, 64, 67], quality: 'major' },\n * //   { degree: 2, roman: 'ii', root: 62, notes: [62, 65, 69], quality: 'minor' },\n * //   ...\n * // ]\n */\nexport function generateDiatonicChords(rootMidi, scaleType = 'major') {\n  const scaleNotes = generateScale(rootMidi, scaleType, 2);\n  const qualities = DIATONIC_CHORD_QUALITIES[scaleType] || DIATONIC_CHORD_QUALITIES.major;\n  const chords = [];\n\n  for (const quality of qualities) {\n    const degree = quality.degree - 1; // 0-indexed\n    const chordRoot = scaleNotes[degree];\n\n    // Build chord from scale notes (skip notes to get 3rd and 5th)\n    const notes = [\n      scaleNotes[degree],           // Root\n      scaleNotes[degree + 2],       // 3rd (skip one)\n      scaleNotes[degree + 4]        // 5th (skip another)\n    ];\n\n    chords.push({\n      degree: quality.degree,\n      roman: quality.symbol,\n      root: chordRoot,\n      notes,\n      quality: quality.quality,\n      function: quality.function,\n      name: quality.name\n    });\n  }\n\n  return chords;\n}\n\n/**\n * Generate chord inversion\n *\n * MUSIC THEORY CONCEPT:\n * - Root position: root is the lowest note [C, E, G]\n * - First inversion: 3rd is lowest note [E, G, C] (C/E)\n * - Second inversion: 5th is lowest note [G, C, E] (C/G)\n *\n * WHY INVERSIONS MATTER:\n * - Smooth voice leading (moving between chords with minimal motion)\n * - Better bass lines\n * - Different sounds and functions\n * - Cadences often use inversions\n *\n * @param {Array<number>} chordNotes - MIDI notes of chord\n * @param {number} inversion - 0 = root, 1 = first, 2 = second\n * @returns {Array<number>} Inverted chord notes\n *\n * @example\n * const cMajor = [60, 64, 67];\n * invert(cMajor, 0);  // [60, 64, 67] (root position)\n * invert(cMajor, 1);  // [64, 67, 72] (first inversion, E in bass)\n * invert(cMajor, 2);  // [67, 72, 76] (second inversion, G in bass)\n */\nexport function invert(chordNotes, inversion = 0) {\n  if (inversion === 0) return chordNotes;\n\n  const inverted = [...chordNotes];\n  for (let i = 0; i < inversion; i++) {\n    const lowest = inverted.shift();\n    inverted.push(lowest + 12); // Move to next octave\n  }\n  return inverted;\n}\n\n/**\n * Calculate voice leading between two chords\n *\n * MUSIC THEORY CONCEPT:\n * Voice leading: smooth movement from one chord to another\n * Goals:\n * - Minimize total distance moved\n * - Avoid large jumps\n * - Keep common tones (notes that appear in both chords)\n *\n * WHY IT MATTERS:\n * - Smooth transitions sound better\n * - Easier to play\n * - More professional sounding\n *\n * ALGORITHM:\n * 1. Find which notes from first chord move to which notes in second chord\n * 2. Calculate total semitone distance\n * 3. Try different inversions of second chord\n * 4. Return the inversion with minimum total movement\n *\n * @param {Array<number>} fromChord - Starting chord MIDI notes\n * @param {Array<number>} toChord - Target chord MIDI notes\n * @returns {Object} Voice leading info\n *\n * @example\n * const cMajor = [60, 64, 67];  // C Major\n * const fMajor = [65, 69, 72];  // F Major\n *\n * const voiceLeading = calculateVoiceLeading(cMajor, fMajor);\n * // Suggests which inversion of F Major is closest\n */\nexport function calculateVoiceLeading(fromChord, toChord) {\n  let bestInversion = 0;\n  let minDistance = Infinity;\n  const distances = [];\n\n  // Try each possible inversion\n  for (let inv = 0; inv < toChord.length; inv++) {\n    const inverted = invert(toChord, inv);\n    let totalDistance = 0;\n\n    // Calculate total semitone movement\n    for (let i = 0; i < Math.min(fromChord.length, inverted.length); i++) {\n      const distance = Math.abs(fromChord[i] - inverted[i]);\n      totalDistance += distance;\n    }\n\n    distances.push({ inversion: inv, distance: totalDistance });\n\n    if (totalDistance < minDistance) {\n      minDistance = totalDistance;\n      bestInversion = inv;\n    }\n  }\n\n  return {\n    bestInversion,\n    minDistance,\n    allDistances: distances,\n    suggestedNotes: invert(toChord, bestInversion)\n  };\n}\n\n/**\n * Get chord information by name\n *\n * @param {string} chordType - Chord type key (e.g., 'major', 'min7')\n * @returns {Object} Chord template object\n */\nexport function getChordInfo(chordType) {\n  return CHORD_TEMPLATES[chordType] || CHORD_TEMPLATES.major;\n}\n\n/**\n * Get all available chord types\n *\n * @returns {Array<string>} Array of chord type keys\n */\nexport function getAvailableChords() {\n  return Object.keys(CHORD_TEMPLATES);\n}\n\nexport default {\n  CHORD_TEMPLATES,\n  DIATONIC_CHORD_QUALITIES,\n  generateChord,\n  generateDiatonicChords,\n  invert,\n  calculateVoiceLeading,\n  getChordInfo,\n  getAvailableChords\n};\n","/**\n * midi.js - MIDI Utilities\n *\n * CONCEPT:\n * MIDI (Musical Instrument Digital Interface) is the standard for\n * representing musical notes and control information in digital systems.\n *\n * MIDI BASICS:\n * - MIDI notes: 0-127 (0 = C-1 to 127 = G9)\n * - Middle C = MIDI 60 = C4\n * - A4 (concert pitch) = MIDI 69\n * - Each semitone = 1 MIDI number\n * - Octaves: 12 semitones = 12 MIDI numbers\n *\n * NOTE NAMING:\n * - Scientific pitch notation: Note + Accidental + Octave\n * - Note: C, D, E, F, G, A, B\n * - Accidental: sharp (#) = +1 semitone, flat (b) = -1 semitone\n * - Octave: numbered from C (C0 = MIDI 0, C1 = MIDI 12, etc.)\n *\n * @module music-theory/midi\n */\n\n// ============================================================\n// CONSTANTS\n// ============================================================\n\n/**\n * MIDI note names\n * 12 notes per octave, repeating pattern\n */\nconst NOTE_NAMES_SHARP = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\nconst NOTE_NAMES_FLAT = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n\n/**\n * Standard MIDI note reference points\n * - Middle C (C4): MIDI 60 (used as reference in most DAWs)\n * - A4 (concert pitch): MIDI 69 (440 Hz, standard tuning)\n * - C0: MIDI 0 (lowest MIDI note)\n * - G9: MIDI 127 (highest MIDI note)\n */\nexport const MIDI_REFERENCE_NOTES = {\n  C0: 0,\n  C1: 12,\n  C2: 24,\n  C3: 36,\n  C4: 48, // One octave below Middle C\n  C5: 60, // Middle C (most common reference)\n  C6: 72,\n  C7: 84,\n  C8: 96,\n  A0: 9,\n  A1: 21,\n  A2: 33,\n  A3: 45,\n  A4: 69,    // Concert pitch (440 Hz standard tuning)\n  A5: 81,\n  A6: 93,\n  A7: 105,\n  // Piano key range: A0 to C8\n  PIANO_LOWEST: 21,  // A0\n  PIANO_HIGHEST: 108  // C8\n};\n\n/**\n * Note frequency mapping (equal temperament tuning)\n * Used to convert MIDI note to frequency in Hz\n *\n * Formula: f = 440 * 2^((n - 69) / 12)\n * Where: f = frequency (Hz), n = MIDI note number, 69 = A4\n */\nconst A4_FREQUENCY = 440; // Hz\nconst A4_MIDI = 69;\n\n// ============================================================\n// MIDI NOTE CONVERSION FUNCTIONS\n// ============================================================\n\n/**\n * Convert MIDI note number to note name\n *\n * ALGORITHM:\n * 1. Octave = floor(MIDI / 12) - 1\n * 2. Note index = MIDI % 12\n * 3. Look up note name from array\n *\n * WHY OCTAVE FORMULA:\n * - MIDI 0-11 = C-1 to B-1 (below octave 0)\n * - MIDI 12-23 = C0 to B0 (octave 0)\n * - MIDI 60-71 = C5 to B5 (middle C is C5)\n * - Formula accounts for this offset\n *\n * @param {number} midiNote - MIDI note number (0-127)\n * @param {boolean} useSharps - Use sharps (default) or flats\n * @returns {string} Note name (e.g., \"C4\", \"F#3\", \"Bb5\")\n *\n * @example\n * midiToNoteName(60);        // \"C5\" (Middle C)\n * midiToNoteName(69);        // \"A4\" (Concert pitch)\n * midiToNoteName(61);        // \"C#5\"\n * midiToNoteName(61, false); // \"Db5\"\n * midiToNoteName(0);         // \"C-1\"\n * midiToNoteName(127);       // \"G9\"\n */\nexport function midiToNoteName(midiNote, useSharps = true) {\n  // Validate MIDI range\n  if (midiNote < 0 || midiNote > 127) {\n    console.warn(`MIDI note out of range: ${midiNote}. Clamping to 0-127.`);\n    midiNote = Math.max(0, Math.min(127, midiNote));\n  }\n\n  const octave = Math.floor(midiNote / 12) - 1;\n  const noteIndex = midiNote % 12;\n  const noteNames = useSharps ? NOTE_NAMES_SHARP : NOTE_NAMES_FLAT;\n\n  return `${noteNames[noteIndex]}${octave}`;\n}\n\n/**\n * Convert note name to MIDI note number\n *\n * PARSER ALGORITHM:\n * 1. Extract note letter (C-G)\n * 2. Extract accidental (# or b if present)\n * 3. Extract octave number\n * 4. Calculate: base note + accidental adjustment + (octave * 12)\n *\n * @param {string} noteName - Note name (e.g., \"C4\", \"F#3\", \"Bb5\")\n * @returns {number} MIDI note number (0-127), or null if invalid\n *\n * @example\n * noteNameToMidi(\"C5\");    // 60 (Middle C)\n * noteNameToMidi(\"A4\");    // 69 (Concert pitch)\n * noteNameToMidi(\"C#5\");   // 61\n * noteNameToMidi(\"Db5\");   // 61 (enharmonic equivalent)\n * noteNameToMidi(\"G9\");    // 127\n * noteNameToMidi(\"Invalid\"); // null\n */\nexport function noteNameToMidi(noteName) {\n  // Validate input\n  if (typeof noteName !== 'string') return null;\n\n  // Parse note name: letter + accidental + octave\n  // Example: \"C#5\" or \"Db5\"\n  const match = noteName.match(/^([A-G])([#b]?)(-?\\d+)$/);\n  if (!match) return null;\n\n  const [, letter, accidental, octaveStr] = match;\n  const octave = parseInt(octaveStr);\n\n  // Find base note (assuming C = 0)\n  const baseNotes = { C: 0, D: 2, E: 4, F: 5, G: 7, A: 9, B: 11 };\n  let noteNum = baseNotes[letter];\n\n  if (noteNum === undefined) return null;\n\n  // Apply accidental\n  if (accidental === '#') noteNum += 1;\n  if (accidental === 'b') noteNum -= 1;\n\n  // Calculate MIDI note: ((octave + 1) * 12) + note_in_octave\n  const midiNote = (octave + 1) * 12 + noteNum;\n\n  // Validate MIDI range\n  if (midiNote < 0 || midiNote > 127) return null;\n\n  return midiNote;\n}\n\n/**\n * Convert MIDI note to frequency in Hz\n *\n * FORMULA (Equal Temperament Tuning):\n * f = 440 * 2^((n - 69) / 12)\n *\n * Where:\n * - f = frequency in Hz\n * - n = MIDI note number\n * - 69 = A4 (reference note at 440 Hz)\n * - 12 = semitones per octave\n *\n * WHY THIS FORMULA:\n * - Equal temperament: each semitone = constant frequency ratio\n * - Ratio = 2^(1/12) â‰ˆ 1.0595 (5.95% increase per semitone)\n * - A4 = 440 Hz is international standard tuning\n * - Musicians hear frequency logarithmically (logarithmic scale)\n *\n * @param {number} midiNote - MIDI note number (0-127)\n * @returns {number} Frequency in Hz (e.g., 440 for A4)\n *\n * @example\n * midiToFrequency(69);  // 440 (A4, concert pitch)\n * midiToFrequency(60);  // ~261.63 (Middle C)\n * midiToFrequency(81);  // ~880 (A5, one octave above)\n * midiToFrequency(57);  // ~220 (A3, one octave below concert pitch)\n */\nexport function midiToFrequency(midiNote) {\n  // Validate MIDI range\n  if (midiNote < 0 || midiNote > 127) {\n    console.warn(`MIDI note out of range: ${midiNote}`);\n    return null;\n  }\n\n  // Equal temperament formula\n  // Exponent: (midiNote - 69) / 12 = semitones away from A4 divided by semitones per octave\n  const exponent = (midiNote - A4_MIDI) / 12;\n  const frequency = A4_FREQUENCY * Math.pow(2, exponent);\n\n  return frequency;\n}\n\n/**\n * Convert frequency in Hz to MIDI note number\n *\n * INVERSE FORMULA:\n * n = 69 + 12 * log2(f / 440)\n *\n * Used when:\n * - Converting from frequency domain (FFT analysis, oscillator frequencies)\n * - Finding nearest MIDI note to arbitrary frequency\n *\n * @param {number} frequency - Frequency in Hz\n * @returns {number} Nearest MIDI note number (0-127), or null if out of range\n *\n * @example\n * frequencyToMidi(440);       // 69 (A4, concert pitch)\n * frequencyToMidi(261.63);    // 60 (Middle C)\n * frequencyToMidi(880);       // 81 (A5)\n * frequencyToMidi(55);        // 33 (A1, very low)\n */\nexport function frequencyToMidi(frequency) {\n  if (frequency <= 0) {\n    console.warn(`Frequency must be positive: ${frequency}`);\n    return null;\n  }\n\n  // Inverse of equal temperament formula\n  // n = A4 + 12 * log2(f / 440)\n  const midiNote = A4_MIDI + 12 * Math.log2(frequency / A4_FREQUENCY);\n\n  // Round to nearest semitone\n  const roundedMidi = Math.round(midiNote);\n\n  // Validate MIDI range\n  if (roundedMidi < 0 || roundedMidi > 127) {\n    console.warn(`Frequency ${frequency} Hz is out of MIDI range`);\n    return null;\n  }\n\n  return roundedMidi;\n}\n\n// ============================================================\n// MIDI NOTE UTILITIES\n// ============================================================\n\n/**\n * Get MIDI note offset between two notes\n *\n * ALGORITHM:\n * Calculate semitone distance between two MIDI notes\n * Positive = interval up, negative = interval down\n *\n * @param {number} fromMidi - Starting MIDI note\n * @param {number} toMidi - Target MIDI note\n * @returns {number} Semitone distance (positive = up, negative = down)\n *\n * @example\n * getMidiOffset(60, 67);   // 7 (perfect 5th up)\n * getMidiOffset(67, 60);   // -7 (perfect 5th down)\n * getMidiOffset(60, 60);   // 0 (unison)\n * getMidiOffset(60, 72);   // 12 (octave up)\n */\nexport function getMidiOffset(fromMidi, toMidi) {\n  return toMidi - fromMidi;\n}\n\n/**\n * Transpose MIDI notes by semitone interval\n *\n * @param {Array<number>|number} notes - MIDI note(s) to transpose\n * @param {number} semitones - Semitone distance (positive = up, negative = down)\n * @returns {Array<number>|number} Transposed MIDI note(s)\n *\n * @example\n * transpose(60, 5);       // 65 (C5 â†’ F5)\n * transpose([60, 64, 67], 7);  // [67, 71, 74] (C major â†’ G major)\n * transpose(69, -12);     // 57 (A4 â†’ A3, octave down)\n */\nexport function transpose(notes, semitones) {\n  if (Array.isArray(notes)) {\n    return notes.map(note => {\n      const transposed = note + semitones;\n      // Clamp to MIDI range\n      return Math.max(0, Math.min(127, transposed));\n    });\n  } else {\n    const transposed = notes + semitones;\n    return Math.max(0, Math.min(127, transposed));\n  }\n}\n\n/**\n * Get interval name (musical interval between two notes)\n *\n * MUSIC THEORY:\n * Intervals are named by distance between notes:\n * - Unison (1): same note\n * - 2nd: 1 semitone (minor) or 2 semitones (major)\n * - 3rd: 3 semitones (minor) or 4 semitones (major)\n * - 4th: 5 semitones (perfect)\n * - 5th: 7 semitones (perfect)\n * - 6th: 8 semitones (minor) or 9 semitones (major)\n * - 7th: 10 semitones (minor) or 11 semitones (major)\n * - Octave (8): 12 semitones\n *\n * @param {number} semitones - Semitone distance\n * @returns {string} Interval name (e.g., \"major 3rd\", \"perfect 5th\")\n */\nexport function getIntervalName(semitones) {\n  const intervals = {\n    0: 'unison',\n    1: 'minor 2nd',\n    2: 'major 2nd',\n    3: 'minor 3rd',\n    4: 'major 3rd',\n    5: 'perfect 4th',\n    6: 'tritone',\n    7: 'perfect 5th',\n    8: 'minor 6th',\n    9: 'major 6th',\n    10: 'minor 7th',\n    11: 'major 7th',\n    12: 'octave'\n  };\n\n  return intervals[semitones % 12] || 'unknown';\n}\n\n/**\n * Clamp MIDI notes to valid range and piano key range\n *\n * @param {number|Array<number>} notes - MIDI note(s) to clamp\n * @param {number} min - Minimum MIDI note (default: 0)\n * @param {number} max - Maximum MIDI note (default: 127)\n * @returns {number|Array<number>} Clamped MIDI note(s)\n */\nexport function clampMidi(notes, min = 0, max = 127) {\n  if (Array.isArray(notes)) {\n    return notes.map(note => Math.max(min, Math.min(max, note)));\n  } else {\n    return Math.max(min, Math.min(max, notes));\n  }\n}\n\n/**\n * Check if MIDI note is in piano range (A0-C8)\n *\n * @param {number} midiNote - MIDI note to check\n * @returns {boolean} True if note is in piano range\n */\nexport function isInPianoRange(midiNote) {\n  return midiNote >= MIDI_REFERENCE_NOTES.PIANO_LOWEST &&\n         midiNote <= MIDI_REFERENCE_NOTES.PIANO_HIGHEST;\n}\n\nexport default {\n  MIDI_REFERENCE_NOTES,\n  midiToNoteName,\n  noteNameToMidi,\n  midiToFrequency,\n  frequencyToMidi,\n  getMidiOffset,\n  transpose,\n  getIntervalName,\n  clampMidi,\n  isInPianoRange\n};\n","/**\n * progressions.js - Music Theory: Chord Progressions\n *\n * CONCEPT:\n * A chord progression is a sequence of chords in a song.\n * Understanding progressions is key to writing and understanding music.\n *\n * MUSIC THEORY:\n * - Harmonic function: each chord has a role (tonic, subdominant, dominant)\n * - Diatonic progressions: chords from the same scale sound \"right\" together\n * - Voice leading: smooth movement between chords\n * - Cadences: ending progressions that create specific feelings (resolution, suspension)\n *\n * COMMON PROGRESSIONS:\n * - I-IV-V-I (classic, resolves strongly)\n * - vi-IV-I-V (sad start, happy resolution, very popular)\n * - ii-V-I (jazz standard, smooth movement)\n * - I-V-vi-IV (pop progression, extremely common)\n *\n * @module music-theory/progressions\n */\n\nimport { generateDiatonicChords, calculateVoiceLeading } from './chords.js';\n\n// ============================================================\n// HARMONIC FUNCTION DEFINITIONS\n// ============================================================\n\n/**\n * Harmonic functions describe the role each chord plays\n *\n * MUSIC THEORY:\n * - Tonic (I): home, rest, resolution (stable)\n * - Subdominant (IV): moving away from home (pre-dominant function)\n * - Dominant (V): tension, wants to resolve back to tonic (unstable)\n * - Pre-dominant: chords that lead to dominant (ii, iii, vi)\n *\n * WHY THIS MATTERS:\n * - Understanding function helps predict where progressions will go\n * - Creates emotional tension and release\n * - Foundation of classical harmony and song structure\n */\nexport const HARMONIC_FUNCTIONS = {\n  tonic: {\n    name: 'Tonic',\n    symbol: 'T',\n    description: 'Home, rest, resolution',\n    stability: 'stable',\n    examples: ['I', 'iii', 'vi']\n  },\n\n  subdominant: {\n    name: 'Subdominant',\n    symbol: 'S',\n    description: 'Move away from tonic',\n    stability: 'stable',\n    examples: ['IV', 'ii']\n  },\n\n  dominant: {\n    name: 'Dominant',\n    symbol: 'D',\n    description: 'Tension, wants to resolve',\n    stability: 'unstable',\n    examples: ['V', 'viiÂ°']\n  },\n\n  preDominant: {\n    name: 'Pre-dominant',\n    symbol: 'PD',\n    description: 'Lead to dominant',\n    stability: 'stable-unstable',\n    examples: ['ii', 'iii', 'vi', 'IV']\n  }\n};\n\n// ============================================================\n// PROGRESSION TEMPLATES\n// ============================================================\n\n/**\n * Common chord progressions from different genres\n *\n * Each progression stored as Roman numerals so it works in any key\n */\nexport const PROGRESSION_TEMPLATES = {\n  // CLASSIC PROGRESSIONS\n  perfectCadence: {\n    name: 'Perfect Cadence',\n    roman: ['V', 'I'],\n    description: 'Dominant to Tonic, strong resolution',\n    genre: 'classical, universal',\n    feel: 'resolved, satisfied',\n    difficulty: 'beginner'\n  },\n\n  plagalCadence: {\n    name: 'Plagal Cadence',\n    roman: ['IV', 'I'],\n    description: 'Subdominant to Tonic, like \"Amen\"',\n    genre: 'classical, hymns',\n    feel: 'resolved, peaceful',\n    difficulty: 'beginner'\n  },\n\n  deceptiveCadence: {\n    name: 'Deceptive Cadence',\n    roman: ['V', 'vi'],\n    description: 'Dominant expects I but gets vi (relative minor)',\n    genre: 'classical, surprise effect',\n    feel: 'unexpected, sad turn',\n    difficulty: 'intermediate'\n  },\n\n  // POPULAR POP PROGRESSIONS\n  popProgression: {\n    name: 'Popular Pop Progression',\n    roman: ['I', 'V', 'vi', 'IV'],\n    description: 'One of the most common progressions in modern pop',\n    genre: 'pop, rock',\n    feel: 'uplifting, energetic',\n    difficulty: 'beginner',\n    repeatable: true\n  },\n\n  sadProgression: {\n    name: 'Sad Pop Progression',\n    roman: ['vi', 'IV', 'I', 'V'],\n    description: 'Starts sad (vi=relative minor), resolves happy',\n    genre: 'pop, ballads',\n    feel: 'emotional journey',\n    difficulty: 'beginner',\n    repeatable: true\n  },\n\n  circleOfFifths: {\n    name: 'Circle of Fifths',\n    roman: ['I', 'IV', 'viiÂ°', 'iii', 'vi', 'ii', 'V', 'I'],\n    description: 'Each chord is a perfect 5th below the previous',\n    genre: 'baroque, classical, jazz',\n    feel: 'sophisticated, musical journey',\n    difficulty: 'advanced'\n  },\n\n  // JAZZ PROGRESSIONS\n  jazzTurnaround: {\n    name: 'Jazz Turnaround',\n    roman: ['vi', 'ii', 'V', 'I'],\n    description: 'Common ending progression in jazz standards',\n    genre: 'jazz, standards',\n    feel: 'sophisticated, smooth',\n    difficulty: 'intermediate',\n    repeatable: true\n  },\n\n  iimV: {\n    name: 'ii-V-I (Jazz Standard)',\n    roman: ['ii', 'V', 'I'],\n    description: 'Most common progression in jazz, very smooth',\n    genre: 'jazz, blues',\n    feel: 'smooth, professional',\n    difficulty: 'intermediate',\n    repeatable: true\n  },\n\n  // BLUES PROGRESSIONS\n  bluesProgression12Bar: {\n    name: '12-Bar Blues',\n    roman: ['I', 'I', 'I', 'I', 'IV', 'IV', 'I', 'I', 'V', 'IV', 'I', 'V'],\n    description: 'Classic 12-bar blues structure',\n    genre: 'blues, rock',\n    feel: 'soulful, groovy',\n    difficulty: 'beginner',\n    bars: 12\n  },\n\n  blues12BarMinor: {\n    name: '12-Bar Blues (Minor)',\n    roman: ['i', 'i', 'i', 'i', 'iv', 'iv', 'i', 'i', 'v', 'iv', 'i', 'v'],\n    description: 'Classic 12-bar blues in minor key',\n    genre: 'blues, rock, metal',\n    feel: 'dark, bluesy',\n    difficulty: 'beginner',\n    bars: 12\n  },\n\n  // MINIMALIST PROGRESSIONS\n  singleChord: {\n    name: 'Single Chord Vamp',\n    roman: ['I'],\n    description: 'Focus on rhythm and timbre, not harmony',\n    genre: 'minimalism, ambient, techno',\n    feel: 'meditative, hypnotic',\n    difficulty: 'beginner',\n    repeatable: true\n  },\n\n  twoChordVamp: {\n    name: 'Two Chord Vamp',\n    roman: ['I', 'IV'],\n    description: 'Simple back and forth, very effective',\n    genre: 'rock, pop, folk',\n    feel: 'driving, energetic',\n    difficulty: 'beginner',\n    repeatable: true\n  }\n};\n\n// ============================================================\n// PROGRESSION GENERATION & ANALYSIS\n// ============================================================\n\n/**\n * Generate a chord progression given root key and Roman numerals\n *\n * ALGORITHM:\n * 1. Generate all diatonic chords for the key/scale\n * 2. For each Roman numeral in the progression:\n *    a. Find corresponding chord by degree\n *    b. Apply voice leading for smooth transitions\n *    c. Add to progression\n * 3. Return array of chord objects with notes\n *\n * @param {number} rootMidi - Root MIDI note for the key\n * @param {string} scaleType - Scale type (e.g., 'major', 'minorNatural')\n * @param {Array<string>} romanNumerals - Progression as Roman numerals (e.g., ['I', 'IV', 'V', 'I'])\n * @returns {Array<Object>} Array of chord objects with notes and voice leading\n *\n * @example\n * const progression = generateProgression(60, 'major', ['I', 'IV', 'V', 'I']);\n * // Returns chords with smooth voice leading applied\n */\nexport function generateProgression(rootMidi, scaleType, romanNumerals) {\n  const diatonicChords = generateDiatonicChords(rootMidi, scaleType);\n  const progression = [];\n  let previousChord = null;\n\n  for (const roman of romanNumerals) {\n    // Find matching chord by Roman numeral\n    const chord = diatonicChords.find(c => c.roman === roman);\n\n    if (!chord) {\n      console.warn(`Chord not found: ${roman}`);\n      continue;\n    }\n\n    // Apply voice leading if not first chord\n    let voiceLedChord = { ...chord };\n    if (previousChord) {\n      const voiceLeading = calculateVoiceLeading(previousChord.notes, chord.notes);\n      voiceLedChord.voiceLeadingInversion = voiceLeading.bestInversion;\n      voiceLedChord.notes = voiceLeading.suggestedNotes;\n      voiceLedChord.voiceLeadingDistance = voiceLeading.minDistance;\n    }\n\n    progression.push(voiceLedChord);\n    previousChord = voiceLedChord;\n  }\n\n  return progression;\n}\n\n/**\n * Analyze harmonic function of a chord\n *\n * ALGORITHM:\n * 1. Get scale degrees involved in chord\n * 2. Find common harmonic function patterns\n * 3. Return function description\n *\n * @param {string} roman - Roman numeral (e.g., 'V', 'IV')\n * @param {string} scaleType - Scale type (major, minorNatural, etc.)\n * @returns {Object} Function information\n *\n * @example\n * const func = analyzeChordFunction('V', 'major');\n * // Returns: { primary: 'dominant', secondary: [...], qualities: [...] }\n */\nexport function analyzeChordFunction(roman, scaleType = 'major') {\n  const functionMap = {\n    'I': { primary: 'tonic', secondary: [], qualities: ['stable', 'resolved'] },\n    'i': { primary: 'tonic', secondary: [], qualities: ['stable', 'resolved'] },\n    'ii': { primary: 'pre-dominant', secondary: ['subdominant'], qualities: ['stable', 'smooth'] },\n    'iiÂ°': { primary: 'pre-dominant', secondary: [], qualities: ['unstable', 'darkens'] },\n    'iii': { primary: 'relative', secondary: ['tonic'], qualities: ['stable', 'warm'] },\n    'III': { primary: 'relative', secondary: ['subdominant'], qualities: ['stable', 'bright'] },\n    'IV': { primary: 'subdominant', secondary: [], qualities: ['stable', 'moving-away'] },\n    'iv': { primary: 'subdominant', secondary: [], qualities: ['stable', 'dark'] },\n    'V': { primary: 'dominant', secondary: [], qualities: ['unstable', 'tension'] },\n    'v': { primary: 'dominant', secondary: [], qualities: ['unstable', 'dark-tension'] },\n    'VI': { primary: 'subdominant', secondary: ['tonic-alternative'], qualities: ['stable', 'peaceful'] },\n    'vi': { primary: 'relative', secondary: ['tonic-alternative'], qualities: ['stable', 'sad'] },\n    'VII': { primary: 'dominant-like', secondary: ['dominant'], qualities: ['unstable', 'unusual'] },\n    'viiÂ°': { primary: 'dominant', secondary: [], qualities: ['unstable', 'very-tense'] }\n  };\n\n  return functionMap[roman] || { primary: 'unknown', secondary: [], qualities: [] };\n}\n\n/**\n * Check if a progression follows good voice leading principles\n *\n * VOICE LEADING RULES:\n * 1. Minimize total note movement\n * 2. Keep common tones when possible\n * 3. Avoid large jumps (especially in bass)\n * 4. Smooth transitions = better sound\n *\n * @param {Array<Object>} progression - Array of chord objects with notes\n * @returns {Object} Voice leading analysis\n *\n * @example\n * const analysis = analyzeVoiceLeading(progression);\n * // Returns: { totalDistance: 45, averageDistance: 9, quality: 'good', suggestions: [...] }\n */\nexport function analyzeVoiceLeading(progression) {\n  let totalDistance = 0;\n  const distances = [];\n\n  for (let i = 1; i < progression.length; i++) {\n    const prevChord = progression[i - 1];\n    const currChord = progression[i];\n\n    // Calculate distance between chords\n    let chordDistance = 0;\n    for (let j = 0; j < Math.min(prevChord.notes.length, currChord.notes.length); j++) {\n      chordDistance += Math.abs(prevChord.notes[j] - currChord.notes[j]);\n    }\n\n    distances.push(chordDistance);\n    totalDistance += chordDistance;\n  }\n\n  const averageDistance = totalDistance / distances.length;\n  const quality = averageDistance < 5 ? 'excellent' : averageDistance < 10 ? 'good' : 'fair';\n\n  return {\n    totalDistance,\n    averageDistance,\n    quality,\n    distances,\n    suggestions: quality !== 'excellent' ? ['Consider applying voice leading inversions'] : []\n  };\n}\n\n/**\n * Get a progression template\n *\n * @param {string} templateName - Template key from PROGRESSION_TEMPLATES\n * @returns {Object} Progression template object\n */\nexport function getProgressionTemplate(templateName) {\n  return PROGRESSION_TEMPLATES[templateName];\n}\n\n/**\n * Get all available progression templates\n *\n * @returns {Array<string>} Array of template keys\n */\nexport function getAvailableProgressions() {\n  return Object.keys(PROGRESSION_TEMPLATES);\n}\n\n/**\n * Get progressions by genre\n *\n * @param {string} genre - Genre to filter by (e.g., 'jazz', 'pop', 'blues')\n * @returns {Array<Object>} Matching progression templates\n */\nexport function getProgressionsByGenre(genre) {\n  return Object.values(PROGRESSION_TEMPLATES).filter(prog =>\n    prog.genre && prog.genre.toLowerCase().includes(genre.toLowerCase())\n  );\n}\n\nexport default {\n  HARMONIC_FUNCTIONS,\n  PROGRESSION_TEMPLATES,\n  generateProgression,\n  analyzeChordFunction,\n  analyzeVoiceLeading,\n  getProgressionTemplate,\n  getAvailableProgressions,\n  getProgressionsByGenre\n};\n","<script>\n  /**\n   * ChordSelector.svelte\n   *\n   * PURPOSE:\n   * Interactive component for selecting the musical key (root note) and scale type.\n   * Displays all 12 chromatic notes and 13 available scale types.\n   *\n   * DESIGN PHILOSOPHY:\n   * - Clean, minimal interface following lofi-piano aesthetic\n   * - Numbers-free design (no MIDI numbers shown)\n   * - Visual feedback showing current key and scale\n   * - Comprehensive scale information on hover/selection\n   * - Svelte 5 Runes for reactive state management\n   *\n   * MUSIC THEORY CONTEXT:\n   * The root note + scale type define a key. For example:\n   * - C Major: All white piano keys (C, D, E, F, G, A, B)\n   * - D Minor: Same as F Major (relative minor)\n   * - G Dorian: Different mode of C Major\n   *\n   * SVELTE 5 PATTERNS:\n   * - $props() for component input (rootMidi, scaleType, callbacks)\n   * - $state() for local reactive state (showScaleInfo)\n   * - $derived() for computed values (currentKeyName, currentScaleInfo)\n   * - $effect() for side effects (broadcasting changes to parent)\n   *\n   * USAGE:\n   * <ChordSelector\n   *   bind:rootMidi={currentKey}\n   *   bind:scaleType={currentScale}\n   *   onKeyChange={(midi) => console.log('Key changed to', midi)}\n   *   onScaleChange={(type) => console.log('Scale changed to', type)}\n   * />\n   */\n\n  import { onMount } from 'svelte';\n  import {\n    getAvailableScales,\n    getScaleInfo,\n    midiToNoteName,\n    MIDI_REFERENCE_NOTES\n  } from '@audio/music-theory';\n\n  // ===== COMPONENT PROPS (Svelte 5 $props rune) =====\n  // rootMidi: MIDI note number for the root (e.g., 60 = C5, Middle C)\n  // scaleType: Scale type (e.g., 'major', 'minorNatural', 'dorian')\n  // onKeyChange: Callback fired when user changes root note\n  // onScaleChange: Callback fired when user changes scale type\n  let {\n    rootMidi = 60,\n    scaleType = 'major',\n    onKeyChange = undefined,\n    onScaleChange = undefined\n  } = $props();\n\n  // ===== LOCAL REACTIVE STATE (Svelte 5 $state rune) =====\n  // showScaleInfo: Toggle for displaying scale metadata (pattern, usage, etc.)\n  let showScaleInfo = $state(false);\n\n  // ===== CONSTANTS =====\n  // 12 chromatic notes (C to B) - these repeat every octave\n  const CHROMATIC_NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n\n  // Standard octave context for UI display (C4 = Middle C, C5 = one octave higher)\n  // We'll show octave numbers relative to Middle C (C5 = MIDI 60)\n  const DISPLAY_OCTAVE_START = 4;\n\n  // ===== DERIVED STATE (Svelte 5 $derived rune) =====\n  // These auto-update whenever rootMidi or scaleType change\n\n  // currentKeyName: Human-readable key name (e.g., \"C5 Major\", \"F# Harmonic Minor\")\n  let currentKeyName = $derived.by(() => {\n    const noteName = midiToNoteName(rootMidi, true);\n    const scaleName = getScaleInfo(scaleType)?.name || 'Unknown';\n    return `${noteName} ${scaleName}`;\n  });\n\n  // currentScaleInfo: Metadata for current scale (intervals, pattern, description)\n  let currentScaleInfo = $derived(getScaleInfo(scaleType));\n\n  // availableScales: All 13 available scale types\n  let availableScales = $derived(getAvailableScales());\n\n  // noteName: Derived note name of current rootMidi\n  let noteName = $derived(midiToNoteName(rootMidi, true));\n\n  // noteIndex: Which chromatic note (0-11) is the root\n  let noteIndex = $derived(rootMidi % 12);\n\n  // octaveNumber: Which octave (used for display)\n  let octaveNumber = $derived(Math.floor(rootMidi / 12) - 1);\n\n  // ===== EFFECTS (Svelte 5 $effect rune) =====\n  // These run when their dependencies change\n\n  // Broadcast key change to parent\n  $effect(() => {\n    if (onKeyChange) {\n      onKeyChange(rootMidi);\n    }\n  });\n\n  // Broadcast scale change to parent\n  $effect(() => {\n    if (onScaleChange) {\n      onScaleChange(scaleType);\n    }\n  });\n\n  // ===== HELPER FUNCTIONS =====\n\n  /**\n   * Handle root note selection from dropdown\n   * User selects a note name (C, C#, D, etc.)\n   * We keep the same octave and just change the semitone\n   *\n   * @param {string} note - Chromatic note name (C, C#, D, etc.)\n   * @private\n   */\n  function handleNoteSelect(note) {\n    const noteIdx = CHROMATIC_NOTES.indexOf(note);\n    if (noteIdx >= 0) {\n      // Keep same octave, change note\n      rootMidi = octaveNumber * 12 + 12 + noteIdx;\n    }\n  }\n\n  /**\n   * Handle octave change from input (if user can change it)\n   * This adjusts which octave the root note is in\n   *\n   * @param {number} newOctave - New octave number\n   * @private\n   */\n  function handleOctaveChange(newOctave) {\n    // Keep same note, change octave\n    rootMidi = (newOctave + 1) * 12 + noteIndex;\n\n    // Clamp to valid MIDI range (0-127)\n    rootMidi = Math.max(0, Math.min(127, rootMidi));\n  }\n\n  /**\n   * Format scale info for display\n   * Returns a readable description of the current scale\n   *\n   * @returns {string} Formatted scale information\n   * @private\n   */\n  function formatScaleInfo() {\n    if (!currentScaleInfo) return '';\n\n    const parts = [];\n    parts.push(`Pattern: ${currentScaleInfo.pattern}`);\n    if (currentScaleInfo.commonUsage) {\n      parts.push(`Usage: ${currentScaleInfo.commonUsage.substring(0, 100)}...`);\n    }\n    return parts.join('\\n');\n  }\n</script>\n\n<!-- ===== COMPONENT TEMPLATE ===== -->\n<div class=\"chord-selector\" role=\"region\" aria-label=\"Key and Scale Selector\">\n  <!-- Header: Current Key Display -->\n  <div class=\"selector-header\">\n    <h2 class=\"current-key\">{currentKeyName}</h2>\n    <p class=\"subtitle\">Select your musical key and scale</p>\n  </div>\n\n  <!-- Main Selection Area -->\n  <div class=\"selector-controls\">\n    <!-- Root Note Selection -->\n    <div class=\"control-group\">\n      <label for=\"note-select\" class=\"control-label\">Root Note</label>\n      <select\n        id=\"note-select\"\n        value={noteName.substring(0, noteName.length - 1)}\n        onchange={(e) => handleNoteSelect(e.target.value)}\n        aria-label=\"Select root note (C to B)\"\n      >\n        {#each CHROMATIC_NOTES as note}\n          <option value={note}>{note}</option>\n        {/each}\n      </select>\n    </div>\n\n    <!-- Octave Adjustment (Optional - for advanced users) -->\n    <div class=\"control-group\">\n      <label for=\"octave-input\" class=\"control-label\">Octave</label>\n      <div class=\"octave-controls\">\n        <button\n          class=\"octave-btn\"\n          onclick={() => handleOctaveChange(octaveNumber - 1)}\n          disabled={rootMidi < 12}\n          aria-label=\"Lower octave\"\n          title=\"Lower by one octave\"\n        >\n          âˆ’\n        </button>\n        <input\n          id=\"octave-input\"\n          type=\"number\"\n          value={octaveNumber}\n          onchange={(e) => handleOctaveChange(parseInt(e.target.value))}\n          min=\"0\"\n          max=\"10\"\n          aria-label=\"Select octave (0-10)\"\n        />\n        <button\n          class=\"octave-btn\"\n          onclick={() => handleOctaveChange(octaveNumber + 1)}\n          disabled={rootMidi > 115}\n          aria-label=\"Raise octave\"\n          title=\"Raise by one octave\"\n        >\n          +\n        </button>\n      </div>\n    </div>\n\n    <!-- Scale Type Selection -->\n    <div class=\"control-group\">\n      <label for=\"scale-select\" class=\"control-label\">Scale Type</label>\n      <select\n        id=\"scale-select\"\n        value={scaleType}\n        onchange={(e) => (scaleType = e.target.value)}\n        aria-label=\"Select scale type (Major, Minor, Modes, Pentatonic, etc.)\"\n      >\n        {#each availableScales as scale}\n          <option value={scale}>{getScaleInfo(scale).name}</option>\n        {/each}\n      </select>\n    </div>\n  </div>\n\n  <!-- Scale Information Toggle -->\n  <div class=\"info-section\">\n    <button\n      class=\"info-toggle\"\n      onclick={() => (showScaleInfo = !showScaleInfo)}\n      aria-expanded={showScaleInfo}\n      aria-controls=\"scale-info\"\n    >\n      <span class=\"toggle-icon\">{showScaleInfo ? 'â–¼' : 'â–¶'}</span>\n      Scale Information\n    </button>\n\n    <!-- Scale Info Details (collapsible) -->\n    {#if showScaleInfo && currentScaleInfo}\n      <div id=\"scale-info\" class=\"scale-info\">\n        <div class=\"info-item\">\n          <span class=\"info-label\">Pattern:</span>\n          <span class=\"info-value\">{currentScaleInfo.pattern}</span>\n        </div>\n\n        <div class=\"info-item\">\n          <span class=\"info-label\">Notes:</span>\n          <span class=\"info-value\">{currentScaleInfo.degrees.join(' - ')}</span>\n        </div>\n\n        {#if currentScaleInfo.description}\n          <div class=\"info-item\">\n            <span class=\"info-label\">Feel:</span>\n            <span class=\"info-value\">{currentScaleInfo.description}</span>\n          </div>\n        {/if}\n\n        {#if currentScaleInfo.commonUsage}\n          <div class=\"info-item full-width\">\n            <span class=\"info-label\">Common Usage:</span>\n            <p class=\"info-text\">{currentScaleInfo.commonUsage}</p>\n          </div>\n        {/if}\n      </div>\n    {/if}\n  </div>\n\n  <!-- Quick Reference: Piano Key Layout -->\n  <div class=\"visual-reference\">\n    <div class=\"reference-label\">Piano Keys in {noteName.substring(0, noteName.length - 1)} {currentScaleInfo.name}</div>\n    <div class=\"keyboard-preview\">\n      {#each CHROMATIC_NOTES as note, idx}\n        <!-- Check if this note is in the current scale -->\n        {@const midiNote = octaveNumber * 12 + 12 + idx}\n        {@const isInScale = currentScaleInfo?.intervals.includes(idx)}\n        <div\n          class=\"key-preview\"\n          class:in-scale={isInScale}\n          class:root-note={note === noteName.substring(0, noteName.length - 1)}\n          title={`${note} ${isInScale ? '(in scale)' : '(not in scale)'}`}\n        >\n          {note}\n        </div>\n      {/each}\n    </div>\n  </div>\n</div>\n\n<!-- ===== STYLES ===== -->\n<style>\n  .chord-selector {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    padding: 1.5rem;\n    background: linear-gradient(135deg, #f5f1e8 0%, #e8e3d8 100%);\n    border-radius: 12px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n  }\n\n  .selector-header {\n    text-align: center;\n    border-bottom: 2px solid rgba(139, 69, 19, 0.2);\n    padding-bottom: 1rem;\n  }\n\n  .current-key {\n    font-size: 1.75rem;\n    font-weight: 600;\n    color: #5c3317;\n    margin: 0 0 0.25rem 0;\n    letter-spacing: 0.5px;\n  }\n\n  .subtitle {\n    font-size: 0.875rem;\n    color: #8b6f47;\n    margin: 0;\n    font-weight: 500;\n  }\n\n  .selector-controls {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1rem;\n  }\n\n  @media (max-width: 600px) {\n    .selector-controls {\n      grid-template-columns: 1fr;\n    }\n  }\n\n  .control-group {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n\n  .control-label {\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: #5c3317;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  select,\n  input[type='number'] {\n    padding: 0.75rem;\n    font-size: 1rem;\n    border: 2px solid #d4c4b0;\n    border-radius: 6px;\n    background: white;\n    color: #5c3317;\n    font-weight: 500;\n    transition: all 0.3s ease;\n    cursor: pointer;\n  }\n\n  select:hover,\n  input[type='number']:hover {\n    border-color: #b89968;\n    box-shadow: 0 2px 8px rgba(139, 69, 19, 0.1);\n  }\n\n  select:focus,\n  input[type='number']:focus {\n    outline: none;\n    border-color: #8b6f47;\n    box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);\n  }\n\n  /* Octave Controls */\n  .octave-controls {\n    display: grid;\n    grid-template-columns: auto 1fr auto;\n    gap: 0.5rem;\n    align-items: center;\n  }\n\n  .octave-btn {\n    width: 2.5rem;\n    height: 2.75rem;\n    padding: 0;\n    font-size: 1.25rem;\n    border: 2px solid #d4c4b0;\n    border-radius: 6px;\n    background: white;\n    color: #5c3317;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .octave-btn:hover:not(:disabled) {\n    border-color: #b89968;\n    background: #fffaf3;\n  }\n\n  .octave-btn:active:not(:disabled) {\n    transform: scale(0.95);\n  }\n\n  .octave-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  #octave-input {\n    text-align: center;\n    font-weight: 600;\n  }\n\n  /* Scale Information Section */\n  .info-section {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n\n  .info-toggle {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    padding: 0.75rem 1rem;\n    background: rgba(139, 69, 19, 0.05);\n    border: 1px solid #d4c4b0;\n    border-radius: 6px;\n    font-size: 0.9rem;\n    font-weight: 600;\n    color: #5c3317;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    text-align: left;\n  }\n\n  .info-toggle:hover {\n    background: rgba(139, 69, 19, 0.1);\n    border-color: #b89968;\n  }\n\n  .toggle-icon {\n    font-size: 0.75rem;\n    transition: transform 0.2s ease;\n  }\n\n  .info-toggle[aria-expanded='true'] .toggle-icon {\n    transform: rotate(0deg);\n  }\n\n  .scale-info {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.6);\n    border-radius: 6px;\n    border-left: 4px solid #8b6f47;\n    animation: slideDown 0.2s ease;\n  }\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-0.5rem);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  .info-item {\n    display: flex;\n    gap: 0.75rem;\n    font-size: 0.875rem;\n  }\n\n  .info-item.full-width {\n    flex-direction: column;\n    gap: 0.25rem;\n  }\n\n  .info-label {\n    font-weight: 600;\n    color: #5c3317;\n    min-width: 80px;\n    text-align: right;\n  }\n\n  .info-item.full-width .info-label {\n    text-align: left;\n    min-width: auto;\n  }\n\n  .info-value,\n  .info-text {\n    color: #6b5d4f;\n    font-weight: 500;\n  }\n\n  .info-text {\n    margin: 0;\n    line-height: 1.4;\n  }\n\n  /* Visual Reference */\n  .visual-reference {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    padding: 1rem;\n    background: rgba(139, 69, 19, 0.05);\n    border-radius: 6px;\n  }\n\n  .reference-label {\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: #5c3317;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  .keyboard-preview {\n    display: grid;\n    grid-template-columns: repeat(12, 1fr);\n    gap: 0.35rem;\n  }\n\n  .key-preview {\n    aspect-ratio: 1;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: white;\n    border: 2px solid #d4c4b0;\n    border-radius: 4px;\n    font-size: 0.7rem;\n    font-weight: 600;\n    color: #8b6f47;\n    transition: all 0.2s ease;\n  }\n\n  .key-preview.in-scale {\n    background: linear-gradient(135deg, #fff8e7 0%, #fffaf3 100%);\n    border-color: #8b6f47;\n    color: #5c3317;\n    font-weight: 700;\n  }\n\n  .key-preview.root-note {\n    background: linear-gradient(135deg, #d4a574 0%, #c99056 100%);\n    border-color: #8b6f47;\n    color: white;\n    box-shadow: 0 2px 6px rgba(139, 69, 19, 0.3);\n  }\n\n  .key-preview.in-scale.root-note {\n    animation: pulse 2s ease-in-out infinite;\n  }\n\n  @keyframes pulse {\n    0%,\n    100% {\n      box-shadow: 0 2px 6px rgba(139, 69, 19, 0.3);\n    }\n    50% {\n      box-shadow: 0 4px 12px rgba(139, 69, 19, 0.5);\n    }\n  }\n</style>\n","<script>\n  /**\n   * ChordDisplay.svelte\n   *\n   * PURPOSE:\n   * Display all 7 diatonic chords available in the selected key/scale.\n   * Allows user to select, preview, and play individual chords.\n   *\n   * DESIGN PHILOSOPHY:\n   * - Visual grid showing all available harmonically-related chords\n   * - One chord is highlighted as \"selected\"\n   * - Each chord shows: Roman numeral, quality, harmonic function, notes\n   * - Play button for quick chord preview\n   * - Tooltip showing harmonic context and educational info\n   * - Numbers-free design (shows note names, not MIDI numbers)\n   *\n   * MUSIC THEORY CONTEXT:\n   * The 7 diatonic chords are built from each scale degree using only\n   * notes from the same scale. This guarantees harmonic compatibility.\n   * Example C Major scale â†’ I, ii, iii, IV, V, vi, viiÂ°\n   *\n   * SVELTE 5 PATTERNS:\n   * - $props() for component input (rootMidi, scaleType, audioState, callbacks)\n   * - $state() for local state (selectedChordRoman, hoveredChord)\n   * - $derived() for computed values (diatonicChords)\n   * - $effect() to broadcast changes to parent\n   *\n   * USAGE:\n   * <ChordDisplay\n   *   rootMidi={60}\n   *   scaleType=\"major\"\n   *   bind:selectedChordRoman\n   *   onChordSelect={handleChordSelect}\n   *   onChordPlay={handleChordPlay}\n   * />\n   */\n\n  import {\n    generateDiatonicChords,\n    analyzeChordFunction,\n    midiToNoteName\n  } from '@audio/music-theory';\n\n  // ===== COMPONENT PROPS (Svelte 5 $props rune) =====\n  let {\n    rootMidi = 60,\n    scaleType = 'major',\n    selectedChordRoman = undefined,\n    audioState = undefined,\n    onChordSelect = undefined,\n    onChordPlay = undefined\n  } = $props();\n\n  // ===== LOCAL REACTIVE STATE (Svelte 5 $state rune) =====\n  // selectedChordRoman: Which chord is currently selected (I, ii, iii, etc.)\n  // hoveredChord: Which chord user is hovering over (for visual feedback)\n  let hoveredChord = $state(undefined);\n\n  // ===== DERIVED STATE (Svelte 5 $derived rune) =====\n\n  // diatonicChords: All 7 chords in current key\n  let diatonicChords = $derived(\n    generateDiatonicChords(rootMidi, scaleType)\n  );\n\n  // selectedChord: Full chord object of selected Roman numeral\n  let selectedChord = $derived.by(() => {\n    if (!selectedChordRoman) return null;\n    return diatonicChords.find(c => c.roman === selectedChordRoman);\n  });\n\n  // selectedChordFunction: Harmonic function of selected chord\n  let selectedChordFunction = $derived.by(() => {\n    if (!selectedChordRoman) return null;\n    return analyzeChordFunction(selectedChordRoman, scaleType);\n  });\n\n  // selectedChordNotes: Human-readable note names of selected chord\n  let selectedChordNotes = $derived.by(() => {\n    if (!selectedChord) return [];\n    return selectedChord.notes.map(midi => midiToNoteName(midi, true));\n  });\n\n  // ===== EFFECTS (Svelte 5 $effect rune) =====\n\n  // Broadcast selection change to parent\n  $effect(() => {\n    if (selectedChordRoman && onChordSelect) {\n      onChordSelect(selectedChordRoman);\n    }\n  });\n\n  // Auto-select first chord if none selected\n  $effect(() => {\n    if (!selectedChordRoman && diatonicChords.length > 0) {\n      selectedChordRoman = diatonicChords[0].roman;\n    }\n  });\n\n  // ===== HELPER FUNCTIONS =====\n\n  /**\n   * Handle chord selection\n   * @param {string} roman - Roman numeral (e.g., 'I', 'IV', 'V')\n   * @private\n   */\n  function selectChord(roman) {\n    selectedChordRoman = roman;\n  }\n\n  /**\n   * Play the selected chord\n   * Calls onChordPlay with the MIDI notes\n   * @param {Object} chord - Chord object with notes array\n   * @private\n   */\n  function playChord(chord) {\n    if (onChordPlay && chord.notes) {\n      // Play for 1 second at default velocity\n      onChordPlay(chord.notes, 1.0);\n    }\n  }\n\n  /**\n   * Get descriptive name for harmonic function\n   * @param {Object} funcInfo - Function info from analyzeChordFunction\n   * @returns {string} Human-readable function description\n   * @private\n   */\n  function getFunctionDescription(funcInfo) {\n    if (!funcInfo) return 'Unknown function';\n\n    const parts = [funcInfo.primary];\n    if (funcInfo.secondary && funcInfo.secondary.length > 0) {\n      parts.push(`(${funcInfo.secondary.join(', ')})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * Get CSS class for function type (for color coding)\n   * @param {string} primary - Primary harmonic function\n   * @returns {string} CSS class name\n   * @private\n   */\n  function getFunctionClass(primary) {\n    switch (primary) {\n      case 'tonic':\n        return 'function-tonic';\n      case 'subdominant':\n        return 'function-subdominant';\n      case 'dominant':\n        return 'function-dominant';\n      case 'pre-dominant':\n        return 'function-predominant';\n      default:\n        return 'function-other';\n    }\n  }\n</script>\n\n<!-- ===== COMPONENT TEMPLATE ===== -->\n<div class=\"chord-display\" role=\"region\" aria-label=\"Diatonic Chords\">\n  <!-- Header -->\n  <div class=\"display-header\">\n    <h3 class=\"display-title\">Available Chords</h3>\n    <p class=\"display-subtitle\">All 7 chords from {scaleType} scale (harmonically matched)</p>\n  </div>\n\n  <!-- Chords Grid -->\n  <div class=\"chords-grid\">\n    {#each diatonicChords as chord (chord.roman)}\n      {@const chordFunc = analyzeChordFunction(chord.roman, scaleType)}\n      {@const isSelected = chord.roman === selectedChordRoman}\n      {@const isHovered = chord.roman === hoveredChord}\n\n      <button\n        class=\"chord-card {chordFunc?.primary ? `function-${chordFunc.primary}` : ''}\"\n        class:selected={isSelected}\n        class:hovered={isHovered}\n        data-chord={chord.roman}\n        onclick={() => selectChord(chord.roman)}\n        onmouseenter={() => (hoveredChord = chord.roman)}\n        onmouseleave={() => (hoveredChord = undefined)}\n        aria-pressed={isSelected}\n        title={`${chord.roman} chord - ${chord.quality} - ${chord.function}`}\n      >\n        <!-- Roman Numeral (Main Display) -->\n        <div class=\"chord-roman\">{chord.roman}</div>\n\n        <!-- Chord Quality (Major, Minor, Diminished, etc.) -->\n        <div class=\"chord-quality\">{chord.quality}</div>\n\n        <!-- Harmonic Function Badge -->\n        <div class=\"chord-function {getFunctionClass(chordFunc?.primary)}\">\n          {chordFunc?.primary || 'Unknown'}\n        </div>\n\n        <!-- MIDI Notes (shown on hover/selection) -->\n        {#if isSelected || isHovered}\n          <div class=\"chord-notes\">\n            {chord.notes.map(midi => midiToNoteName(midi, true)).join(' ')}\n          </div>\n        {/if}\n      </button>\n    {/each}\n  </div>\n\n  <!-- Selected Chord Details Panel -->\n  {#if selectedChord}\n    <div class=\"chord-details\" role=\"region\" aria-live=\"polite\" aria-label=\"Selected chord details\">\n      <div class=\"details-header\">\n        <h4 class=\"selected-chord-name\">{selectedChord.roman} - {selectedChord.quality}</h4>\n        <button\n          class=\"play-button\"\n          onclick={() => playChord(selectedChord)}\n          disabled={!onChordPlay}\n          aria-label={`Play ${selectedChord.roman} chord`}\n          title=\"Play this chord\"\n        >\n          <span class=\"play-icon\">â–¶</span>\n          <span class=\"play-text\">Play</span>\n        </button>\n      </div>\n\n      <!-- Chord Information Grid -->\n      <div class=\"details-info\">\n        <!-- Notes -->\n        <div class=\"detail-item\">\n          <span class=\"detail-label\">Notes:</span>\n          <span class=\"detail-value\">{selectedChordNotes.join(' - ')}</span>\n        </div>\n\n        <!-- MIDI Numbers -->\n        <div class=\"detail-item\">\n          <span class=\"detail-label\">MIDI:</span>\n          <span class=\"detail-value\">{selectedChord.notes.join(', ')}</span>\n        </div>\n\n        <!-- Degree -->\n        <div class=\"detail-item\">\n          <span class=\"detail-label\">Degree:</span>\n          <span class=\"detail-value\">Scale degree {selectedChord.degree}</span>\n        </div>\n\n        <!-- Harmonic Function -->\n        <div class=\"detail-item\">\n          <span class=\"detail-label\">Function:</span>\n          <span\n            class=\"detail-value {getFunctionClass(selectedChordFunction?.primary)}\"\n          >\n            {getFunctionDescription(selectedChordFunction)}\n          </span>\n        </div>\n      </div>\n\n      <!-- Function Description -->\n      {#if selectedChordFunction}\n        <div class=\"function-description\">\n          <div class=\"description-title\">Harmonic Function</div>\n          <div class=\"description-text\">\n            {#if selectedChordFunction.primary === 'tonic'}\n              This chord is the <strong>home base</strong>. It sounds resolved and stable.\n              Most progressions start and end here.\n            {:else if selectedChordFunction.primary === 'subdominant'}\n              This chord moves <strong>away from home</strong>. It's stable but creates forward\n              motion, typically leading toward the dominant.\n            {:else if selectedChordFunction.primary === 'dominant'}\n              This chord creates <strong>tension</strong> that wants to resolve. It's unstable\n              and typically moves to the tonic (home).\n            {:else if selectedChordFunction.primary === 'pre-dominant'}\n              This is a <strong>transition chord</strong>. It's stable like the tonic but leads\n              naturally toward the dominant.\n            {:else if selectedChordFunction.primary === 'relative'}\n              This is a <strong>relative chord</strong>. It shares notes with the tonic but has\n              a different character or emotional quality.\n            {:else}\n              This chord has a unique harmonic function in the progression.\n            {/if}\n          </div>\n        </div>\n      {/if}\n    </div>\n  {/if}\n\n  <!-- Quick Tips -->\n  <div class=\"chord-tips\">\n    <div class=\"tips-title\">ðŸ’¡ Tips</div>\n    <ul class=\"tips-list\">\n      <li>All 7 chords share the same scale - they sound great together</li>\n      <li>Click a chord to select it and see details</li>\n      <li>Use progressions like I-IV-V-I or vi-IV-I-V for classic sounds</li>\n      <li>The color indicates harmonic function (Tonic, Subdominant, Dominant)</li>\n    </ul>\n  </div>\n</div>\n\n<!-- ===== STYLES ===== -->\n<style>\n  .chord-display {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    padding: 1.5rem;\n    background: linear-gradient(135deg, #f5f1e8 0%, #e8e3d8 100%);\n    border-radius: 12px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  }\n\n  .display-header {\n    border-bottom: 2px solid rgba(139, 69, 19, 0.2);\n    padding-bottom: 0.75rem;\n  }\n\n  .display-title {\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: #5c3317;\n    margin: 0 0 0.25rem 0;\n  }\n\n  .display-subtitle {\n    font-size: 0.85rem;\n    color: #8b6f47;\n    margin: 0;\n    font-weight: 500;\n  }\n\n  /* Chords Grid */\n  .chords-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n    gap: 0.75rem;\n  }\n\n  .chord-card {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    padding: 1rem;\n    background: white;\n    border: 2px solid #d4c4b0;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    text-align: center;\n    position: relative;\n    overflow: hidden;\n  }\n\n  .chord-card:hover {\n    border-color: #8b6f47;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n    transform: translateY(-2px);\n  }\n\n  .chord-card.selected {\n    background: linear-gradient(135deg, #d4a574 0%, #c99056 100%);\n    border-color: #8b6f47;\n    color: white;\n    box-shadow: 0 6px 16px rgba(139, 69, 19, 0.3);\n  }\n\n  .chord-card.hovered {\n    border-color: #b89968;\n  }\n\n  /* Function-based coloring */\n  .chord-card.function-tonic {\n    --accent-color: #8b6f47;\n  }\n\n  .chord-card.function-subdominant {\n    --accent-color: #a87f4a;\n  }\n\n  .chord-card.function-dominant {\n    --accent-color: #c99056;\n  }\n\n  .chord-card.function-predominant {\n    --accent-color: #9e7c4f;\n  }\n\n  .chord-card.function-other {\n    --accent-color: #a88555;\n  }\n\n  .chord-card:not(.selected):hover {\n    border-color: var(--accent-color, #8b6f47);\n    background: rgba(212, 165, 116, 0.05);\n  }\n\n  .chord-roman {\n    font-size: 1.5rem;\n    font-weight: 700;\n    color: inherit;\n  }\n\n  .chord-card.selected .chord-roman {\n    color: #fffaf3;\n    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n  }\n\n  .chord-quality {\n    font-size: 0.75rem;\n    font-weight: 600;\n    color: #8b6f47;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  .chord-card.selected .chord-quality {\n    color: rgba(255, 255, 255, 0.85);\n  }\n\n  .chord-function {\n    font-size: 0.65rem;\n    font-weight: 600;\n    padding: 0.25rem 0.5rem;\n    border-radius: 3px;\n    text-transform: uppercase;\n    letter-spacing: 0.4px;\n    background: rgba(139, 69, 19, 0.1);\n    color: #5c3317;\n    margin-top: 0.25rem;\n  }\n\n  .chord-card.selected .chord-function {\n    background: rgba(255, 255, 255, 0.2);\n    color: white;\n  }\n\n  .chord-notes {\n    font-size: 0.75rem;\n    color: #6b5d4f;\n    font-weight: 500;\n    margin-top: 0.25rem;\n    opacity: 0.8;\n    animation: fadeIn 0.2s ease;\n  }\n\n  .chord-card.selected .chord-notes {\n    color: rgba(255, 255, 255, 0.9);\n  }\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(-0.25rem);\n    }\n    to {\n      opacity: 0.8;\n      transform: translateY(0);\n    }\n  }\n\n  /* Selected Chord Details */\n  .chord-details {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.7);\n    border-radius: 8px;\n    border-left: 4px solid #8b6f47;\n  }\n\n  .details-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 1rem;\n  }\n\n  .selected-chord-name {\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: #5c3317;\n    margin: 0;\n  }\n\n  .play-button {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1rem;\n    background: linear-gradient(135deg, #d4a574 0%, #c99056 100%);\n    color: white;\n    border: none;\n    border-radius: 6px;\n    font-size: 0.9rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    white-space: nowrap;\n  }\n\n  .play-button:hover:not(:disabled) {\n    transform: scale(1.05);\n    box-shadow: 0 4px 12px rgba(139, 69, 19, 0.3);\n  }\n\n  .play-button:active:not(:disabled) {\n    transform: scale(0.98);\n  }\n\n  .play-button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .play-icon {\n    font-size: 0.8rem;\n  }\n\n  .details-info {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n    gap: 0.75rem;\n  }\n\n  .detail-item {\n    display: flex;\n    flex-direction: column;\n    gap: 0.25rem;\n  }\n\n  .detail-label {\n    font-size: 0.75rem;\n    font-weight: 600;\n    color: #5c3317;\n    text-transform: uppercase;\n    letter-spacing: 0.4px;\n  }\n\n  .detail-value {\n    font-size: 0.9rem;\n    font-weight: 500;\n    color: #6b5d4f;\n  }\n\n  .detail-value.function-tonic {\n    color: #8b6f47;\n  }\n\n  .detail-value.function-subdominant {\n    color: #a87f4a;\n  }\n\n  .detail-value.function-dominant {\n    color: #c99056;\n  }\n\n  .detail-value.function-predominant {\n    color: #9e7c4f;\n  }\n\n  /* Function Description */\n  .function-description {\n    padding: 0.75rem;\n    background: rgba(212, 165, 116, 0.1);\n    border-radius: 6px;\n    border-left: 3px solid #8b6f47;\n  }\n\n  .description-title {\n    font-size: 0.8rem;\n    font-weight: 600;\n    color: #5c3317;\n    text-transform: uppercase;\n    letter-spacing: 0.4px;\n    margin-bottom: 0.4rem;\n  }\n\n  .description-text {\n    font-size: 0.85rem;\n    color: #6b5d4f;\n    line-height: 1.5;\n    margin: 0;\n  }\n\n  .description-text strong {\n    color: #5c3317;\n    font-weight: 600;\n  }\n\n  /* Tips Section */\n  .chord-tips {\n    padding: 0.75rem 1rem;\n    background: rgba(139, 69, 19, 0.05);\n    border-radius: 6px;\n    border-left: 3px solid #b89968;\n  }\n\n  .tips-title {\n    font-size: 0.8rem;\n    font-weight: 600;\n    color: #5c3317;\n    margin-bottom: 0.5rem;\n  }\n\n  .tips-list {\n    display: flex;\n    flex-direction: column;\n    gap: 0.4rem;\n    margin: 0;\n    padding-left: 1.25rem;\n    font-size: 0.8rem;\n    color: #6b5d4f;\n  }\n\n  .tips-list li {\n    line-height: 1.4;\n  }\n</style>\n","<script>\n  /**\n   * ProgressionBuilder.svelte\n   *\n   * PURPOSE:\n   * Create and play chord progressions. Allows building sequences of chords,\n   * selecting from templates, and hearing them with proper voice leading.\n   *\n   * DESIGN PHILOSOPHY:\n   * - Drag-and-drop chord builder for intuitive progression creation\n   * - One-click access to classic progressions (templates)\n   * - Real-time playback with visual feedback (which chord is playing)\n   * - Tempo control for different song styles\n   * - Voice leading analysis showing progression quality\n   * - Educational: Shows Roman numerals, teaches harmonic function\n   *\n   * MUSIC THEORY CONTEXT:\n   * A progression is a sequence of chords connected by voice leading.\n   * Common patterns: I-IV-V-I (classic), vi-IV-I-V (pop), ii-V-I (jazz)\n   * Voice leading ensures smooth, professional transitions between chords.\n   *\n   * SVELTE 5 PATTERNS:\n   * - $props() for input (rootMidi, scaleType, audioState, templates)\n   * - $state() for progression, playback state, tempo\n   * - $derived() for computed values (currentProgressionChords, analysis)\n   * - $effect() to broadcast changes and handle playback\n   *\n   * USAGE:\n   * <ProgressionBuilder\n   *   rootMidi={60}\n   *   scaleType=\"major\"\n   *   audioState={pianoState}\n   *   onProgressionChange={handleProgressionChange}\n   * />\n   */\n\n  import { onMount } from 'svelte';\n  import {\n    generateProgression,\n    analyzeVoiceLeading,\n    getAvailableProgressions,\n    getProgressionTemplate,\n    generateDiatonicChords,\n    analyzeChordFunction,\n    midiToNoteName\n  } from '@audio/music-theory';\n\n  // ===== COMPONENT PROPS (Svelte 5 $props rune) =====\n  let {\n    rootMidi = 60,\n    scaleType = 'major',\n    audioState = undefined,\n    onProgressionChange = undefined\n  } = $props();\n\n  // ===== LOCAL REACTIVE STATE (Svelte 5 $state rune) =====\n  let progression = $state(['I', 'IV', 'V', 'I']); // Current progression as Roman numerals\n  let isPlaying = $state(false);\n  let currentChordIndex = $state(-1); // Which chord is playing (-1 = none)\n  let tempo = $state(90); // BPM (beats per minute)\n  let chordDuration = $state(1); // Duration per chord in beats\n  let loopEnabled = $state(false); // Should progression loop when finished\n  let customChord = $state('I'); // For adding chords\n\n  // ===== DERIVED STATE (Svelte 5 $derived rune) =====\n\n  // allDiatonicChords: All 7 available chords for this key\n  let allDiatonicChords = $derived(\n    generateDiatonicChords(rootMidi, scaleType)\n  );\n\n  // availableChordRomans: Just the Roman numerals (I, ii, iii, etc.)\n  let availableChordRomans = $derived(\n    allDiatonicChords.map(c => c.roman)\n  );\n\n  // currentProgressionChords: Full chord objects for current progression\n  let currentProgressionChords = $derived.by(() => {\n    try {\n      return generateProgression(rootMidi, scaleType, progression);\n    } catch (error) {\n      console.error('Error generating progression:', error);\n      return [];\n    }\n  });\n\n  // voiceLeadingAnalysis: Quality analysis of voice leading\n  let voiceLeadingAnalysis = $derived.by(() => {\n    if (currentProgressionChords.length === 0) return null;\n    return analyzeVoiceLeading(currentProgressionChords);\n  });\n\n  // availableProgressions: List of progression templates (keys)\n  let availableProgressions = $derived(getAvailableProgressions());\n\n  // playbackPosition: Formatted display of current playback position\n  let playbackPosition = $derived.by(() => {\n    if (currentChordIndex === -1) return 'â€”';\n    return `${currentChordIndex + 1} / ${progression.length}`;\n  });\n\n  // ===== EFFECTS (Svelte 5 $effect rune) =====\n\n  // Broadcast progression changes to parent\n  $effect(() => {\n    if (onProgressionChange) {\n      onProgressionChange(progression);\n    }\n  });\n\n  // Auto-stop playback when progression changes\n  $effect(() => {\n    if (isPlaying) {\n      stopPlayback();\n    }\n  });\n\n  // ===== HELPER FUNCTIONS =====\n\n  /**\n   * Add a chord to the progression\n   * @param {string} roman - Roman numeral to add\n   * @private\n   */\n  function addChord(roman) {\n    if (availableChordRomans.includes(roman)) {\n      progression = [...progression, roman];\n    }\n  }\n\n  /**\n   * Remove a chord from progression by index\n   * @param {number} index - Index to remove\n   * @private\n   */\n  function removeChord(index) {\n    progression = progression.filter((_, i) => i !== index);\n    if (currentChordIndex >= progression.length) {\n      currentChordIndex = -1;\n    }\n  }\n\n  /**\n   * Load a progression from template\n   * @param {string} templateKey - Template name from PROGRESSION_TEMPLATES\n   * @private\n   */\n  function loadTemplate(templateKey) {\n    const template = getProgressionTemplate(templateKey);\n    if (template && template.roman) {\n      progression = [...template.roman];\n      currentChordIndex = -1;\n      if (isPlaying) stopPlayback();\n    }\n  }\n\n  /**\n   * Clear the progression\n   * @private\n   */\n  function clearProgression() {\n    progression = [];\n    currentChordIndex = -1;\n    if (isPlaying) stopPlayback();\n  }\n\n  /**\n   * Start playback of the progression\n   * @private\n   */\n  async function playProgression() {\n    if (progression.length === 0) return;\n    if (isPlaying) return; // Already playing\n\n    isPlaying = true;\n    const durationMs = (chordDuration * 60000) / tempo; // Convert beats to ms at given tempo\n\n    // Play loop\n    do {\n      for (let i = 0; i < progression.length; i++) {\n        currentChordIndex = i;\n        const chord = currentProgressionChords[i];\n\n        if (audioState && chord && chord.notes) {\n          // Play the chord\n          audioState.playChord(chord.notes, chordDuration);\n        }\n\n        // Wait for duration\n        await new Promise(resolve => setTimeout(resolve, durationMs));\n\n        // Check if playback was stopped\n        if (!isPlaying) {\n          currentChordIndex = -1;\n          return;\n        }\n      }\n\n      // If not looping, exit\n      if (!loopEnabled) {\n        break;\n      }\n    } while (isPlaying);\n\n    isPlaying = false;\n    currentChordIndex = -1;\n  }\n\n  /**\n   * Stop playback\n   * @private\n   */\n  function stopPlayback() {\n    isPlaying = false;\n    currentChordIndex = -1;\n    if (audioState && audioState.stopAll) {\n      audioState.stopAll();\n    }\n  }\n\n  /**\n   * Get template display name\n   * @param {string} key - Template key\n   * @returns {string} Display name\n   * @private\n   */\n  function getTemplateName(key) {\n    const template = getProgressionTemplate(key);\n    return template?.name || key;\n  }\n\n  /**\n   * Get quality indicator class based on voice leading\n   * @returns {string} CSS class name\n   * @private\n   */\n  function getQualityClass() {\n    if (!voiceLeadingAnalysis) return '';\n    switch (voiceLeadingAnalysis.quality) {\n      case 'excellent':\n        return 'quality-excellent';\n      case 'good':\n        return 'quality-good';\n      case 'fair':\n        return 'quality-fair';\n      default:\n        return '';\n    }\n  }\n\n  /**\n   * Get quality description\n   * @returns {string} Readable description\n   * @private\n   */\n  function getQualityDescription() {\n    if (!voiceLeadingAnalysis) return '';\n    switch (voiceLeadingAnalysis.quality) {\n      case 'excellent':\n        return 'Excellent voice leading - very smooth transitions';\n      case 'good':\n        return 'Good voice leading - smooth transitions';\n      case 'fair':\n        return 'Fair voice leading - some larger jumps';\n      default:\n        return 'Unknown quality';\n    }\n  }\n</script>\n\n<!-- ===== COMPONENT TEMPLATE ===== -->\n<div class=\"progression-builder\" role=\"region\" aria-label=\"Chord Progression Builder\">\n  <!-- Header -->\n  <div class=\"builder-header\">\n    <h3 class=\"builder-title\">Build a Progression</h3>\n    <p class=\"builder-subtitle\">Create chord sequences and play them back</p>\n  </div>\n\n  <!-- Progression Controls -->\n  <div class=\"progression-controls\">\n    <!-- Template Selector -->\n    <div class=\"control-group\">\n      <label for=\"template-select\" class=\"control-label\">Load Template</label>\n      <select\n        id=\"template-select\"\n        value=\"\"\n        onchange={(e) => e.target.value && loadTemplate(e.target.value)}\n        aria-label=\"Load progression template\"\n      >\n        <option value=\"\">Choose a template...</option>\n        {#each availableProgressions as templateKey}\n          <option value={templateKey}>{getTemplateName(templateKey)}</option>\n        {/each}\n      </select>\n    </div>\n\n    <!-- Add Chord Controls -->\n    <div class=\"control-group\">\n      <label for=\"chord-select\" class=\"control-label\">Add Chord</label>\n      <div class=\"add-chord-row\">\n        <select\n          id=\"chord-select\"\n          bind:value={customChord}\n          aria-label=\"Select chord to add\"\n        >\n          {#each availableChordRomans as roman}\n            <option value={roman}>{roman}</option>\n          {/each}\n        </select>\n        <button\n          class=\"add-btn\"\n          onclick={() => addChord(customChord)}\n          aria-label=\"Add chord to progression\"\n        >\n          +\n        </button>\n      </div>\n    </div>\n\n    <!-- Control Buttons -->\n    <div class=\"control-group\">\n      <label class=\"control-label\">Actions</label>\n      <div class=\"button-group\">\n        <button\n          class=\"action-btn clear-btn\"\n          onclick={() => clearProgression()}\n          disabled={progression.length === 0}\n          aria-label=\"Clear progression\"\n          title=\"Remove all chords\"\n        >\n          Clear\n        </button>\n      </div>\n    </div>\n  </div>\n\n  <!-- Progression Display -->\n  <div class=\"progression-display\">\n    <div class=\"progression-title\">Progression</div>\n\n    {#if progression.length === 0}\n      <div class=\"progression-empty\">\n        <p>No chords yet. Load a template or add chords to get started.</p>\n      </div>\n    {:else}\n      <div class=\"progression-sequence\">\n        {#each progression as roman, index (index)}\n          {@const chord = currentProgressionChords[index]}\n          {@const func = analyzeChordFunction(roman, scaleType)}\n          {@const isPlaying = index === currentChordIndex}\n          {@const notes = chord\n            ? chord.notes.map(m => midiToNoteName(m, true)).join(' ')\n            : '?'}\n\n          <div\n            class=\"progression-item\"\n            class:playing={isPlaying}\n            data-roman={roman}\n          >\n            <!-- Chord Card -->\n            <div class=\"item-chord\">\n              <div class=\"item-roman\">{roman}</div>\n              <div class=\"item-quality\">{chord?.quality || '?'}</div>\n            </div>\n\n            <!-- Chord Details -->\n            <div class=\"item-details\">\n              <div class=\"item-notes\" title={notes}>{notes}</div>\n              <div class=\"item-function\" title={func?.primary || 'Unknown'}>\n                {func?.primary || '?'}\n              </div>\n            </div>\n\n            <!-- Remove Button -->\n            <button\n              class=\"item-remove\"\n              onclick={() => removeChord(index)}\n              aria-label={`Remove ${roman} chord`}\n              title=\"Remove this chord\"\n            >\n              Ã—\n            </button>\n          </div>\n        {/each}\n      </div>\n    {/if}\n  </div>\n\n  <!-- Playback Controls -->\n  <div class=\"playback-section\">\n    <div class=\"playback-controls\">\n      <button\n        class=\"play-btn\"\n        onclick={() => playProgression()}\n        disabled={progression.length === 0 || isPlaying || !audioState}\n        aria-label=\"Play progression\"\n        title=\"Play the progression\"\n      >\n        <span class=\"btn-icon\">â–¶</span>\n        <span class=\"btn-text\">Play</span>\n      </button>\n\n      <button\n        class=\"stop-btn\"\n        onclick={() => stopPlayback()}\n        disabled={!isPlaying}\n        aria-label=\"Stop playback\"\n        title=\"Stop playing\"\n      >\n        <span class=\"btn-icon\">â¹</span>\n        <span class=\"btn-text\">Stop</span>\n      </button>\n\n      <div class=\"position-display\">\n        Position: <span class=\"position-value\">{playbackPosition}</span>\n      </div>\n    </div>\n\n    <!-- Tempo and Duration Controls -->\n    <div class=\"tempo-controls\">\n      <div class=\"tempo-item\">\n        <label for=\"tempo-input\" class=\"tempo-label\">Tempo (BPM)</label>\n        <input\n          id=\"tempo-input\"\n          type=\"range\"\n          min=\"40\"\n          max=\"200\"\n          step=\"1\"\n          bind:value={tempo}\n          aria-label=\"Tempo in beats per minute\"\n        />\n        <span class=\"tempo-value\">{tempo}</span>\n      </div>\n\n      <div class=\"tempo-item\">\n        <label for=\"duration-input\" class=\"tempo-label\">Duration (beats)</label>\n        <input\n          id=\"duration-input\"\n          type=\"range\"\n          min=\"0.5\"\n          max=\"4\"\n          step=\"0.5\"\n          bind:value={chordDuration}\n          aria-label=\"Chord duration in beats\"\n        />\n        <span class=\"tempo-value\">{chordDuration}</span>\n      </div>\n\n      <div class=\"loop-control\">\n        <label for=\"loop-checkbox\" class=\"loop-label\">\n          <input\n            id=\"loop-checkbox\"\n            type=\"checkbox\"\n            bind:checked={loopEnabled}\n            aria-label=\"Loop progression\"\n          />\n          <span>Loop</span>\n        </label>\n      </div>\n    </div>\n  </div>\n\n  <!-- Voice Leading Analysis -->\n  {#if voiceLeadingAnalysis && progression.length > 1}\n    <div class=\"voice-leading-analysis {getQualityClass()}\">\n      <div class=\"analysis-title\">Voice Leading Analysis</div>\n      <div class=\"analysis-content\">\n        <div class=\"analysis-item\">\n          <span class=\"analysis-label\">Quality:</span>\n          <span class=\"analysis-value\">{getQualityDescription()}</span>\n        </div>\n\n        <div class=\"analysis-item\">\n          <span class=\"analysis-label\">Total Movement:</span>\n          <span class=\"analysis-value\">{voiceLeadingAnalysis.totalDistance} semitones</span>\n        </div>\n\n        <div class=\"analysis-item\">\n          <span class=\"analysis-label\">Average per Transition:</span>\n          <span class=\"analysis-value\">{voiceLeadingAnalysis.averageDistance.toFixed(1)} semitones</span>\n        </div>\n\n        {#if voiceLeadingAnalysis.suggestions && voiceLeadingAnalysis.suggestions.length > 0}\n          <div class=\"analysis-suggestions\">\n            {#each voiceLeadingAnalysis.suggestions as suggestion}\n              <div class=\"suggestion-item\">ðŸ’¡ {suggestion}</div>\n            {/each}\n          </div>\n        {/if}\n      </div>\n    </div>\n  {/if}\n\n  <!-- Tips -->\n  <div class=\"builder-tips\">\n    <div class=\"tips-title\">ðŸ’¡ Tips</div>\n    <ul class=\"tips-list\">\n      <li>Start with a template to see common progressions</li>\n      <li>Voice leading automatically applies optimal chord inversions</li>\n      <li>Adjust tempo to match the mood (slow = 60-80 BPM, fast = 120-160 BPM)</li>\n      <li>Loop to practice the progression repeatedly</li>\n      <li>Notice how voice leading quality affects the smoothness</li>\n    </ul>\n  </div>\n</div>\n\n<!-- ===== STYLES ===== -->\n<style>\n  .progression-builder {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    padding: 1.5rem;\n    background: linear-gradient(135deg, #f5f1e8 0%, #e8e3d8 100%);\n    border-radius: 12px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  }\n\n  .builder-header {\n    border-bottom: 2px solid rgba(139, 69, 19, 0.2);\n    padding-bottom: 0.75rem;\n  }\n\n  .builder-title {\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: #5c3317;\n    margin: 0 0 0.25rem 0;\n  }\n\n  .builder-subtitle {\n    font-size: 0.85rem;\n    color: #8b6f47;\n    margin: 0;\n    font-weight: 500;\n  }\n\n  /* Controls */\n  .progression-controls {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n    gap: 1rem;\n  }\n\n  .control-group {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n\n  .control-label {\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: #5c3317;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  select {\n    padding: 0.75rem;\n    font-size: 0.9rem;\n    border: 2px solid #d4c4b0;\n    border-radius: 6px;\n    background: white;\n    color: #5c3317;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n  }\n\n  select:hover {\n    border-color: #b89968;\n    box-shadow: 0 2px 8px rgba(139, 69, 19, 0.1);\n  }\n\n  select:focus {\n    outline: none;\n    border-color: #8b6f47;\n    box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);\n  }\n\n  .add-chord-row {\n    display: grid;\n    grid-template-columns: 1fr auto;\n    gap: 0.5rem;\n  }\n\n  .add-btn {\n    width: 2.75rem;\n    height: 2.75rem;\n    padding: 0;\n    font-size: 1.5rem;\n    border: 2px solid #d4c4b0;\n    border-radius: 6px;\n    background: white;\n    color: #8b6f47;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .add-btn:hover:not(:disabled) {\n    border-color: #b89968;\n    background: linear-gradient(135deg, #d4a574 0%, #c99056 100%);\n    color: white;\n  }\n\n  .add-btn:active:not(:disabled) {\n    transform: scale(0.95);\n  }\n\n  .add-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .button-group {\n    display: flex;\n    gap: 0.5rem;\n  }\n\n  .action-btn {\n    flex: 1;\n    padding: 0.75rem;\n    font-size: 0.85rem;\n    font-weight: 600;\n    border: 2px solid #d4c4b0;\n    border-radius: 6px;\n    background: white;\n    color: #5c3317;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    text-transform: uppercase;\n    letter-spacing: 0.4px;\n  }\n\n  .action-btn:hover:not(:disabled) {\n    border-color: #b89968;\n    background: rgba(212, 165, 116, 0.1);\n  }\n\n  .action-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .clear-btn {\n    border-color: #d4a574;\n  }\n\n  .clear-btn:hover:not(:disabled) {\n    background: rgba(212, 165, 116, 0.15);\n    color: #c99056;\n  }\n\n  /* Progression Display */\n  .progression-display {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.6);\n    border-radius: 8px;\n    border: 1px solid #d4c4b0;\n  }\n\n  .progression-title {\n    font-size: 0.9rem;\n    font-weight: 600;\n    color: #5c3317;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  .progression-empty {\n    padding: 1.5rem;\n    text-align: center;\n    color: #8b6f47;\n    font-style: italic;\n  }\n\n  .progression-empty p {\n    margin: 0;\n  }\n\n  .progression-sequence {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 0.75rem;\n  }\n\n  .progression-item {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    padding: 0.75rem;\n    background: white;\n    border: 2px solid #d4c4b0;\n    border-radius: 6px;\n    position: relative;\n    transition: all 0.2s ease;\n  }\n\n  .progression-item:hover {\n    border-color: #8b6f47;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n  }\n\n  .progression-item.playing {\n    background: linear-gradient(135deg, #fffaf3 0%, #fff8e7 100%);\n    border-color: #c99056;\n    box-shadow: 0 4px 12px rgba(201, 144, 86, 0.3);\n    animation: pulse 1s ease-in-out;\n  }\n\n  @keyframes pulse {\n    0%,\n    100% {\n      box-shadow: 0 4px 12px rgba(201, 144, 86, 0.3);\n    }\n    50% {\n      box-shadow: 0 6px 16px rgba(201, 144, 86, 0.5);\n    }\n  }\n\n  .item-chord {\n    display: flex;\n    align-items: baseline;\n    gap: 0.5rem;\n  }\n\n  .item-roman {\n    font-size: 1.25rem;\n    font-weight: 700;\n    color: #5c3317;\n  }\n\n  .item-quality {\n    font-size: 0.7rem;\n    font-weight: 600;\n    color: #8b6f47;\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n  }\n\n  .item-details {\n    display: flex;\n    flex-direction: column;\n    gap: 0.25rem;\n  }\n\n  .item-notes {\n    font-size: 0.75rem;\n    color: #6b5d4f;\n    font-weight: 500;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .item-function {\n    font-size: 0.65rem;\n    color: #8b6f47;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n  }\n\n  .item-remove {\n    position: absolute;\n    top: 0.25rem;\n    right: 0.25rem;\n    width: 1.5rem;\n    height: 1.5rem;\n    padding: 0;\n    border: none;\n    background: rgba(201, 144, 86, 0.2);\n    color: #c99056;\n    font-size: 1.25rem;\n    line-height: 1;\n    cursor: pointer;\n    border-radius: 3px;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .item-remove:hover {\n    background: rgba(201, 144, 86, 0.4);\n    color: #8b4513;\n  }\n\n  /* Playback Controls */\n  .playback-section {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    padding: 1rem;\n    background: rgba(139, 69, 19, 0.05);\n    border-radius: 8px;\n    border: 1px solid #d4c4b0;\n  }\n\n  .playback-controls {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n  }\n\n  .play-btn,\n  .stop-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1rem;\n    font-size: 0.9rem;\n    font-weight: 600;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n  }\n\n  .play-btn {\n    background: linear-gradient(135deg, #d4a574 0%, #c99056 100%);\n    color: white;\n  }\n\n  .play-btn:hover:not(:disabled) {\n    transform: scale(1.05);\n    box-shadow: 0 4px 12px rgba(139, 69, 19, 0.3);\n  }\n\n  .play-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .stop-btn {\n    background: rgba(201, 144, 86, 0.2);\n    color: #c99056;\n  }\n\n  .stop-btn:hover:not(:disabled) {\n    background: rgba(201, 144, 86, 0.3);\n  }\n\n  .stop-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  .btn-icon {\n    font-size: 0.8rem;\n  }\n\n  .position-display {\n    margin-left: auto;\n    font-size: 0.85rem;\n    color: #5c3317;\n    font-weight: 500;\n  }\n\n  .position-value {\n    font-weight: 700;\n    color: #8b6f47;\n  }\n\n  /* Tempo Controls */\n  .tempo-controls {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n    gap: 1rem;\n    align-items: end;\n  }\n\n  .tempo-item {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n\n  .tempo-label {\n    font-size: 0.8rem;\n    font-weight: 600;\n    color: #5c3317;\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n  }\n\n  input[type='range'] {\n    width: 100%;\n    height: 6px;\n    background: #d4c4b0;\n    border-radius: 3px;\n    outline: none;\n    -webkit-appearance: none;\n    appearance: none;\n    cursor: pointer;\n  }\n\n  input[type='range']::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 18px;\n    height: 18px;\n    background: linear-gradient(135deg, #d4a574 0%, #c99056 100%);\n    border-radius: 50%;\n    cursor: pointer;\n    box-shadow: 0 2px 6px rgba(139, 69, 19, 0.3);\n    transition: all 0.2s ease;\n  }\n\n  input[type='range']::-webkit-slider-thumb:hover {\n    transform: scale(1.15);\n    box-shadow: 0 4px 12px rgba(139, 69, 19, 0.4);\n  }\n\n  input[type='range']::-moz-range-thumb {\n    width: 18px;\n    height: 18px;\n    background: linear-gradient(135deg, #d4a574 0%, #c99056 100%);\n    border-radius: 50%;\n    border: none;\n    cursor: pointer;\n    box-shadow: 0 2px 6px rgba(139, 69, 19, 0.3);\n    transition: all 0.2s ease;\n  }\n\n  input[type='range']::-moz-range-thumb:hover {\n    transform: scale(1.15);\n    box-shadow: 0 4px 12px rgba(139, 69, 19, 0.4);\n  }\n\n  .tempo-value {\n    font-weight: 700;\n    color: #8b6f47;\n    text-align: center;\n  }\n\n  .loop-control {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n  }\n\n  .loop-label {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 0.85rem;\n    font-weight: 500;\n    color: #5c3317;\n    cursor: pointer;\n  }\n\n  input[type='checkbox'] {\n    width: 18px;\n    height: 18px;\n    cursor: pointer;\n    accent-color: #c99056;\n  }\n\n  /* Voice Leading Analysis */\n  .voice-leading-analysis {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.6);\n    border-radius: 8px;\n    border-left: 4px solid #8b6f47;\n  }\n\n  .voice-leading-analysis.quality-excellent {\n    border-left-color: #4caf50;\n    background: rgba(76, 175, 80, 0.05);\n  }\n\n  .voice-leading-analysis.quality-good {\n    border-left-color: #8bc34a;\n    background: rgba(139, 195, 74, 0.05);\n  }\n\n  .voice-leading-analysis.quality-fair {\n    border-left-color: #ffc107;\n    background: rgba(255, 193, 7, 0.05);\n  }\n\n  .analysis-title {\n    font-size: 0.85rem;\n    font-weight: 600;\n    color: #5c3317;\n    text-transform: uppercase;\n    letter-spacing: 0.4px;\n  }\n\n  .analysis-content {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n\n  .analysis-item {\n    display: flex;\n    gap: 0.5rem;\n    font-size: 0.85rem;\n  }\n\n  .analysis-label {\n    font-weight: 600;\n    color: #5c3317;\n    min-width: 120px;\n  }\n\n  .analysis-value {\n    color: #6b5d4f;\n    font-weight: 500;\n  }\n\n  .analysis-suggestions {\n    display: flex;\n    flex-direction: column;\n    gap: 0.4rem;\n    margin-top: 0.5rem;\n    padding-top: 0.5rem;\n    border-top: 1px solid rgba(139, 69, 19, 0.1);\n  }\n\n  .suggestion-item {\n    font-size: 0.8rem;\n    color: #6b5d4f;\n  }\n\n  /* Tips */\n  .builder-tips {\n    padding: 0.75rem 1rem;\n    background: rgba(139, 69, 19, 0.05);\n    border-radius: 6px;\n    border-left: 3px solid #b89968;\n  }\n\n  .tips-title {\n    font-size: 0.8rem;\n    font-weight: 600;\n    color: #5c3317;\n    margin-bottom: 0.5rem;\n  }\n\n  .tips-list {\n    display: flex;\n    flex-direction: column;\n    gap: 0.4rem;\n    margin: 0;\n    padding-left: 1.25rem;\n    font-size: 0.8rem;\n    color: #6b5d4f;\n  }\n\n  .tips-list li {\n    line-height: 1.4;\n  }\n</style>\n","<script>\n  /**\n   * ChordGenerator.svelte\n   *\n   * PURPOSE:\n   * Main container component that combines all chord generator functionality\n   * into a cohesive, integrated interface for building and playing chord progressions.\n   *\n   * DESIGN PHILOSOPHY:\n   * - Complete workflow in one component: select key â†’ view chords â†’ build progression â†’ play\n   * - All sub-components work together seamlessly\n   * - Educational interface teaching music theory through interaction\n   * - Integrated with existing PianoKeyboard and audioState\n   * - Minimal, numbers-free design following lofi-piano aesthetic\n   *\n   * FUNCTIONALITY:\n   * 1. ChordSelector: Choose root note and scale type\n   * 2. ChordDisplay: See all available diatonic chords\n   * 3. ProgressionBuilder: Create sequences and play them\n   * 4. Status panel: Show current key, scale, and progression info\n   *\n   * SVELTE 5 PATTERNS:\n   * - $props() for audioState reference and initial settings\n   * - $state() for root/scale selection and progression\n   * - $derived() for computed values\n   * - All state synchronized between child components\n   *\n   * INTEGRATION:\n   * ChordSelector â†’ ChordDisplay â†’ ProgressionBuilder â†’ audioState.playChord()\n   *\n   * USAGE:\n   * <ChordGenerator\n   *   audioState={pianoState}\n   *   initialRootMidi={60}\n   *   initialScaleType=\"major\"\n   * />\n   */\n\n  import ChordSelector from './ChordSelector.svelte';\n  import ChordDisplay from './ChordDisplay.svelte';\n  import ProgressionBuilder from './ProgressionBuilder.svelte';\n  import { midiToNoteName, getScaleInfo } from '@audio/music-theory';\n\n  // ===== COMPONENT PROPS (Svelte 5 $props rune) =====\n  let {\n    audioState = undefined,\n    initialRootMidi = 60,\n    initialScaleType = 'major'\n  } = $props();\n\n  // ===== LOCAL REACTIVE STATE (Svelte 5 $state rune) =====\n  let rootMidi = $state(initialRootMidi);\n  let scaleType = $state(initialScaleType);\n  let selectedChordRoman = $state(undefined);\n  let currentProgression = $state(['I', 'IV', 'V', 'I']);\n\n  // ===== DERIVED STATE (Svelte 5 $derived rune) =====\n\n  // currentKeyName: Display name for current key (e.g., \"C5 Major\")\n  let currentKeyName = $derived.by(() => {\n    const noteName = midiToNoteName(rootMidi, true);\n    const scaleInfo = getScaleInfo(scaleType);\n    return `${noteName} ${scaleInfo?.name || 'Scale'}`;\n  });\n\n  // currentScaleInfo: Metadata for current scale\n  let currentScaleInfo = $derived(getScaleInfo(scaleType));\n\n  // ===== EFFECTS (Svelte 5 $effect rune) =====\n  // (Communication between components handled via $derived and state binding)\n</script>\n\n<!-- ===== COMPONENT TEMPLATE ===== -->\n<div class=\"chord-generator\" role=\"main\" aria-label=\"MIDI Chord Generator\">\n  <!-- Header Section -->\n  <div class=\"generator-header\">\n    <div class=\"header-content\">\n      <h1 class=\"generator-title\">ðŸŽµ MIDI Chord Generator</h1>\n      <p class=\"generator-subtitle\">\n        Build harmonically-coherent chord progressions in any key\n      </p>\n    </div>\n\n    <!-- Quick Status -->\n    <div class=\"quick-status\">\n      <div class=\"status-item\">\n        <span class=\"status-label\">Current Key:</span>\n        <span class=\"status-value\">{currentKeyName}</span>\n      </div>\n      <div class=\"status-item\">\n        <span class=\"status-label\">Progression:</span>\n        <span class=\"status-value\">{currentProgression.join(' - ')}</span>\n      </div>\n    </div>\n  </div>\n\n  <!-- Main Content Grid -->\n  <div class=\"generator-content\">\n    <!-- Left Column: Key & Chord Selection -->\n    <section class=\"content-section selector-section\">\n      <ChordSelector\n        bind:rootMidi\n        bind:scaleType\n        onKeyChange={(midi) => {\n          rootMidi = midi;\n        }}\n        onScaleChange={(type) => {\n          scaleType = type;\n        }}\n      />\n\n      <ChordDisplay\n        {rootMidi}\n        {scaleType}\n        bind:selectedChordRoman\n        {audioState}\n        onChordSelect={(roman) => {\n          selectedChordRoman = roman;\n        }}\n        onChordPlay={(notes, duration) => {\n          if (audioState && audioState.playChord) {\n            audioState.playChord(notes, duration || 1.0);\n          }\n        }}\n      />\n    </section>\n\n    <!-- Right Column: Progression Building & Playback -->\n    <section class=\"content-section progression-section\">\n      <ProgressionBuilder\n        {rootMidi}\n        {scaleType}\n        {audioState}\n        onProgressionChange={(prog) => {\n          currentProgression = prog;\n        }}\n      />\n    </section>\n  </div>\n\n  <!-- Footer: Learning Resources & Tips -->\n  <footer class=\"generator-footer\">\n    <div class=\"footer-content\">\n      <div class=\"footer-section\">\n        <h3 class=\"footer-title\">ðŸŽ“ Learning Tips</h3>\n        <ul class=\"footer-list\">\n          <li>\n            <strong>Harmonic Functions:</strong>\n            Tonic (home), Subdominant (moving away), Dominant (tension), Pre-dominant (transition)\n          </li>\n          <li>\n            <strong>Common Progressions:</strong>\n            I-IV-V-I (classic), vi-IV-I-V (pop), ii-V-I (jazz), I-V-vi-IV (modern pop)\n          </li>\n          <li>\n            <strong>Voice Leading:</strong>\n            Smooth chord transitions with minimal note movement sound better and are easier to play\n          </li>\n          <li>\n            <strong>Scale Degrees:</strong>\n            All 7 diatonic chords come from the same scale - they always sound good together!\n          </li>\n        </ul>\n      </div>\n\n      <div class=\"footer-section\">\n        <h3 class=\"footer-title\">ðŸŽ¹ Integration Tips</h3>\n        <ul class=\"footer-list\">\n          <li>Play individual chords from ChordDisplay to preview them</li>\n          <li>Use templates in ProgressionBuilder to learn classic patterns</li>\n          <li>Adjust tempo to match different song styles (60 = slow ballad, 140 = upbeat)</li>\n          <li>Watch voice leading analysis to understand smooth transitions</li>\n          <li>Experiment with different scales and modes to explore new sounds</li>\n        </ul>\n      </div>\n\n      <div class=\"footer-section\">\n        <h3 class=\"footer-title\">ðŸ“š Music Theory</h3>\n        <ul class=\"footer-list\">\n          <li>\n            <strong>Diatonic Chords:</strong>\n            Built from scale degrees, always harmonically compatible\n          </li>\n          <li>\n            <strong>Voice Leading:</strong>\n            Automatically optimizes chord inversions for smooth movement\n          </li>\n          <li>\n            <strong>MIDI Note Numbers:</strong>\n            0-127, Middle C = 60, A4 (concert pitch) = 69 (440 Hz)\n          </li>\n          <li>\n            <strong>Scale Intervals:</strong>\n            Semitone distances repeated every octave (equal temperament)\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    <div class=\"footer-divider\"></div>\n\n    <div class=\"footer-credit\">\n      <p>\n        Built with music theory principles from centuries of harmonic practice. Learn more in the\n        <a href=\"/docs/MUSIC-THEORY-GUIDE.md\">Music Theory Guide</a>.\n      </p>\n    </div>\n  </footer>\n</div>\n\n<!-- ===== STYLES - Using Design Tokens ===== -->\n<style>\n  /* ========================================\n     MAIN CONTAINER - Vintage Aesthetic\n     ======================================== */\n  \n  .chord-generator {\n    display: flex;\n    flex-direction: column;\n    gap: var(--gap-sections);\n    width: 100%;\n    font-family: var(--font-family-primary);\n  }\n\n  /* ========================================\n     HEADER SECTION\n     ======================================== */\n  \n  .generator-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    gap: var(--space-8);\n    padding-bottom: var(--space-6);\n    border-bottom: 2px solid var(--border-color);\n  }\n\n  .header-content {\n    flex: 1;\n  }\n\n  .generator-title {\n    font-size: var(--font-size-2xl);\n    font-weight: var(--font-weight-bold);\n    color: var(--text-primary);\n    margin: 0 0 var(--space-2) 0;\n    letter-spacing: var(--letter-spacing-wide);\n  }\n\n  .generator-subtitle {\n    font-size: var(--font-size-base);\n    color: var(--text-secondary);\n    margin: 0;\n    font-weight: var(--font-weight-normal);\n  }\n\n  /* Quick Status Card */\n  .quick-status {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-3);\n    padding: var(--space-4) var(--space-6);\n    background: var(--bg-elevated);\n    border-radius: var(--border-radius-lg);\n    border-left: 4px solid var(--accent);\n    box-shadow: var(--shadow-md);\n  }\n\n  .status-item {\n    display: flex;\n    align-items: center;\n    gap: var(--space-3);\n    font-size: var(--font-size-sm);\n  }\n\n  .status-label {\n    font-weight: var(--font-weight-semibold);\n    color: var(--text-secondary);\n    min-width: 100px;\n  }\n\n  .status-value {\n    font-weight: var(--font-weight-bold);\n    color: var(--accent);\n    font-family: var(--font-family-mono);\n    letter-spacing: var(--letter-spacing-wide);\n  }\n\n  /* ========================================\n     MAIN CONTENT GRID\n     ======================================== */\n  \n  .generator-content {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: var(--gap-sections);\n  }\n\n  .content-section {\n    display: flex;\n    flex-direction: column;\n    gap: var(--gap-controls);\n  }\n\n  .selector-section {\n    order: 1;\n  }\n\n  .progression-section {\n    order: 2;\n  }\n\n  /* ========================================\n     FOOTER - EDUCATIONAL RESOURCES\n     ======================================== */\n  \n  .generator-footer {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-6);\n    padding: var(--space-8);\n    background: var(--bg-secondary);\n    border-radius: var(--border-radius-xl);\n    border: var(--border-default);\n    margin-top: var(--space-4);\n  }\n\n  .footer-content {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: var(--gap-sections);\n  }\n\n  .footer-section {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-3);\n  }\n\n  .footer-title {\n    font-size: var(--font-size-base);\n    font-weight: var(--font-weight-bold);\n    color: var(--text-primary);\n    margin: 0 0 var(--space-2) 0;\n    text-transform: uppercase;\n    letter-spacing: var(--letter-spacing-wider);\n  }\n\n  .footer-list {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-2);\n    margin: 0;\n    padding-left: var(--space-5);\n    font-size: var(--font-size-sm);\n    color: var(--text-secondary);\n    line-height: var(--line-height-relaxed);\n  }\n\n  .footer-list li {\n    margin: 0;\n  }\n\n  .footer-list strong {\n    color: var(--text-primary);\n    font-weight: var(--font-weight-semibold);\n  }\n\n  .footer-divider {\n    height: 1px;\n    background: var(--border-color);\n    margin: var(--space-2) 0;\n  }\n\n  .footer-credit {\n    text-align: center;\n    padding: 0;\n    margin: 0;\n  }\n\n  .footer-credit p {\n    margin: 0;\n    font-size: var(--font-size-sm);\n    color: var(--text-secondary);\n    font-weight: var(--font-weight-medium);\n  }\n\n  .footer-credit a {\n    color: var(--accent);\n    text-decoration: underline;\n    font-weight: var(--font-weight-semibold);\n    transition: var(--transition-colors);\n  }\n\n  .footer-credit a:hover {\n    color: var(--accent-hover);\n  }\n\n  .footer-credit a:focus-visible {\n    outline: var(--border-width-normal) solid var(--accent);\n    outline-offset: 2px;\n    border-radius: var(--border-radius-sm);\n  }\n\n  /* ========================================\n     RESPONSIVE DESIGN\n     ======================================== */\n  \n  @media (max-width: 1200px) {\n    .generator-content {\n      grid-template-columns: 1fr;\n      gap: var(--gap-controls);\n    }\n  }\n\n  @media (max-width: 768px) {\n    .generator-header {\n      flex-direction: column;\n      gap: var(--space-4);\n    }\n\n    .generator-title {\n      font-size: var(--font-size-xl);\n    }\n\n    .generator-subtitle {\n      font-size: var(--font-size-sm);\n    }\n\n    .quick-status {\n      width: 100%;\n    }\n\n    .generator-footer {\n      padding: var(--space-6);\n    }\n\n    .footer-content {\n      grid-template-columns: 1fr;\n      gap: var(--gap-controls);\n    }\n  }\n\n  /* ========================================\n     PRINT STYLES\n     ======================================== */\n  \n  @media print {\n    .chord-generator {\n      background: white;\n      gap: var(--space-4);\n    }\n\n    .generator-header {\n      border-bottom: 1px solid var(--border-color);\n      page-break-after: avoid;\n    }\n\n    .generator-footer {\n      background: white;\n      border: 1px solid var(--border-color);\n    }\n  }\n</style>\n","<!--\n  Main Layout Component\n\n  Renders the complete LoFi Piano UI including:\n  - Piano keyboard\n  - Control panel with effect parameters\n  - Audio state management\n-->\n\n<script>\n  import { onMount } from 'svelte';\n  import { unlockAudioContext } from '$audio/context.js';\n  import { createAudioState } from '$stores/audio-state.svelte.js';\n  import PianoKeyboard from '$components/piano/PianoKeyboard.svelte';\n  import ControlPanel from '$components/controls/ControlPanel.svelte';\n  import ChordGenerator from '$components/chord-generator/ChordGenerator.svelte';\n\n  // Create audio state instance\n  const audioState = createAudioState();\n\n  let isReady = $state(false);\n  let error = $state(null);\n  let currentView = $state('piano'); // 'piano' | 'chords'\n\n  onMount(async () => {\n    try {\n      // Unlock AudioContext for iOS/mobile browsers\n      await unlockAudioContext();\n\n      // Initialize audio system\n      await audioState.init();\n\n      isReady = true;\n      console.log('âœ“ LoFi Piano initialized');\n      console.log('  - Audio context ready');\n      console.log('  - Effect chain connected');\n      console.log('  - Ready to play');\n    } catch (err) {\n      console.error('Failed to initialize audio:', err);\n      error = err.message;\n    }\n  });\n\n  /**\n   * Switch between Piano and Chord Generator views\n   */\n  function switchView(view) {\n    currentView = view;\n  }\n</script>\n\n<main>\n  <div class=\"container\">\n    <!-- Header Section -->\n    <header class=\"app-header\">\n      <div class=\"header-content\">\n        <h1 class=\"app-title\">ðŸŽ¹ LoFi Piano</h1>\n        <p class=\"app-subtitle\">Nostalgic warm piano for lo-fi beats</p>\n      </div>\n      \n      {#if isReady}\n        <!-- Tab Navigation -->\n        <div class=\"view-tabs\" role=\"tablist\">\n          <button\n            class=\"tab\"\n            class:active={currentView === 'piano'}\n            onclick={() => switchView('piano')}\n            role=\"tab\"\n            aria-selected={currentView === 'piano'}\n            aria-controls=\"piano-panel\"\n          >\n            Piano\n          </button>\n          <button\n            class=\"tab\"\n            class:active={currentView === 'chords'}\n            onclick={() => switchView('chords')}\n            role=\"tab\"\n            aria-selected={currentView === 'chords'}\n            aria-controls=\"chords-panel\"\n          >\n            Chord Generator\n          </button>\n        </div>\n        \n        <!-- Status Info -->\n        <div class=\"status-info\">\n          <span class=\"status-indicator\">â— Live</span>\n          <span class=\"note-count\">\n            {audioState.pianoState.activeNotes.size} notes\n          </span>\n        </div>\n      {/if}\n    </header>\n\n    {#if error}\n      <!-- Error State -->\n      <div class=\"error-state\">\n        <p class=\"error-icon\">âš ï¸</p>\n        <h2>Audio Initialization Failed</h2>\n        <p class=\"error-message\">{error}</p>\n        <p class=\"error-help\">\n          Try refreshing the page or check browser console for details.\n        </p>\n      </div>\n    {:else if isReady}\n      <!-- Main Content with View Switching -->\n      <div class=\"app-content\">\n        {#if currentView === 'piano'}\n          <div class=\"piano-view\" id=\"piano-panel\" role=\"tabpanel\">\n            <ControlPanel {audioState} />\n            <div class=\"keyboard-wrapper\">\n              <PianoKeyboard {audioState} />\n            </div>\n          </div>\n        {:else if currentView === 'chords'}\n          <div class=\"chords-view\" id=\"chords-panel\" role=\"tabpanel\">\n            <ChordGenerator {audioState} />\n          </div>\n        {/if}\n      </div>\n    {:else}\n      <!-- Loading State -->\n      <div class=\"loading\">\n        <div class=\"spinner\"></div>\n        <p>Initializing audio system...</p>\n        <p class=\"loading-hint\">Click anywhere to unlock audio (iOS/mobile)</p>\n      </div>\n    {/if}\n  </div>\n</main>\n\n<style>\n  /* ========================================\n     LAYOUT CONTAINER - Vintage Aesthetic\n     ======================================== */\n  \n  main {\n    min-height: 100vh;\n    padding: var(--space-6);\n    background: var(--bg-primary);\n  }\n\n  .container {\n    max-width: var(--container-2xl);\n    width: 100%;\n    margin: 0 auto;\n  }\n\n  /* ========================================\n     HEADER & NAVIGATION\n     ======================================== */\n  \n  .app-header {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-4);\n    padding-bottom: var(--space-6);\n    margin-bottom: var(--space-8);\n    border-bottom: 2px solid var(--border-color);\n  }\n\n  .header-content {\n    text-align: center;\n  }\n\n  .app-title {\n    font-size: var(--font-size-2xl);\n    font-weight: var(--font-weight-bold);\n    color: var(--text-primary);\n    margin: 0 0 var(--space-2) 0;\n    letter-spacing: var(--letter-spacing-wide);\n  }\n\n  .app-subtitle {\n    font-size: var(--font-size-base);\n    color: var(--text-secondary);\n    margin: 0;\n    font-weight: var(--font-weight-normal);\n  }\n\n  /* Tab Navigation */\n  .view-tabs {\n    display: flex;\n    justify-content: center;\n    gap: var(--space-2);\n    padding: 0;\n  }\n\n  .tab {\n    padding: var(--space-3) var(--space-6);\n    background: var(--bg-secondary);\n    color: var(--text-secondary);\n    border: var(--border-default);\n    border-radius: var(--border-radius-md);\n    font-size: var(--font-size-base);\n    font-weight: var(--font-weight-semibold);\n    cursor: pointer;\n    transition: var(--transition-colors);\n    letter-spacing: var(--letter-spacing-wide);\n  }\n\n  .tab:hover {\n    background: var(--accent);\n    color: var(--text-primary);\n    border-color: var(--accent-hover);\n  }\n\n  .tab.active {\n    background: var(--accent);\n    color: var(--text-primary);\n    border-color: var(--accent-hover);\n    box-shadow: var(--shadow-md);\n  }\n\n  .tab:focus-visible {\n    outline: var(--border-width-normal) solid var(--accent);\n    outline-offset: 2px;\n  }\n\n  /* Status Info */\n  .status-info {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: var(--space-4);\n    font-size: var(--font-size-sm);\n    color: var(--text-secondary);\n  }\n\n  .status-indicator {\n    color: var(--color-success);\n    font-weight: var(--font-weight-semibold);\n  }\n\n  .note-count {\n    padding: var(--space-1) var(--space-3);\n    background: var(--bg-secondary);\n    border-radius: var(--border-radius-sm);\n    border: var(--border-default);\n    font-weight: var(--font-weight-medium);\n    font-family: var(--font-family-mono);\n  }\n\n  /* ========================================\n     MAIN CONTENT VIEWS\n     ======================================== */\n  \n  .app-content {\n    width: 100%;\n  }\n\n  .piano-view,\n  .chords-view {\n    display: flex;\n    flex-direction: column;\n    gap: var(--gap-sections);\n    animation: fadeIn var(--transition-base) var(--ease-out);\n  }\n\n  .keyboard-wrapper {\n    width: 100%;\n  }\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(8px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  /* ========================================\n     ERROR STATE\n     ======================================== */\n  \n  .error-state {\n    text-align: center;\n    padding: var(--space-16);\n    color: var(--color-error);\n  }\n\n  .error-icon {\n    font-size: 4rem;\n    margin: 0;\n  }\n\n  .error-state h2 {\n    color: var(--color-error);\n    margin: var(--space-4) 0;\n    font-weight: var(--font-weight-bold);\n  }\n\n  .error-message {\n    color: var(--color-error);\n    font-family: var(--font-family-mono);\n    background: var(--bg-secondary);\n    padding: var(--space-4);\n    border-radius: var(--border-radius-md);\n    border: var(--border-width-thin) solid var(--color-error);\n    margin: var(--space-4) auto;\n    max-width: 600px;\n    font-size: var(--font-size-sm);\n  }\n\n  .error-help {\n    color: var(--text-secondary);\n    font-size: var(--font-size-sm);\n    margin-top: var(--space-4);\n  }\n\n  /* ========================================\n     LOADING STATE\n     ======================================== */\n  \n  .loading {\n    text-align: center;\n    color: var(--text-secondary);\n    padding: var(--space-16);\n  }\n\n  .spinner {\n    width: 50px;\n    height: 50px;\n    margin: 0 auto var(--space-6);\n    border: 4px solid var(--border-color);\n    border-top-color: var(--accent);\n    border-radius: var(--border-radius-full);\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    to {\n      transform: rotate(360deg);\n    }\n  }\n\n  .loading p {\n    margin: var(--space-2) 0;\n    color: var(--text-primary);\n    font-size: var(--font-size-base);\n  }\n\n  .loading-hint {\n    font-size: var(--font-size-sm);\n    color: var(--text-muted);\n    font-style: italic;\n  }\n\n  /* ========================================\n     RESPONSIVE DESIGN\n     ======================================== */\n  \n  @media (max-width: 1024px) {\n    main {\n      padding: var(--space-4);\n    }\n\n    .app-header {\n      gap: var(--space-3);\n    }\n\n    .app-title {\n      font-size: var(--font-size-xl);\n    }\n  }\n\n  @media (max-width: 768px) {\n    main {\n      padding: var(--space-3);\n    }\n\n    .app-header {\n      gap: var(--space-3);\n      margin-bottom: var(--space-6);\n    }\n\n    .app-title {\n      font-size: var(--font-size-lg);\n    }\n\n    .app-subtitle {\n      font-size: var(--font-size-sm);\n    }\n\n    .view-tabs {\n      flex-direction: column;\n      gap: var(--space-2);\n    }\n\n    .tab {\n      width: 100%;\n    }\n\n    .status-info {\n      flex-direction: column;\n      gap: var(--space-2);\n    }\n\n    .piano-view,\n    .chords-view {\n      gap: var(--gap-controls);\n    }\n  }\n\n  /* ========================================\n     ACCESSIBILITY\n     ======================================== */\n  \n  @media (prefers-reduced-motion: reduce) {\n    .piano-view,\n    .chords-view {\n      animation: none;\n    }\n\n    .spinner {\n      animation: spin 2s linear infinite;\n    }\n  }\n</style>\n","<!--\n  LoFi Piano Plugin - Main Page\n\n  This is the single-page app entry point.\n  The entire plugin UI renders on this page.\n-->\n\n<script>\n  import { onMount } from 'svelte';\n  import Layout from '$components/Layout.svelte';\n\n  onMount(() => {\n    console.log('ðŸŽ¹ LoFi Piano loaded');\n  });\n</script>\n\n<Layout />\n\n<style>\n  :global(main) {\n    width: 100%;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n</style>\n"],"names":["index","_","i","pause_effects","state","items","controlled_anchor","items_map","transitions","length","pause_children","is_controlled","parent_node","clear_text_content","link","run_out_transitions","item","destroy_effect","each","node","flags","get_collection","get_key","render_fn","fallback_fn","anchor","EACH_IS_CONTROLLED","hydrating","set_hydrate_node","get_first_child","create_text","hydrate_next","fallback","was_empty","offscreen_items","each_array","derived_safe_equal","collection","is_array","array_from","array","each_effect","commit","reconcile","resume_effect","branch","pause_effect","block","active_effect","get","mismatch","is_else","read_hydration_instruction","HYDRATION_START_ELSE","skip_nodes","set_hydrating","prev","hydrate_node","COMMENT_NODE","HYDRATION_END","value","key","create_item","should_defer_append","keys","batch","current_batch","existing","EACH_ITEM_REACTIVE","EACH_INDEX_REACTIVE","update_item","is_animated","EACH_IS_ANIMATED","should_update","first","current","seen","to_animate","matched","stashed","pending","next","move","child_anchor","INERT","start","j","a","b","to_destroy","destroy_length","queue_micro_task","unused","type","internal_set","deferred","reactive","mutable","EACH_ITEM_IMMUTABLE","v","mutable_source","source","fragment","end","dest","next_node","get_next_sibling","whitespace","to_class","hash","directives","classname","len","to_style","styles","set_class","dom","is_html","prev_classes","next_classes","next_class_name","is_present","set_style","prev_styles","next_styles","next_style_attr","select_option","select","mounting","w.select_multiple_invalid_value","option","get_option_value","option_value","is","init_select","observer","teardown","bind_select_value","set","batches","listen_to_event_and_reset_event","is_reset","query","selected_option","effect","previous_batch","IS_CUSTOM_ELEMENT","IS_HTML","remove_input_defaults","input","already_removed","remove_defaults","set_attribute","checked","add_form_reset_listener","set_value","element","attributes","get_attributes","attribute","skip_warning","LOADING_ATTR_SYMBOL","get_setters","NAMESPACE_HTML","setters_cache","cache_key","setters","descriptors","proto","element_proto","get_descriptors","get_prototype_of","bind_value","is_numberlike_input","to_number","tick","new_length","untrack","render_effect","bind_checked","audioContext","getAudioContext","AudioContextClass","unlockAudioContext","ctx","buffer","error","DEFAULT_DETUNE_CENTS","DEFAULT_ATTACK","DEFAULT_DECAY","DEFAULT_SUSTAIN","DEFAULT_RELEASE","FREQUENCY_RAMP_TIME","VELOCITY_RAMP_TIME","MIN_FREQUENCY","MAX_FREQUENCY","createPianoVoice","options","frequency","velocity","attackTime","decayTime","sustainLevel","releaseTime","detuneCents","velocityScale","oscillators","cents","osc","envelope","velocityGain","normalizedVelocity","isPlaying","currentFrequency","currentVelocity","currentDetuning","validateEnvelopeTimes","attack","decay","sustain","release","now","destination","freq","vel","normalizedVel","newDetuneCents","envelopeParams","newAttack","newDecay","newSustain","newRelease","DEFAULT_AMOUNT","DEFAULT_TONE","createSaturation","amount","tone","dryWet","inputGain","dryGain","wetGain","toneFilter","outputGain","currentAmount","currentTone","currentDryWet","applySoftClipping","intensity","factor","sample","processor","event","output","newAmount","newGainValue","newTone","newFrequency","newGain","newDryWet","DEFAULT_THRESHOLD","DEFAULT_RATIO","DEFAULT_KNEE","createCompressor","threshold","ratio","knee","compressor","makeupGain","currentThreshold","currentRatio","currentAttack","currentRelease","calculateMakeupGain","maxReduction","newThreshold","newRatio","DEFAULT_DECAY_TIME","DEFAULT_ROOM_SIZE","DEFAULT_PRE_DELAY","DEFAULT_DRY_WET","createReverb","roomSize","preDelay","preDelayNode","delays","delayTimes","delayGains","time","delay","gain","feedbackGain","currentDecayTime","currentRoomSize","currentPreDelay","newDecayTime","newRoomSize","newDelayTime","newPreDelay","createAudioState","pianoVoices","saturationEffect","compressionEffect","reverbEffect","masterGain","pianoState","synthesis","effects","initializeAudio","ensureAudioInitialized","syncSaturation","syncCompression","syncReverb","syncMasterVolume","note","duration","validNote","noteToFrequency","voice","path","obj","lastKey","nodeName","audioState","startNote","keyCount","showNoteNames","showOctaveNumbers","$.prop","$$props","keyboardElement","$.state","isMouseDown","activeKeys","keyboardMapping","createKeyboardMapping","noteNames","getNoteInfo","midiNote","octave","isBlackKey","noteInOctave","handleKeyDown","e","$.set","handleKeyUp","handleMouseEnter","$.get","handleMouseLeave","handleWindowKeyDown","handleWindowKeyUp","cleanup","onMount","generateNotes","notes","$.each","div_1","isBlack","$.derived","noteInfo","noteLabel","$.template_effect","$.set_text","text_1","$$render","consequent","text","consequent_1","$.set_attribute","button","$.bind_this","div","$$value","min","max","step","label","showIntensity","disabled","ariaLabel","ariaDescribedBy","isDragging","knobElement","containerElement","normalizedValue","rotation","angleToNormalized","angle","clientToAngle","clientX","clientY","rect","centerX","centerY","dx","dy","updateValueFromPosition","normalized","handleMouseDown","handleMouseMove","handleMouseUp","increment","handleTouchStart","touch","handleTouchMove","handleTouchEnd","$.user_effect","$.set_style","ageAmount","ageCharacter","roomMix","roomDecay","mixCharacter","decayCharacter","saturation","harmonicContent","saturationCharacter","sourceNode","width","height","fftSize","smoothing","canvasRef","analyser","dataArray","animationId","isActive","draw","err","canvas","canvasWidth","canvasHeight","binCount","barWidth","barGap","normalizedAmplitude","barHeight","x","y","alpha","canvas_1","alternate","envelopePath","graphWidth","graphHeight","totalTime","attackX","decayX","sustainX","releaseX","peakY","sustainY","silenceY","gridLines","phaseMarkers","line","line_1","node_1","marker","text_2","text_3","text_4","svg","orientation","currentLevel","peakLevel","peakHoldTime","sumSquares","rms","drawMeter","w","h","drawVerticalMeter","drawHorizontalMeter","gradient","peakX","currentDb","peakDb","classes_1","$.set_class","span","classes_2","span_1","masterVolume","showAdvanced","compressionThreshold","$.proxy","compressionRatio","toggleAdvanced","$0","$1","SCALE_DEFINITIONS","generateScale","rootMidi","scaleType","octaves","scaleDef","oct","interval","getScaleInfo","getAvailableScales","DIATONIC_CHORD_QUALITIES","generateDiatonicChords","scaleNotes","qualities","chords","quality","degree","chordRoot","invert","chordNotes","inversion","inverted","lowest","calculateVoiceLeading","fromChord","toChord","bestInversion","minDistance","distances","inv","totalDistance","distance","NOTE_NAMES_SHARP","NOTE_NAMES_FLAT","midiToNoteName","useSharps","noteIndex","PROGRESSION_TEMPLATES","generateProgression","romanNumerals","diatonicChords","progression","previousChord","roman","chord","c","voiceLedChord","voiceLeading","analyzeChordFunction","analyzeVoiceLeading","prevChord","currChord","chordDistance","averageDistance","getProgressionTemplate","templateName","getAvailableProgressions","onKeyChange","onScaleChange","showScaleInfo","CHROMATIC_NOTES","currentKeyName","noteName","scaleName","currentScaleInfo","availableScales","octaveNumber","handleNoteSelect","noteIdx","handleOctaveChange","newOctave","select_1","scale","button_2","text_6","text_7","consequent_2","div_15","idx","isInScale","div_16","button_1","text_8","selectedChordRoman","onChordSelect","onChordPlay","hoveredChord","selectedChord","selectedChordFunction","selectedChordNotes","midi","selectChord","playChord","getFunctionDescription","funcInfo","parts","getFunctionClass","primary","div_2","chordFunc","isSelected","isHovered","classes","$.event","consequent_5","consequent_4","alternate_1","consequent_3","alternate_2","alternate_3","alternate_4","consequent_6","text_5","consequent_7","onProgressionChange","currentChordIndex","tempo","chordDuration","loopEnabled","customChord","allDiatonicChords","availableChordRomans","currentProgressionChords","voiceLeadingAnalysis","availableProgressions","playbackPosition","stopPlayback","addChord","removeChord","loadTemplate","templateKey","template","clearProgression","playProgression","durationMs","resolve","getTemplateName","getQualityClass","getQualityDescription","div_9","$$array","func","m","$.index","$$anchor","suggestion","text_10","button_3","$.bind_select_value","$.bind_value","input_1","$.bind_checked","input_2","initialRootMidi","initialScaleType","currentProgression","scaleInfo","prog","isReady","currentView","switchView","view"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6]}