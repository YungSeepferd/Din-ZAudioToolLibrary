{"version":3,"file":"2.B5q-dv_d.js","sources":["../../../../../../node_modules/svelte/src/internal/client/dom/blocks/each.js","../../../../../../node_modules/svelte/src/internal/shared/attributes.js","../../../../../../node_modules/svelte/src/internal/client/dom/elements/class.js","../../../../../../node_modules/svelte/src/internal/client/dom/elements/style.js","../../../../../../node_modules/svelte/src/internal/client/dom/elements/attributes.js","../../../../../../src/lib/audio/context.js","../../../../../../src/lib/audio/synthesis/piano-voice.js","../../../../../../src/lib/audio/effects/saturation.js","../../../../../../src/lib/audio/effects/compression.js","../../../../../../src/lib/audio/effects/reverb.js","../../../../../../src/lib/stores/audio-state.svelte.js","../../../../../../src/lib/components/piano/PianoKeyboard.svelte","../../../../../../../../../shared/ui-components/controls/VintageKnob.svelte","../../../../../../src/lib/components/controls/AGEControl.svelte","../../../../../../src/lib/components/controls/RoomMicsControl.svelte","../../../../../../src/lib/components/controls/TubeSaturationControl.svelte","../../../../../../src/lib/components/controls/ControlPanel.svelte","../../../../../../src/lib/components/Layout.svelte","../../../../../../src/routes/+page.svelte"],"sourcesContent":["/** @import { EachItem, EachState, Effect, MaybeSource, Source, TemplateNode, TransitionManager, Value } from '#client' */\n/** @import { Batch } from '../../reactivity/batch.js'; */\nimport {\n\tEACH_INDEX_REACTIVE,\n\tEACH_IS_ANIMATED,\n\tEACH_IS_CONTROLLED,\n\tEACH_ITEM_IMMUTABLE,\n\tEACH_ITEM_REACTIVE,\n\tHYDRATION_END,\n\tHYDRATION_START_ELSE\n} from '../../../../constants.js';\nimport {\n\thydrate_next,\n\thydrate_node,\n\thydrating,\n\tread_hydration_instruction,\n\tskip_nodes,\n\tset_hydrate_node,\n\tset_hydrating\n} from '../hydration.js';\nimport {\n\tclear_text_content,\n\tcreate_text,\n\tget_first_child,\n\tget_next_sibling,\n\tshould_defer_append\n} from '../operations.js';\nimport {\n\tblock,\n\tbranch,\n\tdestroy_effect,\n\trun_out_transitions,\n\tpause_children,\n\tpause_effect,\n\tresume_effect\n} from '../../reactivity/effects.js';\nimport { source, mutable_source, internal_set } from '../../reactivity/sources.js';\nimport { array_from, is_array } from '../../../shared/utils.js';\nimport { COMMENT_NODE, INERT } from '#client/constants';\nimport { queue_micro_task } from '../task.js';\nimport { active_effect, get } from '../../runtime.js';\nimport { DEV } from 'esm-env';\nimport { derived_safe_equal } from '../../reactivity/deriveds.js';\nimport { current_batch } from '../../reactivity/batch.js';\n\n/**\n * The row of a keyed each block that is currently updating. We track this\n * so that `animate:` directives have something to attach themselves to\n * @type {EachItem | null}\n */\nexport let current_each_item = null;\n\n/** @param {EachItem | null} item */\nexport function set_current_each_item(item) {\n\tcurrent_each_item = item;\n}\n\n/**\n * @param {any} _\n * @param {number} i\n */\nexport function index(_, i) {\n\treturn i;\n}\n\n/**\n * Pause multiple effects simultaneously, and coordinate their\n * subsequent destruction. Used in each blocks\n * @param {EachState} state\n * @param {EachItem[]} items\n * @param {null | Node} controlled_anchor\n */\nfunction pause_effects(state, items, controlled_anchor) {\n\tvar items_map = state.items;\n\n\t/** @type {TransitionManager[]} */\n\tvar transitions = [];\n\tvar length = items.length;\n\n\tfor (var i = 0; i < length; i++) {\n\t\tpause_children(items[i].e, transitions, true);\n\t}\n\n\tvar is_controlled = length > 0 && transitions.length === 0 && controlled_anchor !== null;\n\t// If we have a controlled anchor, it means that the each block is inside a single\n\t// DOM element, so we can apply a fast-path for clearing the contents of the element.\n\tif (is_controlled) {\n\t\tvar parent_node = /** @type {Element} */ (\n\t\t\t/** @type {Element} */ (controlled_anchor).parentNode\n\t\t);\n\t\tclear_text_content(parent_node);\n\t\tparent_node.append(/** @type {Element} */ (controlled_anchor));\n\t\titems_map.clear();\n\t\tlink(state, items[0].prev, items[length - 1].next);\n\t}\n\n\trun_out_transitions(transitions, () => {\n\t\tfor (var i = 0; i < length; i++) {\n\t\t\tvar item = items[i];\n\t\t\tif (!is_controlled) {\n\t\t\t\titems_map.delete(item.k);\n\t\t\t\tlink(state, item.prev, item.next);\n\t\t\t}\n\t\t\tdestroy_effect(item.e, !is_controlled);\n\t\t}\n\t});\n}\n\n/**\n * @template V\n * @param {Element | Comment} node The next sibling node, or the parent node if this is a 'controlled' block\n * @param {number} flags\n * @param {() => V[]} get_collection\n * @param {(value: V, index: number) => any} get_key\n * @param {(anchor: Node, item: MaybeSource<V>, index: MaybeSource<number>) => void} render_fn\n * @param {null | ((anchor: Node) => void)} fallback_fn\n * @returns {void}\n */\nexport function each(node, flags, get_collection, get_key, render_fn, fallback_fn = null) {\n\tvar anchor = node;\n\n\t/** @type {EachState} */\n\tvar state = { flags, items: new Map(), first: null };\n\n\tvar is_controlled = (flags & EACH_IS_CONTROLLED) !== 0;\n\n\tif (is_controlled) {\n\t\tvar parent_node = /** @type {Element} */ (node);\n\n\t\tanchor = hydrating\n\t\t\t? set_hydrate_node(/** @type {Comment | Text} */ (get_first_child(parent_node)))\n\t\t\t: parent_node.appendChild(create_text());\n\t}\n\n\tif (hydrating) {\n\t\thydrate_next();\n\t}\n\n\t/** @type {Effect | null} */\n\tvar fallback = null;\n\n\tvar was_empty = false;\n\n\t/** @type {Map<any, EachItem>} */\n\tvar offscreen_items = new Map();\n\n\t// TODO: ideally we could use derived for runes mode but because of the ability\n\t// to use a store which can be mutated, we can't do that here as mutating a store\n\t// will still result in the collection array being the same from the store\n\tvar each_array = derived_safe_equal(() => {\n\t\tvar collection = get_collection();\n\n\t\treturn is_array(collection) ? collection : collection == null ? [] : array_from(collection);\n\t});\n\n\t/** @type {V[]} */\n\tvar array;\n\n\t/** @type {Effect} */\n\tvar each_effect;\n\n\tfunction commit() {\n\t\treconcile(\n\t\t\teach_effect,\n\t\t\tarray,\n\t\t\tstate,\n\t\t\toffscreen_items,\n\t\t\tanchor,\n\t\t\trender_fn,\n\t\t\tflags,\n\t\t\tget_key,\n\t\t\tget_collection\n\t\t);\n\n\t\tif (fallback_fn !== null) {\n\t\t\tif (array.length === 0) {\n\t\t\t\tif (fallback) {\n\t\t\t\t\tresume_effect(fallback);\n\t\t\t\t} else {\n\t\t\t\t\tfallback = branch(() => fallback_fn(anchor));\n\t\t\t\t}\n\t\t\t} else if (fallback !== null) {\n\t\t\t\tpause_effect(fallback, () => {\n\t\t\t\t\tfallback = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tblock(() => {\n\t\t// store a reference to the effect so that we can update the start/end nodes in reconciliation\n\t\teach_effect ??= /** @type {Effect} */ (active_effect);\n\n\t\tarray = /** @type {V[]} */ (get(each_array));\n\t\tvar length = array.length;\n\n\t\tif (was_empty && length === 0) {\n\t\t\t// ignore updates if the array is empty,\n\t\t\t// and it already was empty on previous run\n\t\t\treturn;\n\t\t}\n\t\twas_empty = length === 0;\n\n\t\t/** `true` if there was a hydration mismatch. Needs to be a `let` or else it isn't treeshaken out */\n\t\tlet mismatch = false;\n\n\t\tif (hydrating) {\n\t\t\tvar is_else = read_hydration_instruction(anchor) === HYDRATION_START_ELSE;\n\n\t\t\tif (is_else !== (length === 0)) {\n\t\t\t\t// hydration mismatch — remove the server-rendered DOM and start over\n\t\t\t\tanchor = skip_nodes();\n\n\t\t\t\tset_hydrate_node(anchor);\n\t\t\t\tset_hydrating(false);\n\t\t\t\tmismatch = true;\n\t\t\t}\n\t\t}\n\n\t\t// this is separate to the previous block because `hydrating` might change\n\t\tif (hydrating) {\n\t\t\t/** @type {EachItem | null} */\n\t\t\tvar prev = null;\n\n\t\t\t/** @type {EachItem} */\n\t\t\tvar item;\n\n\t\t\tfor (var i = 0; i < length; i++) {\n\t\t\t\tif (\n\t\t\t\t\thydrate_node.nodeType === COMMENT_NODE &&\n\t\t\t\t\t/** @type {Comment} */ (hydrate_node).data === HYDRATION_END\n\t\t\t\t) {\n\t\t\t\t\t// The server rendered fewer items than expected,\n\t\t\t\t\t// so break out and continue appending non-hydrated items\n\t\t\t\t\tanchor = /** @type {Comment} */ (hydrate_node);\n\t\t\t\t\tmismatch = true;\n\t\t\t\t\tset_hydrating(false);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvar value = array[i];\n\t\t\t\tvar key = get_key(value, i);\n\t\t\t\titem = create_item(\n\t\t\t\t\thydrate_node,\n\t\t\t\t\tstate,\n\t\t\t\t\tprev,\n\t\t\t\t\tnull,\n\t\t\t\t\tvalue,\n\t\t\t\t\tkey,\n\t\t\t\t\ti,\n\t\t\t\t\trender_fn,\n\t\t\t\t\tflags,\n\t\t\t\t\tget_collection\n\t\t\t\t);\n\t\t\t\tstate.items.set(key, item);\n\n\t\t\t\tprev = item;\n\t\t\t}\n\n\t\t\t// remove excess nodes\n\t\t\tif (length > 0) {\n\t\t\t\tset_hydrate_node(skip_nodes());\n\t\t\t}\n\t\t}\n\n\t\tif (hydrating) {\n\t\t\tif (length === 0 && fallback_fn) {\n\t\t\t\tfallback = branch(() => fallback_fn(anchor));\n\t\t\t}\n\t\t} else {\n\t\t\tif (should_defer_append()) {\n\t\t\t\tvar keys = new Set();\n\t\t\t\tvar batch = /** @type {Batch} */ (current_batch);\n\n\t\t\t\tfor (i = 0; i < length; i += 1) {\n\t\t\t\t\tvalue = array[i];\n\t\t\t\t\tkey = get_key(value, i);\n\n\t\t\t\t\tvar existing = state.items.get(key) ?? offscreen_items.get(key);\n\n\t\t\t\t\tif (existing) {\n\t\t\t\t\t\t// update before reconciliation, to trigger any async updates\n\t\t\t\t\t\tif ((flags & (EACH_ITEM_REACTIVE | EACH_INDEX_REACTIVE)) !== 0) {\n\t\t\t\t\t\t\tupdate_item(existing, value, i, flags);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem = create_item(\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\trender_fn,\n\t\t\t\t\t\t\tflags,\n\t\t\t\t\t\t\tget_collection,\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\toffscreen_items.set(key, item);\n\t\t\t\t\t}\n\n\t\t\t\t\tkeys.add(key);\n\t\t\t\t}\n\n\t\t\t\tfor (const [key, item] of state.items) {\n\t\t\t\t\tif (!keys.has(key)) {\n\t\t\t\t\t\tbatch.skipped_effects.add(item.e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbatch.oncommit(commit);\n\t\t\t} else {\n\t\t\t\tcommit();\n\t\t\t}\n\t\t}\n\n\t\tif (mismatch) {\n\t\t\t// continue in hydration mode\n\t\t\tset_hydrating(true);\n\t\t}\n\n\t\t// When we mount the each block for the first time, the collection won't be\n\t\t// connected to this effect as the effect hasn't finished running yet and its deps\n\t\t// won't be assigned. However, it's possible that when reconciling the each block\n\t\t// that a mutation occurred and it's made the collection MAYBE_DIRTY, so reading the\n\t\t// collection again can provide consistency to the reactive graph again as the deriveds\n\t\t// will now be `CLEAN`.\n\t\tget(each_array);\n\t});\n\n\tif (hydrating) {\n\t\tanchor = hydrate_node;\n\t}\n}\n\n/**\n * Add, remove, or reorder items output by an each block as its input changes\n * @template V\n * @param {Effect} each_effect\n * @param {Array<V>} array\n * @param {EachState} state\n * @param {Map<any, EachItem>} offscreen_items\n * @param {Element | Comment | Text} anchor\n * @param {(anchor: Node, item: MaybeSource<V>, index: number | Source<number>, collection: () => V[]) => void} render_fn\n * @param {number} flags\n * @param {(value: V, index: number) => any} get_key\n * @param {() => V[]} get_collection\n * @returns {void}\n */\nfunction reconcile(\n\teach_effect,\n\tarray,\n\tstate,\n\toffscreen_items,\n\tanchor,\n\trender_fn,\n\tflags,\n\tget_key,\n\tget_collection\n) {\n\tvar is_animated = (flags & EACH_IS_ANIMATED) !== 0;\n\tvar should_update = (flags & (EACH_ITEM_REACTIVE | EACH_INDEX_REACTIVE)) !== 0;\n\n\tvar length = array.length;\n\tvar items = state.items;\n\tvar first = state.first;\n\tvar current = first;\n\n\t/** @type {undefined | Set<EachItem>} */\n\tvar seen;\n\n\t/** @type {EachItem | null} */\n\tvar prev = null;\n\n\t/** @type {undefined | Set<EachItem>} */\n\tvar to_animate;\n\n\t/** @type {EachItem[]} */\n\tvar matched = [];\n\n\t/** @type {EachItem[]} */\n\tvar stashed = [];\n\n\t/** @type {V} */\n\tvar value;\n\n\t/** @type {any} */\n\tvar key;\n\n\t/** @type {EachItem | undefined} */\n\tvar item;\n\n\t/** @type {number} */\n\tvar i;\n\n\tif (is_animated) {\n\t\tfor (i = 0; i < length; i += 1) {\n\t\t\tvalue = array[i];\n\t\t\tkey = get_key(value, i);\n\t\t\titem = items.get(key);\n\n\t\t\tif (item !== undefined) {\n\t\t\t\titem.a?.measure();\n\t\t\t\t(to_animate ??= new Set()).add(item);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (i = 0; i < length; i += 1) {\n\t\tvalue = array[i];\n\t\tkey = get_key(value, i);\n\n\t\titem = items.get(key);\n\n\t\tif (item === undefined) {\n\t\t\tvar pending = offscreen_items.get(key);\n\n\t\t\tif (pending !== undefined) {\n\t\t\t\toffscreen_items.delete(key);\n\t\t\t\titems.set(key, pending);\n\n\t\t\t\tvar next = prev ? prev.next : current;\n\n\t\t\t\tlink(state, prev, pending);\n\t\t\t\tlink(state, pending, next);\n\n\t\t\t\tmove(pending, next, anchor);\n\t\t\t\tprev = pending;\n\t\t\t} else {\n\t\t\t\tvar child_anchor = current ? /** @type {TemplateNode} */ (current.e.nodes_start) : anchor;\n\n\t\t\t\tprev = create_item(\n\t\t\t\t\tchild_anchor,\n\t\t\t\t\tstate,\n\t\t\t\t\tprev,\n\t\t\t\t\tprev === null ? state.first : prev.next,\n\t\t\t\t\tvalue,\n\t\t\t\t\tkey,\n\t\t\t\t\ti,\n\t\t\t\t\trender_fn,\n\t\t\t\t\tflags,\n\t\t\t\t\tget_collection\n\t\t\t\t);\n\t\t\t}\n\n\t\t\titems.set(key, prev);\n\n\t\t\tmatched = [];\n\t\t\tstashed = [];\n\n\t\t\tcurrent = prev.next;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (should_update) {\n\t\t\tupdate_item(item, value, i, flags);\n\t\t}\n\n\t\tif ((item.e.f & INERT) !== 0) {\n\t\t\tresume_effect(item.e);\n\t\t\tif (is_animated) {\n\t\t\t\titem.a?.unfix();\n\t\t\t\t(to_animate ??= new Set()).delete(item);\n\t\t\t}\n\t\t}\n\n\t\tif (item !== current) {\n\t\t\tif (seen !== undefined && seen.has(item)) {\n\t\t\t\tif (matched.length < stashed.length) {\n\t\t\t\t\t// more efficient to move later items to the front\n\t\t\t\t\tvar start = stashed[0];\n\t\t\t\t\tvar j;\n\n\t\t\t\t\tprev = start.prev;\n\n\t\t\t\t\tvar a = matched[0];\n\t\t\t\t\tvar b = matched[matched.length - 1];\n\n\t\t\t\t\tfor (j = 0; j < matched.length; j += 1) {\n\t\t\t\t\t\tmove(matched[j], start, anchor);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (j = 0; j < stashed.length; j += 1) {\n\t\t\t\t\t\tseen.delete(stashed[j]);\n\t\t\t\t\t}\n\n\t\t\t\t\tlink(state, a.prev, b.next);\n\t\t\t\t\tlink(state, prev, a);\n\t\t\t\t\tlink(state, b, start);\n\n\t\t\t\t\tcurrent = start;\n\t\t\t\t\tprev = b;\n\t\t\t\t\ti -= 1;\n\n\t\t\t\t\tmatched = [];\n\t\t\t\t\tstashed = [];\n\t\t\t\t} else {\n\t\t\t\t\t// more efficient to move earlier items to the back\n\t\t\t\t\tseen.delete(item);\n\t\t\t\t\tmove(item, current, anchor);\n\n\t\t\t\t\tlink(state, item.prev, item.next);\n\t\t\t\t\tlink(state, item, prev === null ? state.first : prev.next);\n\t\t\t\t\tlink(state, prev, item);\n\n\t\t\t\t\tprev = item;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmatched = [];\n\t\t\tstashed = [];\n\n\t\t\twhile (current !== null && current.k !== key) {\n\t\t\t\t// If the each block isn't inert and an item has an effect that is already inert,\n\t\t\t\t// skip over adding it to our seen Set as the item is already being handled\n\t\t\t\tif ((current.e.f & INERT) === 0) {\n\t\t\t\t\t(seen ??= new Set()).add(current);\n\t\t\t\t}\n\t\t\t\tstashed.push(current);\n\t\t\t\tcurrent = current.next;\n\t\t\t}\n\n\t\t\tif (current === null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\titem = current;\n\t\t}\n\n\t\tmatched.push(item);\n\t\tprev = item;\n\t\tcurrent = item.next;\n\t}\n\n\tif (current !== null || seen !== undefined) {\n\t\tvar to_destroy = seen === undefined ? [] : array_from(seen);\n\n\t\twhile (current !== null) {\n\t\t\t// If the each block isn't inert, then inert effects are currently outroing and will be removed once the transition is finished\n\t\t\tif ((current.e.f & INERT) === 0) {\n\t\t\t\tto_destroy.push(current);\n\t\t\t}\n\t\t\tcurrent = current.next;\n\t\t}\n\n\t\tvar destroy_length = to_destroy.length;\n\n\t\tif (destroy_length > 0) {\n\t\t\tvar controlled_anchor = (flags & EACH_IS_CONTROLLED) !== 0 && length === 0 ? anchor : null;\n\n\t\t\tif (is_animated) {\n\t\t\t\tfor (i = 0; i < destroy_length; i += 1) {\n\t\t\t\t\tto_destroy[i].a?.measure();\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < destroy_length; i += 1) {\n\t\t\t\t\tto_destroy[i].a?.fix();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpause_effects(state, to_destroy, controlled_anchor);\n\t\t}\n\t}\n\n\tif (is_animated) {\n\t\tqueue_micro_task(() => {\n\t\t\tif (to_animate === undefined) return;\n\t\t\tfor (item of to_animate) {\n\t\t\t\titem.a?.apply();\n\t\t\t}\n\t\t});\n\t}\n\n\teach_effect.first = state.first && state.first.e;\n\teach_effect.last = prev && prev.e;\n\n\tfor (var unused of offscreen_items.values()) {\n\t\tdestroy_effect(unused.e);\n\t}\n\n\toffscreen_items.clear();\n}\n\n/**\n * @param {EachItem} item\n * @param {any} value\n * @param {number} index\n * @param {number} type\n * @returns {void}\n */\nfunction update_item(item, value, index, type) {\n\tif ((type & EACH_ITEM_REACTIVE) !== 0) {\n\t\tinternal_set(item.v, value);\n\t}\n\n\tif ((type & EACH_INDEX_REACTIVE) !== 0) {\n\t\tinternal_set(/** @type {Value<number>} */ (item.i), index);\n\t} else {\n\t\titem.i = index;\n\t}\n}\n\n/**\n * @template V\n * @param {Node | null} anchor\n * @param {EachState} state\n * @param {EachItem | null} prev\n * @param {EachItem | null} next\n * @param {V} value\n * @param {unknown} key\n * @param {number} index\n * @param {(anchor: Node, item: V | Source<V>, index: number | Value<number>, collection: () => V[]) => void} render_fn\n * @param {number} flags\n * @param {() => V[]} get_collection\n * @param {boolean} [deferred]\n * @returns {EachItem}\n */\nfunction create_item(\n\tanchor,\n\tstate,\n\tprev,\n\tnext,\n\tvalue,\n\tkey,\n\tindex,\n\trender_fn,\n\tflags,\n\tget_collection,\n\tdeferred\n) {\n\tvar previous_each_item = current_each_item;\n\tvar reactive = (flags & EACH_ITEM_REACTIVE) !== 0;\n\tvar mutable = (flags & EACH_ITEM_IMMUTABLE) === 0;\n\n\tvar v = reactive ? (mutable ? mutable_source(value, false, false) : source(value)) : value;\n\tvar i = (flags & EACH_INDEX_REACTIVE) === 0 ? index : source(index);\n\n\tif (DEV && reactive) {\n\t\t// For tracing purposes, we need to link the source signal we create with the\n\t\t// collection + index so that tracing works as intended\n\t\t/** @type {Value} */ (v).trace = () => {\n\t\t\tvar collection_index = typeof i === 'number' ? index : i.v;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\t\t\tget_collection()[collection_index];\n\t\t};\n\t}\n\n\t/** @type {EachItem} */\n\tvar item = {\n\t\ti,\n\t\tv,\n\t\tk: key,\n\t\ta: null,\n\t\t// @ts-expect-error\n\t\te: null,\n\t\tprev,\n\t\tnext\n\t};\n\n\tcurrent_each_item = item;\n\n\ttry {\n\t\tif (anchor === null) {\n\t\t\tvar fragment = document.createDocumentFragment();\n\t\t\tfragment.append((anchor = create_text()));\n\t\t}\n\n\t\titem.e = branch(() => render_fn(/** @type {Node} */ (anchor), v, i, get_collection), hydrating);\n\n\t\titem.e.prev = prev && prev.e;\n\t\titem.e.next = next && next.e;\n\n\t\tif (prev === null) {\n\t\t\tif (!deferred) {\n\t\t\t\tstate.first = item;\n\t\t\t}\n\t\t} else {\n\t\t\tprev.next = item;\n\t\t\tprev.e.next = item.e;\n\t\t}\n\n\t\tif (next !== null) {\n\t\t\tnext.prev = item;\n\t\t\tnext.e.prev = item.e;\n\t\t}\n\n\t\treturn item;\n\t} finally {\n\t\tcurrent_each_item = previous_each_item;\n\t}\n}\n\n/**\n * @param {EachItem} item\n * @param {EachItem | null} next\n * @param {Text | Element | Comment} anchor\n */\nfunction move(item, next, anchor) {\n\tvar end = item.next ? /** @type {TemplateNode} */ (item.next.e.nodes_start) : anchor;\n\n\tvar dest = next ? /** @type {TemplateNode} */ (next.e.nodes_start) : anchor;\n\tvar node = /** @type {TemplateNode} */ (item.e.nodes_start);\n\n\twhile (node !== null && node !== end) {\n\t\tvar next_node = /** @type {TemplateNode} */ (get_next_sibling(node));\n\t\tdest.before(node);\n\t\tnode = next_node;\n\t}\n}\n\n/**\n * @param {EachState} state\n * @param {EachItem | null} prev\n * @param {EachItem | null} next\n */\nfunction link(state, prev, next) {\n\tif (prev === null) {\n\t\tstate.first = next;\n\t} else {\n\t\tprev.next = next;\n\t\tprev.e.next = next && next.e;\n\t}\n\n\tif (next !== null) {\n\t\tnext.prev = prev;\n\t\tnext.e.prev = prev && prev.e;\n\t}\n}\n","import { escape_html } from '../../escaping.js';\nimport { clsx as _clsx } from 'clsx';\n\n/**\n * `<div translate={false}>` should be rendered as `<div translate=\"no\">` and _not_\n * `<div translate=\"false\">`, which is equivalent to `<div translate=\"yes\">`. There\n * may be other odd cases that need to be added to this list in future\n * @type {Record<string, Map<any, string>>}\n */\nconst replacements = {\n\ttranslate: new Map([\n\t\t[true, 'yes'],\n\t\t[false, 'no']\n\t])\n};\n\n/**\n * @template V\n * @param {string} name\n * @param {V} value\n * @param {boolean} [is_boolean]\n * @returns {string}\n */\nexport function attr(name, value, is_boolean = false) {\n\t// attribute hidden for values other than \"until-found\" behaves like a boolean attribute\n\tif (name === 'hidden' && value !== 'until-found') {\n\t\tis_boolean = true;\n\t}\n\tif (value == null || (!value && is_boolean)) return '';\n\tconst normalized = (name in replacements && replacements[name].get(value)) || value;\n\tconst assignment = is_boolean ? '' : `=\"${escape_html(normalized, true)}\"`;\n\treturn ` ${name}${assignment}`;\n}\n\n/**\n * Small wrapper around clsx to preserve Svelte's (weird) handling of falsy values.\n * TODO Svelte 6 revisit this, and likely turn all falsy values into the empty string (what clsx also does)\n * @param  {any} value\n */\nexport function clsx(value) {\n\tif (typeof value === 'object') {\n\t\treturn _clsx(value);\n\t} else {\n\t\treturn value ?? '';\n\t}\n}\n\nconst whitespace = [...' \\t\\n\\r\\f\\u00a0\\u000b\\ufeff'];\n\n/**\n * @param {any} value\n * @param {string | null} [hash]\n * @param {Record<string, boolean>} [directives]\n * @returns {string | null}\n */\nexport function to_class(value, hash, directives) {\n\tvar classname = value == null ? '' : '' + value;\n\n\tif (hash) {\n\t\tclassname = classname ? classname + ' ' + hash : hash;\n\t}\n\n\tif (directives) {\n\t\tfor (var key in directives) {\n\t\t\tif (directives[key]) {\n\t\t\t\tclassname = classname ? classname + ' ' + key : key;\n\t\t\t} else if (classname.length) {\n\t\t\t\tvar len = key.length;\n\t\t\t\tvar a = 0;\n\n\t\t\t\twhile ((a = classname.indexOf(key, a)) >= 0) {\n\t\t\t\t\tvar b = a + len;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t(a === 0 || whitespace.includes(classname[a - 1])) &&\n\t\t\t\t\t\t(b === classname.length || whitespace.includes(classname[b]))\n\t\t\t\t\t) {\n\t\t\t\t\t\tclassname = (a === 0 ? '' : classname.substring(0, a)) + classname.substring(b + 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ta = b;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn classname === '' ? null : classname;\n}\n\n/**\n *\n * @param {Record<string,any>} styles\n * @param {boolean} important\n */\nfunction append_styles(styles, important = false) {\n\tvar separator = important ? ' !important;' : ';';\n\tvar css = '';\n\n\tfor (var key in styles) {\n\t\tvar value = styles[key];\n\t\tif (value != null && value !== '') {\n\t\t\tcss += ' ' + key + ': ' + value + separator;\n\t\t}\n\t}\n\n\treturn css;\n}\n\n/**\n * @param {string} name\n * @returns {string}\n */\nfunction to_css_name(name) {\n\tif (name[0] !== '-' || name[1] !== '-') {\n\t\treturn name.toLowerCase();\n\t}\n\treturn name;\n}\n\n/**\n * @param {any} value\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [styles]\n * @returns {string | null}\n */\nexport function to_style(value, styles) {\n\tif (styles) {\n\t\tvar new_style = '';\n\n\t\t/** @type {Record<string,any> | undefined} */\n\t\tvar normal_styles;\n\n\t\t/** @type {Record<string,any> | undefined} */\n\t\tvar important_styles;\n\n\t\tif (Array.isArray(styles)) {\n\t\t\tnormal_styles = styles[0];\n\t\t\timportant_styles = styles[1];\n\t\t} else {\n\t\t\tnormal_styles = styles;\n\t\t}\n\n\t\tif (value) {\n\t\t\tvalue = String(value)\n\t\t\t\t.replaceAll(/\\s*\\/\\*.*?\\*\\/\\s*/g, '')\n\t\t\t\t.trim();\n\n\t\t\t/** @type {boolean | '\"' | \"'\"} */\n\t\t\tvar in_str = false;\n\t\t\tvar in_apo = 0;\n\t\t\tvar in_comment = false;\n\n\t\t\tvar reserved_names = [];\n\n\t\t\tif (normal_styles) {\n\t\t\t\treserved_names.push(...Object.keys(normal_styles).map(to_css_name));\n\t\t\t}\n\t\t\tif (important_styles) {\n\t\t\t\treserved_names.push(...Object.keys(important_styles).map(to_css_name));\n\t\t\t}\n\n\t\t\tvar start_index = 0;\n\t\t\tvar name_index = -1;\n\n\t\t\tconst len = value.length;\n\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\tvar c = value[i];\n\n\t\t\t\tif (in_comment) {\n\t\t\t\t\tif (c === '/' && value[i - 1] === '*') {\n\t\t\t\t\t\tin_comment = false;\n\t\t\t\t\t}\n\t\t\t\t} else if (in_str) {\n\t\t\t\t\tif (in_str === c) {\n\t\t\t\t\t\tin_str = false;\n\t\t\t\t\t}\n\t\t\t\t} else if (c === '/' && value[i + 1] === '*') {\n\t\t\t\t\tin_comment = true;\n\t\t\t\t} else if (c === '\"' || c === \"'\") {\n\t\t\t\t\tin_str = c;\n\t\t\t\t} else if (c === '(') {\n\t\t\t\t\tin_apo++;\n\t\t\t\t} else if (c === ')') {\n\t\t\t\t\tin_apo--;\n\t\t\t\t}\n\n\t\t\t\tif (!in_comment && in_str === false && in_apo === 0) {\n\t\t\t\t\tif (c === ':' && name_index === -1) {\n\t\t\t\t\t\tname_index = i;\n\t\t\t\t\t} else if (c === ';' || i === len - 1) {\n\t\t\t\t\t\tif (name_index !== -1) {\n\t\t\t\t\t\t\tvar name = to_css_name(value.substring(start_index, name_index).trim());\n\n\t\t\t\t\t\t\tif (!reserved_names.includes(name)) {\n\t\t\t\t\t\t\t\tif (c !== ';') {\n\t\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar property = value.substring(start_index, i).trim();\n\t\t\t\t\t\t\t\tnew_style += ' ' + property + ';';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstart_index = i + 1;\n\t\t\t\t\t\tname_index = -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (normal_styles) {\n\t\t\tnew_style += append_styles(normal_styles);\n\t\t}\n\n\t\tif (important_styles) {\n\t\t\tnew_style += append_styles(important_styles, true);\n\t\t}\n\n\t\tnew_style = new_style.trim();\n\t\treturn new_style === '' ? null : new_style;\n\t}\n\n\treturn value == null ? null : String(value);\n}\n","import { to_class } from '../../../shared/attributes.js';\nimport { hydrating } from '../hydration.js';\n\n/**\n * @param {Element} dom\n * @param {boolean | number} is_html\n * @param {string | null} value\n * @param {string} [hash]\n * @param {Record<string, any>} [prev_classes]\n * @param {Record<string, any>} [next_classes]\n * @returns {Record<string, boolean> | undefined}\n */\nexport function set_class(dom, is_html, value, hash, prev_classes, next_classes) {\n\t// @ts-expect-error need to add __className to patched prototype\n\tvar prev = dom.__className;\n\n\tif (\n\t\thydrating ||\n\t\tprev !== value ||\n\t\tprev === undefined // for edge case of `class={undefined}`\n\t) {\n\t\tvar next_class_name = to_class(value, hash, next_classes);\n\n\t\tif (!hydrating || next_class_name !== dom.getAttribute('class')) {\n\t\t\t// Removing the attribute when the value is only an empty string causes\n\t\t\t// performance issues vs simply making the className an empty string. So\n\t\t\t// we should only remove the class if the value is nullish\n\t\t\t// and there no hash/directives :\n\t\t\tif (next_class_name == null) {\n\t\t\t\tdom.removeAttribute('class');\n\t\t\t} else if (is_html) {\n\t\t\t\tdom.className = next_class_name;\n\t\t\t} else {\n\t\t\t\tdom.setAttribute('class', next_class_name);\n\t\t\t}\n\t\t}\n\n\t\t// @ts-expect-error need to add __className to patched prototype\n\t\tdom.__className = value;\n\t} else if (next_classes && prev_classes !== next_classes) {\n\t\tfor (var key in next_classes) {\n\t\t\tvar is_present = !!next_classes[key];\n\n\t\t\tif (prev_classes == null || is_present !== !!prev_classes[key]) {\n\t\t\t\tdom.classList.toggle(key, is_present);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn next_classes;\n}\n","import { to_style } from '../../../shared/attributes.js';\nimport { hydrating } from '../hydration.js';\n\n/**\n * @param {Element & ElementCSSInlineStyle} dom\n * @param {Record<string, any>} prev\n * @param {Record<string, any>} next\n * @param {string} [priority]\n */\nfunction update_styles(dom, prev = {}, next, priority) {\n\tfor (var key in next) {\n\t\tvar value = next[key];\n\n\t\tif (prev[key] !== value) {\n\t\t\tif (next[key] == null) {\n\t\t\t\tdom.style.removeProperty(key);\n\t\t\t} else {\n\t\t\t\tdom.style.setProperty(key, value, priority);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} dom\n * @param {string | null} value\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [prev_styles]\n * @param {Record<string, any> | [Record<string, any>, Record<string, any>]} [next_styles]\n */\nexport function set_style(dom, value, prev_styles, next_styles) {\n\t// @ts-expect-error\n\tvar prev = dom.__style;\n\n\tif (hydrating || prev !== value) {\n\t\tvar next_style_attr = to_style(value, next_styles);\n\n\t\tif (!hydrating || next_style_attr !== dom.getAttribute('style')) {\n\t\t\tif (next_style_attr == null) {\n\t\t\t\tdom.removeAttribute('style');\n\t\t\t} else {\n\t\t\t\tdom.style.cssText = next_style_attr;\n\t\t\t}\n\t\t}\n\n\t\t// @ts-expect-error\n\t\tdom.__style = value;\n\t} else if (next_styles) {\n\t\tif (Array.isArray(next_styles)) {\n\t\t\tupdate_styles(dom, prev_styles?.[0], next_styles[0]);\n\t\t\tupdate_styles(dom, prev_styles?.[1], next_styles[1], 'important');\n\t\t} else {\n\t\t\tupdate_styles(dom, prev_styles, next_styles);\n\t\t}\n\t}\n\n\treturn next_styles;\n}\n","/** @import { Effect } from '#client' */\nimport { DEV } from 'esm-env';\nimport { hydrating, set_hydrating } from '../hydration.js';\nimport { get_descriptors, get_prototype_of } from '../../../shared/utils.js';\nimport { create_event, delegate } from './events.js';\nimport { add_form_reset_listener, autofocus } from './misc.js';\nimport * as w from '../../warnings.js';\nimport { LOADING_ATTR_SYMBOL } from '#client/constants';\nimport { queue_micro_task } from '../task.js';\nimport { is_capture_event, can_delegate_event, normalize_attribute } from '../../../../utils.js';\nimport {\n\tactive_effect,\n\tactive_reaction,\n\tget,\n\tset_active_effect,\n\tset_active_reaction\n} from '../../runtime.js';\nimport { attach } from './attachments.js';\nimport { clsx } from '../../../shared/attributes.js';\nimport { set_class } from './class.js';\nimport { set_style } from './style.js';\nimport { ATTACHMENT_KEY, NAMESPACE_HTML, UNINITIALIZED } from '../../../../constants.js';\nimport { block, branch, destroy_effect, effect } from '../../reactivity/effects.js';\nimport { init_select, select_option } from './bindings/select.js';\nimport { flatten } from '../../reactivity/async.js';\n\nexport const CLASS = Symbol('class');\nexport const STYLE = Symbol('style');\n\nconst IS_CUSTOM_ELEMENT = Symbol('is custom element');\nconst IS_HTML = Symbol('is html');\n\n/**\n * The value/checked attribute in the template actually corresponds to the defaultValue property, so we need\n * to remove it upon hydration to avoid a bug when someone resets the form value.\n * @param {HTMLInputElement} input\n * @returns {void}\n */\nexport function remove_input_defaults(input) {\n\tif (!hydrating) return;\n\n\tvar already_removed = false;\n\n\t// We try and remove the default attributes later, rather than sync during hydration.\n\t// Doing it sync during hydration has a negative impact on performance, but deferring the\n\t// work in an idle task alleviates this greatly. If a form reset event comes in before\n\t// the idle callback, then we ensure the input defaults are cleared just before.\n\tvar remove_defaults = () => {\n\t\tif (already_removed) return;\n\t\talready_removed = true;\n\n\t\t// Remove the attributes but preserve the values\n\t\tif (input.hasAttribute('value')) {\n\t\t\tvar value = input.value;\n\t\t\tset_attribute(input, 'value', null);\n\t\t\tinput.value = value;\n\t\t}\n\n\t\tif (input.hasAttribute('checked')) {\n\t\t\tvar checked = input.checked;\n\t\t\tset_attribute(input, 'checked', null);\n\t\t\tinput.checked = checked;\n\t\t}\n\t};\n\n\t// @ts-expect-error\n\tinput.__on_r = remove_defaults;\n\tqueue_micro_task(remove_defaults);\n\tadd_form_reset_listener();\n}\n\n/**\n * @param {Element} element\n * @param {any} value\n */\nexport function set_value(element, value) {\n\tvar attributes = get_attributes(element);\n\n\tif (\n\t\tattributes.value ===\n\t\t\t(attributes.value =\n\t\t\t\t// treat null and undefined the same for the initial value\n\t\t\t\tvalue ?? undefined) ||\n\t\t// @ts-expect-error\n\t\t// `progress` elements always need their value set when it's `0`\n\t\t(element.value === value && (value !== 0 || element.nodeName !== 'PROGRESS'))\n\t) {\n\t\treturn;\n\t}\n\n\t// @ts-expect-error\n\telement.value = value ?? '';\n}\n\n/**\n * @param {Element} element\n * @param {boolean} checked\n */\nexport function set_checked(element, checked) {\n\tvar attributes = get_attributes(element);\n\n\tif (\n\t\tattributes.checked ===\n\t\t(attributes.checked =\n\t\t\t// treat null and undefined the same for the initial value\n\t\t\tchecked ?? undefined)\n\t) {\n\t\treturn;\n\t}\n\n\t// @ts-expect-error\n\telement.checked = checked;\n}\n\n/**\n * Sets the `selected` attribute on an `option` element.\n * Not set through the property because that doesn't reflect to the DOM,\n * which means it wouldn't be taken into account when a form is reset.\n * @param {HTMLOptionElement} element\n * @param {boolean} selected\n */\nexport function set_selected(element, selected) {\n\tif (selected) {\n\t\t// The selected option could've changed via user selection, and\n\t\t// setting the value without this check would set it back.\n\t\tif (!element.hasAttribute('selected')) {\n\t\t\telement.setAttribute('selected', '');\n\t\t}\n\t} else {\n\t\telement.removeAttribute('selected');\n\t}\n}\n\n/**\n * Applies the default checked property without influencing the current checked property.\n * @param {HTMLInputElement} element\n * @param {boolean} checked\n */\nexport function set_default_checked(element, checked) {\n\tconst existing_value = element.checked;\n\telement.defaultChecked = checked;\n\telement.checked = existing_value;\n}\n\n/**\n * Applies the default value property without influencing the current value property.\n * @param {HTMLInputElement | HTMLTextAreaElement} element\n * @param {string} value\n */\nexport function set_default_value(element, value) {\n\tconst existing_value = element.value;\n\telement.defaultValue = value;\n\telement.value = existing_value;\n}\n\n/**\n * @param {Element} element\n * @param {string} attribute\n * @param {string | null} value\n * @param {boolean} [skip_warning]\n */\nexport function set_attribute(element, attribute, value, skip_warning) {\n\tvar attributes = get_attributes(element);\n\n\tif (hydrating) {\n\t\tattributes[attribute] = element.getAttribute(attribute);\n\n\t\tif (\n\t\t\tattribute === 'src' ||\n\t\t\tattribute === 'srcset' ||\n\t\t\t(attribute === 'href' && element.nodeName === 'LINK')\n\t\t) {\n\t\t\tif (!skip_warning) {\n\t\t\t\tcheck_src_in_dev_hydration(element, attribute, value ?? '');\n\t\t\t}\n\n\t\t\t// If we reset these attributes, they would result in another network request, which we want to avoid.\n\t\t\t// We assume they are the same between client and server as checking if they are equal is expensive\n\t\t\t// (we can't just compare the strings as they can be different between client and server but result in the\n\t\t\t// same url, so we would need to create hidden anchor elements to compare them)\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (attributes[attribute] === (attributes[attribute] = value)) return;\n\n\tif (attribute === 'loading') {\n\t\t// @ts-expect-error\n\t\telement[LOADING_ATTR_SYMBOL] = value;\n\t}\n\n\tif (value == null) {\n\t\telement.removeAttribute(attribute);\n\t} else if (typeof value !== 'string' && get_setters(element).includes(attribute)) {\n\t\t// @ts-ignore\n\t\telement[attribute] = value;\n\t} else {\n\t\telement.setAttribute(attribute, value);\n\t}\n}\n\n/**\n * @param {Element} dom\n * @param {string} attribute\n * @param {string} value\n */\nexport function set_xlink_attribute(dom, attribute, value) {\n\tdom.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\n/**\n * @param {HTMLElement} node\n * @param {string} prop\n * @param {any} value\n */\nexport function set_custom_element_data(node, prop, value) {\n\t// We need to ensure that setting custom element props, which can\n\t// invoke lifecycle methods on other custom elements, does not also\n\t// associate those lifecycle methods with the current active reaction\n\t// or effect\n\tvar previous_reaction = active_reaction;\n\tvar previous_effect = active_effect;\n\n\t// If we're hydrating but the custom element is from Svelte, and it already scaffolded,\n\t// then it might run block logic in hydration mode, which we have to prevent.\n\tlet was_hydrating = hydrating;\n\tif (hydrating) {\n\t\tset_hydrating(false);\n\t}\n\n\tset_active_reaction(null);\n\tset_active_effect(null);\n\n\ttry {\n\t\tif (\n\t\t\t// `style` should use `set_attribute` rather than the setter\n\t\t\tprop !== 'style' &&\n\t\t\t// Don't compute setters for custom elements while they aren't registered yet,\n\t\t\t// because during their upgrade/instantiation they might add more setters.\n\t\t\t// Instead, fall back to a simple \"an object, then set as property\" heuristic.\n\t\t\t(setters_cache.has(node.getAttribute('is') || node.nodeName) ||\n\t\t\t// customElements may not be available in browser extension contexts\n\t\t\t!customElements ||\n\t\t\tcustomElements.get(node.getAttribute('is') || node.tagName.toLowerCase())\n\t\t\t\t? get_setters(node).includes(prop)\n\t\t\t\t: value && typeof value === 'object')\n\t\t) {\n\t\t\t// @ts-expect-error\n\t\t\tnode[prop] = value;\n\t\t} else {\n\t\t\t// We did getters etc checks already, stringify before passing to set_attribute\n\t\t\t// to ensure it doesn't invoke the same logic again, and potentially populating\n\t\t\t// the setters cache too early.\n\t\t\tset_attribute(node, prop, value == null ? value : String(value));\n\t\t}\n\t} finally {\n\t\tset_active_reaction(previous_reaction);\n\t\tset_active_effect(previous_effect);\n\t\tif (was_hydrating) {\n\t\t\tset_hydrating(true);\n\t\t}\n\t}\n}\n\n/**\n * Spreads attributes onto a DOM element, taking into account the currently set attributes\n * @param {Element & ElementCSSInlineStyle} element\n * @param {Record<string | symbol, any> | undefined} prev\n * @param {Record<string | symbol, any>} next New attributes - this function mutates this object\n * @param {string} [css_hash]\n * @param {boolean} [should_remove_defaults]\n * @param {boolean} [skip_warning]\n * @returns {Record<string, any>}\n */\nfunction set_attributes(\n\telement,\n\tprev,\n\tnext,\n\tcss_hash,\n\tshould_remove_defaults = false,\n\tskip_warning = false\n) {\n\tif (hydrating && should_remove_defaults && element.tagName === 'INPUT') {\n\t\tvar input = /** @type {HTMLInputElement} */ (element);\n\t\tvar attribute = input.type === 'checkbox' ? 'defaultChecked' : 'defaultValue';\n\n\t\tif (!(attribute in next)) {\n\t\t\tremove_input_defaults(input);\n\t\t}\n\t}\n\n\tvar attributes = get_attributes(element);\n\n\tvar is_custom_element = attributes[IS_CUSTOM_ELEMENT];\n\tvar preserve_attribute_case = !attributes[IS_HTML];\n\n\t// If we're hydrating but the custom element is from Svelte, and it already scaffolded,\n\t// then it might run block logic in hydration mode, which we have to prevent.\n\tlet is_hydrating_custom_element = hydrating && is_custom_element;\n\tif (is_hydrating_custom_element) {\n\t\tset_hydrating(false);\n\t}\n\n\tvar current = prev || {};\n\tvar is_option_element = element.tagName === 'OPTION';\n\n\tfor (var key in prev) {\n\t\tif (!(key in next)) {\n\t\t\tnext[key] = null;\n\t\t}\n\t}\n\n\tif (next.class) {\n\t\tnext.class = clsx(next.class);\n\t} else if (css_hash || next[CLASS]) {\n\t\tnext.class = null; /* force call to set_class() */\n\t}\n\n\tif (next[STYLE]) {\n\t\tnext.style ??= null; /* force call to set_style() */\n\t}\n\n\tvar setters = get_setters(element);\n\n\t// since key is captured we use const\n\tfor (const key in next) {\n\t\t// let instead of var because referenced in a closure\n\t\tlet value = next[key];\n\n\t\t// Up here because we want to do this for the initial value, too, even if it's undefined,\n\t\t// and this wouldn't be reached in case of undefined because of the equality check below\n\t\tif (is_option_element && key === 'value' && value == null) {\n\t\t\t// The <option> element is a special case because removing the value attribute means\n\t\t\t// the value is set to the text content of the option element, and setting the value\n\t\t\t// to null or undefined means the value is set to the string \"null\" or \"undefined\".\n\t\t\t// To align with how we handle this case in non-spread-scenarios, this logic is needed.\n\t\t\t// There's a super-edge-case bug here that is left in in favor of smaller code size:\n\t\t\t// Because of the \"set missing props to null\" logic above, we can't differentiate\n\t\t\t// between a missing value and an explicitly set value of null or undefined. That means\n\t\t\t// that once set, the value attribute of an <option> element can't be removed. This is\n\t\t\t// a very rare edge case, and removing the attribute altogether isn't possible either\n\t\t\t// for the <option value={undefined}> case, so we're not losing any functionality here.\n\t\t\t// @ts-ignore\n\t\t\telement.value = element.__value = '';\n\t\t\tcurrent[key] = value;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (key === 'class') {\n\t\t\tvar is_html = element.namespaceURI === 'http://www.w3.org/1999/xhtml';\n\t\t\tset_class(element, is_html, value, css_hash, prev?.[CLASS], next[CLASS]);\n\t\t\tcurrent[key] = value;\n\t\t\tcurrent[CLASS] = next[CLASS];\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (key === 'style') {\n\t\t\tset_style(element, value, prev?.[STYLE], next[STYLE]);\n\t\t\tcurrent[key] = value;\n\t\t\tcurrent[STYLE] = next[STYLE];\n\t\t\tcontinue;\n\t\t}\n\n\t\tvar prev_value = current[key];\n\n\t\t// Skip if value is unchanged, unless it's `undefined` and the element still has the attribute\n\t\tif (value === prev_value && !(value === undefined && element.hasAttribute(key))) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tcurrent[key] = value;\n\n\t\tvar prefix = key[0] + key[1]; // this is faster than key.slice(0, 2)\n\t\tif (prefix === '$$') continue;\n\n\t\tif (prefix === 'on') {\n\t\t\t/** @type {{ capture?: true }} */\n\t\t\tconst opts = {};\n\t\t\tconst event_handle_key = '$$' + key;\n\t\t\tlet event_name = key.slice(2);\n\t\t\tvar delegated = can_delegate_event(event_name);\n\n\t\t\tif (is_capture_event(event_name)) {\n\t\t\t\tevent_name = event_name.slice(0, -7);\n\t\t\t\topts.capture = true;\n\t\t\t}\n\n\t\t\tif (!delegated && prev_value) {\n\t\t\t\t// Listening to same event but different handler -> our handle function below takes care of this\n\t\t\t\t// If we were to remove and add listeners in this case, it could happen that the event is \"swallowed\"\n\t\t\t\t// (the browser seems to not know yet that a new one exists now) and doesn't reach the handler\n\t\t\t\t// https://github.com/sveltejs/svelte/issues/11903\n\t\t\t\tif (value != null) continue;\n\n\t\t\t\telement.removeEventListener(event_name, current[event_handle_key], opts);\n\t\t\t\tcurrent[event_handle_key] = null;\n\t\t\t}\n\n\t\t\tif (value != null) {\n\t\t\t\tif (!delegated) {\n\t\t\t\t\t/**\n\t\t\t\t\t * @this {any}\n\t\t\t\t\t * @param {Event} evt\n\t\t\t\t\t */\n\t\t\t\t\tfunction handle(evt) {\n\t\t\t\t\t\tcurrent[key].call(this, evt);\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrent[event_handle_key] = create_event(event_name, element, handle, opts);\n\t\t\t\t} else {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\telement[`__${event_name}`] = value;\n\t\t\t\t\tdelegate([event_name]);\n\t\t\t\t}\n\t\t\t} else if (delegated) {\n\t\t\t\t// @ts-ignore\n\t\t\t\telement[`__${event_name}`] = undefined;\n\t\t\t}\n\t\t} else if (key === 'style') {\n\t\t\t// avoid using the setter\n\t\t\tset_attribute(element, key, value);\n\t\t} else if (key === 'autofocus') {\n\t\t\tautofocus(/** @type {HTMLElement} */ (element), Boolean(value));\n\t\t} else if (!is_custom_element && (key === '__value' || (key === 'value' && value != null))) {\n\t\t\t// @ts-ignore We're not running this for custom elements because __value is actually\n\t\t\t// how Lit stores the current value on the element, and messing with that would break things.\n\t\t\telement.value = element.__value = value;\n\t\t} else if (key === 'selected' && is_option_element) {\n\t\t\tset_selected(/** @type {HTMLOptionElement} */ (element), value);\n\t\t} else {\n\t\t\tvar name = key;\n\t\t\tif (!preserve_attribute_case) {\n\t\t\t\tname = normalize_attribute(name);\n\t\t\t}\n\n\t\t\tvar is_default = name === 'defaultValue' || name === 'defaultChecked';\n\n\t\t\tif (value == null && !is_custom_element && !is_default) {\n\t\t\t\tattributes[key] = null;\n\n\t\t\t\tif (name === 'value' || name === 'checked') {\n\t\t\t\t\t// removing value/checked also removes defaultValue/defaultChecked — preserve\n\t\t\t\t\tlet input = /** @type {HTMLInputElement} */ (element);\n\t\t\t\t\tconst use_default = prev === undefined;\n\t\t\t\t\tif (name === 'value') {\n\t\t\t\t\t\tlet previous = input.defaultValue;\n\t\t\t\t\t\tinput.removeAttribute(name);\n\t\t\t\t\t\tinput.defaultValue = previous;\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tinput.value = input.__value = use_default ? previous : null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet previous = input.defaultChecked;\n\t\t\t\t\t\tinput.removeAttribute(name);\n\t\t\t\t\t\tinput.defaultChecked = previous;\n\t\t\t\t\t\tinput.checked = use_default ? previous : false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\telement.removeAttribute(key);\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tis_default ||\n\t\t\t\t(setters.includes(name) && (is_custom_element || typeof value !== 'string'))\n\t\t\t) {\n\t\t\t\t// @ts-ignore\n\t\t\t\telement[name] = value;\n\t\t\t\t// remove it from attributes's cache\n\t\t\t\tif (name in attributes) attributes[name] = UNINITIALIZED;\n\t\t\t} else if (typeof value !== 'function') {\n\t\t\t\tset_attribute(element, name, value, skip_warning);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (is_hydrating_custom_element) {\n\t\tset_hydrating(true);\n\t}\n\n\treturn current;\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} element\n * @param {(...expressions: any) => Record<string | symbol, any>} fn\n * @param {Array<() => any>} sync\n * @param {Array<() => Promise<any>>} async\n * @param {string} [css_hash]\n * @param {boolean} [should_remove_defaults]\n * @param {boolean} [skip_warning]\n */\nexport function attribute_effect(\n\telement,\n\tfn,\n\tsync = [],\n\tasync = [],\n\tcss_hash,\n\tshould_remove_defaults = false,\n\tskip_warning = false\n) {\n\tflatten(sync, async, (values) => {\n\t\t/** @type {Record<string | symbol, any> | undefined} */\n\t\tvar prev = undefined;\n\n\t\t/** @type {Record<symbol, Effect>} */\n\t\tvar effects = {};\n\n\t\tvar is_select = element.nodeName === 'SELECT';\n\t\tvar inited = false;\n\n\t\tblock(() => {\n\t\t\tvar next = fn(...values.map(get));\n\t\t\t/** @type {Record<string | symbol, any>} */\n\t\t\tvar current = set_attributes(\n\t\t\t\telement,\n\t\t\t\tprev,\n\t\t\t\tnext,\n\t\t\t\tcss_hash,\n\t\t\t\tshould_remove_defaults,\n\t\t\t\tskip_warning\n\t\t\t);\n\n\t\t\tif (inited && is_select && 'value' in next) {\n\t\t\t\tselect_option(/** @type {HTMLSelectElement} */ (element), next.value);\n\t\t\t}\n\n\t\t\tfor (let symbol of Object.getOwnPropertySymbols(effects)) {\n\t\t\t\tif (!next[symbol]) destroy_effect(effects[symbol]);\n\t\t\t}\n\n\t\t\tfor (let symbol of Object.getOwnPropertySymbols(next)) {\n\t\t\t\tvar n = next[symbol];\n\n\t\t\t\tif (symbol.description === ATTACHMENT_KEY && (!prev || n !== prev[symbol])) {\n\t\t\t\t\tif (effects[symbol]) destroy_effect(effects[symbol]);\n\t\t\t\t\teffects[symbol] = branch(() => attach(element, () => n));\n\t\t\t\t}\n\n\t\t\t\tcurrent[symbol] = n;\n\t\t\t}\n\n\t\t\tprev = current;\n\t\t});\n\n\t\tif (is_select) {\n\t\t\tvar select = /** @type {HTMLSelectElement} */ (element);\n\n\t\t\teffect(() => {\n\t\t\t\tselect_option(select, /** @type {Record<string | symbol, any>} */ (prev).value, true);\n\t\t\t\tinit_select(select);\n\t\t\t});\n\t\t}\n\n\t\tinited = true;\n\t});\n}\n\n/**\n *\n * @param {Element} element\n */\nfunction get_attributes(element) {\n\treturn /** @type {Record<string | symbol, unknown>} **/ (\n\t\t// @ts-expect-error\n\t\telement.__attributes ??= {\n\t\t\t[IS_CUSTOM_ELEMENT]: element.nodeName.includes('-'),\n\t\t\t[IS_HTML]: element.namespaceURI === NAMESPACE_HTML\n\t\t}\n\t);\n}\n\n/** @type {Map<string, string[]>} */\nvar setters_cache = new Map();\n\n/** @param {Element} element */\nfunction get_setters(element) {\n\tvar cache_key = element.getAttribute('is') || element.nodeName;\n\tvar setters = setters_cache.get(cache_key);\n\tif (setters) return setters;\n\tsetters_cache.set(cache_key, (setters = []));\n\n\tvar descriptors;\n\tvar proto = element; // In the case of custom elements there might be setters on the instance\n\tvar element_proto = Element.prototype;\n\n\t// Stop at Element, from there on there's only unnecessary setters we're not interested in\n\t// Do not use contructor.name here as that's unreliable in some browser environments\n\twhile (element_proto !== proto) {\n\t\tdescriptors = get_descriptors(proto);\n\n\t\tfor (var key in descriptors) {\n\t\t\tif (descriptors[key].set) {\n\t\t\t\tsetters.push(key);\n\t\t\t}\n\t\t}\n\n\t\tproto = get_prototype_of(proto);\n\t}\n\n\treturn setters;\n}\n\n/**\n * @param {any} element\n * @param {string} attribute\n * @param {string} value\n */\nfunction check_src_in_dev_hydration(element, attribute, value) {\n\tif (!DEV) return;\n\tif (attribute === 'srcset' && srcset_url_equal(element, value)) return;\n\tif (src_url_equal(element.getAttribute(attribute) ?? '', value)) return;\n\n\tw.hydration_attribute_changed(\n\t\tattribute,\n\t\telement.outerHTML.replace(element.innerHTML, element.innerHTML && '...'),\n\t\tString(value)\n\t);\n}\n\n/**\n * @param {string} element_src\n * @param {string} url\n * @returns {boolean}\n */\nfunction src_url_equal(element_src, url) {\n\tif (element_src === url) return true;\n\treturn new URL(element_src, document.baseURI).href === new URL(url, document.baseURI).href;\n}\n\n/** @param {string} srcset */\nfunction split_srcset(srcset) {\n\treturn srcset.split(',').map((src) => src.trim().split(' ').filter(Boolean));\n}\n\n/**\n * @param {HTMLSourceElement | HTMLImageElement} element\n * @param {string} srcset\n * @returns {boolean}\n */\nfunction srcset_url_equal(element, srcset) {\n\tvar element_urls = split_srcset(element.srcset);\n\tvar urls = split_srcset(srcset);\n\n\treturn (\n\t\turls.length === element_urls.length &&\n\t\turls.every(\n\t\t\t([url, width], i) =>\n\t\t\t\twidth === element_urls[i][1] &&\n\t\t\t\t// We need to test both ways because Vite will create an a full URL with\n\t\t\t\t// `new URL(asset, import.meta.url).href` for the client when `base: './'`, and the\n\t\t\t\t// relative URLs inside srcset are not automatically resolved to absolute URLs by\n\t\t\t\t// browsers (in contrast to img.src). This means both SSR and DOM code could\n\t\t\t\t// contain relative or absolute URLs.\n\t\t\t\t(src_url_equal(element_urls[i][0], url) || src_url_equal(url, element_urls[i][0]))\n\t\t)\n\t);\n}\n","/**\n * Audio Context Manager\n *\n * Provides a singleton AudioContext instance with browser compatibility\n * handling and unlock functionality for iOS/Safari.\n *\n * @module audio/context\n */\n\nlet audioContext = null;\n\n/**\n * Get the global AudioContext instance\n * @returns {AudioContext} The audio context\n */\nexport function getAudioContext() {\n  if (!audioContext) {\n    const AudioContextClass =\n      (typeof window !== 'undefined' && (window.AudioContext || window.webkitAudioContext)) ||\n      globalThis.AudioContext ||\n      globalThis.webkitAudioContext;\n\n    if (!AudioContextClass) {\n      throw new Error('AudioContext is not available in this environment');\n    }\n\n    audioContext = new AudioContextClass();\n  }\n  return audioContext;\n}\n\n/**\n * Unlock AudioContext on iOS (required for user interaction)\n * @returns {Promise<void>}\n */\nexport async function unlockAudioContext() {\n  const ctx = getAudioContext();\n\n  if (ctx.state === 'suspended') {\n    const buffer = ctx.createBuffer(1, 1, 8000);\n    const source = ctx.createBufferSource();\n    source.buffer = buffer;\n    source.connect(ctx.destination);\n    source.start(0);\n\n    try {\n      await ctx.resume();\n      console.log('✓ AudioContext unlocked');\n    } catch (error) {\n      console.error('Failed to unlock AudioContext:', error);\n    }\n  }\n}\n\n/**\n * Suspend AudioContext\n */\nexport function suspendAudioContext() {\n  if (audioContext && audioContext.state === 'running') {\n    audioContext.suspend();\n  }\n}\n","/**\n * Piano Voice Generator\n *\n * Creates a single polyphonic voice with three detuned oscillators\n * and ADSR envelope. Designed for warm, chorus-like timbre.\n *\n * Features:\n * - Multiple detuned oscillators for rich, warm tone\n * - Configurable ADSR envelope\n * - Velocity-sensitive amplitude\n * - Smooth parameter automation (no clicks/pops)\n * - Dynamic detuning control for adaptive chorus effect\n *\n * @module audio/synthesis/piano-voice\n */\n\nimport { getAudioContext } from '../context.js';\n\nconst DEFAULT_DETUNE_CENTS = [0, 15, -20];\nconst DEFAULT_ATTACK = 0.05;\nconst DEFAULT_DECAY = 0.2;\nconst DEFAULT_SUSTAIN = 0.6;\nconst DEFAULT_RELEASE = 1.0;\nconst FREQUENCY_RAMP_TIME = 0.05; // Smooth frequency changes over 50ms\nconst VELOCITY_RAMP_TIME = 0.01; // Quick velocity response\nconst MIN_FREQUENCY = 20;\nconst MAX_FREQUENCY = 20000;\n\n/**\n * Creates a piano voice with detuned oscillators and envelope\n *\n * Architecture:\n * Oscillators (3x detuned) → Envelope (ADSR) → Velocity Gain → Output\n *\n * @param {Object} options - Configuration options\n * @param {number} [options.frequency=440] - Frequency in Hz (20-20000)\n * @param {number} [options.velocity=100] - Velocity (0-127, MIDI range)\n * @param {number} [options.attackTime=0.05] - Attack time in seconds\n * @param {number} [options.decayTime=0.2] - Decay time in seconds\n * @param {number} [options.sustainLevel=0.6] - Sustain level (0-1)\n * @param {number} [options.releaseTime=1.0] - Release time in seconds\n * @param {number[]} [options.detuneCents] - Custom detuning in cents [osc1, osc2, osc3]\n * @param {number} [options.velocityScale=0.3] - Scale factor for velocity (0-1)\n * @returns {Object} Piano voice instance with methods for control\n * @throws {Error} If frequency is out of valid range\n */\nexport function createPianoVoice(options = {}) {\n  const ctx = getAudioContext();\n  const {\n    frequency = 440,\n    velocity = 100,\n    attackTime = DEFAULT_ATTACK,\n    decayTime = DEFAULT_DECAY,\n    sustainLevel = DEFAULT_SUSTAIN,\n    releaseTime = DEFAULT_RELEASE,\n    detuneCents = DEFAULT_DETUNE_CENTS,\n    velocityScale = 0.3\n  } = options;\n\n  // Validate inputs\n  if (frequency < MIN_FREQUENCY || frequency > MAX_FREQUENCY) {\n    throw new Error(\n      `Frequency out of range: ${frequency} Hz. Valid range: ${MIN_FREQUENCY}-${MAX_FREQUENCY} Hz`\n    );\n  }\n\n  if (velocity < 0 || velocity > 127) {\n    throw new Error(`Velocity out of range: ${velocity}. Valid range: 0-127`);\n  }\n\n  if (attackTime < 0 || decayTime < 0 || releaseTime < 0) {\n    throw new Error('Attack, decay, and release times must be non-negative');\n  }\n\n  if (sustainLevel < 0 || sustainLevel > 1) {\n    throw new Error('Sustain level must be between 0 and 1');\n  }\n\n  // Create oscillators with detuning\n  const oscillators = detuneCents.map((cents) => {\n    const osc = ctx.createOscillator();\n    osc.type = 'sine';\n    osc.frequency.value = frequency;\n    osc.detune.value = cents;\n    return osc;\n  });\n\n  // Create envelope\n  const envelope = ctx.createGain();\n  envelope.gain.value = 0;\n\n  // Create velocity controller\n  const velocityGain = ctx.createGain();\n  const normalizedVelocity = velocity / 127;\n  velocityGain.gain.value = normalizedVelocity * velocityScale;\n\n  // Internal state\n  let isPlaying = false;\n  let currentFrequency = frequency;\n  let currentVelocity = velocity;\n  let currentDetuning = [...detuneCents];\n\n  // Connect oscillators to envelope\n  oscillators.forEach((osc) => osc.connect(envelope));\n  envelope.connect(velocityGain);\n\n  /**\n   * Validates and updates envelope times\n   * @private\n   */\n  function validateEnvelopeTimes(attack, decay, sustain, release) {\n    if (attack < 0 || decay < 0 || release < 0) {\n      throw new Error('Envelope times must be non-negative');\n    }\n    if (sustain < 0 || sustain > 1) {\n      throw new Error('Sustain level must be between 0 and 1');\n    }\n  }\n\n  // Public interface\n  return {\n    // Audio nodes (for advanced connections)\n    oscillators,\n    envelope,\n    velocityGain,\n\n    // State getters\n    getIsPlaying() {\n      return isPlaying;\n    },\n\n    getFrequency() {\n      return currentFrequency;\n    },\n\n    getVelocity() {\n      return currentVelocity;\n    },\n\n    getDetuning() {\n      return [...currentDetuning];\n    },\n\n    /**\n     * Start the voice and trigger ADSR envelope\n     * Automatically schedules attack, decay, and sustain phases.\n     *\n     * @returns {Object} this (for chaining)\n     */\n    noteOn() {\n      if (isPlaying) {\n        // If already playing, restart envelope\n        this.noteOff();\n      }\n\n      const now = ctx.currentTime;\n      isPlaying = true;\n\n      // Start all oscillators\n      oscillators.forEach((osc) => osc.start(now));\n\n      // Schedule ADSR envelope\n      // Attack: 0 → 1\n      envelope.gain.setValueAtTime(0, now);\n      envelope.gain.linearRampToValueAtTime(1, now + attackTime);\n\n      // Decay: 1 → sustain level\n      envelope.gain.linearRampToValueAtTime(\n        sustainLevel,\n        now + attackTime + decayTime\n      );\n\n      return this;\n    },\n\n    /**\n     * Release the voice (trigger release phase)\n     * Smoothly ramps gain to 0 and stops oscillators.\n     *\n     * @returns {Object} this (for chaining)\n     */\n    noteOff() {\n      const now = ctx.currentTime;\n      isPlaying = false;\n\n      // Capture current gain value to avoid clicks\n      envelope.gain.setValueAtTime(envelope.gain.value, now);\n\n      // Release: current value → 0\n      envelope.gain.linearRampToValueAtTime(0, now + releaseTime);\n\n      // Stop oscillators after release completes\n      oscillators.forEach((osc) => osc.stop(now + releaseTime));\n\n      return this;\n    },\n\n    /**\n     * Connect voice to destination node\n     *\n     * @param {AudioNode} destination - Target node (e.g., audioContext.destination)\n     * @returns {Object} this (for chaining)\n     */\n    connect(destination) {\n      velocityGain.connect(destination);\n      return this;\n    },\n\n    /**\n     * Disconnect voice from all destinations\n     *\n     * @returns {Object} this (for chaining)\n     */\n    disconnect() {\n      velocityGain.disconnect();\n      return this;\n    },\n\n    /**\n     * Set frequency with smooth ramping\n     * Prevents clicks/pops by ramping over 50ms.\n     *\n     * @param {number} freq - Frequency in Hz (20-20000)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If frequency is out of valid range\n     */\n    setFrequency(freq) {\n      if (freq < MIN_FREQUENCY || freq > MAX_FREQUENCY) {\n        throw new Error(\n          `Frequency out of range: ${freq} Hz. Valid range: ${MIN_FREQUENCY}-${MAX_FREQUENCY} Hz`\n        );\n      }\n\n      currentFrequency = freq;\n      const now = ctx.currentTime;\n\n      // Smooth frequency change over FREQUENCY_RAMP_TIME\n      oscillators.forEach((osc) => {\n        osc.frequency.linearRampToValueAtTime(freq, now + FREQUENCY_RAMP_TIME);\n      });\n\n      return this;\n    },\n\n    /**\n     * Set velocity (amplitude control)\n     * Velocity affects final output level based on velocityScale.\n     *\n     * @param {number} vel - Velocity (0-127, MIDI range)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If velocity is out of valid range\n     */\n    setVelocity(vel) {\n      if (vel < 0 || vel > 127) {\n        throw new Error(`Velocity out of range: ${vel}. Valid range: 0-127`);\n      }\n\n      currentVelocity = vel;\n      const now = ctx.currentTime;\n      const normalizedVel = vel / 127;\n\n      // Quick velocity response (10ms ramp)\n      velocityGain.gain.linearRampToValueAtTime(\n        normalizedVel * velocityScale,\n        now + VELOCITY_RAMP_TIME\n      );\n\n      return this;\n    },\n\n    /**\n     * Dynamically adjust detuning of oscillators\n     * Allows for adaptive chorus/detune effects post-initialization.\n     *\n     * @param {number[]} newDetuneCents - New detuning values in cents [osc1, osc2, osc3]\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If detuning array length doesn't match oscillator count\n     */\n    setDetuning(newDetuneCents) {\n      if (newDetuneCents.length !== oscillators.length) {\n        throw new Error(\n          `Detuning array length (${newDetuneCents.length}) must match oscillator count (${oscillators.length})`\n        );\n      }\n\n      currentDetuning = [...newDetuneCents];\n      const now = ctx.currentTime;\n\n      // Apply detuning with smooth ramping\n      oscillators.forEach((osc, index) => {\n        osc.detune.linearRampToValueAtTime(\n          newDetuneCents[index],\n          now + FREQUENCY_RAMP_TIME\n        );\n      });\n\n      return this;\n    },\n\n    /**\n     * Update ADSR envelope times\n     * Can be called while voice is playing to create dynamic envelope changes.\n     *\n     * @param {Object} envelopeParams - New envelope parameters\n     * @param {number} envelopeParams.attackTime - Attack time in seconds\n     * @param {number} envelopeParams.decayTime - Decay time in seconds\n     * @param {number} envelopeParams.sustainLevel - Sustain level (0-1)\n     * @param {number} envelopeParams.releaseTime - Release time in seconds\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If parameters are invalid\n     */\n    setEnvelope(envelopeParams) {\n      const {\n        attackTime: newAttack,\n        decayTime: newDecay,\n        sustainLevel: newSustain,\n        releaseTime: newRelease\n      } = envelopeParams;\n\n      validateEnvelopeTimes(newAttack, newDecay, newSustain, newRelease);\n\n      // Note: Updating envelope times won't retroactively affect\n      // currently playing notes. This is by design - envelope times\n      // only affect notes started AFTER this call.\n      // TODO: Implement dynamic envelope reshaping if needed\n\n      return this;\n    },\n\n    /**\n     * Get current state snapshot\n     *\n     * @returns {Object} Current voice state\n     */\n    getState() {\n      return {\n        isPlaying,\n        frequency: currentFrequency,\n        velocity: currentVelocity,\n        detuning: [...currentDetuning],\n        envelopePhase: isPlaying ? 'sustain' : 'idle' // Simplified for now\n      };\n    }\n  };\n}\n","/**\n * Saturation Effect (Tape Warmth)\n *\n * Adds gentle harmonic saturation for a warm, vintage tape-like tone.\n * Uses soft clipping to simulate tape saturation without harsh distortion.\n *\n * Features:\n * - Soft clipping saturation\n * - Tone control (adjustable harmonic character)\n * - Input/output gain control\n * - Smooth parameter automation\n *\n * @module audio/effects/saturation\n */\n\nimport { getAudioContext } from '../context.js';\n\nconst DEFAULT_AMOUNT = 0.3; // 0-1, how much saturation\nconst DEFAULT_TONE = 0.5; // 0-1, brightness of saturation\nconst MIN_FREQUENCY = 100; // Hz\nconst MAX_FREQUENCY = 10000; // Hz\n\n/**\n * Creates a soft-clipping saturation effect for warm tone\n *\n * @param {Object} options - Configuration options\n * @param {number} [options.amount=0.3] - Saturation amount (0-1)\n * @param {number} [options.tone=0.5] - Tone color (0-1, dark to bright)\n * @param {number} [options.dryWet=1] - Dry/wet balance (0=dry, 1=wet)\n * @returns {Object} Saturation effect instance\n * @throws {Error} If parameters are out of valid range\n */\nexport function createSaturation(options = {}) {\n  const ctx = getAudioContext();\n  const {\n    amount = DEFAULT_AMOUNT,\n    tone = DEFAULT_TONE,\n    dryWet = 1\n  } = options;\n\n  // Validate inputs\n  if (amount < 0 || amount > 1) {\n    throw new Error(`Saturation amount out of range: ${amount}. Valid range: 0-1`);\n  }\n\n  if (tone < 0 || tone > 1) {\n    throw new Error(`Saturation tone out of range: ${tone}. Valid range: 0-1`);\n  }\n\n  if (dryWet < 0 || dryWet > 1) {\n    throw new Error(`Dry/wet balance out of range: ${dryWet}. Valid range: 0-1`);\n  }\n\n  // Input gain control\n  const inputGain = ctx.createGain();\n  inputGain.gain.value = 1 + amount * 2; // Increase gain based on saturation amount\n\n  // Dry signal path\n  const dryGain = ctx.createGain();\n  dryGain.gain.value = 1 - dryWet;\n\n  // Wet signal path with saturation\n  const wetGain = ctx.createGain();\n  wetGain.gain.value = dryWet;\n\n  // Tone shaping (high-pass filter to control brightness)\n  const toneFilter = ctx.createBiquadFilter();\n  toneFilter.type = 'highshelf';\n  toneFilter.frequency.value = MIN_FREQUENCY + tone * (MAX_FREQUENCY - MIN_FREQUENCY);\n  toneFilter.gain.value = -10 + tone * 20; // -10dB to +10dB\n\n  // Output gain\n  const outputGain = ctx.createGain();\n  outputGain.gain.value = 1 / (1 + amount * 2); // Compensate for input gain\n\n  // Internal state\n  let currentAmount = amount;\n  let currentTone = tone;\n  let currentDryWet = dryWet;\n\n  /**\n   * Soft clipping saturation curve\n   * Uses tanh-like curve for smooth saturation\n   *\n   * @private\n   * @param {Float32Array} buffer - Audio buffer to process\n   * @param {number} intensity - Saturation intensity (0-1)\n   */\n  function applySoftClipping(buffer, intensity) {\n    const factor = 1 + intensity * 50; // Scale factor for saturation curve\n\n    for (let i = 0; i < buffer.length; i++) {\n      const sample = buffer[i];\n      // Soft clipping curve: tanh-like behavior\n      buffer[i] = (sample * factor) / (1 + Math.abs(sample * factor));\n    }\n  }\n\n  // Create a local offline context for saturation processing (if needed)\n  // For now, saturation is applied in real-time via ScriptProcessorNode\n  const processor = ctx.createScriptProcessor(4096, 1, 1);\n\n  processor.onaudioprocess = (event) => {\n    const input = event.inputBuffer.getChannelData(0);\n    const output = event.outputBuffer.getChannelData(0);\n\n    // Apply soft clipping saturation\n    applySoftClipping(input, currentAmount);\n\n    // Copy processed audio to output\n    for (let i = 0; i < input.length; i++) {\n      output[i] = input[i];\n    }\n  };\n\n  // Connect audio graph\n  // Input → Input Gain → (Dry Path & Tone-shaped Path) → Output Gain → Output\n  inputGain.connect(dryGain);\n  inputGain.connect(processor);\n  inputGain.connect(toneFilter);\n\n  dryGain.connect(outputGain);\n  processor.connect(toneFilter);\n  toneFilter.connect(wetGain);\n  wetGain.connect(outputGain);\n\n  // Public interface\n  return {\n    // Audio nodes for routing\n    get input() {\n      return inputGain;\n    },\n\n    get output() {\n      return outputGain;\n    },\n\n    // State getters\n    getAmount() {\n      return currentAmount;\n    },\n\n    getTone() {\n      return currentTone;\n    },\n\n    getDryWet() {\n      return currentDryWet;\n    },\n\n    /**\n     * Set saturation amount\n     *\n     * @param {number} newAmount - Saturation amount (0-1)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If amount is out of valid range\n     */\n    setAmount(newAmount) {\n      if (newAmount < 0 || newAmount > 1) {\n        throw new Error(`Saturation amount out of range: ${newAmount}. Valid range: 0-1`);\n      }\n\n      currentAmount = newAmount;\n      const now = ctx.currentTime;\n\n      // Smooth gain changes\n      const newGainValue = 1 + newAmount * 2;\n      inputGain.gain.linearRampToValueAtTime(newGainValue, now + 0.05);\n      outputGain.gain.linearRampToValueAtTime(1 / newGainValue, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set tone (brightness of saturation)\n     *\n     * @param {number} newTone - Tone control (0=dark, 1=bright)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If tone is out of valid range\n     */\n    setTone(newTone) {\n      if (newTone < 0 || newTone > 1) {\n        throw new Error(`Saturation tone out of range: ${newTone}. Valid range: 0-1`);\n      }\n\n      currentTone = newTone;\n      const now = ctx.currentTime;\n\n      // Smooth tone filter changes\n      const newFrequency = MIN_FREQUENCY + newTone * (MAX_FREQUENCY - MIN_FREQUENCY);\n      const newGain = -10 + newTone * 20;\n\n      toneFilter.frequency.linearRampToValueAtTime(newFrequency, now + 0.05);\n      toneFilter.gain.linearRampToValueAtTime(newGain, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set dry/wet balance\n     *\n     * @param {number} newDryWet - Balance (0=dry only, 1=wet only)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If balance is out of valid range\n     */\n    setDryWet(newDryWet) {\n      if (newDryWet < 0 || newDryWet > 1) {\n        throw new Error(`Dry/wet balance out of range: ${newDryWet}. Valid range: 0-1`);\n      }\n\n      currentDryWet = newDryWet;\n      const now = ctx.currentTime;\n\n      dryGain.gain.linearRampToValueAtTime(1 - newDryWet, now + 0.05);\n      wetGain.gain.linearRampToValueAtTime(newDryWet, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Connect saturation to input source\n     *\n     * @param {AudioNode} source - Source to connect from\n     * @returns {Object} this (for chaining)\n     */\n    connect(source) {\n      source.connect(this.input);\n      return this;\n    },\n\n    /**\n     * Disconnect saturation effect\n     *\n     * @returns {Object} this (for chaining)\n     */\n    disconnect() {\n      inputGain.disconnect();\n      dryGain.disconnect();\n      wetGain.disconnect();\n      processor.disconnect();\n      toneFilter.disconnect();\n      outputGain.disconnect();\n      return this;\n    },\n\n    /**\n     * Get current effect state\n     *\n     * @returns {Object} Effect state\n     */\n    getState() {\n      return {\n        amount: currentAmount,\n        tone: currentTone,\n        dryWet: currentDryWet\n      };\n    }\n  };\n}\n","/**\n * Dynamic Range Compressor\n *\n * Reduces dynamic range to keep audio levels consistent.\n * Essential for controlling piano dynamics and achieving cohesive mix.\n *\n * Features:\n * - Threshold, ratio, attack, release controls\n * - Makeup gain to compensate for reduction\n * - Look-ahead mode for smoother compression\n * - Dry/wet mixing\n *\n * @module audio/effects/compression\n */\n\nimport { getAudioContext } from '../context.js';\n\nconst DEFAULT_THRESHOLD = -24; // dB\nconst DEFAULT_RATIO = 4; // 4:1 compression\nconst DEFAULT_ATTACK = 0.003; // seconds (3ms for piano)\nconst DEFAULT_RELEASE = 0.25; // seconds\nconst DEFAULT_KNEE = 30; // dB (soft knee)\n\n/**\n * Creates a dynamic range compressor effect\n *\n * @param {Object} options - Configuration options\n * @param {number} [options.threshold=-24] - Threshold in dB\n * @param {number} [options.ratio=4] - Compression ratio (1:ratio)\n * @param {number} [options.attack=0.003] - Attack time in seconds\n * @param {number} [options.release=0.25] - Release time in seconds\n * @param {number} [options.knee=30] - Knee in dB (soft knee range)\n * @param {number} [options.dryWet=1] - Dry/wet balance (0-1)\n * @returns {Object} Compressor instance\n * @throws {Error} If parameters are out of valid range\n */\nexport function createCompressor(options = {}) {\n  const ctx = getAudioContext();\n  const {\n    threshold = DEFAULT_THRESHOLD,\n    ratio = DEFAULT_RATIO,\n    attack = DEFAULT_ATTACK,\n    release = DEFAULT_RELEASE,\n    knee = DEFAULT_KNEE,\n    dryWet = 1\n  } = options;\n\n  // Validate inputs\n  if (threshold < -100 || threshold > 0) {\n    throw new Error(`Compressor threshold out of range: ${threshold} dB. Valid range: -100 to 0 dB`);\n  }\n\n  if (ratio < 1 || ratio > 20) {\n    throw new Error(`Compression ratio out of range: ${ratio}. Valid range: 1-20`);\n  }\n\n  if (attack < 0 || attack > 1) {\n    throw new Error(`Attack time out of range: ${attack}s. Valid range: 0-1s`);\n  }\n\n  if (release < 0 || release > 2) {\n    throw new Error(`Release time out of range: ${release}s. Valid range: 0-2s`);\n  }\n\n  if (dryWet < 0 || dryWet > 1) {\n    throw new Error(`Dry/wet balance out of range: ${dryWet}. Valid range: 0-1`);\n  }\n\n  // Create dynamic compressor node\n  const compressor = ctx.createDynamicsCompressor();\n  compressor.threshold.value = threshold;\n  compressor.ratio.value = ratio;\n  compressor.attack.value = attack;\n  compressor.release.value = release;\n  compressor.knee.value = knee;\n\n  // Dry/wet mixing\n  const dryGain = ctx.createGain();\n  dryGain.gain.value = 1 - dryWet;\n\n  const wetGain = ctx.createGain();\n  wetGain.gain.value = dryWet;\n\n  // Makeup gain to compensate for reduction\n  const makeupGain = ctx.createGain();\n  makeupGain.gain.value = 1; // Will be calculated based on threshold and ratio\n\n  // Master gain\n  const inputGain = ctx.createGain();\n  inputGain.gain.value = 1;\n\n  const outputGain = ctx.createGain();\n  outputGain.gain.value = 1;\n\n  // Internal state\n  let currentThreshold = threshold;\n  let currentRatio = ratio;\n  let currentAttack = attack;\n  let currentRelease = release;\n  let currentDryWet = dryWet;\n\n  /**\n   * Calculate makeup gain to compensate for compression reduction\n   * @private\n   */\n  function calculateMakeupGain() {\n    // Simplified makeup gain calculation\n    // For a given reduction, apply opposite gain\n    const maxReduction = currentThreshold * (1 - 1 / currentRatio);\n    return Math.abs(maxReduction) / 20; // Convert dB to linear\n  }\n\n  // Connect audio graph\n  inputGain.connect(dryGain);\n  inputGain.connect(compressor);\n\n  compressor.connect(makeupGain);\n  makeupGain.connect(wetGain);\n\n  dryGain.connect(outputGain);\n  wetGain.connect(outputGain);\n\n  // Public interface\n  return {\n    // Audio nodes for routing\n    get input() {\n      return inputGain;\n    },\n\n    get output() {\n      return outputGain;\n    },\n\n    // Compressor node (for advanced inspection)\n    get compressorNode() {\n      return compressor;\n    },\n\n    // State getters\n    getThreshold() {\n      return currentThreshold;\n    },\n\n    getRatio() {\n      return currentRatio;\n    },\n\n    getAttack() {\n      return currentAttack;\n    },\n\n    getRelease() {\n      return currentRelease;\n    },\n\n    getDryWet() {\n      return currentDryWet;\n    },\n\n    getReduction() {\n      // Returns current reduction in dB (read from compressor)\n      return compressor.reduction;\n    },\n\n    /**\n     * Set compression threshold\n     *\n     * @param {number} newThreshold - Threshold in dB (-100 to 0)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If threshold is out of valid range\n     */\n    setThreshold(newThreshold) {\n      if (newThreshold < -100 || newThreshold > 0) {\n        throw new Error(`Compressor threshold out of range: ${newThreshold} dB. Valid range: -100 to 0 dB`);\n      }\n\n      currentThreshold = newThreshold;\n      const now = ctx.currentTime;\n\n      compressor.threshold.linearRampToValueAtTime(newThreshold, now + 0.05);\n      makeupGain.gain.linearRampToValueAtTime(calculateMakeupGain(), now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set compression ratio\n     *\n     * @param {number} newRatio - Ratio (1:newRatio)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If ratio is out of valid range\n     */\n    setRatio(newRatio) {\n      if (newRatio < 1 || newRatio > 20) {\n        throw new Error(`Compression ratio out of range: ${newRatio}. Valid range: 1-20`);\n      }\n\n      currentRatio = newRatio;\n      const now = ctx.currentTime;\n\n      compressor.ratio.linearRampToValueAtTime(newRatio, now + 0.05);\n      makeupGain.gain.linearRampToValueAtTime(calculateMakeupGain(), now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set attack time\n     *\n     * @param {number} newAttack - Attack time in seconds (0-1)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If attack is out of valid range\n     */\n    setAttack(newAttack) {\n      if (newAttack < 0 || newAttack > 1) {\n        throw new Error(`Attack time out of range: ${newAttack}s. Valid range: 0-1s`);\n      }\n\n      currentAttack = newAttack;\n      const now = ctx.currentTime;\n\n      compressor.attack.linearRampToValueAtTime(newAttack, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set release time\n     *\n     * @param {number} newRelease - Release time in seconds (0-2)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If release is out of valid range\n     */\n    setRelease(newRelease) {\n      if (newRelease < 0 || newRelease > 2) {\n        throw new Error(`Release time out of range: ${newRelease}s. Valid range: 0-2s`);\n      }\n\n      currentRelease = newRelease;\n      const now = ctx.currentTime;\n\n      compressor.release.linearRampToValueAtTime(newRelease, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set dry/wet balance\n     *\n     * @param {number} newDryWet - Balance (0=dry, 1=wet)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If balance is out of valid range\n     */\n    setDryWet(newDryWet) {\n      if (newDryWet < 0 || newDryWet > 1) {\n        throw new Error(`Dry/wet balance out of range: ${newDryWet}. Valid range: 0-1`);\n      }\n\n      currentDryWet = newDryWet;\n      const now = ctx.currentTime;\n\n      dryGain.gain.linearRampToValueAtTime(1 - newDryWet, now + 0.05);\n      wetGain.gain.linearRampToValueAtTime(newDryWet, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Connect compressor to input\n     *\n     * @param {AudioNode} source - Source to connect from\n     * @returns {Object} this (for chaining)\n     */\n    connect(source) {\n      source.connect(this.input);\n      return this;\n    },\n\n    /**\n     * Disconnect compressor\n     *\n     * @returns {Object} this (for chaining)\n     */\n    disconnect() {\n      inputGain.disconnect();\n      dryGain.disconnect();\n      wetGain.disconnect();\n      compressor.disconnect();\n      makeupGain.disconnect();\n      outputGain.disconnect();\n      return this;\n    },\n\n    /**\n     * Get current effect state\n     *\n     * @returns {Object} Effect state\n     */\n    getState() {\n      return {\n        threshold: currentThreshold,\n        ratio: currentRatio,\n        attack: currentAttack,\n        release: currentRelease,\n        dryWet: currentDryWet,\n        currentReduction: this.getReduction()\n      };\n    }\n  };\n}\n","/**\n * Reverb Effect (Space & Ambience)\n *\n * Creates a simple reverb effect to add space and vintage character.\n * Uses a combination of delays to simulate room reflections.\n *\n * Features:\n * - Room size control\n * - Decay time control\n * - Pre-delay for realism\n * - Dry/wet mixing\n * - Simple convolver-based approach\n *\n * @module audio/effects/reverb\n */\n\nimport { getAudioContext } from '../context.js';\n\nconst DEFAULT_DECAY_TIME = 2.0; // seconds\nconst DEFAULT_ROOM_SIZE = 0.5; // 0-1\nconst DEFAULT_PRE_DELAY = 0.02; // 20ms\nconst DEFAULT_DRY_WET = 0.3; // Subtle reverb\n\n/**\n * Creates a reverb effect for space and ambience\n *\n * @param {Object} options - Configuration options\n * @param {number} [options.decayTime=2.0] - Reverb decay time in seconds\n * @param {number} [options.roomSize=0.5] - Room size (0-1, small to large)\n * @param {number} [options.preDelay=0.02] - Pre-delay before reverb in seconds\n * @param {number} [options.dryWet=0.3] - Dry/wet balance (0-1)\n * @returns {Object} Reverb instance\n * @throws {Error} If parameters are out of valid range\n */\nexport function createReverb(options = {}) {\n  const ctx = getAudioContext();\n  const {\n    decayTime = DEFAULT_DECAY_TIME,\n    roomSize = DEFAULT_ROOM_SIZE,\n    preDelay = DEFAULT_PRE_DELAY,\n    dryWet = DEFAULT_DRY_WET\n  } = options;\n\n  // Validate inputs\n  if (decayTime < 0.1 || decayTime > 10) {\n    throw new Error(`Decay time out of range: ${decayTime}s. Valid range: 0.1-10s`);\n  }\n\n  if (roomSize < 0 || roomSize > 1) {\n    throw new Error(`Room size out of range: ${roomSize}. Valid range: 0-1`);\n  }\n\n  if (preDelay < 0 || preDelay > 1) {\n    throw new Error(`Pre-delay out of range: ${preDelay}s. Valid range: 0-1s`);\n  }\n\n  if (dryWet < 0 || dryWet > 1) {\n    throw new Error(`Dry/wet balance out of range: ${dryWet}. Valid range: 0-1`);\n  }\n\n  // Input stage\n  const inputGain = ctx.createGain();\n  inputGain.gain.value = 1;\n\n  // Dry signal path\n  const dryGain = ctx.createGain();\n  dryGain.gain.value = 1 - dryWet;\n\n  // Wet signal path (reverb)\n  const wetGain = ctx.createGain();\n  wetGain.gain.value = dryWet;\n\n  // Pre-delay\n  const preDelayNode = ctx.createDelay(5); // Max 5 second delay\n  preDelayNode.delayTime.value = preDelay;\n\n  // Create multi-tap delay for reverb simulation\n  // Using multiple delays at different times to simulate room reflections\n  const delays = [];\n  const delayTimes = [0.037, 0.041, 0.043, 0.047]; // Prime numbers for natural sound\n  const delayGains = [];\n\n  delayTimes.forEach((time) => {\n    const delay = ctx.createDelay(time + 0.1);\n    delay.delayTime.value = time * roomSize; // Scale by room size\n    delays.push(delay);\n\n    const gain = ctx.createGain();\n    // Feedback to create decay\n    gain.gain.value = Math.pow(0.5, time / decayTime);\n    delayGains.push(gain);\n  });\n\n  // Feedback paths for extended reverb\n  const feedbackGain = ctx.createGain();\n  feedbackGain.gain.value = roomSize * 0.5;\n\n  // Tone control for reverb (low-pass filter to darken reflections)\n  const toneFilter = ctx.createBiquadFilter();\n  toneFilter.type = 'lowpass';\n  toneFilter.frequency.value = 5000; // Darken the reverb tail\n  toneFilter.Q.value = 0.7;\n\n  // Output stage\n  const outputGain = ctx.createGain();\n  outputGain.gain.value = 1;\n\n  // Internal state\n  let currentDecayTime = decayTime;\n  let currentRoomSize = roomSize;\n  let currentPreDelay = preDelay;\n  let currentDryWet = dryWet;\n\n  // Audio graph connections\n  inputGain.connect(dryGain);\n  inputGain.connect(preDelayNode);\n\n  // Delay chain with feedback\n  preDelayNode.connect(delays[0]);\n  for (let i = 0; i < delays.length; i++) {\n    delays[i].connect(delayGains[i]);\n    delayGains[i].connect(toneFilter);\n\n    // Create feedback loop (except for last delay)\n    if (i < delays.length - 1) {\n      delayGains[i].connect(delays[i + 1]);\n    }\n  }\n\n  // Final reverb path\n  toneFilter.connect(feedbackGain);\n  feedbackGain.connect(preDelayNode); // Feedback into reverb\n  toneFilter.connect(wetGain);\n\n  // Mix dry and wet\n  dryGain.connect(outputGain);\n  wetGain.connect(outputGain);\n\n  // Public interface\n  return {\n    // Audio nodes for routing\n    get input() {\n      return inputGain;\n    },\n\n    get output() {\n      return outputGain;\n    },\n\n    // State getters\n    getDecayTime() {\n      return currentDecayTime;\n    },\n\n    getRoomSize() {\n      return currentRoomSize;\n    },\n\n    getPreDelay() {\n      return currentPreDelay;\n    },\n\n    getDryWet() {\n      return currentDryWet;\n    },\n\n    /**\n     * Set reverb decay time\n     *\n     * @param {number} newDecayTime - Decay time in seconds (0.1-10)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If decay time is out of valid range\n     */\n    setDecayTime(newDecayTime) {\n      if (newDecayTime < 0.1 || newDecayTime > 10) {\n        throw new Error(`Decay time out of range: ${newDecayTime}s. Valid range: 0.1-10s`);\n      }\n\n      currentDecayTime = newDecayTime;\n      const now = ctx.currentTime;\n\n      // Update feedback gains based on new decay time\n      delayGains.forEach((gain, index) => {\n        const newGainValue = Math.pow(0.5, delayTimes[index] / newDecayTime);\n        gain.gain.linearRampToValueAtTime(newGainValue, now + 0.1);\n      });\n\n      return this;\n    },\n\n    /**\n     * Set room size\n     *\n     * @param {number} newRoomSize - Room size (0-1, small to large)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If room size is out of valid range\n     */\n    setRoomSize(newRoomSize) {\n      if (newRoomSize < 0 || newRoomSize > 1) {\n        throw new Error(`Room size out of range: ${newRoomSize}. Valid range: 0-1`);\n      }\n\n      currentRoomSize = newRoomSize;\n      const now = ctx.currentTime;\n\n      // Update delay times based on room size\n      delays.forEach((delay, index) => {\n        const newDelayTime = delayTimes[index] * newRoomSize;\n        delay.delayTime.linearRampToValueAtTime(newDelayTime, now + 0.05);\n      });\n\n      // Update feedback\n      feedbackGain.gain.linearRampToValueAtTime(newRoomSize * 0.5, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set pre-delay\n     *\n     * @param {number} newPreDelay - Pre-delay in seconds (0-1)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If pre-delay is out of valid range\n     */\n    setPreDelay(newPreDelay) {\n      if (newPreDelay < 0 || newPreDelay > 1) {\n        throw new Error(`Pre-delay out of range: ${newPreDelay}s. Valid range: 0-1s`);\n      }\n\n      currentPreDelay = newPreDelay;\n      const now = ctx.currentTime;\n\n      preDelayNode.delayTime.linearRampToValueAtTime(newPreDelay, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set dry/wet balance\n     *\n     * @param {number} newDryWet - Balance (0=dry, 1=wet)\n     * @returns {Object} this (for chaining)\n     * @throws {Error} If balance is out of valid range\n     */\n    setDryWet(newDryWet) {\n      if (newDryWet < 0 || newDryWet > 1) {\n        throw new Error(`Dry/wet balance out of range: ${newDryWet}. Valid range: 0-1`);\n      }\n\n      currentDryWet = newDryWet;\n      const now = ctx.currentTime;\n\n      dryGain.gain.linearRampToValueAtTime(1 - newDryWet, now + 0.05);\n      wetGain.gain.linearRampToValueAtTime(newDryWet, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Set reverb tone (brightness of reverb tail)\n     *\n     * @param {number} frequency - Filter frequency in Hz\n     * @returns {Object} this (for chaining)\n     */\n    setTone(frequency) {\n      if (frequency < 100 || frequency > 20000) {\n        throw new Error(`Tone frequency out of range: ${frequency} Hz`);\n      }\n\n      const now = ctx.currentTime;\n      toneFilter.frequency.linearRampToValueAtTime(frequency, now + 0.05);\n\n      return this;\n    },\n\n    /**\n     * Connect reverb to input\n     *\n     * @param {AudioNode} source - Source to connect from\n     * @returns {Object} this (for chaining)\n     */\n    connect(source) {\n      source.connect(this.input);\n      return this;\n    },\n\n    /**\n     * Disconnect reverb\n     *\n     * @returns {Object} this (for chaining)\n     */\n    disconnect() {\n      inputGain.disconnect();\n      dryGain.disconnect();\n      wetGain.disconnect();\n      preDelayNode.disconnect();\n      delays.forEach((delay) => delay.disconnect());\n      delayGains.forEach((gain) => gain.disconnect());\n      feedbackGain.disconnect();\n      toneFilter.disconnect();\n      outputGain.disconnect();\n      return this;\n    },\n\n    /**\n     * Get current effect state\n     *\n     * @returns {Object} Effect state\n     */\n    getState() {\n      return {\n        decayTime: currentDecayTime,\n        roomSize: currentRoomSize,\n        preDelay: currentPreDelay,\n        dryWet: currentDryWet\n      };\n    }\n  };\n}\n","/**\n * Audio State Management\n *\n * Manages audio state for the LoFi Piano.\n * Uses plain JavaScript objects with callback-based updates.\n * Component scripts use Svelte 5 $state to wrap these values.\n *\n * Features:\n * - Integration with audio DSP modules\n * - MIDI note to frequency conversion\n * - Preset management\n * - Parameter change callbacks\n *\n * Note: This is a plain JS module. Use $state in Svelte components\n * to make values reactive, or create a .svelte component wrapper.\n *\n * @module stores/audio-state\n */\nimport { createPianoVoice } from '../audio/synthesis/piano-voice.js';\nimport { createSaturation } from '../audio/effects/saturation.js';\nimport { createCompressor } from '../audio/effects/compression.js';\nimport { createReverb } from '../audio/effects/reverb.js';\nimport { getAudioContext } from '../audio/context.js';\n\n/**\n * Create the global audio state object with integrated DSP\n *\n * @returns {Object} Audio state with reactive properties and audio nodes\n */\nexport function createAudioState() {\n  // Audio context and nodes\n  let audioContext = null;\n  let pianoVoices = new Map(); // Active voices keyed by MIDI note\n  let saturationEffect = null;\n  let compressionEffect = null;\n  let reverbEffect = null;\n  let masterGain = null;\n\n  // Piano state - plain JS object (wrap in $state in components)\n  const pianoState = {\n    isPlaying: false,\n    activeNotes: new Set(),\n    masterVolume: 0.5,\n    presetIndex: 0,\n    isInitialized: false\n  };\n\n  // Synthesis parameters (for new voices)\n  const synthesis = {\n    frequency: 440,\n    detune: [0, 15, -20],\n    velocity: 100,\n    attackTime: 0.05,\n    decayTime: 0.2,\n    sustainLevel: 0.6,\n    releaseTime: 1.0\n  };\n\n  // Effect parameters\n  const effects = {\n    saturation: {\n      amount: 0.3,\n      tone: 0.5,\n      dryWet: 1\n    },\n    compression: {\n      threshold: -24,\n      ratio: 4,\n      attack: 0.003,\n      release: 0.25,\n      dryWet: 1\n    },\n    reverb: {\n      decayTime: 2.0,\n      roomSize: 0.5,\n      preDelay: 0.02,\n      dryWet: 0.3\n    }\n  };\n\n  /**\n   * Initialize audio system\n   * Creates all audio nodes and connections\n   *\n   * @private\n   */\n  function initializeAudio() {\n    try {\n      audioContext = getAudioContext();\n      masterGain = audioContext.createGain();\n      masterGain.gain.value = pianoState.masterVolume;\n\n      // Create effect chain\n      saturationEffect = createSaturation({\n        amount: effects.saturation.amount,\n        tone: effects.saturation.tone,\n        dryWet: effects.saturation.dryWet\n      });\n\n      compressionEffect = createCompressor({\n        threshold: effects.compression.threshold,\n        ratio: effects.compression.ratio,\n        attack: effects.compression.attack,\n        release: effects.compression.release,\n        dryWet: effects.compression.dryWet\n      });\n\n      reverbEffect = createReverb({\n        decayTime: effects.reverb.decayTime,\n        roomSize: effects.reverb.roomSize,\n        preDelay: effects.reverb.preDelay,\n        dryWet: effects.reverb.dryWet\n      });\n\n      // Connect effect chain\n      saturationEffect.input.connect(compressionEffect.input);\n      compressionEffect.output.connect(reverbEffect.input);\n      reverbEffect.output.connect(masterGain);\n      masterGain.connect(audioContext.destination);\n\n      pianoState.isInitialized = true;\n    } catch (error) {\n      console.error('Failed to initialize audio:', error);\n      pianoState.isInitialized = false;\n    }\n  }\n\n  /**\n   * Ensure audio system is ready\n   * @private\n   */\n  function ensureAudioInitialized() {\n    if (!pianoState.isInitialized) {\n      initializeAudio();\n    }\n  }\n\n  /**\n   * Sync parameter changes to audio nodes\n   * These are called from component $effects when values change\n   */\n  function syncSaturation() {\n    if (!pianoState.isInitialized || !saturationEffect) return;\n    saturationEffect.setAmount(effects.saturation.amount);\n    saturationEffect.setTone(effects.saturation.tone);\n  }\n\n  function syncCompression() {\n    if (!pianoState.isInitialized || !compressionEffect) return;\n    compressionEffect.setThreshold(effects.compression.threshold);\n    compressionEffect.setRatio(effects.compression.ratio);\n    compressionEffect.setAttack(effects.compression.attack);\n    compressionEffect.setRelease(effects.compression.release);\n  }\n\n  function syncReverb() {\n    if (!pianoState.isInitialized || !reverbEffect) return;\n    reverbEffect.setDecay(effects.reverb.decayTime);\n    reverbEffect.setRoomSize(effects.reverb.roomSize);\n  }\n\n  function syncMasterVolume() {\n    if (!pianoState.isInitialized || !masterGain) return;\n    masterGain.gain.setValueAtTime(pianoState.masterVolume, getAudioContext().currentTime);\n  }\n\n  // Component $effects will call sync methods when values change\n\n  return {\n    // State objects\n    pianoState,\n    synthesis,\n    effects,\n\n    // Sync methods for $effects in components\n    syncSaturation,\n    syncCompression,\n    syncReverb,\n    syncMasterVolume,\n\n    /**\n     * Initialize audio system\n     * Must be called before playing notes\n     *\n     * @returns {Promise<void>}\n     */\n    async init() {\n      ensureAudioInitialized();\n    },\n\n    /**\n     * Play a piano note\n     *\n     * @param {number} note - MIDI note (0-127)\n     * @param {number} [velocity=100] - Velocity (0-127)\n     * @param {number} [duration] - Optional duration in ms\n     */\n    playNote(note, velocity = 100, duration = null) {\n      ensureAudioInitialized();\n\n      // Clamp note to valid MIDI range\n      const validNote = Math.max(0, Math.min(127, note));\n      const freq = noteToFrequency(validNote);\n\n      // Create new voice\n      const voice = createPianoVoice({\n        frequency: freq,\n        velocity: velocity,\n        attackTime: synthesis.attackTime,\n        decayTime: synthesis.decayTime,\n        sustainLevel: synthesis.sustainLevel,\n        releaseTime: synthesis.releaseTime,\n        detuneCents: synthesis.detune,\n        velocityScale: 0.3\n      });\n\n      // Connect voice to effect chain\n      voice.connect(saturationEffect.input);\n\n      // Start the note\n      voice.noteOn();\n\n      // Store voice reference\n      pianoVoices.set(validNote, voice);\n      pianoState.activeNotes.add(validNote);\n      pianoState.isPlaying = pianoState.activeNotes.size > 0;\n\n      // Optional: Stop note after duration\n      if (duration) {\n        setTimeout(() => {\n          this.stopNote(validNote);\n        }, duration);\n      }\n    },\n\n    /**\n     * Stop a piano note\n     *\n     * @param {number} note - MIDI note to stop (0-127)\n     */\n    stopNote(note) {\n      const validNote = Math.max(0, Math.min(127, note));\n      const voice = pianoVoices.get(validNote);\n\n      if (voice) {\n        voice.noteOff();\n\n        // Remove voice after release time\n        setTimeout(() => {\n          voice.disconnect();\n          pianoVoices.delete(validNote);\n        }, synthesis.releaseTime * 1000);\n      }\n\n      pianoState.activeNotes.delete(validNote);\n      pianoState.isPlaying = pianoState.activeNotes.size > 0;\n    },\n\n    /**\n     * Stop all active notes\n     */\n    stopAll() {\n      Array.from(pianoState.activeNotes).forEach((note) => {\n        this.stopNote(note);\n      });\n    },\n\n    /**\n     * Set a parameter value by path\n     *\n     * @param {string} path - Parameter path (e.g., \"effects.saturation.amount\")\n     * @param {number} value - New value\n     */\n    setParameter(path, value) {\n      const keys = path.split('.');\n      let obj = this;\n\n      // Navigate to parent object\n      for (let i = 0; i < keys.length - 1; i++) {\n        if (keys[i] in obj) {\n          obj = obj[keys[i]];\n        } else {\n          console.warn(`Parameter path not found: ${path}`);\n          return;\n        }\n      }\n\n      // Set the value\n      const lastKey = keys[keys.length - 1];\n      if (lastKey in obj) {\n        obj[lastKey] = value;\n      } else {\n        console.warn(`Parameter not found: ${path}`);\n      }\n    },\n\n    /**\n     * Get audio node for advanced routing\n     *\n     * @param {string} nodeName - Node name (saturation, compression, reverb, masterGain)\n     * @returns {AudioNode|null} Audio node or null\n     */\n    getAudioNode(nodeName) {\n      const nodes = {\n        saturation: saturationEffect?.output,\n        compression: compressionEffect?.output,\n        reverb: reverbEffect?.output,\n        masterGain: masterGain,\n        saturationInput: saturationEffect?.input,\n        compressionInput: compressionEffect?.input,\n        reverbInput: reverbEffect?.input\n      };\n\n      return nodes[nodeName] || null;\n    },\n\n    /**\n     * Get state snapshot of all effects and synthesis\n     *\n     * @returns {Object} Current state\n     */\n    getState() {\n      return {\n        pianoState: { ...pianoState },\n        synthesis: { ...synthesis },\n        effects: JSON.parse(JSON.stringify(effects)),\n        audioInitialized: pianoState.isInitialized\n      };\n    }\n  };\n}\n\n/**\n * Convert MIDI note to frequency\n * @param {number} note - MIDI note (0-127)\n * @returns {number} Frequency in Hz\n */\nexport function noteToFrequency(note) {\n  // A4 (MIDI note 69) = 440 Hz\n  return 440 * Math.pow(2, (note - 69) / 12);\n}\n\n/**\n * Convert frequency to MIDI note\n * @param {number} frequency - Frequency in Hz\n * @returns {number} MIDI note (0-127)\n */\nexport function frequencyToNote(frequency) {\n  return Math.round(69 + 12 * Math.log2(frequency / 440));\n}\n\n/**\n * Singleton instance\n */\nexport const audioState = createAudioState();\n","<script>\n  /**\n   * PianoKeyboard Component\n   *\n   * A full 88-key piano keyboard UI with:\n   * - Mouse and touch support\n   * - MIDI note playback integration\n   * - Visual feedback for active keys\n   * - Octave range control\n   * - Keyboard integration (QWERTY playing)\n   *\n   * @component\n   */\n\n  import { onMount } from 'svelte';\n\n  /**\n   * Component props using Svelte 5 $props()\n   */\n  let {\n    audioState = undefined,\n    startNote = 12,\n    keyCount = 88,\n    showNoteNames = true,\n    showOctaveNumbers = true\n  } = $props();\n\n  let keyboardElement = $state();\n  let isMouseDown = $state(false);\n  let activeKeys = $state(new Map()); // Map of MIDI note -> element\n  let keyboardMapping = createKeyboardMapping();\n\n  // Musical note names (C to B)\n  const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n\n  /**\n   * Create keyboard key to MIDI note mapping\n   * Allows playing piano with QWERTY keyboard\n   *\n   * @private\n   * @returns {Object} Mapping of keyboard keys to MIDI notes\n   */\n  function createKeyboardMapping() {\n    // QWERTY layout for two octaves starting at C\n    return {\n      'z': 48, // C3\n      's': 49, // C#3\n      'x': 50, // D3\n      'd': 51, // D#3\n      'c': 52, // E3\n      'v': 53, // F3\n      'g': 54, // F#3\n      'b': 55, // G3\n      'h': 56, // G#3\n      'n': 57, // A3\n      'j': 58, // A#3\n      'm': 59, // B3\n      ',': 60, // C4 (middle C)\n      'l': 61, // C#4\n      '.': 62, // D4\n      ';': 63, // D#4\n      '/': 64  // E4\n    };\n  }\n\n  /**\n   * Get note name and octave for MIDI note\n   *\n   * @private\n   * @param {number} midiNote - MIDI note number (0-127)\n   * @returns {Object} { name: string, octave: number }\n   */\n  function getNoteInfo(midiNote) {\n    const octave = Math.floor(midiNote / 12) - 1;\n    const noteName = noteNames[midiNote % 12];\n    return { name: noteName, octave };\n  }\n\n  /**\n   * Check if note is black key\n   *\n   * @private\n   * @param {number} midiNote - MIDI note number\n   * @returns {boolean} True if black key\n   */\n  function isBlackKey(midiNote) {\n    const noteInOctave = midiNote % 12;\n    return [1, 3, 6, 8, 10].includes(noteInOctave);\n  }\n\n  /**\n   * Handle mouse/touch down on key\n   *\n   * @private\n   */\n  function handleKeyDown(e) {\n    if (!audioState) return;\n\n    const midiNote = parseInt(e.currentTarget.dataset.note);\n    const velocity = 100;\n\n    audioState.playNote(midiNote, velocity);\n    activeKeys.set(midiNote, e.currentTarget);\n    e.currentTarget.classList.add('active');\n    isMouseDown = true;\n  }\n\n  /**\n   * Handle mouse/touch up on key\n   *\n   * @private\n   */\n  function handleKeyUp(e) {\n    if (!audioState) return;\n\n    const midiNote = parseInt(e.currentTarget.dataset.note);\n\n    audioState.stopNote(midiNote);\n    activeKeys.delete(midiNote);\n    e.currentTarget.classList.remove('active');\n  }\n\n  /**\n   * Handle mouse entering a key while held down\n   *\n   * @private\n   */\n  function handleMouseEnter(e) {\n    if (!isMouseDown || !audioState) return;\n\n    const midiNote = parseInt(e.currentTarget.dataset.note);\n    const velocity = 100;\n\n    // Only trigger if not already active\n    if (!activeKeys.has(midiNote)) {\n      audioState.playNote(midiNote, velocity);\n      activeKeys.set(midiNote, e.currentTarget);\n      e.currentTarget.classList.add('active');\n    }\n  }\n\n  /**\n   * Handle mouse leaving a key while held down\n   *\n   * @private\n   */\n  function handleMouseLeave(e) {\n    if (!isMouseDown || !audioState) return;\n\n    const midiNote = parseInt(e.currentTarget.dataset.note);\n\n    if (activeKeys.has(midiNote)) {\n      audioState.stopNote(midiNote);\n      activeKeys.delete(midiNote);\n      e.currentTarget.classList.remove('active');\n    }\n  }\n\n  /**\n   * Handle keyboard input (QWERTY piano keys)\n   *\n   * @private\n   */\n  function handleWindowKeyDown(e) {\n    if (!audioState) return;\n\n    const key = e.key.toLowerCase();\n    const midiNote = keyboardMapping[key];\n\n    if (midiNote && !e.repeat) {\n      const velocity = 100;\n      audioState.playNote(midiNote, velocity);\n      activeKeys.set(midiNote, document.querySelector(`[data-note=\"${midiNote}\"]`));\n\n      // Add visual feedback\n      const element = document.querySelector(`[data-note=\"${midiNote}\"]`);\n      if (element) {\n        element.classList.add('active');\n      }\n    }\n  }\n\n  /**\n   * Handle keyboard release (QWERTY piano keys)\n   *\n   * @private\n   */\n  function handleWindowKeyUp(e) {\n    if (!audioState) return;\n\n    const key = e.key.toLowerCase();\n    const midiNote = keyboardMapping[key];\n\n    if (midiNote) {\n      audioState.stopNote(midiNote);\n      activeKeys.delete(midiNote);\n\n      // Remove visual feedback\n      const element = document.querySelector(`[data-note=\"${midiNote}\"]`);\n      if (element) {\n        element.classList.remove('active');\n      }\n    }\n  }\n\n  /**\n   * Stop all notes when component unmounts\n   *\n   * @private\n   */\n  function cleanup() {\n    if (audioState) {\n      audioState.stopAll();\n      activeKeys.clear();\n    }\n\n    document.removeEventListener('keydown', handleWindowKeyDown);\n    document.removeEventListener('keyup', handleWindowKeyUp);\n  }\n\n  onMount(() => {\n    document.addEventListener('keydown', handleWindowKeyDown);\n    document.addEventListener('keyup', handleWindowKeyUp);\n\n    return cleanup;\n  });\n\n  /**\n   * Generate array of MIDI notes for keyboard\n   *\n   * @private\n   * @returns {number[]} Array of MIDI notes\n   */\n  function generateNotes() {\n    const notes = [];\n    for (let i = 0; i < keyCount; i++) {\n      notes.push(startNote + i);\n    }\n    return notes;\n  }\n\n  const notes = generateNotes();\n</script>\n\n<div class=\"keyboard-container\" bind:this={keyboardElement}>\n  <div class=\"keyboard\">\n    {#each notes as midiNote, idx (midiNote)}\n      {@const isBlack = isBlackKey(midiNote)}\n      {@const noteInfo = getNoteInfo(midiNote)}\n      {@const noteLabel = `${noteInfo.name}${showOctaveNumbers ? noteInfo.octave : ''}`}\n\n      <button\n        class:key\n        class:white-key={!isBlack}\n        class:black-key={isBlack}\n        data-note={midiNote}\n        onmousedown={handleKeyDown}\n        onmouseup={handleKeyUp}\n        onmouseleave={handleMouseLeave}\n        onmouseenter={handleMouseEnter}\n        ontouchstart={handleKeyDown}\n        ontouchend={handleKeyUp}\n        title={`${noteLabel} (MIDI ${midiNote})`}\n        aria-label=\"Piano key {noteLabel}\"\n      >\n        {#if showNoteNames && !isBlack}\n          <span class=\"note-label\">{noteInfo.name}</span>\n          {#if showOctaveNumbers}\n            <span class=\"octave-label\">{noteInfo.octave}</span>\n          {/if}\n        {/if}\n      </button>\n    {/each}\n  </div>\n\n  <div class=\"keyboard-help\">\n    <p class=\"help-text\">🎹 Click keys or press QWERTY keys (Z-M, comma/period) to play</p>\n  </div>\n</div>\n\n<style>\n  .keyboard-container {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    padding: 1rem;\n    background: linear-gradient(135deg, var(--primary-bg) 0%, var(--surface-bg) 100%);\n    border-radius: var(--border-radius-lg);\n  }\n\n  .keyboard {\n    display: flex;\n    gap: 0;\n    justify-content: center;\n    align-items: flex-end;\n    position: relative;\n    background: var(--surface-bg);\n    padding: 1rem;\n    border-radius: var(--border-radius-md);\n    box-shadow: var(--shadow-lg);\n    overflow-x: auto;\n  }\n\n  /* White keys */\n  .key.white-key {\n    width: 60px;\n    height: 280px;\n    background: linear-gradient(to bottom, #ffffff 0%, #f5f5f5 100%);\n    border: 1px solid #ccc;\n    border-radius: 0 0 8px 8px;\n    cursor: pointer;\n    user-select: none;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: space-between;\n    padding: 8px 4px;\n    position: relative;\n    transition: all 0.05s ease;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n  }\n\n  .key.white-key:hover {\n    background: linear-gradient(to bottom, #ffffff 0%, #f0f0f0 100%);\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);\n  }\n\n  .key.white-key.active {\n    background: linear-gradient(to bottom, #f0f0f0 0%, #e0e0e0 100%);\n    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2);\n    transform: translateY(2px);\n  }\n\n  /* Black keys */\n  .key.black-key {\n    width: 36px;\n    height: 180px;\n    background: linear-gradient(to bottom, #000 0%, #1a1a1a 100%);\n    border: 1px solid #000;\n    border-radius: 0 0 6px 6px;\n    cursor: pointer;\n    user-select: none;\n    position: absolute;\n    margin-left: -18px;\n    margin-right: -18px;\n    z-index: 10;\n    transition: all 0.05s ease;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);\n  }\n\n  .key.black-key:hover {\n    background: linear-gradient(to bottom, #1a1a1a 0%, #333 100%);\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6);\n  }\n\n  .key.black-key.active {\n    background: linear-gradient(to bottom, #333 0%, #555 100%);\n    box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.2), 0 2px 4px rgba(0, 0, 0, 0.3);\n    transform: translateY(2px);\n  }\n\n  /* Note labels */\n  .note-label {\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: #333;\n    margin-top: auto;\n  }\n\n  .octave-label {\n    font-size: 0.75rem;\n    color: #666;\n    font-weight: 500;\n  }\n\n  /* Help text */\n  .keyboard-help {\n    text-align: center;\n  }\n\n  .help-text {\n    font-size: 0.875rem;\n    color: var(--text-secondary);\n    margin: 0;\n  }\n\n  /* Responsive design */\n  @media (max-width: 1024px) {\n    .key.white-key {\n      width: 45px;\n      height: 200px;\n    }\n\n    .key.black-key {\n      width: 27px;\n      height: 130px;\n      margin-left: -13.5px;\n      margin-right: -13.5px;\n    }\n\n    .note-label {\n      font-size: 0.75rem;\n    }\n\n    .octave-label {\n      font-size: 0.65rem;\n    }\n  }\n\n  @media (max-width: 640px) {\n    .key.white-key {\n      width: 35px;\n      height: 150px;\n      padding: 4px 2px;\n    }\n\n    .key.black-key {\n      width: 20px;\n      height: 100px;\n      margin-left: -10px;\n      margin-right: -10px;\n    }\n\n    .note-label {\n      font-size: 0.65rem;\n    }\n\n    .octave-label {\n      display: none;\n    }\n\n    .keyboard-help {\n      display: none;\n    }\n  }\n\n  /* Accessibility */\n  .key:focus {\n    outline: 2px solid var(--accent);\n    outline-offset: 2px;\n  }\n\n  .key:focus:not(:focus-visible) {\n    outline: none;\n  }\n\n  /* Print styles */\n  @media print {\n    .keyboard-container {\n      display: none;\n    }\n  }\n</style>\n","<script>\n  /**\n   * VintageKnob.svelte\n   *\n   * CONCEPT: Accessible rotary control component using Svelte 5 Runes\n   *\n   * DESIGN PHILOSOPHY:\n   * - Numbers-free interface: Users experience the knob visually, not numerically\n   * - Vintage aesthetic: Inspired by analog synthesizers and old audio equipment\n   * - Perceptual feedback: Arc indicator shows intensity without exact values\n   * - Full accessibility: ARIA labels, keyboard navigation, screen reader support\n   *\n   * SVELTE 5 PATTERNS USED:\n   * - $props() for destructuring component properties with defaults\n   * - $bindable() for two-way data binding on the 'value' prop\n   * - $state() for local reactive state (isDragging, ref elements)\n   * - $derived() for computed reactive values (rotation, intensity)\n   *\n   * INTERACTION PATTERNS:\n   * - Mouse/Touch: Click and drag to rotate (270° arc, not full circle)\n   * - Keyboard: Arrow keys (Up/Right = increase, Down/Left = decrease)\n   * - Relative positioning: Angle calculated from knob center\n   * - Responsive step: Quantized to 'step' prop for consistent values\n   *\n   * FEATURES:\n   * - Smooth rotation with mouse drag or touch\n   * - Keyboard support (Arrow keys for fine control)\n   * - Optional visual intensity arc\n   * - No numeric value display (perceptual design)\n   * - Accessibility-friendly (ARIA labels, keyboard navigation)\n   *\n   * IMPLEMENTATION NOTES:\n   * - Uses SVG for visual feedback (arc indicator)\n   * - Event listeners cleaned up in $effect cleanup\n   * - Knob rotates 270° (3/4 circle): -45° to 225° for visual balance\n   *\n   * USAGE:\n   * <VintageKnob\n   *   bind:value={frequency}\n   *   min={20}\n   *   max={20000}\n   *   step={10}\n   *   label=\"Frequency\"\n   *   showIntensity={true}\n   *   disabled={false}\n   * />\n   */\n\n  // ===== PROPS DESTRUCTURING (Svelte 5 $props rune) =====\n  // $props() creates a reactive proxy of component properties\n  // $bindable() marks 'value' as two-way bindable from parent: bind:value={myVar}\n  let {\n    value = $bindable(0.5),    // Current value (0-1 after normalization, but min-max in original scale)\n    min = 0,                    // Minimum boundary value\n    max = 100,                  // Maximum boundary value\n    step = 1,                   // Quantization step (e.g., 1 Hz, 0.1 dB)\n    label = 'Control',          // Display label below knob\n    showIntensity = true,       // Show arc indicator\n    disabled = false,           // Disable interaction\n    ariaLabel = label,          // Accessibility label for screen readers\n    ariaDescribedBy = null      // Optional reference to description element\n  } = $props();\n\n  // ===== LOCAL REACTIVE STATE (Svelte 5 $state rune) =====\n  // $state() creates local reactive variables that trigger reactivity when changed\n  let isDragging = $state(false);      // Tracks whether user is actively dragging\n  let knobElement = $state(null);      // Reference to DOM button element\n  let containerElement = $state(null); // Reference to DOM container div\n\n  // ===== COMPUTED REACTIVE VALUES (Svelte 5 $derived rune) =====\n  // $derived() creates reactive values that auto-update when dependencies change\n  // These are read-only and re-computed on every dependency change\n  let normalizedValue = $derived((value - min) / (max - min));  // 0-1 scale\n  let rotation = $derived(normalizedValue * 270);               // Convert 0-1 to 0-270 degrees\n  let intensity = $derived(normalizedValue);                    // Same as normalized for arc opacity\n  let arcRotation = $derived(rotation);                         // Alias for clarity in template\n\n  // ===== HELPER FUNCTIONS =====\n\n  /**\n   * Convert angle in degrees to normalized 0-1 value\n   * MATH: Clamps angle to valid 270° range and divides by 270\n   * REASON: Knob rotates 270° (3/4 circle), not full 360°\n   *\n   * @param {number} angle - Rotation angle in degrees (0-360)\n   * @returns {number} Normalized value (0-1)\n   */\n  function angleToNormalized(angle) {\n    const clampedAngle = Math.max(0, Math.min(270, angle));\n    return clampedAngle / 270;\n  }\n\n  /**\n   * Convert mouse/touch position to rotation angle\n   * MATH: Uses atan2 to calculate angle from center, adjusts for coordinate system\n   * REASON: Knob needs -45° (bottom-left) to 225° (bottom-right) mapping\n   *\n   * @param {number} clientX - Mouse X coordinate (screen space)\n   * @param {number} clientY - Mouse Y coordinate (screen space)\n   * @returns {number} Angle in degrees relative to knob center\n   */\n  function clientToAngle(clientX, clientY) {\n    if (!knobElement) return 0;\n\n    // Get knob center coordinates\n    const rect = knobElement.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n\n    // Calculate relative position\n    const dx = clientX - centerX;\n    const dy = clientY - centerY;\n\n    // atan2(y, x) gives angle in radians: 0° = right, 90° = down, -90° = up\n    let angle = Math.atan2(dy, dx) * (180 / Math.PI);\n\n    // Rotate coordinate system: shift by -45° so 0° is bottom-left\n    angle = angle - (-45);\n    if (angle < 0) angle += 360;\n\n    return angle;\n  }\n\n  /**\n   * UPDATE VALUE FROM INPUT\n   * Handles the common pattern: calculate angle → normalize → scale to min-max → quantize\n   * @param {number} clientX - Mouse/touch X\n   * @param {number} clientY - Mouse/touch Y\n   */\n  function updateValueFromPosition(clientX, clientY) {\n    const angle = clientToAngle(clientX, clientY);\n    const normalized = angleToNormalized(angle);\n    // QUANTIZATION: Round to nearest 'step' to avoid floating-point drift\n    value = Math.round((min + normalized * (max - min)) / step) * step;\n  }\n\n  // ===== MOUSE INTERACTION HANDLERS =====\n\n  /**\n   * Handle mouse down: Start dragging, attach global listeners\n   * WHY GLOBAL LISTENERS: User may move mouse fast outside knob bounds\n   * So we listen on document, not just the knob element\n   */\n  function handleMouseDown(e) {\n    if (disabled) return;\n    isDragging = true;\n    updateValueFromPosition(e.clientX, e.clientY);\n    // Global listeners persist until user releases mouse\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n  }\n\n  /**\n   * Handle mouse move while dragging\n   * Updates value in real-time as user drags\n   */\n  function handleMouseMove(e) {\n    if (!isDragging) return;\n    e.preventDefault();\n    updateValueFromPosition(e.clientX, e.clientY);\n  }\n\n  /**\n   * Handle mouse up: Stop dragging, remove global listeners\n   */\n  function handleMouseUp() {\n    isDragging = false;\n    document.removeEventListener('mousemove', handleMouseMove);\n    document.removeEventListener('mouseup', handleMouseUp);\n  }\n\n  // ===== KEYBOARD INTERACTION HANDLER =====\n\n  /**\n   * Handle keyboard input for accessible control\n   * Up/Right = increase by step\n   * Down/Left = decrease by step\n   * e.preventDefault() stops browser from scrolling page\n   */\n  function handleKeyDown(e) {\n    if (disabled) return;\n    let increment = 0;\n\n    switch (e.key) {\n      case 'ArrowUp':\n      case 'ArrowRight':\n        increment = step;\n        e.preventDefault();\n        break;\n      case 'ArrowDown':\n      case 'ArrowLeft':\n        increment = -step;\n        e.preventDefault();\n        break;\n      default:\n        return;\n    }\n\n    // Clamp new value to min-max range\n    value = Math.max(min, Math.min(max, value + increment));\n  }\n\n  // ===== TOUCH INTERACTION HANDLERS =====\n\n  /**\n   * Handle touch start: Same as mouse, but for touch devices\n   * Check e.touches.length === 1 to ignore multi-touch\n   */\n  function handleTouchStart(e) {\n    if (disabled || e.touches.length !== 1) return;\n    isDragging = true;\n    const touch = e.touches[0];\n    updateValueFromPosition(touch.clientX, touch.clientY);\n    document.addEventListener('touchmove', handleTouchMove);\n    document.addEventListener('touchend', handleTouchEnd);\n  }\n\n  /**\n   * Handle touch move while dragging\n   */\n  function handleTouchMove(e) {\n    if (!isDragging || e.touches.length !== 1) return;\n    e.preventDefault();\n    const touch = e.touches[0];\n    updateValueFromPosition(touch.clientX, touch.clientY);\n  }\n\n  /**\n   * Handle touch end: Stop dragging, remove listeners\n   */\n  function handleTouchEnd() {\n    isDragging = false;\n    document.removeEventListener('touchmove', handleTouchMove);\n    document.removeEventListener('touchend', handleTouchEnd);\n  }\n\n  // ===== LIFECYCLE & CLEANUP (Svelte 5 $effect with cleanup) =====\n\n  /**\n   * CLEANUP PATTERN: $effect with return function for cleanup\n   * This runs when component unmounts and removes all global event listeners\n   * Prevents memory leaks if component is destroyed while dragging\n   * REASON: If user is dragging and component unmounts, listeners stay active\n   * This causes \"ghost\" events on the removed component\n   */\n  $effect(() => {\n    // Return cleanup function that runs on unmount\n    return () => {\n      // Remove all possible listeners (important: some may not be attached)\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n      document.removeEventListener('touchmove', handleTouchMove);\n      document.removeEventListener('touchend', handleTouchEnd);\n    };\n  });\n</script>\n\n<!--\n  TEMPLATE STRUCTURE:\n  1. Container div: Layout container with design tokens (CSS custom properties)\n  2. Label: Text below knob for affordance (\"Frequency\", \"Volume\", etc.)\n  3. Button: Interactive element (role=\"slider\" for accessibility)\n     - SVG arc: Visual feedback showing intensity (optional)\n     - Grip div: Rotatable indicator showing current position\n  4. Hidden text: Accessibility help for screen readers\n-->\n\n<div class=\"knob-container\" bind:this={containerElement}>\n  <!-- Display label (no numbers, just semantic text) -->\n  <div class=\"knob-label\">{label}</div>\n\n  <!--\n    ACCESSIBLE BUTTON PATTERN:\n    - role=\"slider\": Tells screen readers this is a slider control\n    - aria-valuemin/max/now: Numeric accessibility info for screen readers\n    - tabindex: 0 = focusable, -1 = not focusable (when disabled)\n    - onmousedown/ontouchstart/onkeydown: Svelte 5 event handlers (no on: directive)\n  -->\n  <button\n    bind:this={knobElement}\n    class=\"knob\"\n    class:dragging={isDragging}\n    class:disabled\n    role=\"slider\"\n    aria-label={ariaLabel}\n    aria-describedby={ariaDescribedBy}\n    aria-valuemin={min}\n    aria-valuemax={max}\n    aria-valuenow={value}\n    aria-valuetext={`${value.toFixed(2)}`}\n    onmousedown={handleMouseDown}\n    ontouchstart={handleTouchStart}\n    onkeydown={handleKeyDown}\n    tabindex={disabled ? -1 : 0}\n  >\n    <!--\n      VISUAL FEEDBACK: Optional arc indicator\n      - Uses stroke-dasharray trick: draws partial arc by limiting dash length\n      - Background arc: 220px dash on 220px total (full circle visible)\n      - Active arc: partial dash based on rotation (shows intensity)\n      - SVG path: M = move to, A = arc, coordinates relative to 100x100 viewBox\n    -->\n    {#if showIntensity}\n      <svg class=\"knob-arc\" viewBox=\"0 0 100 100\">\n        <!-- Background arc (shows full range in faded color) -->\n        <path\n          class=\"arc-background\"\n          d=\"M 50 8 A 42 42 0 0 1 78 78\"\n          stroke=\"var(--color-border)\"\n          stroke-width=\"2\"\n          fill=\"none\"\n          stroke-linecap=\"round\"\n        />\n\n        <!--\n          Active arc (visual progress indicator)\n          stroke-dasharray: \"Xpx 220px\" means: draw X pixels, gap 220-X pixels\n          This creates the visual effect of a partial arc based on rotation %\n          opacity: intensity (0-1) fades arc as value changes\n        -->\n        <path\n          class=\"arc-active\"\n          d=\"M 50 8 A 42 42 0 0 1 78 78\"\n          stroke=\"var(--color-accent)\"\n          stroke-width=\"3\"\n          fill=\"none\"\n          stroke-linecap=\"round\"\n          style=\"stroke-dasharray: {(rotation / 270) * 220}px 220px; opacity: {intensity};\"\n        />\n      </svg>\n    {/if}\n\n    <!--\n      ROTATABLE GRIP INDICATOR\n      - Outer div: Rotates via CSS transform\n      - Inner div: Yellow bar showing current position\n      - CSS animation provides smooth rotation transition\n    -->\n    <div class=\"knob-grip\" style=\"transform: rotate({rotation}deg);\">\n      <div class=\"knob-indicator\"></div>\n    </div>\n  </button>\n\n  <!--\n    ACCESSIBILITY: Hidden help text for screen readers\n    sr-only class: CSS hides visually but keeps for screen readers\n    Provides keyboard instructions for non-obvious interactions\n  -->\n  <div class=\"sr-only\" id=\"{label}-help\">\n    Use arrow keys to adjust. Left/Right for coarse, Up/Down for fine control.\n  </div>\n</div>\n\n<style>\n  /* ============================================================\n     DESIGN TOKENS & CONTAINER\n     ============================================================\n     Svelte 5 scoped styles: CSS custom properties are local to component\n     VINTAGE AESTHETIC: Warm earth tones (cream, taupe, gold)\n     These token names follow convention: --color-*, --shadow-*, --space-*\n  */\n  .knob-container {\n    /* --- DESIGN TOKENS: Color Palette (Vintage Audio Equipment) ---*/\n    --color-cream: #f5f1e8;           /* Background: warm off-white */\n    --color-taupe: #8b8680;           /* Secondary text: muted brown */\n    --color-sage: #9ca89a;            /* Borders: dusty green */\n    --color-warm-brown: #6b5b52;      /* Unused in this component */\n    --color-gold: #d4a574;            /* Accent: warm gold for highlights */\n    --color-deep-brown: #3d3230;      /* Primary text: very dark */\n\n    /* --- SEMANTIC COLOR MAPPINGS ---*/\n    --color-background: var(--color-cream);       /* Container background */\n    --color-surface: #ebe7dd;                      /* Knob face color */\n    --color-text-primary: var(--color-deep-brown); /* Main text */\n    --color-text-secondary: var(--color-taupe);    /* Secondary text (label) */\n    --color-border: var(--color-sage);             /* Knob border & arcs */\n    --color-accent: var(--color-gold);             /* Interactive states */\n\n    /* --- SHADOWS: Depth and affordance ---*/\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08); /* Subtle shadow */\n    --shadow-md: 0 2px 4px rgba(61, 50, 48, 0.12); /* Hover shadow */\n\n    /* --- UTILITIES ---*/\n    --border-radius-md: 4px;\n\n    /* --- LAYOUT ---*/\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n  }\n\n  /* Label text below knob: \"FREQUENCY\", \"VOLUME\", etc. */\n  .knob-label {\n    font-size: 12px;\n    font-weight: 500;\n    color: var(--color-text-secondary);\n    text-transform: uppercase;       /* Makes label LOOK more analog */\n    letter-spacing: 0.5px;           /* Slightly spaced for vintage feel */\n    text-align: center;\n    max-width: 120px;                /* Prevent long labels from breaking layout */\n    line-height: 1.2;\n  }\n\n  /* ============================================================\n     INTERACTIVE KNOB BUTTON\n     ============================================================\n     Core element: 80x80px circular button with visual feedback\n     Uses flexbox to center SVG arc and grip indicator\n  */\n  .knob {\n    /* --- BUTTON RESET ---\n       Remove default browser styling from <button> element\n    */\n    background: none;\n    border: none;\n    padding: 0;\n    margin: 0;\n    cursor: grab;          /* \"Grabbable\" cursor affordance */\n    position: relative;    /* Allows absolute positioning of arc & grip */\n\n    /* --- SHAPE & SIZE ---\n       Circular 80x80px knob, centered content\n    */\n    width: 80px;\n    height: 80px;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    /* --- VISUAL STYLING ---\n       Subtle border and shadow for depth\n    */\n    background: var(--color-surface);\n    border: 2px solid var(--color-border);\n    box-shadow: var(--shadow-sm);\n\n    /* --- ANIMATION ---\n       Smooth transitions for interactive feedback (50ms)\n    */\n    transition: all 0.2s ease-out;\n\n    /* --- ACCESSIBILITY ---\n       Remove default focus ring; we provide custom one\n    */\n    outline: none;\n  }\n\n  /* Hover state: Highlight when user hovers (not dragging) */\n  .knob:hover:not(.disabled) {\n    box-shadow: var(--shadow-md);      /* Elevated shadow on hover */\n    border-color: var(--color-accent); /* Highlight border in gold */\n  }\n\n  /* Keyboard focus: Custom focus indicator for accessibility */\n  .knob:focus-visible {\n    outline: 2px solid var(--color-accent);\n    outline-offset: 4px;\n  }\n\n  /* Dragging state: Pressed-in appearance */\n  .knob.dragging {\n    cursor: grabbing;\n    box-shadow: inset 0 2px 4px rgba(61, 50, 48, 0.15); /* Inset shadow = pressed */\n    border-color: var(--color-accent);\n  }\n\n  /* Disabled state: Opacity and cursor change */\n  .knob.disabled {\n    opacity: 0.5;                              /* Faded appearance */\n    cursor: not-allowed;                       /* Clear interaction unavailable */\n    background: rgba(235, 231, 221, 0.7);     /* Desaturated surface */\n  }\n\n  /* ============================================================\n     VISUAL FEEDBACK: SVG Arc Indicator\n     ============================================================\n     Shows intensity via animated arc (stroke-dasharray trick)\n     Layered on top of knob via absolute positioning\n  */\n  .knob-arc {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    pointer-events: none;  /* Don't interfere with mouse/touch on button */\n  }\n\n  /* Background arc: Shows full range (always visible, faded) */\n  .arc-background {\n    opacity: 0.3;\n  }\n\n  /* Active arc: Animates as value changes (stroke-dasharray updates) */\n  .arc-active {\n    /* Fast animation: 50ms matches button feedback speed */\n    transition: stroke-dasharray 0.05s linear, opacity 0.05s linear;\n  }\n\n  /* ============================================================\n     INTERACTIVE INDICATOR: Rotatable Grip\n     ============================================================\n     Yellow bar rotates with knob: { transform: rotate(Ndeg) }\n     Updated by $derived rotation value in script\n  */\n  .knob-grip {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    /* Smooth rotation (50ms matches arc animation) */\n    transition: transform 0.05s linear;\n  }\n\n  /* Yellow indicator bar (3px wide, 28px tall) */\n  .knob-indicator {\n    position: absolute;\n    width: 3px;\n    height: 28px;\n    background: var(--color-accent);        /* Gold color */\n    border-radius: 2px;                     /* Rounded ends */\n    top: 8px;                               /* Position at top of knob */\n    left: 50%;                              /* Center horizontally */\n    transform: translateX(-50%);            /* Precise centering */\n\n    /* Subtle glow: Creates depth & affordance */\n    box-shadow: 0 0 0 2px rgba(212, 165, 116, 0.2);\n  }\n\n  /* ============================================================\n     ACCESSIBILITY: Screen Reader Only Text\n     ============================================================\n     Hides text visually but keeps for screen reader users\n     Standard WAI-ARIA pattern for hidden descriptive text\n  */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n</style>\n","<script>\n  /**\n   * AGEControl.svelte\n   * Analog Gear Emulation - Postcard Piano's signature vintage character effect\n   *\n   * The AGE knob progressively adds analog warmth and character through:\n   * - Tape saturation (subtle harmonic distortion)\n   * - Frequency rolloff (slight high-frequency loss)\n   * - Subtle modulation (analog tape wow/flutter)\n   *\n   * This creates a numbers-free, perceptual interface for vintage warmth.\n   *\n   * Usage:\n   * <AGEControl bind:ageAmount={ageAmount} />\n   */\n\n  import VintageKnob from '@ui/controls/VintageKnob.svelte';\n\n  let { ageAmount = $bindable(0) } = $props();\n\n  // Derived parameters for audio processing\n  let ageIntensity = $derived(ageAmount / 100);\n  let saturationAmount = $derived(ageIntensity * 0.3); // 0-30% harmonic content\n  let rolloffAmount = $derived(ageIntensity * 1500); // 0-1500 Hz high-frequency rolloff\n  let modulationAmount = $derived(ageIntensity * 0.05); // 0-5% tape wobble\n\n  // Perceptual description (no numbers shown to user)\n  let ageCharacter = $derived.by(() => {\n    if (ageAmount === 0) return 'Digital (pristine)';\n    if (ageAmount < 25) return 'Subtle warmth';\n    if (ageAmount < 50) return 'Warm vintage';\n    if (ageAmount < 75) return 'Rich analog';\n    return 'Heavily aged';\n  });\n\n  // Effect on audio is applied when ageAmount changes\n  // The actual audio processing happens in the parent component or audio state manager\n  $effect(() => {\n    // This triggers when ageAmount changes\n    // Parent component or audio state should listen for this effect\n    // Example: audioState.updateAGE({ saturation, rolloff, modulation })\n  });\n</script>\n\n<div class=\"age-section\">\n  <div class=\"age-header\">\n    <h3 class=\"age-title\">AGE</h3>\n    <div class=\"age-description\">{ageCharacter}</div>\n  </div>\n\n  <div class=\"age-knob-container\">\n    <VintageKnob\n      bind:value={ageAmount}\n      min={0}\n      max={100}\n      step={1}\n      label=\"Vintage Character\"\n      showIntensity={true}\n      ariaLabel=\"AGE - Analog Gear Emulation\"\n      ariaDescribedBy=\"age-help\"\n    />\n  </div>\n\n  <!-- Accessibility help text -->\n  <div class=\"sr-only\" id=\"age-help\">\n    Adjust vintage character from pristine digital to heavily aged analog. Use arrow keys for fine control.\n  </div>\n</div>\n\n<style>\n  .age-section {\n    /* Design tokens */\n    --color-cream: #f5f1e8;\n    --color-taupe: #8b8680;\n    --color-sage: #9ca89a;\n    --color-warm-brown: #6b5b52;\n    --color-gold: #d4a574;\n    --color-deep-brown: #3d3230;\n\n    --color-background: var(--color-cream);\n    --color-surface: #ebe7dd;\n    --color-text-primary: var(--color-deep-brown);\n    --color-text-secondary: var(--color-taupe);\n    --color-border: var(--color-sage);\n    --color-accent: var(--color-gold);\n\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08);\n\n    --space-4: 16px;\n    --space-6: 24px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-background);\n  }\n\n  .age-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n    text-align: center;\n  }\n\n  .age-title {\n    font-size: 24px;\n    font-weight: 700;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 2px;\n    text-transform: uppercase;\n  }\n\n  .age-description {\n    font-size: 12px;\n    color: var(--color-text-secondary);\n    font-style: italic;\n    height: 18px; /* Fixed height to prevent layout shift */\n  }\n\n  .age-knob-container {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n  }\n\n  /* Screen reader only text */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n</style>\n","<script>\n  /**\n   * RoomMicsControl.svelte\n   * Intimate studio ambience controls - Postcard Piano's room character feature\n   *\n   * Controls the balance between close-miked dry signal and ambient room reverb\n   * without exposing numeric parameters. Users hear the effect, not numbers.\n   *\n   * Features:\n   * - Mix: Balance between dry and room ambience (0% = dry, 100% = ambient)\n   * - Decay: How long room reverb sustains (perceptual, not quantitative)\n   *\n   * Usage:\n   * <RoomMicsControl\n   *   bind:roomMix={roomMix}\n   *   bind:roomDecay={roomDecay}\n   * />\n   */\n\n  import VintageKnob from '@ui/controls/VintageKnob.svelte';\n\n  let { roomMix = $bindable(0.3), roomDecay = $bindable(2) } = $props();\n\n  // Derived perceptual descriptions (no numbers shown)\n  let mixCharacter = $derived.by(() => {\n    if (roomMix === 0) return 'Dry (no room)';\n    if (roomMix < 0.2) return 'Close (intimate)';\n    if (roomMix < 0.4) return 'Balanced';\n    if (roomMix < 0.7) return 'Ambient';\n    return 'Lush (full room)';\n  });\n\n  let decayCharacter = $derived.by(() => {\n    if (roomDecay < 1) return 'Short (tight)';\n    if (roomDecay < 2) return 'Medium (natural)';\n    if (roomDecay < 3.5) return 'Long (spacious)';\n    return 'Very long (cathedral)';\n  });\n\n  // Visual intensity for arc indicators\n  let mixIntensity = $derived(roomMix);\n  let decayIntensity = $derived(Math.min(roomDecay / 5, 1)); // Normalize to 0-1\n\n  // Effects are applied when values change\n  // Parent component or audio state should listen for these changes\n  $effect(() => {\n    // Update reverb mix when roomMix changes\n    // Example: audioState.updateRoomMix(roomMix)\n  });\n\n  $effect(() => {\n    // Update reverb decay when roomDecay changes\n    // Example: audioState.updateRoomDecay(roomDecay)\n  });\n</script>\n\n<div class=\"room-section\">\n  <div class=\"room-header\">\n    <h3 class=\"room-title\">Room Mics</h3>\n    <div class=\"room-subtitle\">Ambient Studio Character</div>\n  </div>\n\n  <div class=\"room-controls\">\n    <!-- Mix Control -->\n    <div class=\"control-group\">\n      <VintageKnob\n        bind:value={roomMix}\n        min={0}\n        max={1}\n        step={0.05}\n        label=\"Mix\"\n        showIntensity={true}\n        ariaLabel=\"Room Microphone Mix\"\n        ariaDescribedBy=\"mix-help\"\n      />\n      <div class=\"control-info\">{mixCharacter}</div>\n    </div>\n\n    <!-- Decay Control -->\n    <div class=\"control-group\">\n      <VintageKnob\n        bind:value={roomDecay}\n        min={0.5}\n        max={5}\n        step={0.1}\n        label=\"Decay\"\n        showIntensity={true}\n        ariaLabel=\"Room Reverb Decay Time\"\n        ariaDescribedBy=\"decay-help\"\n      />\n      <div class=\"control-info\">{decayCharacter}</div>\n    </div>\n  </div>\n\n  <!-- Accessibility help text -->\n  <div class=\"sr-only\" id=\"mix-help\">\n    Adjust the balance between dry close-miked signal and ambient room reverb. Left is dry, right is full room.\n  </div>\n  <div class=\"sr-only\" id=\"decay-help\">\n    Adjust how long the room reverb sustains. Left is short and tight, right is long and spacious.\n  </div>\n</div>\n\n<style>\n  .room-section {\n    /* Design tokens */\n    --color-cream: #f5f1e8;\n    --color-taupe: #8b8680;\n    --color-sage: #9ca89a;\n    --color-warm-brown: #6b5b52;\n    --color-gold: #d4a574;\n    --color-deep-brown: #3d3230;\n\n    --color-background: var(--color-cream);\n    --color-surface: #ebe7dd;\n    --color-text-primary: var(--color-deep-brown);\n    --color-text-secondary: var(--color-taupe);\n    --color-border: var(--color-sage);\n    --color-accent: var(--color-gold);\n\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08);\n\n    --space-2: 8px;\n    --space-4: 16px;\n    --space-6: 24px;\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-background);\n    border-top: 1px solid var(--color-border);\n  }\n\n  .room-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n    text-align: center;\n  }\n\n  .room-title {\n    font-size: 18px;\n    font-weight: 700;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 1px;\n    text-transform: uppercase;\n  }\n\n  .room-subtitle {\n    font-size: 11px;\n    color: var(--color-text-secondary);\n    font-style: italic;\n    letter-spacing: 0.5px;\n  }\n\n  .room-controls {\n    display: flex;\n    gap: var(--space-6);\n    justify-content: center;\n    flex-wrap: wrap;\n  }\n\n  .control-group {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-2);\n  }\n\n  .control-info {\n    font-size: 11px;\n    color: var(--color-text-secondary);\n    font-style: italic;\n    text-align: center;\n    height: 14px; /* Fixed height to prevent layout shift */\n    min-width: 100px;\n  }\n\n  /* Screen reader only text */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n</style>\n","<script>\n  /**\n   * TubeSaturationControl.svelte\n   * Warm coloration effect simulating analog tube amplifier distortion\n   *\n   * This effect adds progressive harmonic richness and warmth without digital harshness.\n   * It combines:\n   * - Subtle harmonic distortion (even and odd harmonics)\n   * - Gentle frequency shaping (slight low-end boost, high-end softening)\n   * - Output compensation (maintains volume as saturation increases)\n   *\n   * Numbers-free design: users feel the warmth, not the parameters.\n   *\n   * Usage:\n   * <TubeSaturationControl bind:saturation={saturation} />\n   */\n\n  import VintageKnob from '@ui/controls/VintageKnob.svelte';\n\n  let { saturation = $bindable(0) } = $props();\n\n  // Derived parameters for audio processing\n  let driveAmount = $derived(saturation / 100);\n  let outputCompensation = $derived(1 - (saturation / 100) * 0.2); // Slight output reduction\n  let harmonicContent = $derived(Math.min(saturation * 2, 100)); // Visual indicator\n\n  // Perceptual description (no numbers shown to user)\n  let saturationCharacter = $derived.by(() => {\n    if (saturation === 0) return 'Clean (pristine)';\n    if (saturation < 20) return 'Subtle warmth';\n    if (saturation < 40) return 'Warm glow';\n    if (saturation < 60) return 'Rich saturation';\n    if (saturation < 80) return 'Heavy warmth';\n    return 'Intense coloration';\n  });\n\n  // Effect on audio is applied when saturation changes\n  $effect(() => {\n    // This triggers when saturation changes\n    // Parent component or audio state should listen for this effect\n    // Example: audioState.updateTubeSaturation({ drive, output })\n  });\n</script>\n\n<div class=\"saturation-section\">\n  <div class=\"saturation-header\">\n    <h3 class=\"saturation-title\">Tube Saturation</h3>\n    <div class=\"saturation-description\">{saturationCharacter}</div>\n  </div>\n\n  <div class=\"saturation-knob-container\">\n    <VintageKnob\n      bind:value={saturation}\n      min={0}\n      max={100}\n      step={1}\n      label=\"Warmth\"\n      showIntensity={true}\n      ariaLabel=\"Tube Saturation - Warmth\"\n      ariaDescribedBy=\"saturation-help\"\n    />\n  </div>\n\n  <!-- Optional: Visual harmonic indicator (no numbers!) -->\n  {#if saturation > 0}\n    <div class=\"harmonic-indicator\">\n      <div class=\"harmonic-bar\" style=\"width: {harmonicContent}%;\"></div>\n    </div>\n  {/if}\n\n  <!-- Accessibility help text -->\n  <div class=\"sr-only\" id=\"saturation-help\">\n    Adjust tube saturation for warmth and harmonic richness. Increases from clean to heavily saturated.\n  </div>\n</div>\n\n<style>\n  .saturation-section {\n    /* Design tokens */\n    --color-cream: #f5f1e8;\n    --color-taupe: #8b8680;\n    --color-sage: #9ca89a;\n    --color-warm-brown: #6b5b52;\n    --color-gold: #d4a574;\n    --color-accent-dark: #b8935f;\n    --color-deep-brown: #3d3230;\n\n    --color-background: var(--color-cream);\n    --color-surface: #ebe7dd;\n    --color-text-primary: var(--color-deep-brown);\n    --color-text-secondary: var(--color-taupe);\n    --color-border: var(--color-sage);\n    --color-accent: var(--color-gold);\n\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08);\n\n    --space-4: 16px;\n    --space-6: 24px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-background);\n    border-top: 1px solid var(--color-border);\n  }\n\n  .saturation-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 4px;\n    text-align: center;\n  }\n\n  .saturation-title {\n    font-size: 18px;\n    font-weight: 700;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 1px;\n    text-transform: uppercase;\n  }\n\n  .saturation-description {\n    font-size: 12px;\n    color: var(--color-text-secondary);\n    font-style: italic;\n    height: 18px; /* Fixed height to prevent layout shift */\n  }\n\n  .saturation-knob-container {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n  }\n\n  /* Visual harmonic indicator - shows intensity without numbers */\n  .harmonic-indicator {\n    width: 120px;\n    height: 4px;\n    background: var(--color-surface);\n    border-radius: 2px;\n    overflow: hidden;\n    border: 1px solid var(--color-border);\n    box-shadow: var(--shadow-sm);\n  }\n\n  .harmonic-bar {\n    height: 100%;\n    background: linear-gradient(90deg, var(--color-accent), var(--color-accent-dark));\n    width: 0%;\n    transition: width 0.1s ease-out;\n    border-radius: 2px;\n  }\n\n  /* Screen reader only text */\n  .sr-only {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border-width: 0;\n  }\n</style>\n","<script>\n  /**\n   * ControlPanel.svelte\n   * Numbers-free, vintage-aesthetic control interface\n   *\n   * Redesigned for Postcard Piano aesthetic:\n   * - No numeric value displays (all visual/perceptual feedback)\n   * - Custom VintageKnob components instead of sliders\n   * - Signature features: AGE, Room Mics, Tube Saturation\n   * - Minimal layout with generous whitespace\n   * - Advanced controls hidden by default\n   *\n   * @component\n   */\n\n  import VintageKnob from '@ui/controls/VintageKnob.svelte';\n  import AGEControl from './AGEControl.svelte';\n  import RoomMicsControl from './RoomMicsControl.svelte';\n  import TubeSaturationControl from './TubeSaturationControl.svelte';\n\n  let { audioState = undefined } = $props();\n\n  // Primary control states (numbers-free)\n  let masterVolume = $state(audioState?.pianoState?.masterVolume ?? 0.5);\n  let ageAmount = $state(0);\n  let roomMix = $state(0.3);\n  let roomDecay = $state(2);\n  let saturation = $state(0);\n\n  // Advanced controls (hidden by default)\n  let showAdvanced = $state(false);\n\n  // Advanced control states\n  let attackTime = $state(audioState?.synthesis?.attackTime ?? 0.05);\n  let decayTime = $state(audioState?.synthesis?.decayTime ?? 0.2);\n  let sustainLevel = $state(audioState?.synthesis?.sustainLevel ?? 0.6);\n  let releaseTime = $state(audioState?.synthesis?.releaseTime ?? 1.0);\n  let compressionThreshold = $state(audioState?.effects?.compression?.threshold ?? -24);\n  let compressionRatio = $state(audioState?.effects?.compression?.ratio ?? 4);\n\n  // Update audio state when primary controls change\n  $effect(() => {\n    if (audioState) {\n      audioState.setParameter('pianoState.masterVolume', masterVolume);\n    }\n  });\n\n  $effect(() => {\n    if (audioState) {\n      audioState.setParameter('effects.saturation.amount', saturation / 100);\n    }\n  });\n\n  $effect(() => {\n    if (audioState) {\n      audioState.setParameter('effects.reverb.dryWet', roomMix);\n      audioState.setParameter('effects.reverb.decayTime', roomDecay);\n    }\n  });\n\n  // Advanced control effects\n  $effect(() => {\n    if (audioState && showAdvanced) {\n      audioState.setParameter('synthesis.attackTime', attackTime);\n      audioState.setParameter('synthesis.decayTime', decayTime);\n      audioState.setParameter('synthesis.sustainLevel', sustainLevel);\n      audioState.setParameter('synthesis.releaseTime', releaseTime);\n    }\n  });\n\n  $effect(() => {\n    if (audioState && showAdvanced) {\n      audioState.setParameter('effects.compression.threshold', compressionThreshold);\n      audioState.setParameter('effects.compression.ratio', compressionRatio);\n    }\n  });\n\n  function toggleAdvanced() {\n    showAdvanced = !showAdvanced;\n  }\n</script>\n\n<div class=\"control-panel\">\n  <!-- Master Volume Section -->\n  <section class=\"control-section\">\n    <div class=\"section-header\">\n      <h3 class=\"section-title\">Master Volume</h3>\n    </div>\n\n    <div class=\"knob-container\">\n      <VintageKnob\n        bind:value={masterVolume}\n        min={0}\n        max={1}\n        step={0.05}\n        label=\"Level\"\n        showIntensity={true}\n        ariaLabel=\"Master Volume\"\n      />\n    </div>\n  </section>\n\n  <!-- AGE: Signature Vintage Character Feature -->\n  <AGEControl bind:ageAmount={ageAmount} />\n\n  <!-- Room Mics: Intimate Studio Ambience -->\n  <RoomMicsControl bind:roomMix={roomMix} bind:roomDecay={roomDecay} />\n\n  <!-- Tube Saturation: Warm Coloration -->\n  <TubeSaturationControl bind:saturation={saturation} />\n\n  <!-- Advanced Controls: Collapsible Section -->\n  <section class=\"control-section advanced-section\">\n    <button class=\"advanced-toggle\" onclick={toggleAdvanced}>\n      <span class=\"toggle-label\">\n        {showAdvanced ? '▼' : '▶'} Advanced Controls\n      </span>\n    </button>\n\n    {#if showAdvanced}\n      <div class=\"advanced-content\">\n        <!-- Envelope Section -->\n        <div class=\"subsection\">\n          <h4 class=\"subsection-title\">Envelope (ADSR)</h4>\n\n          <div class=\"knob-grid\">\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={attackTime}\n                min={0}\n                max={0.5}\n                step={0.01}\n                label=\"Attack\"\n                ariaLabel=\"Attack Time\"\n              />\n            </div>\n\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={decayTime}\n                min={0}\n                max={1}\n                step={0.01}\n                label=\"Decay\"\n                ariaLabel=\"Decay Time\"\n              />\n            </div>\n\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={sustainLevel}\n                min={0}\n                max={1}\n                step={0.05}\n                label=\"Sustain\"\n                ariaLabel=\"Sustain Level\"\n              />\n            </div>\n\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={releaseTime}\n                min={0}\n                max={3}\n                step={0.05}\n                label=\"Release\"\n                ariaLabel=\"Release Time\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <!-- Compression Section -->\n        <div class=\"subsection\">\n          <h4 class=\"subsection-title\">Compression</h4>\n\n          <div class=\"knob-grid\">\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={compressionThreshold}\n                min={-60}\n                max={0}\n                step={1}\n                label=\"Threshold\"\n                ariaLabel=\"Compression Threshold\"\n              />\n            </div>\n\n            <div class=\"knob-item\">\n              <VintageKnob\n                bind:value={compressionRatio}\n                min={1}\n                max={20}\n                step={0.5}\n                label=\"Ratio\"\n                ariaLabel=\"Compression Ratio\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    {/if}\n  </section>\n</div>\n\n<style>\n  .control-panel {\n    /* Design tokens - local scope */\n    --color-cream: #f5f1e8;\n    --color-taupe: #8b8680;\n    --color-sage: #9ca89a;\n    --color-warm-brown: #6b5b52;\n    --color-gold: #d4a574;\n    --color-deep-brown: #3d3230;\n\n    --color-background: var(--color-cream);\n    --color-surface: #ebe7dd;\n    --color-text-primary: var(--color-deep-brown);\n    --color-text-secondary: var(--color-taupe);\n    --color-border: var(--color-sage);\n    --color-accent: var(--color-gold);\n\n    --shadow-sm: 0 1px 2px rgba(61, 50, 48, 0.08);\n    --shadow-md: 0 2px 4px rgba(61, 50, 48, 0.12);\n\n    --border-radius-md: 4px;\n\n    --space-2: 8px;\n    --space-3: 12px;\n    --space-4: 16px;\n    --space-6: 24px;\n    --space-8: 32px;\n    display: flex;\n    flex-direction: column;\n    gap: 0;\n    background: var(--color-background);\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: var(--shadow-md);\n  }\n\n  .control-section {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-background);\n\n    /* Separator between sections */\n    border-bottom: 1px solid var(--color-border);\n  }\n\n  .control-section:last-child {\n    border-bottom: none;\n  }\n\n  .section-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--space-2);\n    text-align: center;\n  }\n\n  .section-title {\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--color-text-primary);\n    margin: 0;\n    letter-spacing: 0.5px;\n    text-transform: uppercase;\n  }\n\n  .knob-container {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n  }\n\n  /* Advanced Controls Section */\n  .advanced-section {\n    gap: 0;\n    padding: 0;\n    border-top: 2px solid var(--color-border);\n  }\n\n  .advanced-toggle {\n    /* Reset button styling */\n    background: none;\n    border: none;\n    padding: var(--space-6);\n    margin: 0;\n    cursor: pointer;\n    width: 100%;\n    text-align: left;\n\n    /* Typography */\n    font-family: inherit;\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--color-text-primary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n\n    /* Hover state */\n    transition: background 0.2s ease-out;\n    background: var(--color-surface);\n  }\n\n  .advanced-toggle:hover {\n    background: #e0dbd0;\n  }\n\n  .advanced-toggle:focus-visible {\n    outline: 2px solid var(--color-accent);\n    outline-offset: -2px;\n  }\n\n  .toggle-label {\n    display: flex;\n    align-items: center;\n    gap: var(--space-2);\n  }\n\n  .advanced-content {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-6);\n    padding: var(--space-6);\n    background: var(--color-surface);\n    animation: slideDown 0.2s ease-out;\n  }\n\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-8px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  .subsection {\n    display: flex;\n    flex-direction: column;\n    gap: var(--space-4);\n  }\n\n  .subsection:not(:last-child) {\n    padding-bottom: var(--space-4);\n    border-bottom: 1px solid var(--color-border);\n  }\n\n  .subsection-title {\n    font-size: 12px;\n    font-weight: 600;\n    color: var(--color-text-secondary);\n    margin: 0;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    text-align: center;\n  }\n\n  .knob-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n    gap: var(--space-4);\n    justify-items: center;\n  }\n\n  .knob-item {\n    display: flex;\n    justify-content: center;\n  }\n</style>\n","<!--\n  Main Layout Component\n\n  Renders the complete LoFi Piano UI including:\n  - Piano keyboard\n  - Control panel with effect parameters\n  - Audio state management\n-->\n\n<script>\n  import { onMount } from 'svelte';\n  import { unlockAudioContext } from '$audio/context.js';\n  import { createAudioState } from '$stores/audio-state.svelte.js';\n  import PianoKeyboard from '$components/piano/PianoKeyboard.svelte';\n  import ControlPanel from '$components/controls/ControlPanel.svelte';\n\n  // Create audio state instance\n  const audioState = createAudioState();\n\n  let isReady = $state(false);\n  let error = $state(null);\n  let showControls = $state(true);\n\n  onMount(async () => {\n    try {\n      // Unlock AudioContext for iOS/mobile browsers\n      await unlockAudioContext();\n\n      // Initialize audio system\n      await audioState.init();\n\n      isReady = true;\n      console.log('✓ LoFi Piano initialized');\n      console.log('  - Audio context ready');\n      console.log('  - Effect chain connected');\n      console.log('  - Ready to play');\n    } catch (err) {\n      console.error('Failed to initialize audio:', err);\n      error = err.message;\n    }\n  });\n\n  /**\n   * Toggle control panel visibility\n   */\n  function toggleControls() {\n    showControls = !showControls;\n  }\n</script>\n\n<main>\n  <div class=\"container\">\n    <!-- Header Section -->\n    <div class=\"header\">\n      <h1>🎹 LoFi Piano</h1>\n      <p class=\"subtitle\">Nostalgic warm piano for lo-fi hip-hop beats</p>\n\n      {#if isReady}\n        <div class=\"status-bar\">\n          <span class=\"status-indicator active\">● Live</span>\n          <span class=\"note-count\">\n            {audioState.pianoState.activeNotes.size} notes playing\n          </span>\n          <button class=\"toggle-btn\" onclick={toggleControls}>\n            {showControls ? '▼ Hide Controls' : '▶ Show Controls'}\n          </button>\n        </div>\n      {/if}\n    </div>\n\n    {#if error}\n      <!-- Error State -->\n      <div class=\"error-state\">\n        <p class=\"error-icon\">⚠️</p>\n        <h2>Audio Initialization Failed</h2>\n        <p class=\"error-message\">{error}</p>\n        <p class=\"error-help\">\n          Try refreshing the page or check browser console for details.\n        </p>\n      </div>\n    {:else if isReady}\n      <!-- Main Content -->\n      <div class=\"content\">\n        <!-- Control Panel Section -->\n        {#if showControls}\n          <div class=\"controls-section\">\n            <ControlPanel {audioState} />\n          </div>\n        {/if}\n\n        <!-- Piano Keyboard Section -->\n        <div class=\"keyboard-section\">\n          <PianoKeyboard {audioState} />\n        </div>\n\n        <!-- Info Section -->\n        <div class=\"info-section\">\n          <div class=\"info-card\">\n            <h3>🎵 Getting Started</h3>\n            <ul>\n              <li>Click piano keys to play notes</li>\n              <li>Use QWERTY keys (Z-M) for keyboard playing</li>\n              <li>Adjust controls above to shape your sound</li>\n              <li>Drag across keys for glissando effect</li>\n            </ul>\n          </div>\n\n          <div class=\"info-card\">\n            <h3>🎛️ Quick Tips</h3>\n            <ul>\n              <li><strong>Saturation:</strong> Adds warm, tape-like color</li>\n              <li><strong>Compression:</strong> Controls dynamics</li>\n              <li><strong>Reverb:</strong> Adds space and ambience</li>\n              <li><strong>Envelope:</strong> Shapes note attack and decay</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    {:else}\n      <!-- Loading State -->\n      <div class=\"loading\">\n        <div class=\"spinner\"></div>\n        <p>Initializing audio system...</p>\n        <p class=\"loading-hint\">Click anywhere to unlock audio (iOS/mobile)</p>\n      </div>\n    {/if}\n  </div>\n</main>\n\n<style>\n  main {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    min-height: 100vh;\n    padding: 2rem;\n  }\n\n  .container {\n    max-width: 1400px;\n    width: 100%;\n    background: rgba(30, 41, 59, 0.8);\n    border-radius: 16px;\n    padding: 2rem;\n    border: 1px solid rgba(100, 116, 139, 0.2);\n    backdrop-filter: blur(10px);\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  }\n\n  .header {\n    text-align: center;\n    margin-bottom: 2rem;\n    border-bottom: 2px solid rgba(100, 116, 139, 0.3);\n    padding-bottom: 1.5rem;\n  }\n\n  h1 {\n    font-size: 2.5rem;\n    margin: 0;\n    color: #f1f5f9;\n    font-weight: 700;\n  }\n\n  .subtitle {\n    margin: 0.5rem 0 0;\n    color: #cbd5e1;\n    font-size: 1rem;\n  }\n\n  .status-bar {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 2rem;\n    margin-top: 1rem;\n    padding-top: 1rem;\n  }\n\n  .status-indicator {\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: #94a3b8;\n  }\n\n  .status-indicator.active {\n    color: #22c55e;\n  }\n\n  .note-count {\n    font-size: 0.875rem;\n    color: #cbd5e1;\n    font-weight: 500;\n    padding: 0.25rem 0.75rem;\n    background: rgba(96, 165, 250, 0.1);\n    border-radius: var(--border-radius-sm);\n  }\n\n  .toggle-btn {\n    padding: 0.5rem 1rem;\n    background: rgba(96, 165, 250, 0.1);\n    color: var(--accent);\n    border: 1px solid rgba(96, 165, 250, 0.3);\n    border-radius: var(--border-radius-sm);\n    font-size: 0.875rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n  }\n\n  .toggle-btn:hover {\n    background: rgba(96, 165, 250, 0.2);\n    border-color: rgba(96, 165, 250, 0.5);\n  }\n\n  .toggle-btn:active {\n    transform: scale(0.98);\n  }\n\n  .content {\n    display: flex;\n    flex-direction: column;\n    gap: 2rem;\n  }\n\n  .controls-section {\n    width: 100%;\n  }\n\n  .keyboard-section {\n    width: 100%;\n  }\n\n  .info-section {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 1.5rem;\n    margin-top: 1rem;\n  }\n\n  .info-card {\n    background: rgba(15, 23, 42, 0.4);\n    border: 1px solid rgba(96, 165, 250, 0.1);\n    border-radius: var(--border-radius-md);\n    padding: 1.5rem;\n  }\n\n  .info-card h3 {\n    margin: 0 0 1rem 0;\n    color: var(--accent);\n    font-size: 1rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n  }\n\n  .info-card ul {\n    margin: 0;\n    padding-left: 1.5rem;\n    color: var(--text-secondary);\n    font-size: 0.875rem;\n    line-height: 1.6;\n  }\n\n  .info-card li {\n    margin-bottom: 0.5rem;\n  }\n\n  .info-card strong {\n    color: var(--text-primary);\n    font-weight: 600;\n  }\n\n  .error-state {\n    text-align: center;\n    padding: 4rem 2rem;\n    color: #fca5a5;\n  }\n\n  .error-icon {\n    font-size: 4rem;\n    margin: 0;\n  }\n\n  .error-state h2 {\n    color: #fca5a5;\n    margin: 1rem 0;\n  }\n\n  .error-message {\n    color: #fecaca;\n    font-family: 'Monaco', 'Courier New', monospace;\n    background: rgba(239, 68, 68, 0.1);\n    padding: 1rem;\n    border-radius: var(--border-radius-sm);\n    border: 1px solid rgba(239, 68, 68, 0.3);\n    margin: 1rem 0;\n  }\n\n  .error-help {\n    color: #cbd5e1;\n    font-size: 0.875rem;\n  }\n\n  .loading {\n    text-align: center;\n    color: #cbd5e1;\n    padding: 4rem 2rem;\n  }\n\n  .spinner {\n    width: 50px;\n    height: 50px;\n    margin: 0 auto 1.5rem;\n    border: 4px solid rgba(96, 165, 250, 0.2);\n    border-top-color: var(--accent);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n  }\n\n  @keyframes spin {\n    to {\n      transform: rotate(360deg);\n    }\n  }\n\n  .loading p {\n    margin: 0.5rem 0;\n    color: #cbd5e1;\n    font-size: 1rem;\n  }\n\n  .loading-hint {\n    font-size: 0.875rem;\n    color: #94a3b8;\n    font-style: italic;\n  }\n\n  /* Responsive design */\n  @media (max-width: 1024px) {\n    .container {\n      padding: 1.5rem;\n    }\n\n    h1 {\n      font-size: 2rem;\n    }\n\n    .status-bar {\n      flex-direction: column;\n      gap: 0.75rem;\n    }\n  }\n\n  @media (max-width: 768px) {\n    main {\n      padding: 1rem;\n    }\n\n    .container {\n      padding: 1rem;\n    }\n\n    h1 {\n      font-size: 1.75rem;\n    }\n\n    .subtitle {\n      font-size: 0.875rem;\n    }\n\n    .info-section {\n      grid-template-columns: 1fr;\n    }\n\n    .content {\n      gap: 1.5rem;\n    }\n  }\n</style>\n","<!--\n  LoFi Piano Plugin - Main Page\n\n  This is the single-page app entry point.\n  The entire plugin UI renders on this page.\n-->\n\n<script>\n  import { onMount } from 'svelte';\n  import Layout from '$components/Layout.svelte';\n\n  onMount(() => {\n    console.log('🎹 LoFi Piano loaded');\n  });\n</script>\n\n<Layout />\n\n<style>\n  :global(main) {\n    width: 100%;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n</style>\n"],"names":["pause_effects","state","items","controlled_anchor","items_map","transitions","length","i","pause_children","is_controlled","parent_node","clear_text_content","link","run_out_transitions","item","destroy_effect","each","node","flags","get_collection","get_key","render_fn","fallback_fn","anchor","hydrating","set_hydrate_node","get_first_child","create_text","hydrate_next","fallback","was_empty","offscreen_items","each_array","derived_safe_equal","collection","is_array","array_from","array","each_effect","commit","reconcile","resume_effect","branch","pause_effect","block","active_effect","get","mismatch","is_else","read_hydration_instruction","HYDRATION_START_ELSE","skip_nodes","set_hydrating","prev","hydrate_node","COMMENT_NODE","HYDRATION_END","value","key","create_item","should_defer_append","keys","batch","current_batch","existing","update_item","first","current","seen","matched","stashed","pending","next","move","child_anchor","INERT","start","j","a","b","to_destroy","destroy_length","unused","index","type","internal_set","deferred","reactive","EACH_ITEM_REACTIVE","mutable","EACH_ITEM_IMMUTABLE","v","mutable_source","source","EACH_INDEX_REACTIVE","fragment","end","dest","next_node","get_next_sibling","whitespace","to_class","hash","directives","classname","len","to_style","styles","set_class","dom","is_html","prev_classes","next_classes","next_class_name","is_present","set_style","prev_styles","next_styles","next_style_attr","IS_CUSTOM_ELEMENT","IS_HTML","set_attribute","element","attribute","skip_warning","attributes","get_attributes","LOADING_ATTR_SYMBOL","get_setters","NAMESPACE_HTML","setters_cache","cache_key","setters","descriptors","proto","element_proto","get_descriptors","get_prototype_of","audioContext","getAudioContext","AudioContextClass","unlockAudioContext","ctx","buffer","error","DEFAULT_DETUNE_CENTS","DEFAULT_ATTACK","DEFAULT_DECAY","DEFAULT_SUSTAIN","DEFAULT_RELEASE","FREQUENCY_RAMP_TIME","VELOCITY_RAMP_TIME","MIN_FREQUENCY","MAX_FREQUENCY","createPianoVoice","options","frequency","velocity","attackTime","decayTime","sustainLevel","releaseTime","detuneCents","velocityScale","oscillators","cents","osc","envelope","velocityGain","normalizedVelocity","isPlaying","currentFrequency","currentVelocity","currentDetuning","validateEnvelopeTimes","attack","decay","sustain","release","now","destination","freq","vel","normalizedVel","newDetuneCents","envelopeParams","newAttack","newDecay","newSustain","newRelease","DEFAULT_AMOUNT","DEFAULT_TONE","createSaturation","amount","tone","dryWet","inputGain","dryGain","wetGain","toneFilter","outputGain","currentAmount","currentTone","currentDryWet","applySoftClipping","intensity","factor","sample","processor","event","input","output","newAmount","newGainValue","newTone","newFrequency","newGain","newDryWet","DEFAULT_THRESHOLD","DEFAULT_RATIO","DEFAULT_KNEE","createCompressor","threshold","ratio","knee","compressor","makeupGain","currentThreshold","currentRatio","currentAttack","currentRelease","calculateMakeupGain","maxReduction","newThreshold","newRatio","DEFAULT_DECAY_TIME","DEFAULT_ROOM_SIZE","DEFAULT_PRE_DELAY","DEFAULT_DRY_WET","createReverb","roomSize","preDelay","preDelayNode","delays","delayTimes","delayGains","time","delay","gain","feedbackGain","currentDecayTime","currentRoomSize","currentPreDelay","newDecayTime","newRoomSize","newDelayTime","newPreDelay","createAudioState","pianoVoices","saturationEffect","compressionEffect","reverbEffect","masterGain","pianoState","synthesis","effects","initializeAudio","ensureAudioInitialized","syncSaturation","syncCompression","syncReverb","syncMasterVolume","note","duration","validNote","noteToFrequency","voice","path","obj","lastKey","nodeName","audioState","startNote","keyCount","showNoteNames","showOctaveNumbers","$.prop","$$props","keyboardElement","$.state","isMouseDown","activeKeys","keyboardMapping","createKeyboardMapping","noteNames","getNoteInfo","midiNote","octave","isBlackKey","noteInOctave","handleKeyDown","e","$.set","handleKeyUp","handleMouseEnter","$.get","handleMouseLeave","handleWindowKeyDown","handleWindowKeyUp","cleanup","onMount","generateNotes","notes","$.each","div_1","isBlack","$.derived","noteInfo","noteLabel","$.template_effect","$.set_text","text_1","$$render","consequent","text","consequent_1","$.set_attribute","button","$.bind_this","div","$$value","min","max","step","label","showIntensity","disabled","ariaLabel","ariaDescribedBy","isDragging","knobElement","containerElement","normalizedValue","rotation","angleToNormalized","angle","clientToAngle","clientX","clientY","rect","centerX","centerY","dx","dy","updateValueFromPosition","normalized","handleMouseDown","handleMouseMove","handleMouseUp","increment","handleTouchStart","touch","handleTouchMove","handleTouchEnd","$.user_effect","$.set_style","ageAmount","ageCharacter","roomMix","roomDecay","mixCharacter","decayCharacter","saturation","harmonicContent","saturationCharacter","masterVolume","showAdvanced","compressionThreshold","$.proxy","compressionRatio","toggleAdvanced","isReady","showControls","err","toggleControls","consequent_2","consequent_3","alternate","alternate_1"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}